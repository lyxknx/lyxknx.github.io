<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2022/08/21/hello-world/"/>
    <url>/2022/08/21/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a><br>1111</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>第8周作业-2022-8-9</title>
    <link href="/2022/08/14/%E7%AC%AC8%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-8-9/"/>
    <url>/2022/08/14/%E7%AC%AC8%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-8-9/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第三十一天、第三十二天、第三十三天、第三十三四天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h2 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h2><p>“第三十一天：<br>日志服务管理<br>1rsyslog日志服务管理<br>2rsyslog实现网络日志和MySQL存储日志<br>3基于loganalyzer实现日志的web展示<br>4存储类型和ftp服务工作原理<br>5ftp服务基本配置<br>6ftp服务常见功能实现”<br>“第三十二天：<br> 网络文件共享服务<br>1基于DB数据库文件实现FTP的虚拟用户<br>2基于MySQL数据库文件实现FTP的虚拟用户<br>3NFS服务的工作原理<br>4NFS共享服务实现详解<br>5实现NFS共享存储的LAMP架构<br>6autofs实现自动挂载<br>7samba服务实现网络共享<br>8利用inotify和rsync服务实现数据实时同步”<br>“第三十三天：<br>企业级调度器lvs<br>1利用sesync实现数据实时同步<br>2集群和分布式架构介绍<br>3LVS的NAT工作模式实现原理<br>4LVS的DR和TUN工作模式实现原理<br>5LVS的12种调度算法和ipvsadm命令使用<br>6LVS的NAT实战案例<br>7LVS的DR模式单网段实战案例”<br>“第三十四天：<br>高性能服务器nginx<br>1LVS的跨网段实现<br>2LVS的防火墙标记和持久连接及高可用实现<br>3web服务和IO介绍<br>4IO复用模型<br>5nginx的架构和安装<br>6nginx的编译安装和nginx信号管理<br>7nginx平滑升级及基本配置”    </p><h2 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h2><p>“1. 完成ftp的mysql虚拟用户</p><ol start="2"><li>完成rsyslog远程日志收集，及采集mysql日志。</li><li>解析ftp主动和被动模式工作原理。</li><li>利用sesync, inotify分别实现数据备份。</li><li>解析LVS调度算法及几种工作模式原理，实现LVS+DR高可用nginx。</li><li>完成nginx编译安装及平滑升级。”</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>文本处理工具</title>
    <link href="/2022/08/11/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/"/>
    <url>/2022/08/11/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><h3 id="去掉第一列"><a href="#去掉第一列" class="headerlink" title="去掉第一列"></a>去掉第一列</h3><figure class="highlight llvm"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@node2</span> test]# docker <span class="hljs-keyword">load</span> -i <span class="hljs-type">i6000</span>-angular-front_<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>.tar <br>Loaded image: registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> test]# docker <span class="hljs-keyword">load</span> -i <span class="hljs-type">i6000</span>-angular-front_<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>.tar  &gt; loaded.txt<br>[root<span class="hljs-title">@node2</span> test]# cat loaded.txt <br>Loaded image: registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> test]# cat loaded.txt |awk &#x27;BEGIN&#123;FS<span class="hljs-operator">=</span>OFS<span class="hljs-operator">=</span><span class="hljs-string">&quot;/&quot;</span>&#125;&#123;$<span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">;print $0&#125;&#x27;</span><br>/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br></code></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">awk &#x27;<span class="hljs-type">BEGIN</span>&#123;<span class="hljs-type">FS</span><span class="hljs-operator">=</span><span class="hljs-type">OFS</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;/&quot;</span>&#125;&#123;<span class="hljs-variable">$1</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span>;print <span class="hljs-variable">$0</span>&#125;&#x27;      <span class="hljs-comment">// 以斜线为分隔符，分割后，去掉第一列，保留其余部分（第一列是南瑞的仓库地址）</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>脚本方式一键升级平台服务包</title>
    <link href="/2022/08/07/%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7%E5%B9%B3%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%8C%85/"/>
    <url>/2022/08/07/%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E4%B8%80%E9%94%AE%E5%8D%87%E7%BA%A7%E5%B9%B3%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>2022-8-11更新</p><figure class="highlight bash"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: tianyonghui</span><br><span class="hljs-comment">#Date: 2022-07-22</span><br><span class="hljs-comment">#Description： 单个平台包的升级</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment"># 根据提示，手动输入要升级的tar包名称，使用read从标准输入中读取值</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Please input your packageName: &quot;</span> Pkg<br><br><span class="hljs-comment"># 根据读入的Pkg文字信息，定义相关变量</span><br>TarName=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Pkg</span>&quot;</span> |awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>`<br>ServiceName=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TarName</span>&quot;</span>|awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>`<br>TAG=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print$2&#125;&#x27;</span>|awk -v FS=<span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&#x27;&#123;print$1FS$2FS$3FS$4&#125;&#x27;</span>`<br><br><span class="hljs-comment"># 根据load的记录，定义镜像id变量</span><br>docker load -i <span class="hljs-variable">$Pkg</span><br>ImagesId=`docker images|grep <span class="hljs-variable">$ServiceName</span> |grep <span class="hljs-variable">$TAG</span> | awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>`<br><br><span class="hljs-comment"># 将load的最后一行信息导出到文件，定义镜像id变量</span><br>sig_log=Sig_`<span class="hljs-built_in">date</span> +%F_%T`<br><span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$sig_log</span><br>docker load -i <span class="hljs-variable">$Pkg</span> &gt; <span class="hljs-variable">$sig_log</span>/loaded.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span> &gt; <span class="hljs-variable">$sig_log</span>/TarName.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ServiceName</span> &gt; <span class="hljs-variable">$sig_log</span>/ServiceName.txt <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$TAG</span> &gt; <span class="hljs-variable">$sig_log</span>/TAG.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ImagesId</span> &gt; <span class="hljs-variable">$sig_log</span>/ImagesId.txt<br><br><br><span class="hljs-comment"># 打标签</span><br><span class="hljs-comment"># docker tag 镜像id 仓库名/镜像名:标签</span><br><br>sgmc=cr.registry.res.sgmc.sgcc.com.cn     <br>sub_address=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$sig_log</span>/loaded.txt |awk <span class="hljs-string">&#x27;BEGIN&#123;FS=OFS=&quot;/&quot;&#125;&#123;$1=&quot;&quot;;print $0&#125;&#x27;</span>`  <br>registry_Address=<span class="hljs-string">&quot;<span class="hljs-variable">$sgmc</span>&quot;</span><span class="hljs-string">&quot;<span class="hljs-variable">$sub_address</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$sub_address</span> &gt; <span class="hljs-variable">$sig_log</span>/sub_address.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$registry_Address</span> &gt; <span class="hljs-variable">$sig_log</span>/registry_Address.txt<br><br>docker tag <span class="hljs-variable">$ImagesId</span> <span class="hljs-variable">$registry_Address</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span> |grep <span class="hljs-variable">$TAG</span> &gt; <span class="hljs-variable">$sig_log</span>/Taged.txt<br><br><span class="hljs-comment">#推送镜像到仓库</span><br>docker push <span class="hljs-variable">$registry_Address</span><br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@node2 test]# <span class="hljs-keyword">sh</span> -<span class="hljs-keyword">x</span> update_pkg.<span class="hljs-keyword">sh</span> <br>+ <span class="hljs-keyword">read</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;Please input your packageName: &#x27;</span> Pkg<br>Please <span class="hljs-built_in">input</span> your packageName: /test/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>++ <span class="hljs-keyword">echo</span> /test/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>++ awk -F / <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span><br>+ TarName=i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>++ <span class="hljs-keyword">echo</span> i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>++ awk -F / <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span><br>++ awk -F _ <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span><br>+ ServiceName=i6000-angular-front<br>++ <span class="hljs-keyword">echo</span> i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>++ awk -F _ <span class="hljs-string">&#x27;&#123;print$2&#125;&#x27;</span><br>++ awk -v FS=. <span class="hljs-string">&#x27;&#123;print$1FS$2FS$3FS$4&#125;&#x27;</span><br>+ TAG=<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>+ docker load -i /test/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br><span class="hljs-number">2</span>edcec3590a4: Loading layer [==================================================&gt;] <span class="hljs-number">83.86</span> MB/<span class="hljs-number">83.86</span> MB<br>e379e8aedd4d: Loading layer [==================================================&gt;]    <span class="hljs-number">62</span> MB/<span class="hljs-number">62</span> MB<br>b8d6e692a25e: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br>f1db227348d0: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">32</span>ce5f6a5106: Loading layer [==================================================&gt;] <span class="hljs-number">3.584</span> kB/<span class="hljs-number">3.584</span> kB<br>d874fd2bc83b: Loading layer [==================================================&gt;] <span class="hljs-number">7.168</span> kB/<span class="hljs-number">7.168</span> kB<br><span class="hljs-number">6</span>bde2ade907f: Loading layer [==================================================&gt;] <span class="hljs-number">157.9</span> MB/<span class="hljs-number">157.9</span> MB<br><span class="hljs-number">2239</span>ae925798: Loading layer [==================================================&gt;]  <span class="hljs-number">5.12</span> kB/<span class="hljs-number">5.12</span> kB<br><span class="hljs-number">9</span>d31d3f13b68: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">9</span>a26e8d4441e: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">716842</span>aa424f: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">93</span>a1ee32972b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br>a48958a8796b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">52516</span>cae62cd: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">39</span>f1b624a342: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>b79772e475a9: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br><span class="hljs-number">4</span>df452a05af3: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>++ docker images<br>++ <span class="hljs-keyword">grep</span> i6000-angular-front<br>++ <span class="hljs-keyword">grep</span> <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>++ awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span><br>+ ImagesId=<span class="hljs-number">5</span>c178accd6df<br>++ date +%F_%T<br>+ sig_log=Sig_2022-<span class="hljs-number">08</span>-<span class="hljs-number">11</span>_12:<span class="hljs-number">42</span>:<span class="hljs-number">02</span><br>+ <span class="hljs-built_in">mkdir</span> Sig_2022-<span class="hljs-number">08</span>-<span class="hljs-number">11</span>_12:<span class="hljs-number">42</span>:<span class="hljs-number">02</span><br>+ docker load -i /test/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>+ <span class="hljs-keyword">echo</span> i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br>+ <span class="hljs-keyword">echo</span> i6000-angular-front<br>+ <span class="hljs-keyword">echo</span> <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>+ <span class="hljs-keyword">echo</span> <span class="hljs-number">5</span>c178accd6df<br>+ sgmc=<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span><br>++ <span class="hljs-keyword">cat</span> Sig_2022-<span class="hljs-number">08</span>-<span class="hljs-number">11</span>_12:<span class="hljs-number">42</span>:<span class="hljs-number">02</span>/loaded.txt<br>++ awk <span class="hljs-string">&#x27;BEGIN&#123;FS=OFS=&quot;/&quot;&#125;&#123;$1=&quot;&quot;;print $0&#125;&#x27;</span><br>+ sub_address=/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>+ registry_Address=<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>+ <span class="hljs-keyword">echo</span> /i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>+ <span class="hljs-keyword">echo</span> <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>+ docker <span class="hljs-keyword">tag</span> <span class="hljs-number">5</span>c178accd6df <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>+ docker images<br>+ <span class="hljs-keyword">grep</span> i6000-angular-front<br>+ <span class="hljs-keyword">grep</span> <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>+ docker push <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>The push refers <span class="hljs-keyword">to</span> <span class="hljs-keyword">a</span> repository [<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-front]<br>Get https://<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/v1/_ping: dial tcp: lookup <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span> <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">no</span> such host<br></code></pre></td></tr></table></figure><p>2022-8-9更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@node2 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># cat multiple_update_pkg.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment"># 读取文件file1中的带有绝对路径的tar包列表，并加载tar包</span><br><span class="hljs-keyword">for</span> Pkg <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> ./tar_list.txt`;<span class="hljs-keyword">do</span> docker load -i <span class="hljs-variable">$Pkg</span>;<span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 根据load的记录，定义相关变量</span><br>mul_log=Mul`<span class="hljs-built_in">date</span> +%F_%T`<br><span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$mul_log</span><br>docker load -i <span class="hljs-variable">$Pkg</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/loaded.txt<br>version=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$mul_log</span>/loaded.txt |<span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot;:&quot;</span> -f3`<br>ServiceName=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$mul_log</span>/loaded.txt |awk -F <span class="hljs-string">&quot;/|:&quot;</span> <span class="hljs-string">&#x27;&#123;print$5&#125;&#x27;</span>`<br>ImagesId=`docker images|grep <span class="hljs-variable">$ServiceName</span>|grep <span class="hljs-variable">$version</span>|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>`<br>sub_Address=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$mul_log</span>/loaded.txt |awk <span class="hljs-string">&#x27;BEGIN&#123;FS=OFS=&quot;/&quot;&#125;&#123;$1=&quot;&quot;;print $0&#125;&#x27;</span>`<br>sgmc=cr.registry.res.sgmc.sgcc.com.cn<br>registry_Address=$sgmc<span class="hljs-variable">$sub_Address</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$Pkg</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/Pkg.txt <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/version.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ServiceName</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/ServiceName.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ImagesId</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/ImagesId.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$registry_Address</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/registry_Address.txt<br><br><span class="hljs-comment"># 打标签</span><br>docker tag <span class="hljs-variable">$ImagesId</span> <span class="hljs-variable">$registry_Address</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span> |grep <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$mul_log</span>/Taged.txt<br><br><span class="hljs-comment">#推送镜像到仓库</span><br>docker push <span class="hljs-variable">$registry_Address</span><br></code></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[root@node2 test]</span># <span class="hljs-selector-tag">sh</span> <span class="hljs-selector-tag">multiple_update_pkg</span><span class="hljs-selector-class">.sh</span> <br><span class="hljs-number">2</span><span class="hljs-selector-tag">edcec3590a4</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">83.86</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">83.86</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-selector-tag">e379e8aedd4d</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span>    <span class="hljs-number">62</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">62</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-selector-tag">b8d6e692a25e</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">f1db227348d0</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">32</span><span class="hljs-selector-tag">ce5f6a5106</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.584</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.584</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">d874fd2bc83b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">7.168</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">7.168</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">6</span><span class="hljs-selector-tag">bde2ade907f</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">157.9</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">157.9</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-number">2239</span><span class="hljs-selector-tag">ae925798</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span>  <span class="hljs-number">5.12</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.12</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">9</span><span class="hljs-selector-tag">d31d3f13b68</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">9</span><span class="hljs-selector-tag">a26e8d4441e</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">716842</span><span class="hljs-selector-tag">aa424f</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">93</span><span class="hljs-selector-tag">a1ee32972b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">a48958a8796b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">52516</span><span class="hljs-selector-tag">cae62cd</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">39</span><span class="hljs-selector-tag">f1b624a342</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">b79772e475a9</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">4</span><span class="hljs-selector-tag">df452a05af3</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">Loaded</span> <span class="hljs-selector-tag">image</span>: <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.nrxt</span><span class="hljs-selector-class">.com</span>/<span class="hljs-selector-tag">i6000</span>/<span class="hljs-selector-tag">i6000-public</span>/<span class="hljs-selector-tag">i6000-angular-front</span>:<span class="hljs-number">2.0</span><span class="hljs-selector-class">.26</span><span class="hljs-selector-class">.20220424163738</span><br><span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">push</span> <span class="hljs-selector-tag">refers</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">repository</span> <span class="hljs-selector-attr">[cr.registry.res.sgmc.sgcc.com.cn/i6000/i6000-public/i6000-angular-front]</span><br><span class="hljs-selector-tag">Get</span> <span class="hljs-selector-tag">https</span>:<span class="hljs-comment">//cr.registry.res.sgmc.sgcc.com.cn/v1/_ping: dial tcp: lookup cr.registry.res.sgmc.sgcc.com.cn on 192.168.23.254:53: no such host</span><br></code></pre></td></tr></table></figure><p>脚本执行后，会在当前目录下生成一个目录，记录了执行过程中的数据</p><p><img src="image-20220810000214379.png" alt="image-20220810000214379"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs llvm">通过导出文件中记录的信息，调试阶段可以查看其中信息进行确认升级是否正常。<br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat ImagesId.txt <br><span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df<br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat loaded.txt <br>Loaded image: registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat Pkg.txt <br>/test/<span class="hljs-type">i6000</span>-angular-front_<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>.tar<br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat registry_Address.txt <br>cr.registry.res.sgmc.sgcc.com.cn/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat ServiceName.txt <br><span class="hljs-type">i6000</span>-angular-front<br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat Taged.txt <br>cr.registry.res.sgmc.sgcc.com.cn/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front                  <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>[root<span class="hljs-title">@node2</span> Mul<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:<span class="hljs-number">56</span>]# cat version.txt <br><span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br></code></pre></td></tr></table></figure><p>是否可以实现多个包在生产环境执行，还待测试验证。</p><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#升级单个tar包：</span><br>[root@node2 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># cat update_pkg.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: tianyonghui</span><br><span class="hljs-comment">#Date: 2022-07-22</span><br><span class="hljs-comment">#Description： 单个平台包的升级</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment"># 根据提示，手动输入要升级的tar包名称，使用read从标准输入中读取值</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Please input your packageName: &quot;</span> Pkg<br><br><span class="hljs-comment">#加载tar包</span><br>docker load -i <span class="hljs-variable">$Pkg</span><br><br><span class="hljs-comment"># 根据load的记录，定义相关变量</span><br>Sig_log=Sig`<span class="hljs-built_in">date</span> +%F_%T`<br><span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$Sig_log</span><br>docker load -i <span class="hljs-variable">$Pkg</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/loaded.txt<br>version=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$Sig_log</span>/loaded.txt |<span class="hljs-built_in">cut</span> -d<span class="hljs-string">&quot;:&quot;</span> -f3`<br>ServiceName=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$Sig_log</span>/loaded.txt |awk -F <span class="hljs-string">&quot;/|:&quot;</span> <span class="hljs-string">&#x27;&#123;print$5&#125;&#x27;</span>`<br>ImagesId=`docker images|grep <span class="hljs-variable">$ServiceName</span>|grep <span class="hljs-variable">$version</span>|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>`<br>sub_Address=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$Sig_log</span>/loaded.txt |awk <span class="hljs-string">&#x27;BEGIN&#123;FS=OFS=&quot;/&quot;&#125;&#123;$1=&quot;&quot;;print $0&#125;&#x27;</span>`<br>sgmc=cr.registry.res.sgmc.sgcc.com.cn<br>registry_Address=$sgmc<span class="hljs-variable">$sub_Address</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$Pkg</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/Pkg.txt <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/version.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ServiceName</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/ServiceName.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ImagesId</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/ImagesId.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$registry_Address</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/registry_Address.txt<br><br><span class="hljs-comment"># 打标签</span><br>docker tag <span class="hljs-variable">$ImagesId</span> <span class="hljs-variable">$registry_Address</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span> |grep <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$Sig_log</span>/Taged.txt<br><br><span class="hljs-comment">#推送镜像到仓库</span><br>docker push <span class="hljs-variable">$registry_Address</span><br></code></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[root@node2 test]</span># <span class="hljs-selector-tag">sh</span> <span class="hljs-selector-tag">update_pkg</span><span class="hljs-selector-class">.sh</span> <br><span class="hljs-selector-tag">Please</span> <span class="hljs-selector-tag">input</span> <span class="hljs-selector-tag">your</span> <span class="hljs-selector-tag">packageName</span>: <span class="hljs-selector-tag">i6000-angular-front_2</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.26</span><span class="hljs-selector-class">.20220424163738</span><span class="hljs-selector-class">.tar</span><br><span class="hljs-number">2</span><span class="hljs-selector-tag">edcec3590a4</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">83.86</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">83.86</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-selector-tag">e379e8aedd4d</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span>    <span class="hljs-number">62</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">62</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-selector-tag">b8d6e692a25e</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">f1db227348d0</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">32</span><span class="hljs-selector-tag">ce5f6a5106</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.584</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.584</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">d874fd2bc83b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">7.168</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">7.168</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">6</span><span class="hljs-selector-tag">bde2ade907f</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">157.9</span> <span class="hljs-selector-tag">MB</span>/<span class="hljs-number">157.9</span> <span class="hljs-selector-tag">MB</span><br><span class="hljs-number">2239</span><span class="hljs-selector-tag">ae925798</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span>  <span class="hljs-number">5.12</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.12</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">9</span><span class="hljs-selector-tag">d31d3f13b68</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.096</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">9</span><span class="hljs-selector-tag">a26e8d4441e</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">716842</span><span class="hljs-selector-tag">aa424f</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">93</span><span class="hljs-selector-tag">a1ee32972b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">a48958a8796b</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">52516</span><span class="hljs-selector-tag">cae62cd</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">5.632</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">39</span><span class="hljs-selector-tag">f1b624a342</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">b79772e475a9</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">3.072</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-number">4</span><span class="hljs-selector-tag">df452a05af3</span>: <span class="hljs-selector-tag">Loading</span> <span class="hljs-selector-tag">layer</span> <span class="hljs-selector-attr">[==================================================&gt;]</span> <span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span>/<span class="hljs-number">4.608</span> <span class="hljs-selector-tag">kB</span><br><span class="hljs-selector-tag">Loaded</span> <span class="hljs-selector-tag">image</span>: <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.nrxt</span><span class="hljs-selector-class">.com</span>/<span class="hljs-selector-tag">i6000</span>/<span class="hljs-selector-tag">i6000-public</span>/<span class="hljs-selector-tag">i6000-angular-front</span>:<span class="hljs-number">2.0</span><span class="hljs-selector-class">.26</span><span class="hljs-selector-class">.20220424163738</span><br><span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">push</span> <span class="hljs-selector-tag">refers</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">repository</span> <span class="hljs-selector-attr">[cr.registry.res.sgmc.sgcc.com.cn/i6000/i6000-public/i6000-angular-front]</span><br><span class="hljs-selector-tag">Get</span> <span class="hljs-selector-tag">https</span>:<span class="hljs-comment">//cr.registry.res.sgmc.sgcc.com.cn/v1/_ping: dial tcp: lookup cr.registry.res.sgmc.sgcc.com.cn on 192.168.23.254:53: no such host</span><br></code></pre></td></tr></table></figure><p><img src="image-20220810000511284.png" alt="image-20220810000511284"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat ImagesId.txt <br><span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df<br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat loaded.txt <br>Loaded image: registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat Pkg.txt <br><span class="hljs-type">i6000</span>-angular-front_<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>.tar<br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat registry_Address.txt <br>cr.registry.res.sgmc.sgcc.com.cn/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front:<span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat ServiceName.txt <br><span class="hljs-type">i6000</span>-angular-front<br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat Taged.txt <br>cr.registry.res.sgmc.sgcc.com.cn/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>registry.nrxt.com/<span class="hljs-type">i6000</span>/<span class="hljs-type">i6000</span>-public/<span class="hljs-type">i6000</span>-angular-front                  <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">178</span>accd<span class="hljs-number">6</span>df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>[root<span class="hljs-title">@node2</span> Sig<span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-09</span>_<span class="hljs-number">11</span>:<span class="hljs-number">54</span>:<span class="hljs-number">28</span>]# cat version.txt <br><span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span><br></code></pre></td></tr></table></figure><p>===============================</p><p>2022-8-8</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-number">1</span>、docker load -i tar包                             // 加载镜像<br>   docker images |grep tar包名称中的部分文字信息<br><span class="hljs-number">2</span>、docker <span class="hljs-keyword">tag</span> <span class="hljs-title">ImageId</span> 要推送至阿里云仓库的地址         // 打标签<br>ImageId是从步骤<span class="hljs-number">2</span>中查看到的，<br>要推送至阿里云仓库的地址，需要步骤<span class="hljs-number">2</span>中查到的地址:<span class="hljs-keyword">TAG</span><br><span class="hljs-title">3</span>、docker push 地址:<span class="hljs-keyword">TAG</span>                               <span class="hljs-title">// 推送镜像至仓库</span><br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs vim"># <span class="hljs-number">1</span>、加载镜像<br>[root@node2 <span class="hljs-keyword">shell</span>]# docker load -i /test/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br><span class="hljs-number">2</span>edcec3590a4: Loading layer [==================================================&gt;] <span class="hljs-number">83.86</span> MB/<span class="hljs-number">83.86</span> MB<br>e379e8aedd4d: Loading layer [==================================================&gt;]    <span class="hljs-number">62</span> MB/<span class="hljs-number">62</span> MB<br>b8d6e692a25e: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br>f1db227348d0: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">32</span>ce5f6a5106: Loading layer [==================================================&gt;] <span class="hljs-number">3.584</span> kB/<span class="hljs-number">3.584</span> kB<br>d874fd2bc83b: Loading layer [==================================================&gt;] <span class="hljs-number">7.168</span> kB/<span class="hljs-number">7.168</span> kB<br><span class="hljs-number">6</span>bde2ade907f: Loading layer [==================================================&gt;] <span class="hljs-number">157.9</span> MB/<span class="hljs-number">157.9</span> MB<br><span class="hljs-number">2239</span>ae925798: Loading layer [==================================================&gt;]  <span class="hljs-number">5.12</span> kB/<span class="hljs-number">5.12</span> kB<br><span class="hljs-number">9</span>d31d3f13b68: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">9</span>a26e8d4441e: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">716842</span>aa424f: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">93</span>a1ee32972b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br>a48958a8796b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">52516</span>cae62cd: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">39</span>f1b624a342: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>b79772e475a9: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br><span class="hljs-number">4</span>df452a05af3: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br><br>[root@node2 <span class="hljs-keyword">shell</span>]# docker images|<span class="hljs-keyword">grep</span> i6000-angular-front<br>registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br><br># <span class="hljs-number">2</span>、打标签<br>[root@node2 <span class="hljs-keyword">shell</span>]# docker <span class="hljs-keyword">tag</span> <span class="hljs-number">5</span>c178accd6df <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br><br>[root@node2 <span class="hljs-keyword">shell</span>]# docker images|<span class="hljs-keyword">grep</span> i6000-angular-front<br><span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-front                  <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br><br># <span class="hljs-number">3</span>、推送镜像至仓库<br>[root@node2 <span class="hljs-keyword">shell</span>]# docker push <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>The push refers <span class="hljs-keyword">to</span> <span class="hljs-keyword">a</span> repository [<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-front]<br>Get https://<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/v1/_ping: dial tcp: lookup <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span> <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">no</span> such host        // 虚拟机试验环境，未能推送成功<br></code></pre></td></tr></table></figure><h2 id="脚本方式，单个平台包的升级"><a href="#脚本方式，单个平台包的升级" class="headerlink" title="脚本方式，单个平台包的升级"></a>脚本方式，单个平台包的升级</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@node2 shell]<span class="hljs-comment"># cat update_pkg.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: tianyonghui</span><br><span class="hljs-comment">#Date: 2022-07-22</span><br><span class="hljs-comment">#Description： 单个平台包的升级</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment"># 根据提示，手动输入要升级的tar包名称，使用read从标准输入中读取值</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Please input your packageName: &quot;</span> TarName<br><br><span class="hljs-comment"># 根据tar包元素，定义相关变量</span><br>ServiceName=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span>|awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>`<br><span class="hljs-built_in">mkdir</span> <span class="hljs-string">&quot;`date +%F`_<span class="hljs-variable">$ServiceName</span>&quot;</span><br><span class="hljs-built_in">dir</span>=$<span class="hljs-string">&quot;`date +%F`_<span class="hljs-variable">$ServiceName</span>&quot;</span><br>version=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print$2&#125;&#x27;</span>|awk -v FS=<span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&#x27;&#123;print$1FS$2FS$3FS$4&#125;&#x27;</span>`<br><br><span class="hljs-comment"># 加载tar包、定义相关的变量，并将变量记录到文件中</span><br>docker load -i <span class="hljs-variable">$TarName</span> <br>docker images |grep <span class="hljs-variable">$ServiceName</span> &gt;&gt; <span class="hljs-variable">$dir</span>/images.txt<br>ImagesId=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$dir</span>/images.txt|<span class="hljs-built_in">head</span> -1|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>`<br>Tag=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$dir</span>/images.txt  |<span class="hljs-built_in">head</span> -1|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>sub_address=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$dir</span>/images.txt  |<span class="hljs-built_in">head</span> -1|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>|awk <span class="hljs-string">&#x27;BEGIN&#123;FS=OFS=&quot;/&quot;&#125;&#123;$1=&quot;&quot;;print $0&#125;&#x27;</span>`  <br>sgmc=cr.registry.res.sgmc.sgcc.com.cn<br>registry_Address=$sgmc<span class="hljs-variable">$sub_address</span>:<span class="hljs-variable">$Tag</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span> &gt;&gt; <span class="hljs-variable">$dir</span>/TarName.txt &amp;&amp; <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$dir</span>/version.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ServiceName</span> &gt;&gt; <span class="hljs-variable">$dir</span>/ServiceName.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ImagesId</span> &gt;&gt; <span class="hljs-variable">$dir</span>/ImagesId.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$registry_Address</span> &gt;&gt; <span class="hljs-variable">$dir</span>/registry_Address.txt<br><br><span class="hljs-comment"># 打标签</span><br>docker tag <span class="hljs-variable">$ImagesId</span> <span class="hljs-variable">$registry_Address</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span><br><br><span class="hljs-comment">#推送镜像到仓库</span><br>docker push <span class="hljs-variable">$registry_Address</span><br></code></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">awk &#x27;<span class="hljs-type">BEGIN</span>&#123;<span class="hljs-type">FS</span><span class="hljs-operator">=</span><span class="hljs-type">OFS</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;/&quot;</span>&#125;&#123;<span class="hljs-variable">$1</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span>;print <span class="hljs-variable">$0</span>&#125;&#x27;      <span class="hljs-comment">// 以斜线为分隔符，分割后，去掉第一列，保留其余部分（第一列是南瑞的仓库地址）</span><br></code></pre></td></tr></table></figure><p>执行脚本时的反馈信息</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@node2 <span class="hljs-keyword">shell</span>]# <span class="hljs-keyword">sh</span> update_pkg.<span class="hljs-keyword">sh</span> <br>Please <span class="hljs-built_in">input</span> your packageName: /test/<span class="hljs-keyword">shell</span>/i6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar    // 敲入tar包的绝对路径<br><span class="hljs-number">2</span>edcec3590a4: Loading layer [==================================================&gt;] <span class="hljs-number">83.86</span> MB/<span class="hljs-number">83.86</span> MB<br>e379e8aedd4d: Loading layer [==================================================&gt;]    <span class="hljs-number">62</span> MB/<span class="hljs-number">62</span> MB<br>b8d6e692a25e: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br>f1db227348d0: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">32</span>ce5f6a5106: Loading layer [==================================================&gt;] <span class="hljs-number">3.584</span> kB/<span class="hljs-number">3.584</span> kB<br>d874fd2bc83b: Loading layer [==================================================&gt;] <span class="hljs-number">7.168</span> kB/<span class="hljs-number">7.168</span> kB<br><span class="hljs-number">6</span>bde2ade907f: Loading layer [==================================================&gt;] <span class="hljs-number">157.9</span> MB/<span class="hljs-number">157.9</span> MB<br><span class="hljs-number">2239</span>ae925798: Loading layer [==================================================&gt;]  <span class="hljs-number">5.12</span> kB/<span class="hljs-number">5.12</span> kB<br><span class="hljs-number">9</span>d31d3f13b68: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">9</span>a26e8d4441e: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">716842</span>aa424f: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">93</span>a1ee32972b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br>a48958a8796b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">52516</span>cae62cd: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">39</span>f1b624a342: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>b79772e475a9: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br><span class="hljs-number">4</span>df452a05af3: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br><span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-front                  <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>The push refers <span class="hljs-keyword">to</span> <span class="hljs-keyword">a</span> repository [<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-public/i6000-angular-front]<br>Get https://<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/v1/_ping: dial tcp: lookup <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span> <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">no</span> such host       // 推送镜像到仓库这个步骤，需要到接近生产的环境，进行测试验证<br></code></pre></td></tr></table></figure><h2 id="批量升级平台包"><a href="#批量升级平台包" class="headerlink" title="批量升级平台包"></a>批量升级平台包</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 先将要升级的tar包，填写到一个文件中，一行只写一个tar包</span><br>[root@node2 test]<span class="hljs-comment"># cat file1 </span><br><span class="hljs-regexp">/test/i</span>6000-angular-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span>.tar<br><span class="hljs-regexp">/home/i</span>6000<span class="hljs-regexp">/i6000-flow/i</span>6000-angu-end_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163748</span>.tar<br><span class="hljs-regexp">/home/i</span>6000<span class="hljs-regexp">/i6000-app/i</span>6000-app-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163758</span>.tar<br><span class="hljs-regexp">/home/i</span>6000<span class="hljs-regexp">/i6000-app/i</span>6000-app-end_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163768</span>.tar<br><span class="hljs-regexp">/home/i</span>6000<span class="hljs-regexp">/i6000-monitor/i</span>6000-monitor-frnt_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163778</span>.tar<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@node2 shell]<span class="hljs-comment"># cat multiple_update_pkg.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment"># 读取文件file1中的带有绝对路径的tar包列表，并加载tar包</span><br><span class="hljs-keyword">for</span> Pkg <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> ../file1`;<span class="hljs-keyword">do</span> docker load -i <span class="hljs-variable">$Pkg</span>;<span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 根据tar包列表，定义tar包相关的变量</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$Pkg</span> &gt;&gt; Pkg.txt<br>TarName=`<span class="hljs-built_in">cat</span> ../file1 |awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>`      <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TarName</span>&quot;</span> &gt; ../TarName.txt<br><span class="hljs-comment">#TarName=`cat ../TarName`</span><br><br><span class="hljs-comment"># 根据TarName元素，定义相关变量</span><br>ServiceName=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print$1&#125;&#x27;</span>`<br><span class="hljs-built_in">mkdir</span> <span class="hljs-string">&quot;`date +%F`_<span class="hljs-variable">$ServiceName</span>&quot;</span><br><span class="hljs-built_in">dir</span>=$<span class="hljs-string">&quot;`date +%F`_<span class="hljs-variable">$ServiceName</span>&quot;</span><br>version=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span>|awk -F <span class="hljs-string">&quot;_&quot;</span> <span class="hljs-string">&#x27;&#123;print$2&#125;&#x27;</span>|awk -v FS=<span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&#x27;&#123;print$1FS$2FS$3FS$4&#125;&#x27;</span>`<br><br><span class="hljs-comment"># 加载tar包、定义相关的变量，并将变量记录到文件中</span><br>docker load -i <span class="hljs-variable">$TarName</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span> &gt; <span class="hljs-variable">$dir</span>/images.txt<br>ImagesId=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$dir</span>/images.txt|<span class="hljs-built_in">head</span> -1|awk -F <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>`<br>sgmc=cr.registry.res.sgmc.sgcc.com.cn/i6000/<br>registry_Address=$sgmc<span class="hljs-variable">$ServiceName</span>:<span class="hljs-variable">$version</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$TarName</span> &gt;&gt; <span class="hljs-variable">$dir</span>/TarName.txt &amp;&amp; <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> &gt;&gt; <span class="hljs-variable">$dir</span>/version.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ServiceName</span> &gt;&gt; <span class="hljs-variable">$dir</span>/ServiceName.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ImagesId</span> &gt;&gt; <span class="hljs-variable">$dir</span>/ImagesId.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$registry_Address</span> &gt;&gt; <span class="hljs-variable">$dir</span>/registry_Address.txt<br><br><span class="hljs-comment"># 打标签</span><br>docker tag <span class="hljs-variable">$ImagesId</span> <span class="hljs-variable">$registry_Address</span><br>docker images |grep <span class="hljs-variable">$ServiceName</span><br><br><span class="hljs-comment">#推送镜像到仓库</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">TarName=`<span class="hljs-built_in">cat</span> ../file1 |awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>`     // 以斜线为分隔符，截取文件中的最后一列，即tar包名称<br></code></pre></td></tr></table></figure><p>执行脚本批量升级多个tar包时的反馈信息</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vim"># 本机测试环境，只有一个tar包，需要找多个tar环境，进行测试验证。<br>[root@node2 <span class="hljs-keyword">shell</span>]# <span class="hljs-keyword">sh</span> multiple_update_pkg.<span class="hljs-keyword">sh</span> <br><span class="hljs-number">2</span>edcec3590a4: Loading layer [==================================================&gt;] <span class="hljs-number">83.86</span> MB/<span class="hljs-number">83.86</span> MB<br>e379e8aedd4d: Loading layer [==================================================&gt;]    <span class="hljs-number">62</span> MB/<span class="hljs-number">62</span> MB<br>b8d6e692a25e: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br>f1db227348d0: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">32</span>ce5f6a5106: Loading layer [==================================================&gt;] <span class="hljs-number">3.584</span> kB/<span class="hljs-number">3.584</span> kB<br>d874fd2bc83b: Loading layer [==================================================&gt;] <span class="hljs-number">7.168</span> kB/<span class="hljs-number">7.168</span> kB<br><span class="hljs-number">6</span>bde2ade907f: Loading layer [==================================================&gt;] <span class="hljs-number">157.9</span> MB/<span class="hljs-number">157.9</span> MB<br><span class="hljs-number">2239</span>ae925798: Loading layer [==================================================&gt;]  <span class="hljs-number">5.12</span> kB/<span class="hljs-number">5.12</span> kB<br><span class="hljs-number">9</span>d31d3f13b68: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">9</span>a26e8d4441e: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">716842</span>aa424f: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">93</span>a1ee32972b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br>a48958a8796b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">52516</span>cae62cd: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">39</span>f1b624a342: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>b79772e475a9: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br><span class="hljs-number">4</span>df452a05af3: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br><span class="hljs-keyword">open</span> /home/i6000/i6000-flow/i6000-angu-end_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163748</span>.tar: <span class="hljs-keyword">no</span> such <span class="hljs-keyword">file</span> <span class="hljs-built_in">or</span> directory<br><span class="hljs-keyword">open</span> /home/i6000/i6000-app/i6000-app-front_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163758</span>.tar: <span class="hljs-keyword">no</span> such <span class="hljs-keyword">file</span> <span class="hljs-built_in">or</span> directory<br><span class="hljs-keyword">open</span> /home/i6000/i6000-app/i6000-app-end_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163768</span>.tar: <span class="hljs-keyword">no</span> such <span class="hljs-keyword">file</span> <span class="hljs-built_in">or</span> directory<br><span class="hljs-keyword">open</span> /home/i6000/i6000-monitor/i6000-monitor-frnt_2.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163778</span>.tar: <span class="hljs-keyword">no</span> such <span class="hljs-keyword">file</span> <span class="hljs-built_in">or</span> directory<br><span class="hljs-string">&quot;docker load&quot;</span> accepts <span class="hljs-keyword">no</span> <span class="hljs-keyword">argument</span>(s).<br>See <span class="hljs-string">&#x27;docker load --help&#x27;</span>.<br><br>Usage:  docker load [OPTIONS]<br><br>Load <span class="hljs-keyword">an</span> image from <span class="hljs-keyword">a</span> tar archive <span class="hljs-built_in">or</span> STDIN<br><span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-front     <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>The push refers <span class="hljs-keyword">to</span> <span class="hljs-keyword">a</span> repository [<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-angular-front]<br>Get https://<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/v1/_ping: dial tcp: lookup <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span> <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">no</span> such host<br></code></pre></td></tr></table></figure><p>使用此脚本，升级的那个tar包</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@node2 <span class="hljs-keyword">shell</span>]# <span class="hljs-keyword">sh</span> multiple_update_pkg.<span class="hljs-keyword">sh</span> <br><span class="hljs-number">2</span>edcec3590a4: Loading layer [==================================================&gt;] <span class="hljs-number">83.86</span> MB/<span class="hljs-number">83.86</span> MB<br>e379e8aedd4d: Loading layer [==================================================&gt;]    <span class="hljs-number">62</span> MB/<span class="hljs-number">62</span> MB<br>b8d6e692a25e: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br>f1db227348d0: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">32</span>ce5f6a5106: Loading layer [==================================================&gt;] <span class="hljs-number">3.584</span> kB/<span class="hljs-number">3.584</span> kB<br>d874fd2bc83b: Loading layer [==================================================&gt;] <span class="hljs-number">7.168</span> kB/<span class="hljs-number">7.168</span> kB<br><span class="hljs-number">6</span>bde2ade907f: Loading layer [==================================================&gt;] <span class="hljs-number">157.9</span> MB/<span class="hljs-number">157.9</span> MB<br><span class="hljs-number">2239</span>ae925798: Loading layer [==================================================&gt;]  <span class="hljs-number">5.12</span> kB/<span class="hljs-number">5.12</span> kB<br><span class="hljs-number">9</span>d31d3f13b68: Loading layer [==================================================&gt;] <span class="hljs-number">4.096</span> kB/<span class="hljs-number">4.096</span> kB<br><span class="hljs-number">9</span>a26e8d4441e: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">716842</span>aa424f: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">93</span>a1ee32972b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br>a48958a8796b: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">52516</span>cae62cd: Loading layer [==================================================&gt;] <span class="hljs-number">5.632</span> kB/<span class="hljs-number">5.632</span> kB<br><span class="hljs-number">39</span>f1b624a342: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>b79772e475a9: Loading layer [==================================================&gt;] <span class="hljs-number">3.072</span> kB/<span class="hljs-number">3.072</span> kB<br><span class="hljs-number">4</span>df452a05af3: Loading layer [==================================================&gt;] <span class="hljs-number">4.608</span> kB/<span class="hljs-number">4.608</span> kB<br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>Loaded image: registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-fron<span class="hljs-variable">t:2</span>.<span class="hljs-number">0.26</span>.<span class="hljs-number">20220424163738</span><br>registry.nrxt.<span class="hljs-keyword">com</span>/i6000/i6000-public/i6000-angular-front     <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br><span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-angular-front   <span class="hljs-number">2.0</span>.<span class="hljs-number">26.20220424163738</span>   <span class="hljs-number">5</span>c178accd6df        <span class="hljs-number">3</span> months ago        <span class="hljs-number">294</span> MB<br>The push refers <span class="hljs-keyword">to</span> <span class="hljs-keyword">a</span> repository [<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/i6000/i6000-angular-front]<br>Get https://<span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span>/v1/_ping: dial tcp: lookup <span class="hljs-keyword">cr</span>.registry.<span class="hljs-keyword">res</span>.sgmc.sgcc.<span class="hljs-keyword">com</span>.<span class="hljs-keyword">cn</span> <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">no</span> such host<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>自动化运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>i6000</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ansible的安装和入门</title>
    <link href="/2022/08/07/ansible%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%85%A5%E9%97%A8/"/>
    <url>/2022/08/07/ansible%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h2 id="包安装方式"><a href="#包安装方式" class="headerlink" title="包安装方式"></a>包安装方式</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs mipsasm">[root@node1 yum.repos.d]<span class="hljs-comment"># yum provides ansible</span><br>Loaded plugins: fastestmirror<br>Loading mirror speeds from <span class="hljs-keyword">cached </span>hostfile<br> * <span class="hljs-keyword">base: </span>mirrors.<span class="hljs-keyword">bupt.edu.cn</span><br><span class="hljs-keyword"></span> * <span class="hljs-keyword">extras: </span>mirrors.<span class="hljs-keyword">bfsu.edu.cn</span><br><span class="hljs-keyword"></span> * updates: mirrors.<span class="hljs-keyword">bfsu.edu.cn</span><br><span class="hljs-keyword"></span>ansible<span class="hljs-number">-2</span>.<span class="hljs-number">9</span>.<span class="hljs-number">27</span><span class="hljs-number">-1</span>.el7.noarch : SSH-<span class="hljs-keyword">based </span>configuration management, deployment, <span class="hljs-keyword">and </span>task execution system<br>Repo        : epel<br></code></pre></td></tr></table></figure><p>需要有epel源才可以安装ansible。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@node2 yum.repos.d]</span><span class="hljs-comment"># cat epel.repo </span><br><span class="hljs-section">[epel]</span><br><span class="hljs-attr">name</span>=Extra Packages for Enterprise Linux <span class="hljs-number">7</span> - <span class="hljs-variable">$basearch</span><br><span class="hljs-attr">baseurl</span>=http://mirrors.aliyun.com/epel/<span class="hljs-number">7</span>/<span class="hljs-variable">$basearch</span><br><span class="hljs-attr">failovermethod</span>=priority<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 yum.repos.d]# yum install ansible<br><br>[root@node1 yum.repos.d]# yum <span class="hljs-keyword">info</span> ansible<br>Loaded plugins: fastestmirror<br>Loading mirror speeds <span class="hljs-keyword">from</span> cached hostfile<br> * base: mirrors.bupt.edu.cn<br> * extras: mirrors.bfsu.edu.cn<br> * updates: mirrors.bfsu.edu.cn<br>Installed Packages<br><span class="hljs-type">Name</span>        : ansible<br>Arch        : noarch<br><span class="hljs-keyword">Version</span>     : <span class="hljs-number">2.9</span><span class="hljs-number">.27</span><br><span class="hljs-keyword">Release</span>     : <span class="hljs-number">1.</span>el7<br>Size        : <span class="hljs-number">103</span> M<br>Repo        : installed<br><span class="hljs-keyword">From</span> repo   : epel<br><span class="hljs-keyword">Summary</span>     : SSH-based <span class="hljs-keyword">configuration</span> management, deployment, <span class="hljs-keyword">and</span> task execution <span class="hljs-keyword">system</span><br>URL         : http://ansible.com<br>License     : GPLv3+<br>Description : Ansible <span class="hljs-keyword">is</span> a radically simple model-driven <span class="hljs-keyword">configuration</span> management,<br>            : multi-node deployment, <span class="hljs-keyword">and</span> remote task execution <span class="hljs-keyword">system</span>. Ansible works<br>            : <span class="hljs-keyword">over</span> SSH <span class="hljs-keyword">and</span> does <span class="hljs-keyword">not</span> require <span class="hljs-keyword">any</span> software <span class="hljs-keyword">or</span> daemons <span class="hljs-keyword">to</span> be installed<br>            : <span class="hljs-keyword">on</span> remote nodes. <span class="hljs-keyword">Extension</span> modules can be written <span class="hljs-keyword">in</span> <span class="hljs-keyword">any</span> <span class="hljs-keyword">language</span> <span class="hljs-keyword">and</span><br>            : are transferred <span class="hljs-keyword">to</span> managed machines automatically.<br><br>[root@node1 yum.repos.d]# ansible <span class="hljs-comment">--version</span><br>ansible <span class="hljs-number">2.9</span><span class="hljs-number">.27</span><br>  config file = /etc/ansible/ansible.cfg<br>  configured module <span class="hljs-keyword">search</span> <span class="hljs-type">path</span> = [u<span class="hljs-string">&#x27;/root/.ansible/plugins/modules&#x27;</span>, u<span class="hljs-string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]<br>  ansible python module <span class="hljs-keyword">location</span> = /usr/lib/python2<span class="hljs-number">.7</span>/site-packages/ansible<br>  executable <span class="hljs-keyword">location</span> = /usr/bin/ansible<br>  python version = <span class="hljs-number">2.7</span><span class="hljs-number">.5</span> (<span class="hljs-keyword">default</span>, Oct <span class="hljs-number">30</span> <span class="hljs-number">2018</span>, <span class="hljs-number">23</span>:<span class="hljs-number">45</span>:<span class="hljs-number">53</span>) [GCC <span class="hljs-number">4.8</span><span class="hljs-number">.5</span> <span class="hljs-number">20150623</span> (Red Hat <span class="hljs-number">4.8</span><span class="hljs-number">.5</span><span class="hljs-number">-36</span>)]<br>  <br>[root@node1 yum.repos.d]# file /usr/bin/ansible<br>/usr/bin/ansible: symbolic link <span class="hljs-keyword">to</span> `/usr/bin/ansible<span class="hljs-number">-2.7</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 yum.repos.d]# ll /usr/bin/ansible</span><br><span class="hljs-string">lrwxrwxrwx. 1 root root 20 Aug  6 21:55 /usr/bin/ansible -&gt; /usr/bin/ansible-2.7</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 yum.repos.d]# which ansible</span><br><span class="hljs-string">/usr/bin/ansible</span><br><span class="hljs-string">[root@node1 yum.repos.d]# vim `which ansible`</span><br></code></pre></td></tr></table></figure><h2 id="ansible相关文件"><a href="#ansible相关文件" class="headerlink" title="ansible相关文件"></a>ansible相关文件</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">[root@node1 yum.repos.d]<span class="hljs-meta"># vim /etc/ansible/ansible.cfg              <span class="hljs-comment">//ansbile的主配置文件，一般情况不需要修改，采用默认设置</span></span><br>[root@node1 yum.repos.d]<span class="hljs-meta"># vim /etc/ansible/hosts                    <span class="hljs-comment">// 这个文件很关键，存放的被管理的主机清单</span></span><br></code></pre></td></tr></table></figure><p>第一次使用ansible以key方式管理被控制主机时，需要输入yes，添加到ansible机器的.ssh/known_hosts 文件中</p><figure class="highlight pony"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs pony">[root@node1 yum.repos.d]# ansible all -m ping <br><span class="hljs-type">The</span> authenticity of host <span class="hljs-string">&#x27;192.168.23.102 (192.168.23.102)&#x27;</span> can&#x27;t <span class="hljs-keyword">be</span> established.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">SHA256</span>:/<span class="hljs-type">AaL9QiN7JWUr8LZsqaGeKWO</span>+<span class="hljs-type">DfRswsVJVakIyoOHLM</span>.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">MD5</span>:<span class="hljs-number">29</span>:<span class="hljs-number">79</span>:<span class="hljs-number">27</span>:f9:a6:f0:<span class="hljs-number">08</span>:ff:<span class="hljs-number">37</span>:fa:<span class="hljs-number">59</span>:<span class="hljs-number">0</span>a:<span class="hljs-number">0</span>f:a1:ff:<span class="hljs-number">0</span>d.<br><span class="hljs-type">Are</span> you sure you want to <span class="hljs-keyword">continue</span> connecting (yes/no)? <span class="hljs-type">The</span> authenticity of host <span class="hljs-string">&#x27;192.168.23.103 (192.168.23.103)&#x27;</span> can&#x27;t <span class="hljs-keyword">be</span> established.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">SHA256</span>:/<span class="hljs-type">AaL9QiN7JWUr8LZsqaGeKWO</span>+<span class="hljs-type">DfRswsVJVakIyoOHLM</span>.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">MD5</span>:<span class="hljs-number">29</span>:<span class="hljs-number">79</span>:<span class="hljs-number">27</span>:f9:a6:f0:<span class="hljs-number">08</span>:ff:<span class="hljs-number">37</span>:fa:<span class="hljs-number">59</span>:<span class="hljs-number">0</span>a:<span class="hljs-number">0</span>f:a1:ff:<span class="hljs-number">0</span>d.<br><span class="hljs-type">Are</span> you sure you want to <span class="hljs-keyword">continue</span> connecting (yes/no)? <span class="hljs-type">The</span> authenticity of host <span class="hljs-string">&#x27;192.168.23.101 (192.168.23.101)&#x27;</span> can&#x27;t <span class="hljs-keyword">be</span> established.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">SHA256</span>:/<span class="hljs-type">AaL9QiN7JWUr8LZsqaGeKWO</span>+<span class="hljs-type">DfRswsVJVakIyoOHLM</span>.<br><span class="hljs-type">ECDSA</span> key fingerprint <span class="hljs-keyword">is</span> <span class="hljs-type">MD5</span>:<span class="hljs-number">29</span>:<span class="hljs-number">79</span>:<span class="hljs-number">27</span>:f9:a6:f0:<span class="hljs-number">08</span>:ff:<span class="hljs-number">37</span>:fa:<span class="hljs-number">59</span>:<span class="hljs-number">0</span>a:<span class="hljs-number">0</span>f:a1:ff:<span class="hljs-number">0</span>d.<br><span class="hljs-type">Are</span> you sure you want to <span class="hljs-keyword">continue</span> connecting (yes/no)? yes<br><span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.102</span> | <span class="hljs-type">UNREACHABLE</span>! =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Failed to connect to the host via ssh: Warning: Permanently added &#x27;192.168.23.102&#x27; (ECDSA) to the list of known hosts.\r\nPermission denied (publickey,gssapi-keyex,gssapi-with-mic,password).&quot;</span>, <br>    <span class="hljs-string">&quot;unreachable&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br>r | <span class="hljs-type">UNREACHABLE</span>! =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Failed to connect to the host via ssh: ssh: Could not resolve hostname r: Name or service not known&quot;</span>, <br>    <span class="hljs-string">&quot;unreachable&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br>y | <span class="hljs-type">UNREACHABLE</span>! =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Failed to connect to the host via ssh: ssh: Could not resolve hostname y: Name or service not known&quot;</span>, <br>    <span class="hljs-string">&quot;unreachable&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br>q | <span class="hljs-type">UNREACHABLE</span>! =&gt; &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Failed to connect to the host via ssh: ssh: Could not resolve hostname q: Name or service not known&quot;</span>, <br>    <span class="hljs-string">&quot;unreachable&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><p>被管理的机器会很多，一个个点yes不太理想。可以使用以下两种方法，减去输入yes的步骤。</p><h2 id="减去连接远程主机时输入yes的步骤"><a href="#减去连接远程主机时输入yes的步骤" class="headerlink" title="减去连接远程主机时输入yes的步骤"></a>减去连接远程主机时输入yes的步骤</h2><p>方法1、修改ssh客户端的配置文件</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@node1 ~]<span class="hljs-comment"># vim /etc/ssh/ssh_config </span><br><span class="hljs-comment">#   StrictHostKeyChecking ask</span><br>   StrictHostKeyChecking <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><p>方法2、修改ansible的主配置文件</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@node1 ~]</span><span class="hljs-comment"># vim /etc/ansible/ansible.cfg </span><br><span class="hljs-comment">#host_key_checking = False</span><br><span class="hljs-attr">host_key_checking</span> = <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>再次连接时就不要敲yes了</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># echo &gt; .ssh/known_hosts</span><br>[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># ansible 192.168.23.102 -m ping</span><br><span class="hljs-meta prompt_">192.168.23.102 | UNREACHABLE! =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Failed to connect to the host via ssh: Warning: Permanently added &#x27;192.168.23.102&#x27; (ECDSA) to the list of known hosts.\r\nPermission denied (publickey,gssapi-keyex,gssapi-with-mic,password).&quot;</span>, <br>    <span class="hljs-string">&quot;unreachable&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><p>目前还没有做基于kye的验证，所以暂时还连不上，字体颜色是红的。</p><h2 id="基于kye的验证"><a href="#基于kye的验证" class="headerlink" title="基于kye的验证"></a>基于kye的验证</h2><p>有同学写的一键脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#*********************************************</span><br><span class="hljs-comment">#Author:            C3t4m</span><br><span class="hljs-comment">#Blog:              75j.xyz</span><br><span class="hljs-comment">#Description：      基于key验证多主机ssh访问</span><br><span class="hljs-comment">#Date:              2021-03-31</span><br><span class="hljs-comment">#*********************************************</span><br><br>PASS=123456<br><span class="hljs-comment">#设置网段最后的地址，4-255之间，越小扫描越快</span><br>END=254<br><br>IP=`ip a s eth0 | awk -F<span class="hljs-string">&#x27;[ /]+&#x27;</span> <span class="hljs-string">&#x27;NR==3&#123;print $3&#125;&#x27;</span>`<br>NET=<span class="hljs-variable">$&#123;IP%.*&#125;</span>.<br><br><span class="hljs-built_in">rm</span> -f /root/.ssh/id_rsa<br>[ -e ./SCANIP.<span class="hljs-built_in">log</span> ] &amp;&amp; <span class="hljs-built_in">rm</span> -f SCANIP.<span class="hljs-built_in">log</span><br><span class="hljs-keyword">for</span>((i=3;i&lt;=<span class="hljs-string">&quot;<span class="hljs-variable">$END</span>&quot;</span>;i++));<span class="hljs-keyword">do</span><br>ping -c 1 -w 1  <span class="hljs-variable">$&#123;NET&#125;</span><span class="hljs-variable">$i</span> &amp;&gt; /dev/null  &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;NET&#125;</span><span class="hljs-variable">$i</span>&quot;</span> &gt;&gt; SCANIP.<span class="hljs-built_in">log</span> &amp;<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">wait</span><br><br>ssh-keygen -P <span class="hljs-string">&quot;&quot;</span> -f /root/.ssh/id_rsa<br>rpm -q sshpass || yum -y install sshpass<br>sshpass -p <span class="hljs-variable">$PASS</span> ssh-copy-id -o StrictHostKeyChecking=no <span class="hljs-variable">$IP</span> <br><br>AliveIP=(`<span class="hljs-built_in">cat</span> SCANIP.<span class="hljs-built_in">log</span>`)<br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;AliveIP[*]&#125;</span>;<span class="hljs-keyword">do</span><br>sshpass -p <span class="hljs-variable">$PASS</span> scp -o StrictHostKeyChecking=no -r /root/.ssh root@<span class="hljs-variable">$&#123;n&#125;</span>:<br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#把.ssh/known_hosts拷贝到所有主机，使它们第一次互相访问时不需要输入回车</span><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;AliveIP[*]&#125;</span>;<span class="hljs-keyword">do</span><br>scp /root/.ssh/known_hosts <span class="hljs-variable">$&#123;n&#125;</span>:.ssh/<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">脚本的执行记录：<br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># bash ssh_key.sh </span><br>Generating public/private rsa key pair.<br>Your identification has been saved in /root/.ssh/id_rsa.<br>Your public key has been saved in /root/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>SHA256:062ISmu165B+M/nf0d0gvJ5hpXjOZp3ohPY8Qq0mXpk root<span class="hljs-meta">@node1</span><br>The key&#x27;s randomart image is:<br>+---[RSA 2048]----+<br>|<span class="hljs-string">                 </span>|<br>|<span class="hljs-string">                 </span>|<br>|<span class="hljs-string">                 </span>|<br>|<span class="hljs-string">         . o     </span>|<br>|<span class="hljs-string">        S ..+ o  </span>|<br>|<span class="hljs-string">     ... o.*.* o.</span>|<br>|<span class="hljs-string">    +..o..E.Oo..o</span>|<br>|<span class="hljs-string">   o.+* .o+@=+o  </span>|<br>|<span class="hljs-string">   .+oo*o+.=X.   </span>|<br>+----[SHA256]-----+<br>sshpass-1.06-2.el7.x86_64<br>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="hljs-string">&quot;/root/.ssh/id_rsa.pub&quot;</span><br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys<br><br>Number of key(s) added: 1<br><br>Now try logging into the machine, with:   <span class="hljs-string">&quot;ssh -o &#x27;StrictHostKeyChecking=no&#x27; &#x27;192.168.23.101&#x27;&quot;</span><br>and check to make sure that only the key(s) you wanted were added.<br><br>Warning: Permanently added &#x27;192.168.23.11&#x27; (ECDSA) to the list of known hosts.<br>Warning: Permanently added &#x27;192.168.23.8&#x27; (ECDSA) to the list of known hosts.<br>Warning: Permanently added &#x27;192.168.23.9&#x27; (ECDSA) to the list of known hosts.<br>ssh: connect to host 192.168.23.254 port 22: Connection refused<br>lost connection<br>known_hosts                                                                                    100% 1052     1.0MB/s   00:00                // 192.168.23.11/8/9分别是node1、2、3的eth1地址。<br>known_hosts                                                                                    100% 1052   647.8KB/s   00:00    <br>known_hosts                                                                                    100% 1052   444.7KB/s   00:00    <br>known_hosts                                                                                    100% 1052   429.5KB/s   00:00    <br>known_hosts                                                                                    100% 1052   744.2KB/s   00:00    <br>known_hosts                                                                                    100% 1052   590.5KB/s   00:00    <br>ssh: connect to host 192.168.23.254 port 22: Connection refused    //VMnet8的网关地址<br>lost connection<br><br>测试验证基于key的连接：<br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># ssh 192.168.23.102</span><br>Last login: Sat Aug  6 23:21:20 2022 from 192.168.23.1<br>[root<span class="hljs-meta">@node2</span> ~]<span class="hljs-comment"># ssh 192.168.23.103</span><br>Last login: Sat Aug  6 23:21:30 2022 from 192.168.23.1<br>[root<span class="hljs-meta">@node3</span> ~]<span class="hljs-comment"># ssh 192.168.23.102</span><br>Last login: Sat Aug  6 23:35:45 2022 from 192.168.23.101<br>[root<span class="hljs-meta">@node2</span> ~]<span class="hljs-comment"># ssh 192.168.23.101</span><br>Last login: Sat Aug  6 23:21:07 2022 from 192.168.23.1<br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to 192.168.23.101 closed.<br>[root<span class="hljs-meta">@node2</span> ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to 192.168.23.102 closed.<br>[root<span class="hljs-meta">@node3</span> ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to 192.168.23.103 closed.<br>[root<span class="hljs-meta">@node2</span> ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to 192.168.23.102 closed.<br></code></pre></td></tr></table></figure><h2 id="ansible基本工具使用"><a href="#ansible基本工具使用" class="headerlink" title="ansible基本工具使用"></a>ansible基本工具使用</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@ansible</span> ~]<span class="hljs-comment"># hostnamectl set-hostname ansible</span><br>[root<span class="hljs-variable">@ansible</span> ~]<span class="hljs-comment"># ansible all --list-hosts</span><br>  hosts (<span class="hljs-number">3</span>):<br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span><br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">23.102</span><br>    <span class="hljs-number">192.168</span>.<span class="hljs-number">23.103</span><br>    <br>[root<span class="hljs-variable">@ansible</span> ~]<span class="hljs-comment"># ansible all -m ping     //-m,是指的模块，ansible有上千个功能模块</span><br><span class="hljs-meta prompt_">192.168.23.103 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;<br><span class="hljs-meta prompt_">192.168.23.102 | SUCCESS =&gt;</span> &#123;<br>    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span><br>    &#125;, <br>    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>, <br>    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span><br>&#125;                   /<span class="hljs-regexp">/ 不能自动退出，需要使用ctrl+c才能终止，这是为什么？</span><br></code></pre></td></tr></table></figure><h3 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h3><p>此工具用来显示模块帮助,相当于man</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">          status<span class="hljs-operator">:</span><br>[root<span class="hljs-operator">@</span>ansible <span class="hljs-operator">~</span>]# ansible<span class="hljs-operator">-</span>doc ping         <span class="hljs-comment">// // 查看模块的详细用法</span><br>[root<span class="hljs-operator">@</span>ansible <span class="hljs-operator">~</span>]# ansible<span class="hljs-operator">-</span>doc <span class="hljs-operator">-</span>s ping        <span class="hljs-comment">// 查看简短的关于模块的描述</span><br><span class="hljs-operator">-</span> name<span class="hljs-operator">:</span> Try <span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span> host, verify a usable python <span class="hljs-keyword">and</span> <span class="hljs-keyword">return</span> `pong&#x27; on success<br>  ping<span class="hljs-operator">:</span><br>      data<span class="hljs-operator">:</span>                  # Data <span class="hljs-keyword">to</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">for</span> the `ping&#x27; <span class="hljs-keyword">return</span> value. If this parameter is <span class="hljs-built_in">set</span> <span class="hljs-keyword">to</span> `crash&#x27;, the <span class="hljs-keyword">module</span> will cause an <span class="hljs-keyword">exception</span>.<br><br></code></pre></td></tr></table></figure><h3 id="创建一个yaml文件"><a href="#创建一个yaml文件" class="headerlink" title="创建一个yaml文件"></a>创建一个yaml文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># vim hello.yaml</span><br>[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cat hello.yaml </span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># first yaml file</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span> <span class="hljs-comment">#不收集系统信息，提高执行效率</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test</span> <span class="hljs-string">network</span> <span class="hljs-string">connection</span><br>      <span class="hljs-attr">ping:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">excute</span> <span class="hljs-string">command</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">wall</span> <span class="hljs-string">&quot;hello world!&quot;</span><br></code></pre></td></tr></table></figure><p>检查是否有语法错误：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># ansible-playbook --syntax-check hello.yaml </span><br><br><span class="hljs-attr">playbook:</span> <span class="hljs-string">hello.yaml</span><br><br><br>[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cat hello.yaml </span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># first yaml file</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span> <span class="hljs-comment">#不收集系统信息，提高执行效率</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">name:test</span> <span class="hljs-string">network</span> <span class="hljs-string">connection</span>              <span class="hljs-string">//</span> <span class="hljs-string">test前面没有空格</span><br>      <span class="hljs-attr">ping:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">excute</span> <span class="hljs-string">command</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">wall</span> <span class="hljs-string">&quot;hello world!&quot;</span><br> <br>[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># ansible-playbook --syntax-check hello.yaml </span><br><span class="hljs-string">ERROR!</span> <span class="hljs-string">We</span> <span class="hljs-string">were</span> <span class="hljs-string">unable</span> <span class="hljs-string">to</span> <span class="hljs-string">read</span> <span class="hljs-string">either</span> <span class="hljs-string">as</span> <span class="hljs-string">JSON</span> <span class="hljs-string">nor</span> <span class="hljs-string">YAML,</span> <span class="hljs-attr">these are the errors we got from each:</span><br><span class="hljs-attr">JSON:</span> <span class="hljs-literal">No</span> <span class="hljs-string">JSON</span> <span class="hljs-string">object</span> <span class="hljs-string">could</span> <span class="hljs-string">be</span> <span class="hljs-string">decoded</span><br><br><span class="hljs-string">Syntax</span> <span class="hljs-string">Error</span> <span class="hljs-string">while</span> <span class="hljs-string">loading</span> <span class="hljs-string">YAML.</span><br>  <span class="hljs-string">mapping</span> <span class="hljs-string">values</span> <span class="hljs-string">are</span> <span class="hljs-string">not</span> <span class="hljs-string">allowed</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">context</span><br><br><span class="hljs-string">The</span> <span class="hljs-string">error</span> <span class="hljs-string">appears</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">in</span> <span class="hljs-string">&#x27;/root/hello.yaml&#x27;</span><span class="hljs-string">:</span> <span class="hljs-string">line</span> <span class="hljs-number">9</span><span class="hljs-string">,</span> <span class="hljs-string">column</span> <span class="hljs-number">11</span><span class="hljs-string">,</span> <span class="hljs-string">but</span> <span class="hljs-string">may</span><br><span class="hljs-string">be</span> <span class="hljs-string">elsewhere</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">file</span> <span class="hljs-string">depending</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">exact</span> <span class="hljs-string">syntax</span> <span class="hljs-string">problem.</span><br><br><span class="hljs-attr">The offending line appears to be:</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">name:test</span> <span class="hljs-string">network</span> <span class="hljs-string">connection</span>   <span class="hljs-string">//</span> <span class="hljs-string">在进行语法检查时，提示有错误的地方在这里。行数不一定准确</span><br>      <span class="hljs-attr">ping:</span><br>          <span class="hljs-string">^</span> <span class="hljs-string">here</span><br></code></pre></td></tr></table></figure><p>也可以使用-C，进行语法检查，同时做一个假运行（不做文件内容的修改）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[root@ansible ~]# ansible-playbook -C hello.yaml      // 进行语法检查，同时做一个假运行<br><br>PLAY [websrvs] <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**<span class="hljs-emphasis">*</span></span><br><span class="hljs-emphasis"><span class="hljs-strong"></span></span><br><span class="hljs-emphasis"><span class="hljs-strong">TASK [test network connection] *</span>**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>ok: [192.168.23.102]<br>ok: [192.168.23.103]<br><br>^C [ERROR]: User interrupted execution<br>[root@ansible ~]# <br>[root@ansible ~]# <br>[root@ansible ~]# ansible-playbook hello.yaml    // 真的运行了<br><br>PLAY [websrvs] <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**<span class="hljs-emphasis">*</span></span><br><span class="hljs-emphasis"><span class="hljs-strong"></span></span><br><span class="hljs-emphasis"><span class="hljs-strong">TASK [test network connection] *</span>**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br>ok: [192.168.23.103]<br>ok: [192.168.23.102]<br>^C [ERROR]: User interrupted execution<br></code></pre></td></tr></table></figure><p>如上写的第一个yaml文件执行结果，跟老师课堂上的效果不一样，</p><p><img src="image-20220811212310209.png" alt="image-20220811212310209"></p><p><img src="image-20220811211829292.png" alt="image-20220811211829292"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@ansible</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cat hello.yaml </span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># This is a playbook file             // 一个playbook，可以写多个play</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span> <span class="hljs-comment">#不收集系统信息，提高执行效率</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ping</span> <br>      <span class="hljs-attr">ping:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wall</span><br>      <span class="hljs-attr">shell:</span> <span class="hljs-string">wall</span> <span class="hljs-string">hello</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">dbsrvs</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">httpd</span><br>      <span class="hljs-attr">yum:</span> <span class="hljs-string">name=httpd</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">start</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">httpd</span><br>        <span class="hljs-attr">state:</span> <span class="hljs-string">started</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><h3 id="playbook命令常用的选项"><a href="#playbook命令常用的选项" class="headerlink" title="playbook命令常用的选项"></a>playbook命令常用的选项</h3><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-literal">-</span>-syntax-check       <span class="hljs-comment">#语法检查,可缩写成--syntax, 相当于bash -n </span><br><span class="hljs-literal">-</span>C --check <span class="hljs-comment">#模拟执行,只检测可能会发生的改变，但不真正执行操作,dry run </span><br><span class="hljs-literal">-</span>-list-hosts         <span class="hljs-comment">#列出运行任务的主机</span><br><span class="hljs-literal">-</span>-list-tags          <span class="hljs-comment">#列出tag</span><br><span class="hljs-literal">-</span>-list-tasks         <span class="hljs-comment">#列出task</span><br><span class="hljs-literal">-</span>-limit 主机列表      <span class="hljs-comment">#只针对主机列表中的特定主机执行</span><br><span class="hljs-literal">-</span>i INVENTORY         <span class="hljs-comment">#指定主机清单文件,通常一个项对应一个主机清单文件</span><br><span class="hljs-literal">-</span>-start-at-task START_AT_TASK <span class="hljs-comment">#从指定task开始执行,而非从头开始,START_AT_TASK为任务的</span><br>name<br><span class="hljs-literal">-</span>v -vv  -vvv          <span class="hljs-comment">#显示过程</span><br></code></pre></td></tr></table></figure><p>指定当前项目中的主机清单，与其他项目的主机清单做区分，</p><p><img src="image-20220811220749142.png" alt="image-20220811220749142"></p>]]></content>
    
    
    <categories>
      
      <category>运维自动化之ansilbe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>27.4</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7利用yum源安装mysql5.7</title>
    <link href="/2022/07/31/Centos7%E5%88%A9%E7%94%A8yum%E6%BA%90%E5%AE%89%E8%A3%85mysql5-7/"/>
    <url>/2022/07/31/Centos7%E5%88%A9%E7%94%A8yum%E6%BA%90%E5%AE%89%E8%A3%85mysql5-7/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h2 id="CentOS-7-利用yum源安装MySQL5-7"><a href="#CentOS-7-利用yum源安装MySQL5-7" class="headerlink" title="CentOS 7 利用yum源安装MySQL5.7"></a>CentOS 7 利用yum源安装MySQL5.7</h2><figure class="highlight elixir"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs elixir">[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># tee /etc/yum.repos.d/mysql.repo &lt;&lt;EOF</span><br>[mysql]<br>name=mysql5.<span class="hljs-number">7</span><br>baseurl=<span class="hljs-symbol">https:</span>//mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql<span class="hljs-number">-5.7</span>-community-el7-x86_64/<br>gpgcheck=<span class="hljs-number">0</span><br><span class="hljs-title class_">EOF</span><br><br>[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># yum install mysql-community-server</span><br>[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># systemctl enable --now mysqld</span><br>[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># ss -ntl</span><br><span class="hljs-title class_">State</span>       <span class="hljs-title class_">Recv</span>-Q <span class="hljs-title class_">Send</span>-Q         <span class="hljs-title class_">Local</span> <span class="hljs-symbol">Address:</span><span class="hljs-title class_">Port</span>                        <span class="hljs-title class_">Peer</span> <span class="hljs-symbol">Address:</span><span class="hljs-title class_">Port</span>              <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                        *<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                                     *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                                     *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">6010</span>                                   *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">6011</span>                                   *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">80</span>                        ::<span class="hljs-symbol">:</span><span class="hljs-number">3306</span>                                  ::<span class="hljs-symbol">:*</span>     <span class="hljs-comment">#监听的端口             </span><br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                       ::<span class="hljs-symbol">:</span><span class="hljs-number">8080</span>                                  ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                       ::<span class="hljs-symbol">:</span><span class="hljs-number">80</span>                                    ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                       ::<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                                    ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                      ::<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                                    ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                      ::<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">6010</span>                                  ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                      ::<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">6011</span>                                  ::<span class="hljs-symbol">:*</span>    <br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node2 ~]# mysql<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): <span class="hljs-keyword">Access</span> denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> (<span class="hljs-keyword">using</span> <span class="hljs-keyword">password</span>: <span class="hljs-keyword">NO</span>)<br><br>[root@node2 ~]# grep <span class="hljs-keyword">password</span> /var/<span class="hljs-keyword">log</span>/mysqld.<span class="hljs-keyword">log</span> <br><span class="hljs-number">2022</span><span class="hljs-number">-07</span><span class="hljs-number">-31</span>T10:<span class="hljs-number">53</span>:<span class="hljs-number">49.481563</span>Z <span class="hljs-number">1</span> [Note] A <span class="hljs-keyword">temporary</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">generated</span> <span class="hljs-keyword">for</span> root@localhost: <span class="hljs-number">0</span>lz/x-ehjx1V<br><span class="hljs-number">2022</span><span class="hljs-number">-07</span><span class="hljs-number">-31</span>T10:<span class="hljs-number">58</span>:<span class="hljs-number">22.453766</span>Z <span class="hljs-number">2</span> [Note] <span class="hljs-keyword">Access</span> denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> (<span class="hljs-keyword">using</span> <span class="hljs-keyword">password</span>: <span class="hljs-keyword">NO</span>)<br><span class="hljs-number">2022</span><span class="hljs-number">-07</span><span class="hljs-number">-31</span>T11:<span class="hljs-number">01</span>:<span class="hljs-number">16.515730</span>Z <span class="hljs-number">3</span> [Note] <span class="hljs-keyword">Access</span> denied <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> (<span class="hljs-keyword">using</span> <span class="hljs-keyword">password</span>: <span class="hljs-keyword">NO</span>)<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node2 ~]# mysql -u root -p<span class="hljs-string">&#x27;0lz/x-ehjx1V&#x27;</span><br>mysql: [<span class="hljs-built_in">Warning</span>] <span class="hljs-keyword">Using</span> a <span class="hljs-keyword">password</span> <span class="hljs-keyword">on</span> the command <span class="hljs-type">line</span> interface can be insecure.<br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br>Your MySQL <span class="hljs-keyword">connection</span> id <span class="hljs-keyword">is</span> <span class="hljs-number">4</span><br><span class="hljs-keyword">Server</span> <span class="hljs-keyword">version</span>: <span class="hljs-number">5.7</span><span class="hljs-number">.39</span><br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2022</span>, Oracle <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> its affiliates.<br><br>Oracle <span class="hljs-keyword">is</span> a registered trademark <span class="hljs-keyword">of</span> Oracle Corporation <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> its<br>affiliates. Other names may be trademarks <span class="hljs-keyword">of</span> their respective<br>owners.<br><br><span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;help;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> help. <span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;\c&#x27;</span> <span class="hljs-keyword">to</span> clear the <span class="hljs-keyword">current</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">statement</span>.<br><br>mysql&gt; status         #使用初始密码登录无法执行操作,需要修改密码后才可以<br>ERROR <span class="hljs-number">1820</span> (HY000): You must <span class="hljs-keyword">reset</span> your <span class="hljs-keyword">password</span> <span class="hljs-keyword">using</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">statement</span> <span class="hljs-keyword">before</span> executing this <span class="hljs-keyword">statement</span>.<br>mysql&gt; <br></code></pre></td></tr></table></figure><p>修改密码方法一、</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sql">#修改简单密码不符合密码策略<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;lyxknx2022!&#x27;</span>;<br>ERROR <span class="hljs-number">1819</span> (HY000): Your password does <span class="hljs-keyword">not</span> satisfy the <span class="hljs-keyword">current</span> policy requirements<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;lyxknx0!&#x27;</span>;<br>ERROR <span class="hljs-number">1819</span> (HY000): Your password does <span class="hljs-keyword">not</span> satisfy the <span class="hljs-keyword">current</span> policy requirements<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;Lyxknx0!&#x27;</span>;      #需要有大、小写字母、数字、特色符号<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;Lyxknx-node3&#x27;</span>;<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;Lyxknx-node1&#x27;</span>;<br>mysql<span class="hljs-operator">&gt;</span> status<br><span class="hljs-comment">--------------</span><br>mysql  Ver <span class="hljs-number">14.14</span> Distrib <span class="hljs-number">5.7</span><span class="hljs-number">.39</span>, <span class="hljs-keyword">for</span> Linux (x86_64) <span class="hljs-keyword">using</span>  EditLine wrapper<br><br>Connection id:<span class="hljs-number">4</span><br><span class="hljs-keyword">Current</span> database:<br><span class="hljs-keyword">Current</span> <span class="hljs-keyword">user</span>:root<span class="hljs-variable">@localhost</span><br>SSL:<span class="hljs-keyword">Not</span> <span class="hljs-keyword">in</span> use<br><span class="hljs-keyword">Current</span> pager:stdout<br><span class="hljs-keyword">Using</span> outfile:<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">Using</span> delimiter:;<br>Server version:<span class="hljs-number">5.7</span><span class="hljs-number">.39</span><br>Protocol version:<span class="hljs-number">10</span><br>Connection:Localhost via UNIX socket<br>Server characterset:latin1<br>Db     characterset:latin1<br>Client characterset:utf8<br>Conn.  characterset:utf8<br>UNIX socket:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.sock<br>Uptime:<span class="hljs-number">17</span> min <span class="hljs-number">19</span> sec<br><br>Threads: <span class="hljs-number">1</span>  Questions: <span class="hljs-number">15</span>  Slow queries: <span class="hljs-number">0</span>  Opens: <span class="hljs-number">107</span>  Flush tables: <span class="hljs-number">1</span>  <span class="hljs-keyword">Open</span> tables: <span class="hljs-number">100</span>  Queries <span class="hljs-keyword">per</span> <span class="hljs-keyword">second</span> avg: <span class="hljs-number">0.014</span><br><span class="hljs-comment">--------------</span><br><br>mysql<span class="hljs-operator">&gt;</span> exit<br>Bye<br></code></pre></td></tr></table></figure><p>修改密码方法二、</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[root<span class="hljs-meta">@node1</span> yum.repos.d]<span class="hljs-comment"># mysqladmin -uroot -p&#x27;Lyxknx-node1&#x27; password &#x27;Lyxknx-node1!&#x27;</span><br>mysqladmin: [Warning] Using a password on the command line interface can be insecure.<br>Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.<br><br>mysql&gt; show databases;<br>+--------------------+<br>|<span class="hljs-string"> Database           </span>|<br>+--------------------+<br>|<span class="hljs-string"> information_schema </span>|<br>|<span class="hljs-string"> mysql              </span>|<br>|<span class="hljs-string"> performance_schema </span>|<br>|<span class="hljs-string"> sys                </span>|<br>+--------------------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; select <span class="hljs-symbol">*</span> from mysql;<br>ERROR 1046 (3D000): No database selected<br>mysql&gt; select <span class="hljs-symbol">*</span> from mysql.user;<br>+-----------+---------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+<br>|<span class="hljs-string"> Host      </span>|<span class="hljs-string"> User          </span>|<span class="hljs-string"> Select_priv </span>|<span class="hljs-string"> Insert_priv </span>|<span class="hljs-string"> Update_priv </span>|<span class="hljs-string"> Delete_priv </span>|<span class="hljs-string"> Create_priv </span>|<span class="hljs-string"> Drop_priv </span>|<span class="hljs-string"> Reload_priv </span>|<span class="hljs-string"> Shutdown_priv </span>|<span class="hljs-string"> Process_priv </span>|<span class="hljs-string"> File_priv </span>|<span class="hljs-string"> Grant_priv </span>|<span class="hljs-string"> References_priv </span>|<span class="hljs-string"> Index_priv </span>|<span class="hljs-string"> Alter_priv </span>|<span class="hljs-string"> Show_db_priv </span>|<span class="hljs-string"> Super_priv </span>|<span class="hljs-string"> Create_tmp_table_priv </span>|<span class="hljs-string"> Lock_tables_priv </span>|<span class="hljs-string"> Execute_priv </span>|<span class="hljs-string"> Repl_slave_priv </span>|<span class="hljs-string"> Repl_client_priv </span>|<span class="hljs-string"> Create_view_priv </span>|<span class="hljs-string"> Show_view_priv </span>|<span class="hljs-string"> Create_routine_priv </span>|<span class="hljs-string"> Alter_routine_priv </span>|<span class="hljs-string"> Create_user_priv </span>|<span class="hljs-string"> Event_priv </span>|<span class="hljs-string"> Trigger_priv </span>|<span class="hljs-string"> Create_tablespace_priv </span>|<span class="hljs-string"> ssl_type </span>|<span class="hljs-string"> ssl_cipher </span>|<span class="hljs-string"> x509_issuer </span>|<span class="hljs-string"> x509_subject </span>|<span class="hljs-string"> max_questions </span>|<span class="hljs-string"> max_updates </span>|<span class="hljs-string"> max_connections </span>|<span class="hljs-string"> max_user_connections </span>|<span class="hljs-string"> plugin                </span>|<span class="hljs-string"> authentication_string                     </span>|<span class="hljs-string"> password_expired </span>|<span class="hljs-string"> password_last_changed </span>|<span class="hljs-string"> password_lifetime </span>|<span class="hljs-string"> account_locked </span>|<br>+-----------+---------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+<br>|<span class="hljs-string"> localhost </span>|<span class="hljs-string"> root          </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y         </span>|<span class="hljs-string"> Y           </span>|<span class="hljs-string"> Y             </span>|<span class="hljs-string"> Y            </span>|<span class="hljs-string"> Y         </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> Y               </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> Y            </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> Y                     </span>|<span class="hljs-string"> Y                </span>|<span class="hljs-string"> Y            </span>|<span class="hljs-string"> Y               </span>|<span class="hljs-string"> Y                </span>|<span class="hljs-string"> Y                </span>|<span class="hljs-string"> Y              </span>|<span class="hljs-string"> Y                   </span>|<span class="hljs-string"> Y                  </span>|<span class="hljs-string"> Y                </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> Y            </span>|<span class="hljs-string"> Y                      </span>|<span class="hljs-string">          </span>|<span class="hljs-string">            </span>|<span class="hljs-string">             </span>|<span class="hljs-string">              </span>|<span class="hljs-string">             0 </span>|<span class="hljs-string">           0 </span>|<span class="hljs-string">               0 </span>|<span class="hljs-string">                    0 </span>|<span class="hljs-string"> mysql_native_password </span>|<span class="hljs-string"> *3B3BDA31178A2C8206145A975A4BE40B705CD27C </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> 2022-07-31 07:29:37   </span>|<span class="hljs-string">              NULL </span>|<span class="hljs-string"> N              </span>|<br>|<span class="hljs-string"> localhost </span>|<span class="hljs-string"> mysql.session </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N         </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N             </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N         </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N               </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> Y          </span>|<span class="hljs-string"> N                     </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N               </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N              </span>|<span class="hljs-string"> N                   </span>|<span class="hljs-string"> N                  </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N                      </span>|<span class="hljs-string">          </span>|<span class="hljs-string">            </span>|<span class="hljs-string">             </span>|<span class="hljs-string">              </span>|<span class="hljs-string">             0 </span>|<span class="hljs-string">           0 </span>|<span class="hljs-string">               0 </span>|<span class="hljs-string">                    0 </span>|<span class="hljs-string"> mysql_native_password </span>|<span class="hljs-string"> *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> 2022-07-31 07:27:09   </span>|<span class="hljs-string">              NULL </span>|<span class="hljs-string"> Y              </span>|<br>|<span class="hljs-string"> localhost </span>|<span class="hljs-string"> mysql.sys     </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N         </span>|<span class="hljs-string"> N           </span>|<span class="hljs-string"> N             </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N         </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N               </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N                     </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N               </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N              </span>|<span class="hljs-string"> N                   </span>|<span class="hljs-string"> N                  </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> N          </span>|<span class="hljs-string"> N            </span>|<span class="hljs-string"> N                      </span>|<span class="hljs-string">          </span>|<span class="hljs-string">            </span>|<span class="hljs-string">             </span>|<span class="hljs-string">              </span>|<span class="hljs-string">             0 </span>|<span class="hljs-string">           0 </span>|<span class="hljs-string">               0 </span>|<span class="hljs-string">                    0 </span>|<span class="hljs-string"> mysql_native_password </span>|<span class="hljs-string"> *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE </span>|<span class="hljs-string"> N                </span>|<span class="hljs-string"> 2022-07-31 07:27:09   </span>|<span class="hljs-string">              NULL </span>|<span class="hljs-string"> Y              </span>|<br>+-----------+---------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select user,host from mysql.user;<br>+---------------+-----------+<br>|<span class="hljs-string"> user          </span>|<span class="hljs-string"> host      </span>|<br>+---------------+-----------+<br>|<span class="hljs-string"> mysql.session </span>|<span class="hljs-string"> localhost </span>|<br>|<span class="hljs-string"> mysql.sys     </span>|<span class="hljs-string"> localhost </span>|<br>|<span class="hljs-string"> root          </span>|<span class="hljs-string"> localhost </span>|<br>+---------------+-----------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; exit<br>Bye<br></code></pre></td></tr></table></figure><h3 id="mysql健康性检查"><a href="#mysql健康性检查" class="headerlink" title="mysql健康性检查"></a>mysql健康性检查</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 ~]# mysqladmin -uroot -p<span class="hljs-string">&#x27;Lyxknx-node1&#x27;</span> ping<br>mysqladmin: [<span class="hljs-built_in">Warning</span>] <span class="hljs-keyword">Using</span> a <span class="hljs-keyword">password</span> <span class="hljs-keyword">on</span> the command <span class="hljs-type">line</span> interface can be insecure.<br>mysqld <span class="hljs-keyword">is</span> alive<br>[root@node1 ~]# mysqladmin -uroot -p<span class="hljs-string">&#x27;Lyxknx-node1&#x27;</span> ping &amp;&gt; /dev/<span class="hljs-keyword">null</span> <br>[root@node1 ~]# echo $?               # 可以写成mysql健康性检查脚本<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="mysqladmin的用法"><a href="#mysqladmin的用法" class="headerlink" title="mysqladmin的用法"></a>mysqladmin的用法</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><code class="hljs applescript">[root@node1 ~]<span class="hljs-comment"># mysqladmin --help</span><br>mysqladmin  Ver <span class="hljs-number">8.42</span> Distrib <span class="hljs-number">5.7</span><span class="hljs-number">.39</span>, <span class="hljs-keyword">for</span> Linux <span class="hljs-keyword">on</span> x86_64<br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2022</span>, Oracle <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> <span class="hljs-keyword">its</span> affiliates.<br><br>Oracle <span class="hljs-keyword">is</span> a registered trademark <span class="hljs-keyword">of</span> Oracle Corporation <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> <span class="hljs-keyword">its</span><br>affiliates. Other names may be trademarks <span class="hljs-keyword">of</span> their respective<br>owners.<br><br>Administration program <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> mysqld daemon.<br>Usage: mysqladmin [OPTIONS] command command....<br>  <span class="hljs-comment">--bind-address=name IP address to bind to.</span><br>  -c, <span class="hljs-comment">--count=#       Number of iterations to make. This works with -i</span><br>                      (<span class="hljs-comment">--sleep) only.</span><br>  -<span class="hljs-comment">#, --debug[=#]     This is a non-debug version. Catch this and exit.</span><br>  <span class="hljs-comment">--debug-check       This is a non-debug version. Catch this and exit.</span><br>  <span class="hljs-comment">--debug-info        This is a non-debug version. Catch this and exit.</span><br>  -f, <span class="hljs-comment">--force         Don&#x27;t ask for confirmation on drop database; with</span><br>                      multiple commands, <span class="hljs-keyword">continue</span> even <span class="hljs-keyword">if</span> an <span class="hljs-keyword">error</span> occurs.<br>  -C, <span class="hljs-comment">--compress      Use compression in server/client protocol.</span><br>  <span class="hljs-comment">--character-sets-dir=name </span><br>                      Directory <span class="hljs-keyword">for</span> <span class="hljs-built_in">character</span> <span class="hljs-keyword">set</span> files.<br>  <span class="hljs-comment">--default-character-set=name </span><br>                      Set <span class="hljs-keyword">the</span> default <span class="hljs-built_in">character</span> <span class="hljs-keyword">set</span>.<br>  -?, <span class="hljs-comment">--help          Display this help and exit.</span><br>  -h, <span class="hljs-comment">--host=name     Connect to host.</span><br>  -b, <span class="hljs-comment">--no-beep       Turn off beep on error.</span><br>  -p, <span class="hljs-comment">--password[=name] </span><br>                      Password <span class="hljs-keyword">to</span> use when connecting <span class="hljs-keyword">to</span> server. If password <span class="hljs-keyword">is</span><br>                      <span class="hljs-keyword">not</span> <span class="hljs-keyword">given</span> <span class="hljs-keyword">it</span>&#x27;s asked <span class="hljs-keyword">from</span> <span class="hljs-keyword">the</span> tty.<br>  -P, <span class="hljs-comment">--port=#        Port number to use for connection or 0 for default to, in</span><br>                      order <span class="hljs-keyword">of</span> preference, <span class="hljs-keyword">my</span>.cnf, $MYSQL_TCP_PORT,<br>                      /etc/services, built-<span class="hljs-keyword">in</span> default (<span class="hljs-number">3306</span>).<br>  <span class="hljs-comment">--protocol=name     The protocol to use for connection (tcp, socket, pipe,</span><br>                      memory).<br>  -r, <span class="hljs-comment">--relative      Show difference between current and previous values when</span><br>                      used <span class="hljs-keyword">with</span> -i. Currently only works <span class="hljs-keyword">with</span> extended-status.<br>  <span class="hljs-comment">--secure-auth       Refuse client connecting to server if it uses old</span><br>                      (pre<span class="hljs-number">-4.1</span><span class="hljs-number">.1</span>) protocol. Deprecated. Always TRUE<br>  -s, <span class="hljs-comment">--silent        Silently exit if one can&#x27;t connect to server.</span><br>  -S, <span class="hljs-comment">--socket=name   The socket file to use for connection.</span><br>  -i, <span class="hljs-comment">--sleep=#       Execute commands repeatedly with a sleep between.</span><br>  <span class="hljs-comment">--ssl-mode=name     SSL connection mode.</span><br>  <span class="hljs-comment">--ssl               Deprecated. Use --ssl-mode instead.</span><br>                      (Defaults <span class="hljs-keyword">to</span> <span class="hljs-keyword">on</span>; use <span class="hljs-comment">--skip-ssl to disable.)</span><br>  <span class="hljs-comment">--ssl-verify-server-cert </span><br>                      Deprecated. Use <span class="hljs-comment">--ssl-mode=VERIFY_IDENTITY instead.</span><br>  <span class="hljs-comment">--ssl-ca=name       CA file in PEM format.</span><br>  <span class="hljs-comment">--ssl-capath=name   CA directory.</span><br>  <span class="hljs-comment">--ssl-cert=name     X509 cert in PEM format.</span><br>  <span class="hljs-comment">--ssl-cipher=name   SSL cipher to use.</span><br>  <span class="hljs-comment">--ssl-key=name      X509 key in PEM format.</span><br>  <span class="hljs-comment">--ssl-crl=name      Certificate revocation list.</span><br>  <span class="hljs-comment">--ssl-crlpath=name  Certificate revocation list path.</span><br>  <span class="hljs-comment">--tls-version=name  TLS version to use, permitted values are: TLSv1, TLSv1.1,</span><br>                      TLSv1<span class="hljs-number">.2</span><br>  <span class="hljs-comment">--server-public-key-path=name </span><br>                      File <span class="hljs-built_in">path to</span> <span class="hljs-keyword">the</span> server public RSA key <span class="hljs-keyword">in</span> PEM format.<br>  <span class="hljs-comment">--get-server-public-key </span><br>                      Get server public key<br>  -u, <span class="hljs-comment">--user=name     User for login if not current user.</span><br>  -v, <span class="hljs-comment">--verbose       Write more information.</span><br>  -V, <span class="hljs-comment">--version       Output version information and exit.</span><br>  -E, <span class="hljs-comment">--vertical      Print output vertically. Is similar to --relative, but</span><br>                      prints output vertically.<br>  -w, <span class="hljs-comment">--wait[=#]      Wait and retry if connection is down.</span><br>  <span class="hljs-comment">--connect-timeout=# </span><br>  <span class="hljs-comment">--shutdown-timeout=# </span><br>  <span class="hljs-comment">--plugin-dir=name   Directory for client-side plugins.</span><br>  <span class="hljs-comment">--default-auth=name Default authentication client-side plugin to use.</span><br>  <span class="hljs-comment">--enable-cleartext-plugin </span><br>                      Enable/disable <span class="hljs-keyword">the</span> clear <span class="hljs-built_in">text</span> authentication plugin.<br>  <span class="hljs-comment">--show-warnings     Show warnings after execution</span><br><br>Variables (<span class="hljs-comment">--variable-name=value)</span><br><span class="hljs-keyword">and</span> <span class="hljs-built_in">boolean</span> options &#123;FALSE|TRUE&#125;  Value (<span class="hljs-keyword">after</span> reading options)<br><span class="hljs-comment">--------------------------------- ----------------------------------------</span><br>bind-address                      (No default value)<br><span class="hljs-built_in">count</span>                             <span class="hljs-number">0</span><br>force                             FALSE<br>compress                          FALSE<br><span class="hljs-built_in">character</span>-sets-dir                (No default value)<br>default-<span class="hljs-built_in">character</span>-<span class="hljs-keyword">set</span>             auto<br>host                              (No default value)<br>no-<span class="hljs-built_in">beep</span>                           FALSE<br>port                              <span class="hljs-number">0</span><br>relative                          FALSE<br>secure-auth                       TRUE<br>socket                            (No default value)<br>sleep                             <span class="hljs-number">0</span><br>ssl                               TRUE<br>ssl-verify-server-cert            FALSE<br>ssl-ca                            (No default value)<br>ssl-capath                        (No default value)<br>ssl-cert                          (No default value)<br>ssl-cipher                        (No default value)<br>ssl-key                           (No default value)<br>ssl-crl                           (No default value)<br>ssl-crlpath                       (No default value)<br>tls-<span class="hljs-built_in">version</span>                       (No default value)<br>server-public-key-path            (No default value)<br><span class="hljs-keyword">get</span>-server-public-key             FALSE<br>user                              (No default value)<br>verbose                           FALSE<br>vertical                          FALSE<br>connect-<span class="hljs-keyword">timeout</span>                   <span class="hljs-number">43200</span><br>shutdown-<span class="hljs-keyword">timeout</span>                  <span class="hljs-number">3600</span><br>plugin-dir                        (No default value)<br>default-auth                      (No default value)<br>enable-cleartext-plugin           FALSE<br>show-warnings                     FALSE<br><br>Default options are <span class="hljs-built_in">read</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">the</span> following files <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">given</span> order:<br>/etc/<span class="hljs-keyword">my</span>.cnf /etc/mysql/<span class="hljs-keyword">my</span>.cnf /usr/etc/<span class="hljs-keyword">my</span>.cnf ~/.<span class="hljs-keyword">my</span>.cnf <br>The following groups are <span class="hljs-built_in">read</span>: mysqladmin client<br>The following options may be <span class="hljs-keyword">given</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> argument:<br><span class="hljs-comment">--print-defaults        Print the program argument list and exit.</span><br><span class="hljs-comment">--no-defaults           Don&#x27;t read default options from any option file,</span><br>                        except <span class="hljs-keyword">for</span> login <span class="hljs-built_in">file</span>.<br><span class="hljs-comment">--defaults-file=#       Only read default options from the given file #.</span><br><span class="hljs-comment">--defaults-extra-file=# Read this file after the global files are read.</span><br><span class="hljs-comment">--defaults-group-suffix=#</span><br>                        Also <span class="hljs-built_in">read</span> groups <span class="hljs-keyword">with</span> concat(group, suffix)<br><span class="hljs-comment">--login-path=#          Read this path from the login file.</span><br><br>Where command <span class="hljs-keyword">is</span> a one <span class="hljs-keyword">or</span> more <span class="hljs-keyword">of</span>: (Commands may be shortened)<br>  create databasenameCreate a new database<br>  debugInstruct server <span class="hljs-keyword">to</span> <span class="hljs-built_in">write</span> debug information <span class="hljs-keyword">to</span> <span class="hljs-built_in">log</span><br>  drop databasenameDelete a database <span class="hljs-keyword">and</span> all <span class="hljs-keyword">its</span> tables<br>  extended-status       Gives an extended status message <span class="hljs-keyword">from</span> <span class="hljs-keyword">the</span> server<br>  flush-hosts           Flush all cached hosts<br>  flush-logs            Flush all logs<br>  flush-statusClear status variables<br>  flush-tables          Flush all tables<br>  flush-threads         Flush <span class="hljs-keyword">the</span> thread cache<br>  flush-privileges      Reload grant tables (same <span class="hljs-keyword">as</span> reload)<br>  kill <span class="hljs-built_in">id</span>,<span class="hljs-built_in">id</span>,...Kill mysql threads<br>  password [new-password] Change old password <span class="hljs-keyword">to</span> new-password <span class="hljs-keyword">in</span> current format<br>  pingCheck <span class="hljs-keyword">if</span> mysqld <span class="hljs-keyword">is</span> alive<br>  processlistShow <span class="hljs-built_in">list</span> <span class="hljs-keyword">of</span> active threads <span class="hljs-keyword">in</span> server<br>  reloadReload grant tables<br>  refreshFlush all tables <span class="hljs-keyword">and</span> close <span class="hljs-keyword">and</span> open logfiles<br>  shutdownTake server down<br>  statusGives a short status message <span class="hljs-keyword">from</span> <span class="hljs-keyword">the</span> server<br>  start-slaveStart slave<br>  stop-slaveStop slave<br>  variables             Prints variables available<br>  <span class="hljs-built_in">version</span>Get <span class="hljs-built_in">version</span> info <span class="hljs-keyword">from</span> server<br>[root@node1 ~]<span class="hljs-comment"># </span><br>[root@node1 ~]<span class="hljs-comment"># </span><br>[root@node1 ~]<span class="hljs-comment"># mysqladmin -uroot -p&#x27;Lyxknx-node1&#x27; status</span><br>mysqladmin: [Warning] Using a password <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> command line interface can be insecure.<br>Uptime: <span class="hljs-number">9990</span>  Threads: <span class="hljs-number">1</span>  Questions: <span class="hljs-number">101</span>  Slow queries: <span class="hljs-number">0</span>  Opens: <span class="hljs-number">176</span>  Flush tables: <span class="hljs-number">1</span>  Open tables: <span class="hljs-number">169</span>  Queries per <span class="hljs-keyword">second</span> avg: <span class="hljs-number">0.010</span><br>[root@node1 ~]<span class="hljs-comment"># mysqladmin -uroot -p&#x27;Lyxknx-node1&#x27; shutdown </span><br>mysqladmin: [Warning] Using a password <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> command line interface can be insecure.<br>[root@node1 ~]<span class="hljs-comment"># mysqladmin -uroot -p&#x27;Lyxknx-node1&#x27; status</span><br>mysqladmin: [Warning] Using a password <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> command line interface can be insecure.<br>mysqladmin: connect <span class="hljs-keyword">to</span> server <span class="hljs-keyword">at</span> &#x27;localhost&#x27; failed<br><span class="hljs-keyword">error</span>: &#x27;Can&#x27;t connect <span class="hljs-keyword">to</span> <span class="hljs-keyword">local</span> MySQL server <span class="hljs-keyword">through</span> socket &#x27;/var/lib/mysql/mysql.sock&#x27; (<span class="hljs-number">2</span>)&#x27;<br>Check <span class="hljs-keyword">that</span> mysqld <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">that</span> <span class="hljs-keyword">the</span> socket: &#x27;/var/lib/mysql/mysql.sock&#x27; exists!<br>[root@node1 ~]<span class="hljs-comment"># ss -ntl</span><br>State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port              <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                               *:<span class="hljs-number">22</span>                                            *:*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                       <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">25</span>                                            *:*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                              :::<span class="hljs-number">22</span>                                           :::*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                             ::<span class="hljs-number">1</span>:<span class="hljs-number">25</span>                                           :::*                  <br>[root@node1 ~]<span class="hljs-comment"># systemctl start mysqld</span><br>[root@node1 ~]<span class="hljs-comment"># ss -ntl</span><br>State      Recv-Q Send-Q                Local Address:Port                               Peer Address:Port              <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                               *:<span class="hljs-number">22</span>                                            *:*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                       <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">25</span>                                            *:*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">80</span>                               :::<span class="hljs-number">3306</span>                                         :::*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">128</span>                              :::<span class="hljs-number">22</span>                                           :::*                  <br>LISTEN     <span class="hljs-number">0</span>      <span class="hljs-number">100</span>                             ::<span class="hljs-number">1</span>:<span class="hljs-number">25</span>                                           :::*                  <br>[root@node1 ~]<span class="hljs-comment"># mysqladmin -uroot -p&#x27;Lyxknx-node1&#x27; status</span><br>mysqladmin: [Warning] Using a password <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> command line interface can be insecure.<br>Uptime: <span class="hljs-number">6</span>  Threads: <span class="hljs-number">1</span>  Questions: <span class="hljs-number">2</span>  Slow queries: <span class="hljs-number">0</span>  Opens: <span class="hljs-number">106</span>  Flush tables: <span class="hljs-number">1</span>  Open tables: <span class="hljs-number">99</span>  Queries per <span class="hljs-keyword">second</span> avg: <span class="hljs-number">0.333</span><br></code></pre></td></tr></table></figure><h3 id="针对MySQL5-6前的版本进行安全加固"><a href="#针对MySQL5-6前的版本进行安全加固" class="headerlink" title="针对MySQL5.6前的版本进行安全加固"></a>针对MySQL5.6前的版本进行安全加固</h3><p>mysql5.6以前的版本，默认情况下，不输入密码就可以登录，并且用户名随便输入都可以，所以需要进行加固以提高安全性。</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs gauss">[root<span class="hljs-comment">@node1 ~]# mysql_secure_installation          # 脚本</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Securing the MySQL server deployment.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Enter password for user root: </span><br><span class="hljs-comment">The &#x27;validate_password&#x27; plugin is installed on the server.</span><br><span class="hljs-comment">The subsequent steps will run with the existing configuration</span><br><span class="hljs-comment">of the plugin.</span><br><span class="hljs-comment">Using existing password for root.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Estimated strength of the password: 100 </span><br><span class="hljs-comment">Change the password for root ? ((Press y|Y for Yes, any other key for No) : n     #改root密码</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> ... skipping.</span><br><span class="hljs-comment">By default, a MySQL installation has an anonymous user,</span><br><span class="hljs-comment">allowing anyone to log into MySQL without having to have</span><br><span class="hljs-comment">a user account created for them. This is intended only for</span><br><span class="hljs-comment">testing, and to make the installation go a bit smoother.</span><br><span class="hljs-comment">You should remove them before moving into a production</span><br><span class="hljs-comment">environment.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Remove anonymous users? (Press y|Y for Yes, any other key for No) : y      #清除匿名用户，避免随便敲用户名都可以登录的这种情况</span><br><span class="hljs-comment">Success.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Normally, root should only be allowed to connect from</span><br><span class="hljs-comment">&#x27;localhost&#x27;. This ensures that someone cannot guess at</span><br><span class="hljs-comment">the root password from the network.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n   #是否禁止root用户远程登录</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> ... skipping.</span><br><span class="hljs-comment">By default, MySQL comes with a database named &#x27;test&#x27; that</span><br><span class="hljs-comment">anyone can access. This is also intended only for testing,</span><br><span class="hljs-comment">and should be removed before moving into a production</span><br><span class="hljs-comment">environment.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y     #清除测试数据库</span><br><span class="hljs-comment"> - Dropping test database...</span><br><span class="hljs-comment">Success.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> - Removing privileges on test database...</span><br><span class="hljs-comment">Success.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Reloading the privilege tables will ensure that all changes</span><br><span class="hljs-comment">made so far will take effect immediately.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y</span><br><span class="hljs-comment">Success.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">All done!</span><br></code></pre></td></tr></table></figure><h2 id="通用二进制格式安装Mysql"><a href="#通用二进制格式安装Mysql" class="headerlink" title="通用二进制格式安装Mysql"></a>通用二进制格式安装Mysql</h2><h3 id="准备用户"><a href="#准备用户" class="headerlink" title="准备用户"></a>准备用户</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@node4</span> ~]<span class="hljs-meta"># groupadd -r -g 306 mysql</span><br>[root<span class="hljs-symbol">@node4</span> ~]<span class="hljs-meta"># useradd -r -g 306 -u 306 -d /data/mysql mysql</span><br></code></pre></td></tr></table></figure><h3 id="准备数据目录，建议使用逻辑卷"><a href="#准备数据目录，建议使用逻辑卷" class="headerlink" title="准备数据目录，建议使用逻辑卷"></a>准备数据目录，建议使用逻辑卷</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node4 ~]# mkdir -p <span class="hljs-regexp">/data/my</span>sql<br>[root@node4 ~]# ll -d <span class="hljs-regexp">/data/my</span>sql/<br>drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">6</span> Jul <span class="hljs-number">31</span> <span class="hljs-number">11</span>:<span class="hljs-number">05</span> <span class="hljs-regexp">/data/my</span>sql/<br><br>[root@node4 ~]# chown mysql:mysql <span class="hljs-regexp">/data/my</span>sql/<br><br>[root@node4 ~]# ll -d <span class="hljs-regexp">/data/my</span>sql/<br>drwxr-xr-x <span class="hljs-number">2</span> mysql mysql <span class="hljs-number">6</span> Jul <span class="hljs-number">31</span> <span class="hljs-number">11</span>:<span class="hljs-number">05</span> <span class="hljs-regexp">/data/my</span>sql/<br></code></pre></td></tr></table></figure><h3 id="准备二进制程序"><a href="#准备二进制程序" class="headerlink" title="准备二进制程序"></a>准备二进制程序</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node4 ~]<span class="hljs-comment"># tar -xf mysql-5.7.29-el7-x86_64.tar.gz -C /usr/local/</span><br>[root@node4 ~]<span class="hljs-comment"># cd  /usr/local/</span><br>[root@node4 local]<span class="hljs-comment"># ls</span><br>bin  etc  games  include  lib  lib64  libexec  mysql-5.7.29-el7-x86_64  sbin  share  src<br><br>[root@node4 local]<span class="hljs-comment"># ln -sv mysql-5.7.29-el7-x86_64 mysql</span><br>‘mysql’ -&gt; ‘mysql-5.7.29-el7-x86_64’<br><br>[root@node4 local]<span class="hljs-comment"># ll</span><br>total 0<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>bin<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>etc<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>games<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>include<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>lib<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>lib64<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>libexec<br>lrwxrwxrwx <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 23 </span>Jul<span class="hljs-number"> 31 </span>11:13 mysql -&gt; mysql-5.7.29-el7-x86_64<br>drwxr-xr-x <span class="hljs-number"> 9 </span>root root<span class="hljs-number"> 129 </span>Jul<span class="hljs-number"> 31 </span>11:12 mysql-5.7.29-el7-x86_64<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>sbin<br>drwxr-xr-x.<span class="hljs-number"> 5 </span>root root <span class="hljs-number"> 49 </span>Jun<span class="hljs-number"> 28 </span>17:51 share<br>drwxr-xr-x.<span class="hljs-number"> 2 </span>root root  <span class="hljs-number"> 6 </span>Apr<span class="hljs-number"> 11 </span><span class="hljs-number"> 2018 </span>src<br><br>[root@node4 local]<span class="hljs-comment"># chown -R root:root /usr/local/mysql</span><br></code></pre></td></tr></table></figure><h3 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node4 yum.repos.d]<span class="hljs-comment"># cd /usr/local/mysql</span><br>[root@node4 mysql]<span class="hljs-comment"># ll</span><br>total 220<br>drwxr-xr-x <span class="hljs-number"> 2 </span>root root   <span class="hljs-number"> 4096 </span>Jul<span class="hljs-number"> 31 </span>11:33 bin<br>drwxr-xr-x <span class="hljs-number"> 3 </span>root root     <span class="hljs-number"> 18 </span>Jul<span class="hljs-number"> 31 </span>11:33 data<br>drwxr-xr-x <span class="hljs-number"> 2 </span>root root     <span class="hljs-number"> 55 </span>Jul<span class="hljs-number"> 31 </span>11:33 docs<br>drwxr-xr-x <span class="hljs-number"> 3 </span>root root   <span class="hljs-number"> 4096 </span>Jul<span class="hljs-number"> 31 </span>11:33 include<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root   <span class="hljs-number"> 1667 </span>Jul<span class="hljs-number"> 31 </span>11:53 install_mysql.sh<br>drwxr-xr-x <span class="hljs-number"> 3 </span>root root    <span class="hljs-number"> 316 </span>Jul<span class="hljs-number"> 31 </span>11:33 lib<br>-rw-r--r-- <span class="hljs-number"> 1 </span>7161<span class="hljs-number"> 31415 </span>200256 Jan <span class="hljs-number"> 5 </span><span class="hljs-number"> 2021 </span>LICENSE<br>drwxr-xr-x <span class="hljs-number"> 4 </span>root root     <span class="hljs-number"> 30 </span>Jul<span class="hljs-number"> 31 </span>11:33 man<br>drwxr-xr-x<span class="hljs-number"> 10 </span>root root    <span class="hljs-number"> 291 </span>Jul<span class="hljs-number"> 31 </span>11:33 mysql-test<br>-rw-r--r-- <span class="hljs-number"> 1 </span>7161<span class="hljs-number"> 31415 </span>  <span class="hljs-number"> 566 </span>Jan <span class="hljs-number"> 5 </span><span class="hljs-number"> 2021 </span>README<br>drwxr-xr-x <span class="hljs-number"> 2 </span>root root     <span class="hljs-number"> 30 </span>Jul<span class="hljs-number"> 31 </span>11:33 scripts<br>drwxr-xr-x<span class="hljs-number"> 28 </span>root root   <span class="hljs-number"> 4096 </span>Jul<span class="hljs-number"> 31 </span>11:33 share<br>drwxr-xr-x <span class="hljs-number"> 4 </span>root root   <span class="hljs-number"> 4096 </span>Jul<span class="hljs-number"> 31 </span>11:33 sql-bench<br>drwxr-xr-x <span class="hljs-number"> 2 </span>root root    <span class="hljs-number"> 136 </span>Jul<span class="hljs-number"> 31 </span>11:33 support-files<br>[root@node4 mysql]<span class="hljs-comment"># ./scripts/mysql_install_db --datadir=/data/mysql/ --user=mysql</span><br>FATAL ERROR: please install the following Perl modules before executing ./scripts/mysql_install_db:<br>Data::Dumper<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@node2 yum.repos.d]</span><span class="hljs-comment"># cat epel.repo </span><br><span class="hljs-section">[epel]</span><br><span class="hljs-attr">name</span>=Extra Packages for Enterprise Linux <span class="hljs-number">7</span> - <span class="hljs-variable">$basearch</span><br><span class="hljs-attr">baseurl</span>=http://mirrors.aliyun.com/epel/<span class="hljs-number">7</span>/<span class="hljs-variable">$basearch</span><br><span class="hljs-attr">failovermethod</span>=priority<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span><br> <br><span class="hljs-section">[epel-debuginfo]</span><br><span class="hljs-attr">name</span>=Extra Packages for Enterprise Linux <span class="hljs-number">7</span> - <span class="hljs-variable">$basearch</span> - Debug<br><span class="hljs-attr">baseurl</span>=http://mirrors.aliyun.com/epel/<span class="hljs-number">7</span>/<span class="hljs-variable">$basearch</span>/debug<br><span class="hljs-attr">failovermethod</span>=priority<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span><br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br> <br><span class="hljs-section">[epel-source]</span><br><span class="hljs-attr">name</span>=Extra Packages for Enterprise Linux <span class="hljs-number">7</span> - <span class="hljs-variable">$basearch</span> - Source<br><span class="hljs-attr">baseurl</span>=http://mirrors.aliyun.com/epel/<span class="hljs-number">7</span>/SRPMS<br><span class="hljs-attr">failovermethod</span>=priority<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-<span class="hljs-number">7</span><br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node4</span> <span class="hljs-string">mysql</span>]<span class="hljs-comment"># yum install autoconf</span><br>[<span class="hljs-string">root@node4</span> <span class="hljs-string">mysql</span>]<span class="hljs-comment"># ./scripts/mysql_install_db --datadir=/data/mysql/ --user=mysql</span><br><span class="hljs-string">Installing</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">system</span> <span class="hljs-string">tables...2022-08-01</span> <span class="hljs-number">08</span><span class="hljs-string">:58:08</span> <span class="hljs-number">0</span> [<span class="hljs-string">Warning</span>] <span class="hljs-string">TIMESTAMP</span> <span class="hljs-string">with</span> <span class="hljs-string">implicit</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">value</span> <span class="hljs-string">is</span> <span class="hljs-string">deprecated.</span> <span class="hljs-string">Please</span> <span class="hljs-string">use</span> <span class="hljs-string">--explicit_defaults_for_timestamp</span> <span class="hljs-string">server</span> <span class="hljs-string">option</span> <span class="hljs-string">(see</span> <span class="hljs-string">documentation</span> <span class="hljs-string">for</span> <span class="hljs-string">more</span> <span class="hljs-string">details).</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">0</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">Ignoring</span> <span class="hljs-string">--secure-file-priv</span> <span class="hljs-string">value</span> <span class="hljs-string">as</span> <span class="hljs-string">server</span> <span class="hljs-string">is</span> <span class="hljs-string">running</span> <span class="hljs-string">with</span> <span class="hljs-string">--bootstrap.</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">0</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">./bin/mysqld</span> <span class="hljs-string">(mysqld</span> <span class="hljs-number">5.6</span><span class="hljs-number">.51</span><span class="hljs-string">)</span> <span class="hljs-string">starting</span> <span class="hljs-string">as</span> <span class="hljs-string">process</span> <span class="hljs-number">7876</span> <span class="hljs-string">...</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">atomics</span> <span class="hljs-string">to</span> <span class="hljs-string">ref</span> <span class="hljs-string">count</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool</span> <span class="hljs-string">pages</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">The</span> <span class="hljs-string">InnoDB</span> <span class="hljs-string">memory</span> <span class="hljs-string">heap</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Mutexes</span> <span class="hljs-string">and</span> <span class="hljs-string">rw_locks</span> <span class="hljs-string">use</span> <span class="hljs-string">GCC</span> <span class="hljs-string">atomic</span> <span class="hljs-string">builtins</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Memory</span> <span class="hljs-string">barrier</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">used</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Compressed</span> <span class="hljs-string">tables</span> <span class="hljs-string">use</span> <span class="hljs-string">zlib</span> <span class="hljs-number">1.2</span><span class="hljs-number">.11</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">Linux</span> <span class="hljs-string">native</span> <span class="hljs-string">AIO</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">CPU</span> <span class="hljs-string">crc32</span> <span class="hljs-string">instructions</span><br><span class="hljs-number">2022-08-01 08:58:08 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Initializing</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool,</span> <span class="hljs-string">size</span> <span class="hljs-string">=</span> <span class="hljs-number">128.</span><span class="hljs-string">0M</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Completed</span> <span class="hljs-string">initialization</span> <span class="hljs-string">of</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB: The first specified data file ./ibdata1 did not exist:</span> <span class="hljs-string">a</span> <span class="hljs-string">new</span> <span class="hljs-string">database</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">created!</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">file</span> <span class="hljs-string">./ibdata1</span> <span class="hljs-string">size</span> <span class="hljs-string">to</span> <span class="hljs-number">12</span> <span class="hljs-string">MB</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB: Database physically writes the file full:</span> <span class="hljs-string">wait...</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">log</span> <span class="hljs-string">file</span> <span class="hljs-string">./ib_logfile101</span> <span class="hljs-string">size</span> <span class="hljs-string">to</span> <span class="hljs-number">48</span> <span class="hljs-string">MB</span><br><span class="hljs-number">2022-08-01 08:58:09 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Setting</span> <span class="hljs-string">log</span> <span class="hljs-string">file</span> <span class="hljs-string">./ib_logfile1</span> <span class="hljs-string">size</span> <span class="hljs-string">to</span> <span class="hljs-number">48</span> <span class="hljs-string">MB</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Renaming</span> <span class="hljs-string">log</span> <span class="hljs-string">file</span> <span class="hljs-string">./ib_logfile101</span> <span class="hljs-string">to</span> <span class="hljs-string">./ib_logfile0</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Warning</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">New</span> <span class="hljs-string">log</span> <span class="hljs-string">files</span> <span class="hljs-string">created,</span> <span class="hljs-string">LSN=45781</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB: Doublewrite buffer not found:</span> <span class="hljs-string">creating</span> <span class="hljs-string">new</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Doublewrite</span> <span class="hljs-string">buffer</span> <span class="hljs-string">created</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-number">128</span> <span class="hljs-string">rollback</span> <span class="hljs-string">segment(s)</span> <span class="hljs-string">are</span> <span class="hljs-string">active.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Warning</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Creating</span> <span class="hljs-string">foreign</span> <span class="hljs-string">key</span> <span class="hljs-string">constraint</span> <span class="hljs-string">system</span> <span class="hljs-string">tables.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Foreign</span> <span class="hljs-string">key</span> <span class="hljs-string">constraint</span> <span class="hljs-string">system</span> <span class="hljs-string">tables</span> <span class="hljs-string">created</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Creating</span> <span class="hljs-string">tablespace</span> <span class="hljs-string">and</span> <span class="hljs-string">datafile</span> <span class="hljs-string">system</span> <span class="hljs-string">tables.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Tablespace</span> <span class="hljs-string">and</span> <span class="hljs-string">datafile</span> <span class="hljs-string">system</span> <span class="hljs-string">tables</span> <span class="hljs-string">created.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Waiting</span> <span class="hljs-string">for</span> <span class="hljs-string">purge</span> <span class="hljs-string">to</span> <span class="hljs-string">start</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-number">5.6</span><span class="hljs-number">.51</span> <span class="hljs-string">started;</span> <span class="hljs-string">log</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-number">0</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">RSA private key file not found:</span> <span class="hljs-string">/data/mysql//private_key.pem.</span> <span class="hljs-string">Some</span> <span class="hljs-string">authentication</span> <span class="hljs-string">plugins</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">work.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">RSA public key file not found:</span> <span class="hljs-string">/data/mysql//public_key.pem.</span> <span class="hljs-string">Some</span> <span class="hljs-string">authentication</span> <span class="hljs-string">plugins</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">work.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">Binlog</span> <span class="hljs-string">end</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">FTS</span> <span class="hljs-string">optimize</span> <span class="hljs-string">thread</span> <span class="hljs-string">exiting.</span><br><span class="hljs-number">2022-08-01 08:58:10 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Starting</span> <span class="hljs-string">shutdown...</span><br><span class="hljs-number">2022-08-01 08:58:11 </span><span class="hljs-number">7876</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Shutdown</span> <span class="hljs-string">completed;</span> <span class="hljs-string">log</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-number">1625977</span><br><span class="hljs-string">OK</span><br><br><span class="hljs-string">Filling</span> <span class="hljs-string">help</span> <span class="hljs-string">tables...2022-08-01</span> <span class="hljs-number">08</span><span class="hljs-string">:58:12</span> <span class="hljs-number">0</span> [<span class="hljs-string">Warning</span>] <span class="hljs-string">TIMESTAMP</span> <span class="hljs-string">with</span> <span class="hljs-string">implicit</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">value</span> <span class="hljs-string">is</span> <span class="hljs-string">deprecated.</span> <span class="hljs-string">Please</span> <span class="hljs-string">use</span> <span class="hljs-string">--explicit_defaults_for_timestamp</span> <span class="hljs-string">server</span> <span class="hljs-string">option</span> <span class="hljs-string">(see</span> <span class="hljs-string">documentation</span> <span class="hljs-string">for</span> <span class="hljs-string">more</span> <span class="hljs-string">details).</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">0</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">Ignoring</span> <span class="hljs-string">--secure-file-priv</span> <span class="hljs-string">value</span> <span class="hljs-string">as</span> <span class="hljs-string">server</span> <span class="hljs-string">is</span> <span class="hljs-string">running</span> <span class="hljs-string">with</span> <span class="hljs-string">--bootstrap.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">0</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">./bin/mysqld</span> <span class="hljs-string">(mysqld</span> <span class="hljs-number">5.6</span><span class="hljs-number">.51</span><span class="hljs-string">)</span> <span class="hljs-string">starting</span> <span class="hljs-string">as</span> <span class="hljs-string">process</span> <span class="hljs-number">7898</span> <span class="hljs-string">...</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">atomics</span> <span class="hljs-string">to</span> <span class="hljs-string">ref</span> <span class="hljs-string">count</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool</span> <span class="hljs-string">pages</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">The</span> <span class="hljs-string">InnoDB</span> <span class="hljs-string">memory</span> <span class="hljs-string">heap</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Mutexes</span> <span class="hljs-string">and</span> <span class="hljs-string">rw_locks</span> <span class="hljs-string">use</span> <span class="hljs-string">GCC</span> <span class="hljs-string">atomic</span> <span class="hljs-string">builtins</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Memory</span> <span class="hljs-string">barrier</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">used</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Compressed</span> <span class="hljs-string">tables</span> <span class="hljs-string">use</span> <span class="hljs-string">zlib</span> <span class="hljs-number">1.2</span><span class="hljs-number">.11</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">Linux</span> <span class="hljs-string">native</span> <span class="hljs-string">AIO</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Using</span> <span class="hljs-string">CPU</span> <span class="hljs-string">crc32</span> <span class="hljs-string">instructions</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Initializing</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool,</span> <span class="hljs-string">size</span> <span class="hljs-string">=</span> <span class="hljs-number">128.</span><span class="hljs-string">0M</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Completed</span> <span class="hljs-string">initialization</span> <span class="hljs-string">of</span> <span class="hljs-string">buffer</span> <span class="hljs-string">pool</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Highest</span> <span class="hljs-string">supported</span> <span class="hljs-string">file</span> <span class="hljs-string">format</span> <span class="hljs-string">is</span> <span class="hljs-string">Barracuda.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-number">128</span> <span class="hljs-string">rollback</span> <span class="hljs-string">segment(s)</span> <span class="hljs-string">are</span> <span class="hljs-string">active.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Waiting</span> <span class="hljs-string">for</span> <span class="hljs-string">purge</span> <span class="hljs-string">to</span> <span class="hljs-string">start</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-number">5.6</span><span class="hljs-number">.51</span> <span class="hljs-string">started;</span> <span class="hljs-string">log</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-number">1625977</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">RSA private key file not found:</span> <span class="hljs-string">/data/mysql//private_key.pem.</span> <span class="hljs-string">Some</span> <span class="hljs-string">authentication</span> <span class="hljs-string">plugins</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">work.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">RSA public key file not found:</span> <span class="hljs-string">/data/mysql//public_key.pem.</span> <span class="hljs-string">Some</span> <span class="hljs-string">authentication</span> <span class="hljs-string">plugins</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">work.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-string">Binlog</span> <span class="hljs-string">end</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">FTS</span> <span class="hljs-string">optimize</span> <span class="hljs-string">thread</span> <span class="hljs-string">exiting.</span><br><span class="hljs-number">2022-08-01 08:58:12 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Starting</span> <span class="hljs-string">shutdown...</span><br><span class="hljs-number">2022-08-01 08:58:13 </span><span class="hljs-number">7898</span> [<span class="hljs-string">Note</span>] <span class="hljs-attr">InnoDB:</span> <span class="hljs-string">Shutdown</span> <span class="hljs-string">completed;</span> <span class="hljs-string">log</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-number">1625987</span><br><span class="hljs-string">OK</span><br><br><span class="hljs-string">To</span> <span class="hljs-string">start</span> <span class="hljs-string">mysqld</span> <span class="hljs-string">at</span> <span class="hljs-string">boot</span> <span class="hljs-string">time</span> <span class="hljs-string">you</span> <span class="hljs-string">have</span> <span class="hljs-string">to</span> <span class="hljs-string">copy</span><br><span class="hljs-string">support-files/mysql.server</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">right</span> <span class="hljs-string">place</span> <span class="hljs-string">for</span> <span class="hljs-string">your</span> <span class="hljs-string">system</span><br><br><span class="hljs-string">PLEASE</span> <span class="hljs-string">REMEMBER</span> <span class="hljs-string">TO</span> <span class="hljs-string">SET</span> <span class="hljs-string">A</span> <span class="hljs-string">PASSWORD</span> <span class="hljs-string">FOR</span> <span class="hljs-string">THE</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">root</span> <span class="hljs-string">USER</span> <span class="hljs-string">!</span><br><span class="hljs-string">To</span> <span class="hljs-string">do</span> <span class="hljs-string">so,</span> <span class="hljs-string">start</span> <span class="hljs-string">the</span> <span class="hljs-string">server,</span> <span class="hljs-attr">then issue the following commands:</span><br><br>  <span class="hljs-string">./bin/mysqladmin</span> <span class="hljs-string">-u</span> <span class="hljs-string">root</span> <span class="hljs-string">password</span> <span class="hljs-string">&#x27;new-password&#x27;</span><br>  <span class="hljs-string">./bin/mysqladmin</span> <span class="hljs-string">-u</span> <span class="hljs-string">root</span> <span class="hljs-string">-h</span> <span class="hljs-string">node4</span> <span class="hljs-string">password</span> <span class="hljs-string">&#x27;new-password&#x27;</span><br><br><span class="hljs-attr">Alternatively you can run:</span><br><br>  <span class="hljs-string">./bin/mysql_secure_installation</span><br><br><span class="hljs-string">which</span> <span class="hljs-string">will</span> <span class="hljs-string">also</span> <span class="hljs-string">give</span> <span class="hljs-string">you</span> <span class="hljs-string">the</span> <span class="hljs-string">option</span> <span class="hljs-string">of</span> <span class="hljs-string">removing</span> <span class="hljs-string">the</span> <span class="hljs-string">test</span><br><span class="hljs-string">databases</span> <span class="hljs-string">and</span> <span class="hljs-string">anonymous</span> <span class="hljs-string">user</span> <span class="hljs-string">created</span> <span class="hljs-string">by</span> <span class="hljs-string">default.</span>  <span class="hljs-string">This</span> <span class="hljs-string">is</span><br><span class="hljs-string">strongly</span> <span class="hljs-string">recommended</span> <span class="hljs-string">for</span> <span class="hljs-string">production</span> <span class="hljs-string">servers.</span><br><br><span class="hljs-string">See</span> <span class="hljs-string">the</span> <span class="hljs-string">manual</span> <span class="hljs-string">for</span> <span class="hljs-string">more</span> <span class="hljs-string">instructions.</span><br><br><span class="hljs-attr">You can start the MySQL daemon with:</span><br><br>  <span class="hljs-string">cd</span> <span class="hljs-string">.</span> <span class="hljs-string">;</span> <span class="hljs-string">./bin/mysqld_safe</span> <span class="hljs-string">&amp;</span><br><br><span class="hljs-string">You</span> <span class="hljs-string">can</span> <span class="hljs-string">test</span> <span class="hljs-string">the</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">daemon</span> <span class="hljs-string">with</span> <span class="hljs-string">mysql-test-run.pl</span><br><br>  <span class="hljs-string">cd</span> <span class="hljs-string">mysql-test</span> <span class="hljs-string">;</span> <span class="hljs-string">perl</span> <span class="hljs-string">mysql-test-run.pl</span><br><br><span class="hljs-string">Please</span> <span class="hljs-string">report</span> <span class="hljs-string">any</span> <span class="hljs-string">problems</span> <span class="hljs-string">at</span> <span class="hljs-string">http://bugs.mysql.com/</span><br><br><span class="hljs-string">The</span> <span class="hljs-string">latest</span> <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">is</span> <span class="hljs-string">available</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">web</span> <span class="hljs-string">at</span><br><br>  <span class="hljs-string">http://www.mysql.com</span><br><br><span class="hljs-string">Support</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">by</span> <span class="hljs-string">buying</span> <span class="hljs-string">support/licenses</span> <span class="hljs-string">at</span> <span class="hljs-string">http://shop.mysql.com</span><br><br><span class="hljs-string">New</span> <span class="hljs-string">default</span> <span class="hljs-string">config</span> <span class="hljs-string">file</span> <span class="hljs-string">was</span> <span class="hljs-string">created</span> <span class="hljs-string">as</span> <span class="hljs-string">./my.cnf</span> <span class="hljs-string">and</span><br><span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">default</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">server</span> <span class="hljs-string">when</span> <span class="hljs-string">you</span> <span class="hljs-string">start</span> <span class="hljs-string">it.</span><br><span class="hljs-string">You</span> <span class="hljs-string">may</span> <span class="hljs-string">edit</span> <span class="hljs-string">this</span> <span class="hljs-string">file</span> <span class="hljs-string">to</span> <span class="hljs-string">change</span> <span class="hljs-string">server</span> <span class="hljs-string">settings</span><br><br><span class="hljs-attr">WARNING:</span> <span class="hljs-string">Default</span> <span class="hljs-string">config</span> <span class="hljs-string">file</span> <span class="hljs-string">/etc/my.cnf</span> <span class="hljs-string">exists</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">system</span><br><span class="hljs-string">This</span> <span class="hljs-string">file</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">read</span> <span class="hljs-string">by</span> <span class="hljs-string">default</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">server</span><br><span class="hljs-string">If</span> <span class="hljs-string">you</span> <span class="hljs-string">do</span> <span class="hljs-string">not</span> <span class="hljs-string">want</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">this,</span> <span class="hljs-string">either</span> <span class="hljs-string">remove</span> <span class="hljs-string">it,</span> <span class="hljs-string">or</span> <span class="hljs-string">use</span> <span class="hljs-string">the</span><br><span class="hljs-string">--defaults-file</span> <span class="hljs-string">argument</span> <span class="hljs-string">to</span> <span class="hljs-string">mysqld_safe</span> <span class="hljs-string">when</span> <span class="hljs-string">starting</span> <span class="hljs-string">the</span> <span class="hljs-string">server</span><br></code></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node4 mysql]<span class="hljs-comment"># ls /data/mysql/ -l</span><br>total 110600<br>-rw-rw----<span class="hljs-number"> 1 </span>mysql mysql<span class="hljs-number"> 12582912 </span>Aug <span class="hljs-number"> 1 </span>08:58 ibdata1<br>-rw-rw----<span class="hljs-number"> 1 </span>mysql mysql<span class="hljs-number"> 50331648 </span>Aug <span class="hljs-number"> 1 </span>08:58 ib_logfile0<br>-rw-rw----<span class="hljs-number"> 1 </span>mysql mysql<span class="hljs-number"> 50331648 </span>Aug <span class="hljs-number"> 1 </span>08:58 ib_logfile1<br>drwx------<span class="hljs-number"> 2 </span>mysql mysql    <span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 1 </span>08:58 mysql<br>drwx------<span class="hljs-number"> 2 </span>mysql mysql    <span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 1 </span>08:58 performance_schema<br>drwx------<span class="hljs-number"> 2 </span>mysql mysql       <span class="hljs-number"> 6 </span>Aug <span class="hljs-number"> 1 </span>08:58 test<br></code></pre></td></tr></table></figure><h2 id="使用navicate连接mysql"><a href="#使用navicate连接mysql" class="headerlink" title="使用navicate连接mysql"></a>使用navicate连接mysql</h2><p>连接不上，做如下修改：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; select host  from user where user=&#x27;root&#x27;;</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">| host      |</span><br><span class="hljs-section">+-----------+</span><br><span class="hljs-section">| localhost |</span><br><span class="hljs-section">+-----------+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt; update user set host = <span class="hljs-emphasis">&#x27;%&#x27;</span> where user =<span class="hljs-emphasis">&#x27;root&#x27;</span>;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node3 ~]<span class="hljs-comment"># systemctl disable --now  firewalld</span><br>Removed symlink <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants/firewalld.service.<br>Removed symlink <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>dbus-org.fedoraproject.FirewallD1.service.<br><br>[root@node3 ~]<span class="hljs-comment"># getenforce </span><br>Disabled<br>[root@node3 ~]<span class="hljs-comment"># vim /etc/selinux/config</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>mysql数据库一</category>
      
    </categories>
    
    
    <tags>
      
      <tag>23.1</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>面试相关</title>
    <link href="/2022/07/30/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/"/>
    <url>/2022/07/30/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><p>基础面试题: <a href="https://blog.csdn.net/weixin_45413603/article/details/103304255">https://blog.csdn.net/weixin_45413603/article/details/103304255</a></p>]]></content>
    
    
    <categories>
      
      <category>面试题</category>
      
    </categories>
    
    
    <tags>
      
      <tag>基础面试题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>open-v-p-n介绍和环境准备</title>
    <link href="/2022/07/30/open-v-p-n%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"/>
    <url>/2022/07/30/open-v-p-n%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><p>可以购买阿里云的三台ecs，来做试验，按小时计费即可。</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs coffeescript">[root@node1 yum.repos.d]<span class="hljs-comment"># yum install openvpn</span><br>[root@node1 yum.repos.d]<span class="hljs-comment"># yum install easy-rsa -y</span><br></code></pre></td></tr></table></figure><p>查看包中相关文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node1</span> <span class="hljs-string">yum.repos.d</span>]<span class="hljs-comment"># rpm -qi openvpn easy-rsa</span><br><span class="hljs-attr">Name        :</span> <span class="hljs-string">openvpn</span><br><span class="hljs-attr">Version     :</span> <span class="hljs-number">2.4</span><span class="hljs-number">.12</span><br><span class="hljs-attr">Release     :</span> <span class="hljs-number">1.</span><span class="hljs-string">el7</span><br><span class="hljs-attr">Architecture:</span> <span class="hljs-string">x86_64</span><br><span class="hljs-attr">Install Date:</span> <span class="hljs-string">Sat</span> <span class="hljs-number">30</span> <span class="hljs-string">Jul</span> <span class="hljs-number">2022 03:27:49 </span><span class="hljs-string">PM</span> <span class="hljs-string">CST</span><br><span class="hljs-attr">Group       :</span> <span class="hljs-string">Unspecified</span><br><span class="hljs-attr">Size        :</span> <span class="hljs-number">1286851</span><br><span class="hljs-attr">License     :</span> <span class="hljs-string">GPLv2</span><br><span class="hljs-attr">Signature   :</span> <span class="hljs-string">RSA/SHA256,</span> <span class="hljs-string">Fri</span> <span class="hljs-number">18</span> <span class="hljs-string">Mar</span> <span class="hljs-number">2022 05:21:26 </span><span class="hljs-string">AM</span> <span class="hljs-string">CST,</span> <span class="hljs-string">Key</span> <span class="hljs-string">ID</span> <span class="hljs-string">6a2faea2352c64e5</span><br><span class="hljs-attr">Source RPM  :</span> <span class="hljs-string">openvpn-2.4.12-1.el7.src.rpm</span><br><span class="hljs-attr">Build Date  :</span> <span class="hljs-string">Fri</span> <span class="hljs-number">18</span> <span class="hljs-string">Mar</span> <span class="hljs-number">2022 02:59:28 </span><span class="hljs-string">AM</span> <span class="hljs-string">CST</span><br><span class="hljs-attr">Build Host  :</span> <span class="hljs-string">buildvm-x86-10.iad2.fedoraproject.org</span><br><span class="hljs-attr">Relocations :</span> <span class="hljs-string">(not</span> <span class="hljs-string">relocatable)</span><br><span class="hljs-attr">Packager    :</span> <span class="hljs-string">Fedora</span> <span class="hljs-string">Project</span><br><span class="hljs-attr">Vendor      :</span> <span class="hljs-string">Fedora</span> <span class="hljs-string">Project</span><br><span class="hljs-attr">URL         :</span> <span class="hljs-string">https://community.openvpn.net/</span><br><span class="hljs-attr">Bug URL     :</span> <span class="hljs-string">https://bugz.fedoraproject.org/openvpn</span><br><span class="hljs-attr">Summary     :</span> <span class="hljs-string">A</span> <span class="hljs-string">full-featured</span> <span class="hljs-string">SSL</span> <span class="hljs-string">VPN</span> <span class="hljs-string">solution</span><br><span class="hljs-attr">Description :</span><br><span class="hljs-string">OpenVPN</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">robust</span> <span class="hljs-string">and</span> <span class="hljs-string">highly</span> <span class="hljs-string">flexible</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">application</span> <span class="hljs-string">that</span> <span class="hljs-string">uses</span> <span class="hljs-string">all</span><br><span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">encryption,</span> <span class="hljs-string">authentication,</span> <span class="hljs-string">and</span> <span class="hljs-string">certification</span> <span class="hljs-string">features</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br><span class="hljs-string">OpenSSL</span> <span class="hljs-string">library</span> <span class="hljs-string">to</span> <span class="hljs-string">securely</span> <span class="hljs-string">tunnel</span> <span class="hljs-string">IP</span> <span class="hljs-string">networks</span> <span class="hljs-string">over</span> <span class="hljs-string">a</span> <span class="hljs-string">single</span> <span class="hljs-string">UDP</span> <span class="hljs-string">or</span> <span class="hljs-string">TCP</span><br><span class="hljs-string">port.</span>  <span class="hljs-string">It</span> <span class="hljs-string">can</span> <span class="hljs-string">use</span> <span class="hljs-string">the</span> <span class="hljs-string">Marcus</span> <span class="hljs-string">Franz</span> <span class="hljs-string">Xaver</span> <span class="hljs-string">Johannes</span> <span class="hljs-string">Oberhumers</span> <span class="hljs-string">LZO</span> <span class="hljs-string">library</span><br><span class="hljs-string">for</span> <span class="hljs-string">compression.</span><br><span class="hljs-attr">Name        :</span> <span class="hljs-string">easy-rsa</span><br><span class="hljs-attr">Version     :</span> <span class="hljs-number">3.0</span><span class="hljs-number">.8</span><br><span class="hljs-attr">Release     :</span> <span class="hljs-number">1.</span><span class="hljs-string">el7</span><br><span class="hljs-attr">Architecture:</span> <span class="hljs-string">noarch</span><br><span class="hljs-attr">Install Date:</span> <span class="hljs-string">Sat</span> <span class="hljs-number">30</span> <span class="hljs-string">Jul</span> <span class="hljs-number">2022 03:28:14 </span><span class="hljs-string">PM</span> <span class="hljs-string">CST</span><br><span class="hljs-attr">Group       :</span> <span class="hljs-string">Unspecified</span><br><span class="hljs-attr">Size        :</span> <span class="hljs-number">122756</span><br><span class="hljs-attr">License     :</span> <span class="hljs-string">GPLv2</span><br><span class="hljs-attr">Signature   :</span> <span class="hljs-string">RSA/SHA256,</span> <span class="hljs-string">Thu</span> <span class="hljs-number">10</span> <span class="hljs-string">Sep</span> <span class="hljs-number">2020 09:23:24 </span><span class="hljs-string">PM</span> <span class="hljs-string">CST,</span> <span class="hljs-string">Key</span> <span class="hljs-string">ID</span> <span class="hljs-string">6a2faea2352c64e5</span><br><span class="hljs-attr">Source RPM  :</span> <span class="hljs-string">easy-rsa-3.0.8-1.el7.src.rpm</span><br><span class="hljs-attr">Build Date  :</span> <span class="hljs-string">Thu</span> <span class="hljs-number">10</span> <span class="hljs-string">Sep</span> <span class="hljs-number">2020 09:21:31 </span><span class="hljs-string">PM</span> <span class="hljs-string">CST</span><br><span class="hljs-attr">Build Host  :</span> <span class="hljs-string">buildhw-x86-11.iad2.fedoraproject.org</span><br><span class="hljs-attr">Relocations :</span> <span class="hljs-string">(not</span> <span class="hljs-string">relocatable)</span><br><span class="hljs-attr">Packager    :</span> <span class="hljs-string">Fedora</span> <span class="hljs-string">Project</span><br><span class="hljs-attr">Vendor      :</span> <span class="hljs-string">Fedora</span> <span class="hljs-string">Project</span><br><span class="hljs-attr">URL         :</span> <span class="hljs-string">https://github.com/OpenVPN/easy-rsa</span><br><span class="hljs-attr">Bug URL     :</span> <span class="hljs-string">https://bugz.fedoraproject.org/easy-rsa</span><br><span class="hljs-attr">Summary     :</span> <span class="hljs-string">Simple</span> <span class="hljs-string">shell</span> <span class="hljs-string">based</span> <span class="hljs-string">CA</span> <span class="hljs-string">utility</span><br><span class="hljs-attr">Description :</span><br><span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">small</span> <span class="hljs-string">RSA</span> <span class="hljs-string">key</span> <span class="hljs-string">management</span> <span class="hljs-string">package,</span> <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">openssl</span><br><span class="hljs-string">command</span> <span class="hljs-string">line</span> <span class="hljs-string">tool,</span> <span class="hljs-string">that</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">found</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">easy-rsa</span> <span class="hljs-string">subdirectory</span><br><span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">OpenVPN</span> <span class="hljs-string">distribution.</span> <span class="hljs-string">While</span> <span class="hljs-string">this</span> <span class="hljs-string">tool</span> <span class="hljs-string">is</span> <span class="hljs-string">primary</span> <span class="hljs-string">concerned</span><br><span class="hljs-string">with</span> <span class="hljs-string">key</span> <span class="hljs-string">management</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">SSL</span> <span class="hljs-string">VPN</span> <span class="hljs-string">application</span> <span class="hljs-string">space,</span> <span class="hljs-string">it</span> <span class="hljs-string">can</span> <span class="hljs-string">also</span><br><span class="hljs-string">be</span> <span class="hljs-string">used</span> <span class="hljs-string">for</span> <span class="hljs-string">building</span> <span class="hljs-string">web</span> <span class="hljs-string">certificates.</span><br><span class="hljs-string">You</span> <span class="hljs-string">have</span> <span class="hljs-string">new</span> <span class="hljs-string">mail</span> <span class="hljs-string">in</span> <span class="hljs-string">/var/spool/mail/root</span><br></code></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs dts">[root@node1 yum.repos.d]<span class="hljs-meta"># rpm -ql openvpn </span><br><span class="hljs-keyword">/etc/</span>openvpn                         <span class="hljs-comment">//放配置文件的目录</span><br><span class="hljs-keyword">/etc/</span>openvpn/client<br><span class="hljs-keyword">/etc/</span>openvpn/server<br><span class="hljs-keyword">/run/</span>openvpn-client<br><span class="hljs-keyword">/run/</span>openvpn-server<br><span class="hljs-keyword">/usr/</span>lib<span class="hljs-keyword">/systemd/</span>system/openvpn-client@.service<br><span class="hljs-keyword">/usr/</span>lib<span class="hljs-keyword">/systemd/</span>system/openvpn-server@.service<br><span class="hljs-keyword">/usr/</span>lib<span class="hljs-keyword">/systemd/</span>system/openvpn@.service<br><span class="hljs-keyword">/usr/</span>lib/tmpfiles.d/openvpn.conf<br><span class="hljs-keyword">/usr/</span>lib64/openvpn<br><span class="hljs-keyword">/usr/</span>lib64<span class="hljs-keyword">/openvpn/</span>plugins<br><span class="hljs-keyword">/usr/</span>lib64<span class="hljs-keyword">/openvpn/</span>plugins/openvpn-plugin-auth-pam.so<br><span class="hljs-keyword">/usr/</span>lib64<span class="hljs-keyword">/openvpn/</span>plugins/openvpn-plugin-down-root.so<br><span class="hljs-keyword">/usr/</span>sbin/openvpn<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/AUTHORS<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/COPYING<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/COPYRIGHT.GPL<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/ChangeLog<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/Changes.rst<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/README<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/README.auth-pam<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/README.down-root<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/README.systemd<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/contrib<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>OCSP_check<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>OCSP_check/OCSP_check.sh<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>README<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>openvpn-fwmarkroute<span class="hljs-number">-1.00</span><br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>openvpn-fwmarkroute<span class="hljs-number">-1.00</span>/README<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>openvpn-fwmarkroute<span class="hljs-number">-1.00</span>/fwmarkroute.down<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>openvpn-fwmarkroute<span class="hljs-number">-1.00</span>/fwmarkroute.up<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>pull-resolv-conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>pull-resolv-conf/client.down<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/contrib/</span>pull-resolv-conf/client.up<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/management-notes.txt<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span>/sample<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/README<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/client.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/firewall.sh<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/home.up<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/loopback-client<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/loopback-server<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/office.up<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/openvpn-shutdown.sh<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/openvpn-startup.sh<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/roadwarrior-client.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/roadwarrior-server.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/server.conf     <span class="hljs-comment">// 范例</span><br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/static-home.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/static-office.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/tls-home.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/tls-office.conf<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/xinetd-client-config<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-config-files/xinetd-server-config<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts/auth-pam.pl<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts/bridge-start<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts/bridge-stop<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts/ucn.pl<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-scripts/verify-cn<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-windows<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/doc/</span>openvpn<span class="hljs-number">-2.4</span><span class="hljs-number">.12</span><span class="hljs-keyword">/sample/</span>sample-windows/sample.ovpn<br><span class="hljs-keyword">/usr/</span>share<span class="hljs-keyword">/man/</span>man8/openvpn<span class="hljs-number">.8</span>.gz<br><span class="hljs-keyword">/var/</span>lib/openvpn<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 yum.repos.d]<span class="hljs-comment"># rpm -ql easy-rsa    //提供模板和各种范例</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/COPYING.md<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/ChangeLog<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/README.md<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/README.quickstart.md<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/vars.example<br><span class="hljs-regexp">/usr/</span>share/easy-rsa<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/easyrsa<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/openssl-easyrsa.cnf<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/x509-types<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>COMMON<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>ca<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>client<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>code-signing<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>email<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>kdc<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>server<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/x509-types/</span>serverClient<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/licenses/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/licenses/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/gpl-<span class="hljs-number">2.0</span>.txt<br></code></pre></td></tr></table></figure><h2 id="准备相关的配置文件"><a href="#准备相关的配置文件" class="headerlink" title="准备相关的配置文件"></a>准备相关的配置文件</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 yum.repos.d]# cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>openvpn-<span class="hljs-number">2.4</span>.<span class="hljs-number">12</span><span class="hljs-regexp">/sample/</span>sample-config-files<span class="hljs-regexp">/server.conf /</span>etc<span class="hljs-regexp">/openvpn/</span><br>[root@node1 yum.repos.d]# cp -r <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span> <span class="hljs-regexp">/etc/</span>openvpn/easy-rsa-server<br>[root@node1 yum.repos.d]# cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/vars.example /</span>etc<span class="hljs-regexp">/openvpn/</span>easy-rsa-server<span class="hljs-regexp">/3/</span>vars<br>[root@node1 yum.repos.d]# vim <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span>/vars<br>#CA的证书有效期默为为<span class="hljs-number">10</span>年,可以适当延长,比如:<span class="hljs-number">36500</span>天<br>#set_var EASYRSA_CA_EXPIRE     <span class="hljs-number">3650</span><br>set_var EASYRSA_CA_EXPIRE      <span class="hljs-number">36500</span><br>#服务器证书默为为<span class="hljs-number">825</span>天,可适当加长,比如:<span class="hljs-number">3650</span>天<br>#set_var EASYRSA_CERT_EXPIRE   <span class="hljs-number">825</span> <br>#将上面行修改为下面<br>set_var EASYRSA_CERT_EXPIRE    <span class="hljs-number">3650</span><br>[root@node1 yum.repos.d]# tree <span class="hljs-regexp">/etc/</span>openvpn/<br><span class="hljs-regexp">/etc/</span>openvpn/<br>├── client<br>├── easy-rsa-server<br>│   ├── <span class="hljs-number">3</span> -&gt; <span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br>│   ├── <span class="hljs-number">3.0</span> -&gt; <span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br>│   └── <span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br>│       ├── easyrsa<br>│       ├── openssl-easyrsa.cnf<br>│       ├── vars<br>│       └── x509-types<br>│           ├── ca<br>│           ├── client<br>│           ├── code-signing<br>│           ├── COMMON<br>│           ├── email<br>│           ├── kdc<br>│           ├── server<br>│           └── serverClient<br>├── server<br>└── server.conf<br><br><span class="hljs-number">7</span> directories, <span class="hljs-number">12</span> files<br></code></pre></td></tr></table></figure><h2 id="准备证书相关文件"><a href="#准备证书相关文件" class="headerlink" title="准备证书相关文件"></a>准备证书相关文件</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># cd /etc/openvpn/easy-rsa-server/3</span><br><span class="hljs-meta"># ./easyrsa init-pki                         #初始化数据,在当前目录下生成pki目录及相关文件</span><br><br><span class="hljs-meta"># tree </span><br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── pki                        <span class="hljs-meta">#生成一个新目录及相关文件</span><br>│   ├── openssl-easyrsa.cnf<br>│   ├── <span class="hljs-keyword">private</span><br>│   ├── reqs<br>│   └── safessl-easyrsa.cnf<br>├── vars<br>└── x509-types<br>   ├── ca<br>   ├── <span class="hljs-keyword">client</span><br>   ├── code-signing<br>   ├── COMMON<br>   ├── email<br>   ├── kdc<br>   ├── <span class="hljs-keyword">server</span><br>   └── serverClient<br><span class="hljs-number">4</span> directories, <span class="hljs-number">13</span> files<br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vim">脚本easyrsa帮助用法<br>[root@node1 <span class="hljs-number">3</span>]# ./easyrsa <br><br>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/vars<br><br>Easy-RSA <span class="hljs-number">3</span> usage <span class="hljs-built_in">and</span> overview<br><br>USAGE: easyrsa [<span class="hljs-keyword">options</span>] COMMAND [<span class="hljs-keyword">command</span>-<span class="hljs-keyword">options</span>]<br><br>A <span class="hljs-keyword">list</span> of commands <span class="hljs-keyword">is</span> shown below. To <span class="hljs-built_in">get</span> detailed usage <span class="hljs-built_in">and</span> <span class="hljs-keyword">help</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span><br><span class="hljs-keyword">command</span>, run:<br>  ./easyrsa <span class="hljs-keyword">help</span> COMMAND<br><br>For <span class="hljs-keyword">a</span> listing of <span class="hljs-keyword">options</span> that can <span class="hljs-keyword">be</span> supplied before the <span class="hljs-keyword">command</span>, use:<br>  ./easyrsa <span class="hljs-keyword">help</span> <span class="hljs-keyword">options</span><br><br>Here <span class="hljs-keyword">is</span> the <span class="hljs-keyword">list</span> of commands available with <span class="hljs-keyword">a</span> short <span class="hljs-keyword">syntax</span> reminder. Use the<br><span class="hljs-string">&#x27;help&#x27;</span> <span class="hljs-keyword">command</span> above <span class="hljs-keyword">to</span> <span class="hljs-built_in">get</span> full usage details.<br><br>  init-pki<br>  build-<span class="hljs-keyword">ca</span> [ cmd-opts ]<br>  gen-dh<br>  gen-req <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  <span class="hljs-keyword">sign</span>-req <span class="hljs-symbol">&lt;type&gt;</span> <span class="hljs-symbol">&lt;filename_base&gt;</span><br>  build-client-full <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  build-server-full <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  revoke <span class="hljs-symbol">&lt;filename_base&gt;</span> [cmd-opts]<br>  renew <span class="hljs-symbol">&lt;filename_base&gt;</span> [cmd-opts]<br>  build-serverClient-full <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  gen-crl<br>  <span class="hljs-keyword">update</span>-db<br>  show-req <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  show-cert <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  show-<span class="hljs-keyword">ca</span> [ cmd-opts ]<br>  import-req <span class="hljs-symbol">&lt;request_file_path&gt;</span> <span class="hljs-symbol">&lt;short_basename&gt;</span><br>  export-p7 <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  export-p8 <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  export-p12 <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  <span class="hljs-keyword">set</span>-rsa-pass <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  <span class="hljs-keyword">set</span>-<span class="hljs-keyword">ec</span>-pass <span class="hljs-symbol">&lt;filename_base&gt;</span> [ cmd-opts ]<br>  upgrade <span class="hljs-symbol">&lt;type&gt;</span><br><br>DIRECTORY STATUS (commands would take effect <span class="hljs-keyword">on</span> these locations)<br>  EASYRSA: /etc/openvpn/easy-rsa-server/<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><br>      PKI: /etc/openvpn/easy-rsa-server/<span class="hljs-number">3</span>/pki<br></code></pre></td></tr></table></figure><h2 id="创建CA机构"><a href="#创建CA机构" class="headerlink" title="创建CA机构"></a>创建CA机构</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># ./easyrsa build-ca nopass    # nopass表示生成的私钥不加口令</span><br><span class="hljs-comment"># tree pki</span><br>pki<br>├── ca.crt               <span class="hljs-comment">#生成了自签名的证书文件</span><br>├── certs_by_serial<br>├── index.txt<br>├── index.txt.attr<br>├── issued<br>├── openssl-easyrsa.cnf<br>├── private<br>│   └── ca.key           <span class="hljs-comment">#生成了私钥文件</span><br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>└── serial<br><span class="hljs-number">12</span> directories, <span class="hljs-number">7</span> files<br><br>[root<span class="hljs-variable">@node1</span> <span class="hljs-number">3</span>]<span class="hljs-comment"># openssl x509 -in pki/ca.crt -noout -text  // 查看证书文件</span><br><span class="hljs-symbol">Certificate:</span><br>    <span class="hljs-symbol">Data:</span><br>        <span class="hljs-symbol">Version:</span> <span class="hljs-number">3</span> (<span class="hljs-number">0x2</span>)<br>        Serial <span class="hljs-symbol">Number:</span><br>            <span class="hljs-symbol">b6:</span><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:</span><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span><span class="hljs-symbol">:b3</span><span class="hljs-symbol">:de</span><span class="hljs-symbol">:</span>3a<br>    Signature <span class="hljs-symbol">Algorithm:</span> sha256WithRSAEncryption<br>        <span class="hljs-symbol">Issuer:</span> <span class="hljs-variable constant_">CN</span>=Easy-<span class="hljs-variable constant_">RSA</span> <span class="hljs-variable constant_">CA</span>         <span class="hljs-comment"># 证书是给谁发布的</span><br>        Validity                       <span class="hljs-comment"># 证书的有效期，是100年</span><br>            Not <span class="hljs-symbol">Before:</span> Jul <span class="hljs-number">30</span> 08<span class="hljs-symbol">:</span><span class="hljs-number">04</span><span class="hljs-symbol">:</span><span class="hljs-number">50</span> <span class="hljs-number">2022</span> <span class="hljs-variable constant_">GMT</span><br>            Not After : Jul  <span class="hljs-number">6</span> 08<span class="hljs-symbol">:</span><span class="hljs-number">04</span><span class="hljs-symbol">:</span><span class="hljs-number">50</span> <span class="hljs-number">2122</span> <span class="hljs-variable constant_">GMT</span><br>        <span class="hljs-symbol">Subject:</span> <span class="hljs-variable constant_">CN</span>=Easy-<span class="hljs-variable constant_">RSA</span> <span class="hljs-variable constant_">CA</span>         <span class="hljs-comment"># 主题是什么        </span><br>        Subject Public Key <span class="hljs-symbol">Info:</span><br>            Public Key <span class="hljs-symbol">Algorithm:</span> rsaEncryption<br>                Public-<span class="hljs-symbol">Key:</span> (<span class="hljs-number">2048</span> bit)<br>                <span class="hljs-symbol">Modulus:</span><br>                    <span class="hljs-number">00</span><span class="hljs-symbol">:dc</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">36</span><span class="hljs-symbol">:e9</span><span class="hljs-symbol">:b1</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:</span><span class="hljs-number">87</span><span class="hljs-symbol">:fa</span><span class="hljs-symbol">:d3</span><span class="hljs-symbol">:</span><span class="hljs-number">62</span><span class="hljs-symbol">:c1</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">c:</span><span class="hljs-number">61</span><span class="hljs-symbol">:e2</span>:<br>                    <span class="hljs-number">14</span><span class="hljs-symbol">:d9</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">c:</span><span class="hljs-number">65</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">e:</span><span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">62</span><span class="hljs-symbol">:cf</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">a:</span><span class="hljs-number">53</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">f:</span>7<span class="hljs-symbol">f:</span><span class="hljs-number">99</span><span class="hljs-symbol">:ce</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span><br>                    <span class="hljs-symbol">af:</span><span class="hljs-number">79</span><span class="hljs-symbol">:</span><span class="hljs-number">26</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">d:</span><span class="hljs-number">48</span><span class="hljs-symbol">:</span><span class="hljs-number">96</span><span class="hljs-symbol">:b6</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">f:</span><span class="hljs-symbol">b3:</span>0<span class="hljs-symbol">d:</span><span class="hljs-symbol">fb:</span><span class="hljs-symbol">ee:</span>9<span class="hljs-symbol">f:</span><span class="hljs-number">60</span><span class="hljs-symbol">:c8</span>:<br>                    <span class="hljs-symbol">b0:</span><span class="hljs-symbol">c4:</span>0<span class="hljs-symbol">e:</span><span class="hljs-symbol">b2:</span>7<span class="hljs-symbol">e:</span><span class="hljs-number">25</span><span class="hljs-symbol">:e2</span><span class="hljs-symbol">:aa</span><span class="hljs-symbol">:</span><span class="hljs-number">20</span><span class="hljs-symbol">:a8</span><span class="hljs-symbol">:</span><span class="hljs-number">97</span><span class="hljs-symbol">:c0</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">b:</span><span class="hljs-symbol">fe:</span><span class="hljs-symbol">b1:</span><br>                    <span class="hljs-symbol">e4:</span><span class="hljs-number">26</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">d:</span><span class="hljs-symbol">cc:</span><span class="hljs-number">77</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">b:</span><span class="hljs-number">67</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">50</span><span class="hljs-symbol">:f5</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">e:</span><span class="hljs-symbol">ee:</span><span class="hljs-symbol">fc:</span><span class="hljs-number">66</span><span class="hljs-symbol">:</span><span class="hljs-number">70</span>:<br>                    6<span class="hljs-symbol">d:</span><span class="hljs-symbol">f5:</span><span class="hljs-symbol">ea:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span>09<span class="hljs-symbol">:ab</span><span class="hljs-symbol">:</span><span class="hljs-number">72</span><span class="hljs-symbol">:</span><span class="hljs-number">16</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">d:</span><span class="hljs-symbol">e9:</span><span class="hljs-number">31</span><span class="hljs-symbol">:</span><span class="hljs-number">94</span><span class="hljs-symbol">:a1</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">f:</span><span class="hljs-symbol">aa:</span><br>                    <span class="hljs-number">15</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">f:</span><span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:ad</span><span class="hljs-symbol">:d3</span><span class="hljs-symbol">:</span><span class="hljs-number">17</span><span class="hljs-symbol">:</span><span class="hljs-number">02</span><span class="hljs-symbol">:b2</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">f:</span><span class="hljs-symbol">d9:</span><span class="hljs-number">71</span><span class="hljs-symbol">:</span><span class="hljs-number">87</span><span class="hljs-symbol">:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span><span class="hljs-number">18</span>:<br>                    <span class="hljs-number">17</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">f:</span><span class="hljs-symbol">ca:</span><span class="hljs-symbol">e5:</span><span class="hljs-symbol">ea:</span><span class="hljs-number">41</span><span class="hljs-symbol">:a4</span><span class="hljs-symbol">:</span><span class="hljs-number">86</span><span class="hljs-symbol">:</span><span class="hljs-number">07</span><span class="hljs-symbol">:ef</span><span class="hljs-symbol">:a9</span><span class="hljs-symbol">:e2</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span><span class="hljs-number">12</span>:<br>                    <span class="hljs-number">45</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">f:</span><span class="hljs-symbol">aa:</span><span class="hljs-symbol">f5:</span><span class="hljs-number">81</span><span class="hljs-symbol">:</span><span class="hljs-number">32</span><span class="hljs-symbol">:</span><span class="hljs-number">73</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">94</span><span class="hljs-symbol">:</span><span class="hljs-number">96</span><span class="hljs-symbol">:</span><span class="hljs-number">95</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">d:</span><span class="hljs-symbol">e6:</span>8<span class="hljs-symbol">c:</span>6<span class="hljs-symbol">c:</span><br>                    9<span class="hljs-symbol">d:</span><span class="hljs-symbol">d8:</span><span class="hljs-symbol">b4:</span>7<span class="hljs-symbol">b:</span><span class="hljs-number">73</span><span class="hljs-symbol">:</span><span class="hljs-number">78</span><span class="hljs-symbol">:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">37</span><span class="hljs-symbol">:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span><span class="hljs-number">30</span><span class="hljs-symbol">:b7</span><span class="hljs-symbol">:</span><span class="hljs-number">91</span><span class="hljs-symbol">:</span><span class="hljs-number">21</span><span class="hljs-symbol">:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span>:<br>                    <span class="hljs-symbol">b1:</span><span class="hljs-symbol">fc:</span><span class="hljs-symbol">ea:</span>2<span class="hljs-symbol">e:</span><span class="hljs-number">79</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">e:</span>9<span class="hljs-symbol">f:</span><span class="hljs-symbol">cf:</span><span class="hljs-symbol">aa:</span><span class="hljs-number">23</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">e:</span><span class="hljs-symbol">c5:</span><span class="hljs-symbol">e2:</span><span class="hljs-number">05</span><span class="hljs-symbol">:b4</span>:<br>                    <span class="hljs-number">76</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">a:</span><span class="hljs-number">82</span><span class="hljs-symbol">:b5</span><span class="hljs-symbol">:be</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">d:</span><span class="hljs-number">90</span><span class="hljs-symbol">:dd</span><span class="hljs-symbol">:fb</span><span class="hljs-symbol">:a2</span><span class="hljs-symbol">:f8</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">d:</span>7<span class="hljs-symbol">c:</span><span class="hljs-symbol">ab:</span><span class="hljs-symbol">f9:</span><br>                    8<span class="hljs-symbol">a:</span><span class="hljs-number">20</span><span class="hljs-symbol">:a6</span><span class="hljs-symbol">:c6</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">f:</span><span class="hljs-symbol">b8:</span><span class="hljs-number">17</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">c:</span><span class="hljs-number">26</span><span class="hljs-symbol">:</span>9<span class="hljs-symbol">b:</span><span class="hljs-symbol">f1:</span><span class="hljs-symbol">a5:</span>4<span class="hljs-symbol">f:</span><span class="hljs-number">04</span>:<br>                    <span class="hljs-number">70</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">f:</span>1<span class="hljs-symbol">a:</span><span class="hljs-number">92</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">d:</span><span class="hljs-symbol">ec:</span>3<span class="hljs-symbol">e:</span>6<span class="hljs-symbol">e:</span><span class="hljs-symbol">f2:</span><span class="hljs-number">56</span><span class="hljs-symbol">:fb</span><span class="hljs-symbol">:a6</span><span class="hljs-symbol">:bb</span><span class="hljs-symbol">:e8</span>:<br>                    <span class="hljs-number">06</span><span class="hljs-symbol">:b5</span><span class="hljs-symbol">:</span><span class="hljs-number">85</span><span class="hljs-symbol">:a2</span><span class="hljs-symbol">:</span><span class="hljs-number">61</span><span class="hljs-symbol">:ca</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">a:</span><span class="hljs-symbol">f6:</span><span class="hljs-number">60</span><span class="hljs-symbol">:</span><span class="hljs-number">40</span><span class="hljs-symbol">:</span>9<span class="hljs-symbol">b:</span><span class="hljs-symbol">f4:</span><span class="hljs-number">39</span><span class="hljs-symbol">:a6</span><span class="hljs-symbol">:</span><span class="hljs-number">30</span>:<br>                    <span class="hljs-number">26</span><span class="hljs-symbol">:ec</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">f:</span><span class="hljs-number">79</span><span class="hljs-symbol">:</span><span class="hljs-number">98</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">d:</span>8<span class="hljs-symbol">b:</span>7<span class="hljs-symbol">b:</span>1<span class="hljs-symbol">d:</span><span class="hljs-symbol">ef:</span><span class="hljs-symbol">a5:</span><span class="hljs-symbol">c2:</span>3<span class="hljs-symbol">e:</span><span class="hljs-symbol">df:</span>9<span class="hljs-symbol">b:</span><br>                    <span class="hljs-symbol">c7:</span>9<span class="hljs-symbol">d:</span><span class="hljs-symbol">fb:</span><span class="hljs-number">06</span><span class="hljs-symbol">:b8</span><span class="hljs-symbol">:f7</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">f:</span><span class="hljs-symbol">f6:</span>5<span class="hljs-symbol">a:</span><span class="hljs-symbol">af:</span><span class="hljs-symbol">d3:</span>2<span class="hljs-symbol">f:</span><span class="hljs-number">25</span><span class="hljs-symbol">:ab</span>:<br>                    <span class="hljs-symbol">d1:</span>0f<br>                <span class="hljs-symbol">Exponent:</span> <span class="hljs-number">65537</span> (<span class="hljs-number">0x10001</span>)<br>        X509v3 <span class="hljs-symbol">extensions:</span><br>            X509v3 Subject Key <span class="hljs-symbol">Identifier:</span> <br>                8<span class="hljs-symbol">E:</span>1<span class="hljs-symbol">A:</span><span class="hljs-variable constant_">FC</span><span class="hljs-symbol">:</span><span class="hljs-number">24</span><span class="hljs-symbol">:AC</span><span class="hljs-symbol">:C3</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">F:</span><span class="hljs-variable constant_">B7</span><span class="hljs-symbol">:</span><span class="hljs-number">03</span><span class="hljs-symbol">:E3</span><span class="hljs-symbol">:</span><span class="hljs-number">69</span><span class="hljs-symbol">:</span><span class="hljs-number">75</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">F:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span><span class="hljs-number">97</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">D:</span><span class="hljs-variable constant_">AF</span><span class="hljs-symbol">:F0</span><br>            X509v3 Authority Key <span class="hljs-symbol">Identifier:</span> <br>                <span class="hljs-symbol">keyid:</span>8<span class="hljs-symbol">E:</span>1<span class="hljs-symbol">A:</span><span class="hljs-variable constant_">FC</span><span class="hljs-symbol">:</span><span class="hljs-number">24</span><span class="hljs-symbol">:AC</span><span class="hljs-symbol">:C3</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">F:</span><span class="hljs-variable constant_">B7</span><span class="hljs-symbol">:</span><span class="hljs-number">03</span><span class="hljs-symbol">:E3</span><span class="hljs-symbol">:</span><span class="hljs-number">69</span><span class="hljs-symbol">:</span><span class="hljs-number">75</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span><span class="hljs-symbol">:BB</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">F:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span><span class="hljs-number">97</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">D:</span><span class="hljs-variable constant_">AF</span><span class="hljs-symbol">:F0</span><br>                <span class="hljs-symbol">DirName:</span>/<span class="hljs-variable constant_">CN</span>=Easy-<span class="hljs-variable constant_">RSA</span> <span class="hljs-variable constant_">CA</span><br>                <span class="hljs-symbol">serial:</span><span class="hljs-variable constant_">B6</span><span class="hljs-symbol">:</span><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:</span><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span><span class="hljs-symbol">:B3</span><span class="hljs-symbol">:DE</span><span class="hljs-symbol">:</span>3A<br><br>            X509v3 Basic <span class="hljs-symbol">Constraints:</span> <br>                <span class="hljs-variable constant_">CA</span><span class="hljs-symbol">:TRUE</span><br>            X509v3 Key <span class="hljs-symbol">Usage:</span> <br>                Certificate Sign, <span class="hljs-variable constant_">CRL</span> Sign<br>    Signature <span class="hljs-symbol">Algorithm:</span> sha256WithRSAEncryption<br>         <span class="hljs-number">81</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span><span class="hljs-symbol">:</span><span class="hljs-number">37</span><span class="hljs-symbol">:c3</span><span class="hljs-symbol">:d7</span><span class="hljs-symbol">:</span><span class="hljs-number">70</span><span class="hljs-symbol">:f8</span><span class="hljs-symbol">:f0</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span><span class="hljs-symbol">:c7</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">d:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span><span class="hljs-number">70</span><span class="hljs-symbol">:d0</span><span class="hljs-symbol">:a6</span><span class="hljs-symbol">:</span><span class="hljs-number">73</span><span class="hljs-symbol">:d6</span><span class="hljs-symbol">:</span><span class="hljs-number">02</span>:<br>         <span class="hljs-symbol">df:</span><span class="hljs-number">43</span><span class="hljs-symbol">:</span><span class="hljs-number">80</span><span class="hljs-symbol">:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span>1<span class="hljs-symbol">b:</span><span class="hljs-symbol">e0:</span><span class="hljs-symbol">e0:</span><span class="hljs-symbol">d7:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span><span class="hljs-number">68</span><span class="hljs-symbol">:c7</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:</span><span class="hljs-number">17</span><span class="hljs-symbol">:</span><span class="hljs-number">63</span><span class="hljs-symbol">:d6</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">a:</span><span class="hljs-symbol">c6:</span><span class="hljs-symbol">da:</span><br>         <span class="hljs-number">06</span><span class="hljs-symbol">:bf</span><span class="hljs-symbol">:</span>0<span class="hljs-symbol">a:</span><span class="hljs-symbol">c0:</span><span class="hljs-number">58</span><span class="hljs-symbol">:ab</span><span class="hljs-symbol">:ab</span><span class="hljs-symbol">:e7</span><span class="hljs-symbol">:</span>0<span class="hljs-symbol">d:</span><span class="hljs-symbol">cd:</span><span class="hljs-number">34</span><span class="hljs-symbol">:fa</span><span class="hljs-symbol">:bb</span><span class="hljs-symbol">:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span><span class="hljs-number">21</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">f:</span><span class="hljs-number">87</span>:<br>         <span class="hljs-number">51</span><span class="hljs-symbol">:cf</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span><span class="hljs-symbol">:</span>8<span class="hljs-symbol">c:</span><span class="hljs-number">43</span><span class="hljs-symbol">:</span><span class="hljs-number">63</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">a:</span><span class="hljs-symbol">c6:</span><span class="hljs-symbol">ac:</span><span class="hljs-number">24</span><span class="hljs-symbol">:e4</span><span class="hljs-symbol">:</span><span class="hljs-number">66</span><span class="hljs-symbol">:ad</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">32</span><span class="hljs-symbol">:</span><span class="hljs-number">81</span><span class="hljs-symbol">:</span><span class="hljs-number">69</span><span class="hljs-symbol">:ab</span>:<br>         <span class="hljs-number">43</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">b:</span><span class="hljs-number">43</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">b:</span><span class="hljs-symbol">da:</span><span class="hljs-symbol">a6:</span>3<span class="hljs-symbol">d:</span>1<span class="hljs-symbol">a:</span>9<span class="hljs-symbol">a:</span>6<span class="hljs-symbol">f:</span>6<span class="hljs-symbol">c:</span>0<span class="hljs-symbol">b:</span>8<span class="hljs-symbol">c:</span><span class="hljs-symbol">ac:</span><span class="hljs-number">07</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span>5<span class="hljs-symbol">e:</span><br>         3<span class="hljs-symbol">c:</span>1<span class="hljs-symbol">c:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">97</span><span class="hljs-symbol">:bc</span><span class="hljs-symbol">:</span><span class="hljs-number">07</span><span class="hljs-symbol">:f4</span><span class="hljs-symbol">:</span>0<span class="hljs-symbol">a:</span>2<span class="hljs-symbol">d:</span>0<span class="hljs-symbol">d:</span><span class="hljs-number">52</span><span class="hljs-symbol">:d7</span><span class="hljs-symbol">:</span><span class="hljs-number">22</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">b:</span><span class="hljs-symbol">f7:</span><span class="hljs-number">67</span><span class="hljs-symbol">:bd</span><span class="hljs-symbol">:e5</span>:<br>         9<span class="hljs-symbol">b:</span><span class="hljs-number">76</span><span class="hljs-symbol">:</span><span class="hljs-number">15</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">e:</span>9<span class="hljs-symbol">f:</span>5<span class="hljs-symbol">d:</span><span class="hljs-symbol">ec:</span><span class="hljs-symbol">f5:</span><span class="hljs-symbol">ee:</span><span class="hljs-symbol">b8:</span><span class="hljs-symbol">b3:</span>6<span class="hljs-symbol">b:</span><span class="hljs-number">99</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:b3</span><span class="hljs-symbol">:</span>0<span class="hljs-symbol">c:</span><span class="hljs-symbol">dc:</span><span class="hljs-symbol">a8:</span><br>         2<span class="hljs-symbol">b:</span>5<span class="hljs-symbol">a:</span>5<span class="hljs-symbol">b:</span><span class="hljs-number">42</span><span class="hljs-symbol">:</span>9<span class="hljs-symbol">b:</span><span class="hljs-number">90</span><span class="hljs-symbol">:</span><span class="hljs-number">73</span><span class="hljs-symbol">:d9</span><span class="hljs-symbol">:ce</span><span class="hljs-symbol">:d7</span><span class="hljs-symbol">:</span><span class="hljs-number">82</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">c:</span><span class="hljs-number">61</span><span class="hljs-symbol">:e0</span><span class="hljs-symbol">:</span><span class="hljs-number">75</span><span class="hljs-symbol">:d8</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">d:</span><span class="hljs-symbol">d8:</span><br>         <span class="hljs-symbol">ec:</span><span class="hljs-symbol">cd:</span><span class="hljs-number">93</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">a:</span><span class="hljs-symbol">b8:</span><span class="hljs-symbol">e6:</span><span class="hljs-symbol">cf:</span><span class="hljs-number">21</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span>6<span class="hljs-symbol">c:</span><span class="hljs-symbol">e8:</span><span class="hljs-symbol">b3:</span><span class="hljs-number">87</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span><span class="hljs-symbol">:</span><span class="hljs-number">61</span><span class="hljs-symbol">:c8</span><span class="hljs-symbol">:</span><span class="hljs-number">07</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">c:</span><br>         <span class="hljs-number">69</span><span class="hljs-symbol">:fa</span><span class="hljs-symbol">:</span><span class="hljs-number">68</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span><span class="hljs-symbol">:b4</span><span class="hljs-symbol">:</span><span class="hljs-number">91</span><span class="hljs-symbol">:</span><span class="hljs-number">32</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">e:</span><span class="hljs-symbol">f6:</span><span class="hljs-number">44</span><span class="hljs-symbol">:</span><span class="hljs-number">30</span><span class="hljs-symbol">:</span>1<span class="hljs-symbol">a:</span>3<span class="hljs-symbol">b:</span><span class="hljs-symbol">cd:</span><span class="hljs-number">63</span><span class="hljs-symbol">:</span><span class="hljs-number">83</span><span class="hljs-symbol">:f6</span><span class="hljs-symbol">:fd</span>:<br>         <span class="hljs-symbol">a6:</span><span class="hljs-symbol">ce:</span>6<span class="hljs-symbol">d:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">80</span><span class="hljs-symbol">:</span><span class="hljs-number">45</span><span class="hljs-symbol">:</span><span class="hljs-number">51</span><span class="hljs-symbol">:</span>3<span class="hljs-symbol">b:</span><span class="hljs-number">14</span><span class="hljs-symbol">:</span>2<span class="hljs-symbol">e:</span><span class="hljs-symbol">cb:</span><span class="hljs-number">14</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span>4<span class="hljs-symbol">b:</span><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">74</span><span class="hljs-symbol">:f5</span><span class="hljs-symbol">:</span>5<span class="hljs-symbol">e:</span><br>         0<span class="hljs-symbol">f:</span><span class="hljs-number">45</span><span class="hljs-symbol">:</span><span class="hljs-number">87</span><span class="hljs-symbol">:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span><span class="hljs-number">62</span><span class="hljs-symbol">:</span><span class="hljs-number">37</span><span class="hljs-symbol">:fa</span><span class="hljs-symbol">:f8</span><span class="hljs-symbol">:e0</span><span class="hljs-symbol">:</span><span class="hljs-number">29</span><span class="hljs-symbol">:</span><span class="hljs-number">06</span><span class="hljs-symbol">:f6</span><span class="hljs-symbol">:</span><span class="hljs-number">57</span><span class="hljs-symbol">:ea</span><span class="hljs-symbol">:f7</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">a:</span><span class="hljs-number">69</span><span class="hljs-symbol">:</span>1<span class="hljs-symbol">a:</span><br>         <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">01</span><span class="hljs-symbol">:</span><span class="hljs-number">22</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">f:</span><span class="hljs-symbol">b7:</span>9<span class="hljs-symbol">b:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">91</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span>3<span class="hljs-symbol">a:</span><span class="hljs-number">02</span><span class="hljs-symbol">:</span><span class="hljs-number">57</span><span class="hljs-symbol">:</span>7<span class="hljs-symbol">c:</span><span class="hljs-number">62</span><span class="hljs-symbol">:c7</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:</span><span class="hljs-number">23</span><span class="hljs-symbol">:</span><span class="hljs-number">68</span>:<br>         3<span class="hljs-symbol">b:</span><span class="hljs-symbol">bc:</span><span class="hljs-symbol">bc:</span><span class="hljs-symbol">f3:</span><span class="hljs-symbol">bd:</span><span class="hljs-number">16</span><span class="hljs-symbol">:</span>4<span class="hljs-symbol">c:</span>0<span class="hljs-symbol">e:</span><span class="hljs-symbol">df:</span><span class="hljs-symbol">b2:</span><span class="hljs-symbol">e4:</span><span class="hljs-symbol">d8:</span><span class="hljs-symbol">f6:</span><span class="hljs-number">75</span><span class="hljs-symbol">:d0</span><span class="hljs-symbol">:</span>1<span class="hljs-symbol">d:</span><span class="hljs-symbol">ea:</span>0<span class="hljs-symbol">b:</span><br>         <span class="hljs-number">89</span><span class="hljs-symbol">:</span><span class="hljs-number">89</span><span class="hljs-symbol">:</span><span class="hljs-number">17</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><br></code></pre></td></tr></table></figure><h2 id="创建服务端证书申请"><a href="#创建服务端证书申请" class="headerlink" title="创建服务端证书申请"></a>创建服务端证书申请</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># ./easyrsa gen-req server nopass    #创建服务器证书申请文件，其中server是文件前缀</span><br><br>[root@node1 <span class="hljs-number">3</span>]<span class="hljs-meta"># tree pki/</span><br>pki/<br>├── ca.crt<br>├── certs_by_serial<br>├── <span class="hljs-keyword">index</span>.txt<br>├── <span class="hljs-keyword">index</span>.txt.attr<br>├── issued<br>├── openssl-easyrsa.cnf<br>├── <span class="hljs-keyword">private</span><br>│   ├── ca.key<br>│   └── <span class="hljs-keyword">server</span>.key           <span class="hljs-meta">#生成私钥文件</span><br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>│   └── <span class="hljs-keyword">server</span>.req            <span class="hljs-meta">#生成请求文件</span><br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>└── serial<br><br><span class="hljs-number">12</span> directories, <span class="hljs-number">9</span> files<br></code></pre></td></tr></table></figure><h2 id="签发服务端证书"><a href="#签发服务端证书" class="headerlink" title="签发服务端证书"></a>签发服务端证书</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#将上面<span class="hljs-keyword">server</span>.req的申请,颁发<span class="hljs-keyword">server</span>类型的证书<br>[root@node1 <span class="hljs-number">3</span>]# ./easyrsa help sign<br><br>Note: <span class="hljs-keyword">using</span> Easy-RSA <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">from</span>: /etc/openvpn/easy-rsa-<span class="hljs-keyword">server</span>/<span class="hljs-number">3.0</span><span class="hljs-number">.8</span>/vars<br><br>  sign-req &lt;<span class="hljs-keyword">type</span>&gt; &lt;filename_base&gt;<br>      Sign a certificate request <span class="hljs-keyword">of</span> the defined <span class="hljs-keyword">type</span>. &lt;<span class="hljs-keyword">type</span>&gt; must be a known<br>      <span class="hljs-keyword">type</span> such <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;client&#x27;</span>, <span class="hljs-string">&#x27;server&#x27;</span>, <span class="hljs-string">&#x27;serverClient&#x27;</span>, <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;ca&#x27;</span> (<span class="hljs-keyword">or</span> a <span class="hljs-keyword">user</span>-added <span class="hljs-keyword">type</span>.)<br><br>      This request file must exist <span class="hljs-keyword">in</span> the reqs/ dir <span class="hljs-keyword">and</span> have a .req file<br>      <span class="hljs-keyword">extension</span>. See <span class="hljs-keyword">import</span>-req below <span class="hljs-keyword">for</span> importing reqs <span class="hljs-keyword">from</span> other sources.<br><br><br>[root@node1 <span class="hljs-number">3</span>]# ./easyrsa sign <span class="hljs-keyword">server</span> <span class="hljs-keyword">server</span>   #第一个<span class="hljs-keyword">server</span>是类型，客户端还是服务器。第二个<span class="hljs-keyword">server</span>是生成文件名的前缀<br><br>Note: <span class="hljs-keyword">using</span> Easy-RSA <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">from</span>: /etc/openvpn/easy-rsa-<span class="hljs-keyword">server</span>/<span class="hljs-number">3.0</span><span class="hljs-number">.8</span>/vars<br><span class="hljs-keyword">Using</span> SSL: openssl OpenSSL <span class="hljs-number">1.0</span><span class="hljs-number">.2</span>k-fips  <span class="hljs-number">26</span> Jan <span class="hljs-number">2017</span><br><br><br>You are about <span class="hljs-keyword">to</span> sign the <span class="hljs-keyword">following</span> certificate.<br>Please <span class="hljs-keyword">check</span> <span class="hljs-keyword">over</span> the details shown below <span class="hljs-keyword">for</span> accuracy. Note that this request<br>has <span class="hljs-keyword">not</span> been cryptographically verified. Please be sure it came <span class="hljs-keyword">from</span> a <span class="hljs-keyword">trusted</span><br>source <span class="hljs-keyword">or</span> that you have verified the request checksum <span class="hljs-keyword">with</span> the sender.<br><br>Request subject, <span class="hljs-keyword">to</span> be signed <span class="hljs-keyword">as</span> a <span class="hljs-keyword">server</span> certificate <span class="hljs-keyword">for</span> <span class="hljs-number">3650</span> days:    #可以看到<br>vars文件指定的有效期<br><br>subject=<br>    commonName                = <span class="hljs-keyword">server</span><br><br><br><span class="hljs-keyword">Type</span> the word <span class="hljs-string">&#x27;yes&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span>, <span class="hljs-keyword">or</span> <span class="hljs-keyword">any</span> other <span class="hljs-keyword">input</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">abort</span>.<br>  Confirm request details: yes          #输入yes回车<br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">from</span> /etc/openvpn/easy-rsa-<span class="hljs-keyword">server</span>/<span class="hljs-number">3</span>/pki/easy-rsa<span class="hljs-number">-12534.2</span>GqYWI/tmp.q8aLBK<br><span class="hljs-keyword">Check</span> that the request matches the signature<br>Signature ok<br>The Subject<span class="hljs-string">&#x27;s Distinguished Name is as follows</span><br><span class="hljs-string">commonName            :ASN.1 12:&#x27;</span><span class="hljs-keyword">server</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">Certificate is to be certified until Jul 27 08:28:14 2032 GMT (3650 days)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Write out database with 1 new entries</span><br><span class="hljs-string">Data Base Updated</span><br><span class="hljs-string"></span><br><span class="hljs-string">Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt  #生</span><br><span class="hljs-string">成服务器证书文件</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 3]# tree pki</span><br><span class="hljs-string">pki</span><br><span class="hljs-string">├── ca.crt</span><br><span class="hljs-string">├── certs_by_serial</span><br><span class="hljs-string">│   └── FBCA6A70616926FF19135B0F791F0921.pem    #服务器证书文件，跟server.crt的文件内容一样</span><br><span class="hljs-string">├── index.txt</span><br><span class="hljs-string">├── index.txt.attr</span><br><span class="hljs-string">├── index.txt.attr.old</span><br><span class="hljs-string">├── index.txt.old</span><br><span class="hljs-string">├── issued</span><br><span class="hljs-string">│   └── server.crt                               #服务器证书文件</span><br><span class="hljs-string">├── openssl-easyrsa.cnf</span><br><span class="hljs-string">├── private</span><br><span class="hljs-string">│   ├── ca.key</span><br><span class="hljs-string">│   └── server.key</span><br><span class="hljs-string">├── renewed</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── reqs</span><br><span class="hljs-string">│   └── server.req</span><br><span class="hljs-string">├── revoked</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── safessl-easyrsa.cnf</span><br><span class="hljs-string">├── serial</span><br><span class="hljs-string">└── serial.old</span><br><span class="hljs-string"></span><br><span class="hljs-string">12 directories, 14 files</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 3]# diff pki/certs_by_serial/FBCA6A70616926FF19135B0F791F0921.pem pki/issued/server.crt </span><br><span class="hljs-string"></span><br><span class="hljs-string">#证书相关文件</span><br><span class="hljs-string">[root@node1 3]# cat pki/serial</span><br><span class="hljs-string">FBCA6A70616926FF19135B0F791F0922</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 3]# cat pki/serial.old </span><br><span class="hljs-string">fbca6a70616926ff19135b0f791f0921</span><br><span class="hljs-string"> </span><br><span class="hljs-string">[root@node1 3]# cat pki/index.txt</span><br><span class="hljs-string">V320727082814ZFBCA6A70616926FF19135B0F791F0921unknown/CN=server</span><br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title="==================================="></a>===================================</h2><h2 id="准备客户端证书环境"><a href="#准备客户端证书环境" class="headerlink" title="准备客户端证书环境"></a>准备客户端证书环境</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 <span class="hljs-number">3</span>]# cp -r <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span> <span class="hljs-regexp">/etc/</span>openvpn/easy-rsa-client<br>[root@node1 <span class="hljs-number">3</span>]# cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa-<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span><span class="hljs-regexp">/vars.example /</span>etc<span class="hljs-regexp">/openvpn/</span>easy-rsa-client<span class="hljs-regexp">/3/</span>vars<br>[root@node1 <span class="hljs-number">3</span>]# cd <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span><br>[root@node1 <span class="hljs-number">3</span>]# tree<br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── vars<br>└── x509-types<br>    ├── ca<br>    ├── client<br>    ├── code-signing<br>    ├── COMMON<br>    ├── email<br>    ├── kdc<br>    ├── server<br>    └── serverClient<br><br><span class="hljs-number">1</span> directory, <span class="hljs-number">11</span> files<br><br>#生成证书申请所需目录pki目录和文件<br>[root@node1 <span class="hljs-number">3</span>]# ./easyrsa init-pki<br>Note: using Easy-RSA configuration <span class="hljs-keyword">from</span>: <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/vars<br><br>init-pki complete; you may now create a CA or requests.<br>Your newly created PKI dir is: <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span>/pki<br><br>[root@node1 <span class="hljs-number">3</span>]# tree<br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── pki                             #生成的新目录<br>│   ├── openssl-easyrsa.cnf<br>│   ├── <span class="hljs-keyword">private</span><br>│   ├── reqs<br>│   └── safessl-easyrsa.cnf<br>├── vars<br>└── x509-types<br>    ├── ca<br>    ├── client<br>    ├── code-signing<br>    ├── COMMON<br>    ├── email<br>    ├── kdc<br>    ├── server<br>    └── serverClient<br><br><span class="hljs-number">4</span> directories, <span class="hljs-number">13</span> files<br></code></pre></td></tr></table></figure><h2 id="创建客户端证书申请"><a href="#创建客户端证书申请" class="headerlink" title="创建客户端证书申请"></a>创建客户端证书申请</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 <span class="hljs-number">3</span>]# ./easyrsa gen-req lyxknx nopass<br><br>Note: using Easy-RSA configuration <span class="hljs-keyword">from</span>: <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/vars<br>Using SSL: openssl OpenSSL <span class="hljs-number">1.0</span>.<span class="hljs-number">2</span>k-fips  <span class="hljs-number">26</span> Jan <span class="hljs-number">2017</span><br>Generating a <span class="hljs-number">2048</span> bit RSA <span class="hljs-keyword">private</span> key<br>.+++<br>..........+++<br>writing <span class="hljs-keyword">new</span> <span class="hljs-keyword">private</span> key to <span class="hljs-string">&#x27;/etc/openvpn/easy-rsa-client/3/pki/easy-rsa-13652.ATxbpr/tmp.ENd1AK&#x27;</span><br>-----<br>You are about to be asked to enter information that will be incorporated<br><span class="hljs-keyword">into</span> your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br><span class="hljs-keyword">For</span> some fields there will be a <span class="hljs-keyword">default</span> value,<br><span class="hljs-keyword">If</span> you enter <span class="hljs-string">&#x27;.&#x27;</span>, the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [lyxknx]:<br><br>Keypair and certificate request completed. Your files are:<br>req: <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>reqs/lyxknx.req<br>key: <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span><span class="hljs-keyword">private</span>/lyxknx.key<br><br>[root@node1 <span class="hljs-number">3</span>]# tree<br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── pki<br>│   ├── openssl-easyrsa.cnf<br>│   ├── <span class="hljs-keyword">private</span><br>│   │   └── lyxknx.key            #私钥文件<br>│   ├── reqs<br>│   │   └── lyxknx.req            #证书申请文件<br>│   └── safessl-easyrsa.cnf<br>├── vars<br>└── x509-types<br>    ├── ca<br>    ├── client<br>    ├── code-signing<br>    ├── COMMON<br>    ├── email<br>    ├── kdc<br>    ├── server<br>    └── serverClient<br><br><span class="hljs-number">4</span> directories, <span class="hljs-number">15</span> files<br></code></pre></td></tr></table></figure><h2 id="签发客户端证书"><a href="#签发客户端证书" class="headerlink" title="签发客户端证书"></a>签发客户端证书</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 <span class="hljs-number">3</span>]# cd /etc/openvpn/easy-rsa-<span class="hljs-keyword">server</span>/<span class="hljs-number">3</span><br>[root@node1 <span class="hljs-number">3</span>]# ./easyrsa <span class="hljs-keyword">import</span>-req /etc/openvpn/easy-rsa-client/<span class="hljs-number">3</span>/pki/reqs/lyxknx.req lyxknx<br><br>Note: <span class="hljs-keyword">using</span> Easy-RSA <span class="hljs-keyword">configuration</span> <span class="hljs-keyword">from</span>: /etc/openvpn/easy-rsa-<span class="hljs-keyword">server</span>/<span class="hljs-number">3.0</span><span class="hljs-number">.8</span>/vars<br><span class="hljs-keyword">Using</span> SSL: openssl OpenSSL <span class="hljs-number">1.0</span><span class="hljs-number">.2</span>k-fips  <span class="hljs-number">26</span> Jan <span class="hljs-number">2017</span><br><br>The request has been successfully imported <span class="hljs-keyword">with</span> a short <span class="hljs-type">name</span> <span class="hljs-keyword">of</span>: lyxknx<br>You may now use this <span class="hljs-type">name</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">perform</span> signing operations <span class="hljs-keyword">on</span> this request.<br><br>[root@node1 <span class="hljs-number">3</span>]# tree pki<br>pki<br>├── ca.crt<br>├── certs_by_serial<br>│   └── FBCA6A70616926FF19135B0F791F0921.pem<br>├── <span class="hljs-keyword">index</span>.txt<br>├── <span class="hljs-keyword">index</span>.txt.attr<br>├── <span class="hljs-keyword">index</span>.txt.attr.<span class="hljs-built_in">old</span><br>├── <span class="hljs-keyword">index</span>.txt.<span class="hljs-built_in">old</span><br>├── issued<br>│   └── <span class="hljs-keyword">server</span>.crt<br>├── openssl-easyrsa.cnf<br>├── private<br>│   ├── ca.key<br>│   └── <span class="hljs-keyword">server</span>.key<br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>│   ├── lyxknx.req                #导入文件<br>│   └── <span class="hljs-keyword">server</span>.req<br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>├── <span class="hljs-type">serial</span><br>└── <span class="hljs-type">serial</span>.<span class="hljs-built_in">old</span><br><br><span class="hljs-number">12</span> directories, <span class="hljs-number">15</span> files<br></code></pre></td></tr></table></figure><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-comment">#修改给客户端颁发的证书的有效期</span><br>[root@node1 <span class="hljs-number">3</span>]<span class="hljs-comment"># vim vars </span><br><span class="hljs-comment">#建议修改给客户端颁发证书的有效期,可适当减少,比如:90天</span><br><span class="hljs-comment">#set_var EASYRSA_CERT_EXPIRE   825 </span><br><span class="hljs-comment">#将上面行修改为下面</span><br>set_var EASYRSA_CERT_EXPIRE <span class="hljs-number">180</span>          // <span class="hljs-number">180</span>天，<span class="hljs-number">6</span>个月<br><br>[root@node1 <span class="hljs-number">3</span>]<span class="hljs-comment"># ./easyrsa sign client lyxknx</span><br>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/<span class="hljs-number">3.0</span>.<span class="hljs-number">8</span>/vars<br>Using SSL: openssl OpenSSL <span class="hljs-number">1.0</span>.<span class="hljs-number">2k</span>-fips  <span class="hljs-number">26</span> Jan <span class="hljs-number">2017</span><br><br>You are about <span class="hljs-keyword">to</span> sign the following certificate.<br>Please check over the details shown below <span class="hljs-keyword">for</span> accuracy. Note <span class="hljs-literal">that</span> this request<br>has <span class="hljs-keyword">not</span> been cryptographically verified. Please be sure <span class="hljs-literal">it</span> came <span class="hljs-keyword">from</span> a trusted<br>source <span class="hljs-keyword">or</span> <span class="hljs-literal">that</span> you have verified the request checksum <span class="hljs-keyword">with</span> the sender.<br><br>Request subject, <span class="hljs-keyword">to</span> be signed <span class="hljs-keyword">as</span> a client certificate <span class="hljs-keyword">for</span> <span class="hljs-number">180</span> days:<br><br>subject=<br>    commonName                = lyxknx<br><br><br>Type the word <span class="hljs-string">&#x27;yes&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span>, <span class="hljs-keyword">or</span> any other input <span class="hljs-keyword">to</span> abort.<br>  Confirm request details: <span class="hljs-literal">yes</span><br>Using configuration <span class="hljs-keyword">from</span> /etc/openvpn/easy-rsa-server/<span class="hljs-number">3</span>/pki/easy-rsa-<span class="hljs-number">14484.</span>DJyNhP/tmp.yC6RAV<br>Check <span class="hljs-literal">that</span> the request matches the signature<br>Signature ok<br>The Subject<span class="hljs-string">&#x27;s Distinguished Name is as follows</span><br><span class="hljs-string">commonName            :ASN.1 12:&#x27;</span>lyxknx<span class="hljs-string">&#x27;</span><br><span class="hljs-string">Certificate is to be certified until Jan 26 13:20:03 2023 GMT (180 days)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Write out database with 1 new entries</span><br><span class="hljs-string">Data Base Updated</span><br><span class="hljs-string"></span><br><span class="hljs-string">Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/lyxknx.crt  #证书文件</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@node1 3]# tree pki</span><br><span class="hljs-string">pki</span><br><span class="hljs-string">├── ca.crt</span><br><span class="hljs-string">├── certs_by_serial</span><br><span class="hljs-string">│   ├── EB84BBD9A4EF933461BBCF2481F968BB.pem</span><br><span class="hljs-string">│   └── FBCA6A70616926FF19135B0F791F0921.pem</span><br><span class="hljs-string">├── index.txt</span><br><span class="hljs-string">├── index.txt.attr</span><br><span class="hljs-string">├── index.txt.attr.old</span><br><span class="hljs-string">├── index.txt.old</span><br><span class="hljs-string">├── issued</span><br><span class="hljs-string">│   ├── lyxknx.crt                 # 生成的客户端证书</span><br><span class="hljs-string">│   └── server.crt</span><br><span class="hljs-string">├── openssl-easyrsa.cnf</span><br><span class="hljs-string">├── private</span><br><span class="hljs-string">│   ├── ca.key</span><br><span class="hljs-string">│   └── server.key</span><br><span class="hljs-string">├── renewed</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── reqs</span><br><span class="hljs-string">│   ├── lyxknx.req</span><br><span class="hljs-string">│   └── server.req</span><br><span class="hljs-string">├── revoked</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── safessl-easyrsa.cnf</span><br><span class="hljs-string">├── serial</span><br><span class="hljs-string">└── serial.old</span><br><span class="hljs-string"></span><br><span class="hljs-string">12 directories, 17 files</span><br></code></pre></td></tr></table></figure><h2 id="将CA和服务器证书相关文件复制到服务器相应的目录"><a href="#将CA和服务器证书相关文件复制到服务器相应的目录" class="headerlink" title="将CA和服务器证书相关文件复制到服务器相应的目录"></a>将CA和服务器证书相关文件复制到服务器相应的目录</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 <span class="hljs-number">3</span>]# <span class="hljs-keyword">find</span> <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/ \( -name &quot;lyxknx.key&quot; -o -name &quot;lyxknx.crt&quot; -o -name ca.crt \) -exec cp &#123;&#125; /</span>etc<span class="hljs-regexp">/openvpn/</span>client/lyxknx \;<br><br>[root@node1 <span class="hljs-number">3</span>]# tree <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span>lyxknx/<br><span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span>lyxknx/<br>├── ca.crt<br>├── lyxknx.crt<br>└── lyxknx.key<br><br><span class="hljs-number">0</span> directories, <span class="hljs-number">3</span> files<br></code></pre></td></tr></table></figure><h2 id="修改服务器端配置文件"><a href="#修改服务器端配置文件" class="headerlink" title="修改服务器端配置文件"></a>修改服务器端配置文件</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#vim <span class="hljs-regexp">/etc/</span>openvpn/server.conf<br>#<span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;^[a-Z].*&#x27;</span> <span class="hljs-regexp">/etc/</span>openvpn/server.conf<br>#准备目志相关目录<br>[root@node1 yum.repos.d]# getent passwd openvpn<br>openvpn:x:<span class="hljs-number">996</span>:<span class="hljs-number">993</span>:OpenVPN:<span class="hljs-regexp">/etc/</span>openvpn:<span class="hljs-regexp">/sbin/</span>nologin<br><br>[root@node1 yum.repos.d]# mkdir <span class="hljs-regexp">/var/</span>log/openvpn<br><br>[root@node1 yum.repos.d]# ll -d <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span><br>drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">6</span> Jul <span class="hljs-number">30</span> <span class="hljs-number">22</span>:<span class="hljs-number">50</span> <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span><br><br>[root@node1 yum.repos.d]# chown openvpn.openvpn <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span><br>[root@node1 yum.repos.d]# ll -d <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span><br>drwxr-xr-x <span class="hljs-number">2</span> openvpn openvpn <span class="hljs-number">6</span> Jul <span class="hljs-number">30</span> <span class="hljs-number">22</span>:<span class="hljs-number">50</span> <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span><br></code></pre></td></tr></table></figure><h2 id="准备-iptables-规则和内核参数"><a href="#准备-iptables-规则和内核参数" class="headerlink" title="准备 iptables 规则和内核参数"></a>准备 iptables 规则和内核参数</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#在服务器开启ip_forward转发功能<br><br>[root@node1 yum.repos.d]# echo net.ipv4.ip_forward = <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br>You have <span class="hljs-keyword">new</span> mail in <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/mail/</span>root<br>[root@node1 yum.repos.d]# cat <span class="hljs-regexp">/etc/</span>sysctl.conf |<span class="hljs-keyword">grep</span> forward<br>net.ipv4.ip_forward = <span class="hljs-number">1</span><br><br>[root@node1 yum.repos.d]# sysctl -p<br>net.ipv4.ip_forward = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>VPN服务</category>
      
    </categories>
    
    
    <tags>
      
      <tag>22.2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>firewalld</title>
    <link href="/2022/07/28/firewalld/"/>
    <url>/2022/07/28/firewalld/</url>
    
    <content type="html"><![CDATA[<h1 id="20-4firewalld服务"><a href="#20-4firewalld服务" class="headerlink" title="20.4firewalld服务"></a>20.4firewalld服务</h1><span id="more"></span><p>firewalld 就是iptables的二次封装，操作起来简单了很多。</p><p>firewalld 三种配置方法：</p><figure class="highlight elixir"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-number">1</span>、firewall-config 图形工具: 需安装 firewall-config包<br><span class="hljs-number">2</span>、firewall-cmd 命令行工具: firewalld包,默认安装<br><span class="hljs-number">3</span>、/etc/firewalld/ 配置文件，一般不建议,如<span class="hljs-symbol">:/etc/firewalld/zones/public</span>.xml<br></code></pre></td></tr></table></figure><p>启动firewall-config的图形工具：</p><p><img src="image-20220728215220141.png" alt="image-20220728215220141"></p><p><img src="image-20220728215243110.png" alt="image-20220728215243110"></p><p>默认http是没有划勾的，刚刚安装httpd服务后，在其它机器是不能访问的。</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node2 test]<span class="hljs-comment"># systemctl status firewalld.service</span><br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Thu 2022-07-28 09:11:35 EDT; 9min ago<br>     Docs: man:firewalld(1)<br> Main PID:<span class="hljs-number"> 7983 </span>(firewalld)<br>   CGroup: /system.slice/firewalld.service<br>           └─7983 /usr/bin/python2 -Es /usr/sbin/firewalld --nofork --nopid<br><br>Jul<span class="hljs-number"> 28 </span>09:11:34 node2 systemd[1]: Stopped firewalld - dynamic firewall daemon.<br>Jul<span class="hljs-number"> 28 </span>09:11:34 node2 systemd[1]: Starting firewalld - dynamic firewall daemon...<br>Jul<span class="hljs-number"> 28 </span>09:11:35 node2 systemd[1]: Started firewalld - dynamic firewall daemon.<br>Jul<span class="hljs-number"> 28 </span>09:11:35 node2 firewalld[7983]: WARNING: AllowZoneDrifting is enabled. This is...ow.<br>Hint: Some lines were ellipsized, use -l to show in full.<br><br>[root@node2 test]<span class="hljs-comment"># curl 127.0.0.1</span><br>website<br><br>[root@node2 test]<span class="hljs-comment"># ss -ntl</span><br>State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>              *:22                            *:*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>      127.0.0.1:25                            *:*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>      127.0.0.1:6010                          *:*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>             :::80                           :::*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>             :::22                           :::*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>            ::1:25                           :::*                  <br>LISTEN     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>            ::1:6010   <br><br>[root@node1 yum.repos.d]<span class="hljs-comment"># curl 192.168.23.102</span><br>curl: (7) Failed connect to 192.168.23.102:80; No route to host<br></code></pre></td></tr></table></figure><p><img src="image-20220728215621106.png" alt="image-20220728215621106"></p><p>在下拉选项中选择Runtime，则立即生效</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@node1</span> yum.repos.d]<span class="hljs-meta"># curl 192.168.23.102</span><br>website<br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># vim /etc/httpd/conf/httpd.conf</span><br><span class="hljs-comment">#Listen 12.34.56.78:80</span><br><span class="hljs-title class_">Listen</span> <span class="hljs-number">80</span><br><span class="hljs-title class_">Listen</span> <span class="hljs-number">8080</span><br><br>[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># systemctl restart httpd</span><br><br>[root<span class="hljs-variable">@node2</span> test]<span class="hljs-comment"># ss -ntl</span><br><span class="hljs-title class_">State</span>       <span class="hljs-title class_">Recv</span>-Q <span class="hljs-title class_">Send</span>-Q <span class="hljs-title class_">Local</span> <span class="hljs-symbol">Address:</span><span class="hljs-title class_">Port</span>               <span class="hljs-title class_">Peer</span> <span class="hljs-symbol">Address:</span><span class="hljs-title class_">Port</span>              <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>               *<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                            *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">100</span>       <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                            *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>       <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">6010</span>                          *<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>              ::<span class="hljs-symbol">:</span><span class="hljs-number">8080</span>                         ::<span class="hljs-symbol">:*</span>       // 启用了<span class="hljs-number">8080</span>端口           <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>              ::<span class="hljs-symbol">:</span><span class="hljs-number">80</span>                           ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>              ::<span class="hljs-symbol">:</span><span class="hljs-number">22</span>                           ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">100</span>             ::<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span>                           ::<span class="hljs-symbol">:*</span>                  <br><span class="hljs-title class_">LISTEN</span>      <span class="hljs-number">0</span>      <span class="hljs-number">128</span>             ::<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">6010</span>                         ::<span class="hljs-symbol">:*</span> <br></code></pre></td></tr></table></figure><p><img src="image-20220728220120435.png" alt="image-20220728220120435"></p><p>在firewall-config的图形工具中，增加8080端口前后的测试结果：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@node1 yum.repos.d]<span class="hljs-comment"># curl 192.168.23.102:8080</span><br>curl: (<span class="hljs-number">7</span>) Failed connect <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.102</span>:<span class="hljs-number">8080</span>; No route <span class="hljs-keyword">to</span> host<br><br>[root@node1 yum.repos.d]<span class="hljs-comment"># curl 192.168.23.102:8080</span><br>website<br><br>[root@node1 yum.repos.d]<span class="hljs-comment"># curl 192.168.23.102:8080</span><br>curl: (<span class="hljs-number">7</span>) Failed connect <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.102</span>:<span class="hljs-number">8080</span>; No route <span class="hljs-keyword">to</span> host<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>22 VPN服务</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux防火墙</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第七周作业-2022-7-27</title>
    <link href="/2022/07/26/%E7%AC%AC%E4%B8%83%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-27/"/>
    <url>/2022/07/26/%E7%AC%AC%E4%B8%83%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-27/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第二十七天、第二十八天、第二十九天、第三十天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>第二十七天：<br>ANSIBLE运维自动化<br>1、实现PXC集群和压力测试<br>2、自动化运维及运维环境介绍<br>3、ansible的架构和相关文件<br>4、ansible基本工具使用<br>5、ansible常用模块<br>6、ansible常用模块和YAML语言<br>7、playbook实现常用组件和基本格式”<br>“第二十八天：<br>Http协议和Web服务器Apache<br>1、playbook的高级用法<br>2、playbook的高级用法关于变量<br>3、playbook的高级用法变量<br>4、playbook的高级用法迭代和条件判断<br>5、playbook的高级用法<br>6、ansible的企业级应用role<br>7、http和相关技术”<br>“第二十九天：<br>Http协议和Web服务器Apache2<br>1、Http协议各种版本详解<br>2、Http协议的工作过程和Httpd的MPM工作模式<br>3、Httpd安装和配置文件格式介绍<br>4、Httpd常见配置<br>5、Httpd常见配置<br>6、Httpd常见配置<br>7、http的报文结构和常见响应码”<br>“第三十天：<br>http协议和web服务器<br>1http的cookie和session详解<br>2LAMP架构和CGI与FASTCGI区别<br>3常见PHP的配置和php程序<br>4LAMP各种常见应用<br>5基于opcache加速LAMP<br>6实现基于FACTCGI的LAMP架构<br>7编译安装基于”</p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><h2 id="1、说明自动化运维的路径，原理，实践方法，"><a href="#1、说明自动化运维的路径，原理，实践方法，" class="headerlink" title="1、说明自动化运维的路径，原理，实践方法，"></a>1、说明自动化运维的路径，原理，实践方法，</h2><h3 id="互联网运维职业发展路线："><a href="#互联网运维职业发展路线：" class="headerlink" title="互联网运维职业发展路线："></a>互联网运维职业发展路线：</h3><figure class="highlight markdown"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-code">运维的发展可分为以下几个阶段：手工管理阶段，工具批量操作阶段，平台管理阶段，系统自调度阶段。对应的运维职业发展路线为：基础运维→监控运维→系统运维→应用运维→自动化运维→架构师→总监或CTO。</span><br><span class="hljs-code"></span><br>​即对于运维人员来说，首先需要掌握服务器的基础系统管理命令，服务器运行关键性能指标的监控，掌握日常重复性操作的脚本编写；在打好基础后熟悉各种应用的部署和维护工作，根据业务情况为其搭建或扩建适合的配套架构；在拥有以上实践经验后，则可以通过自动化运维工具完成大规模主机的日常管理维护工作，若拥有开发能力还可以集成日常运维工具开发运维平台。在熟悉大型架构、具有丰富运维经验后掌握完整架构的设计搭建和优化，往架构师发展。<br><br>​运维的发展过程可简要概括为：从运维工作的服务部署、维护和监控依赖于人工完成转变为自动化工具或使用运维平台完成，在发生故障后交由自动故障处理软件分析，加快恢复速度。<br></code></pre></td></tr></table></figure><h3 id="自动化运维的原理和实践方法"><a href="#自动化运维的原理和实践方法" class="headerlink" title="自动化运维的原理和实践方法"></a>自动化运维的原理和实践方法</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lasso">在实际生产中，公司内部的主机集群可大致分为DEV开发环境、测试环境、预发布环境、发布环境、生产环境、灰度环境。<br><br>​若某个环境的需求增加多台主机，需要安装系统，则可使用基于PXE的Cobbler来实现自动化部署系统。<br><br>​开发环境和测试环境完成某项目的更新，需要更新应用项目的新版本，可以使用Jenkins和GItlab实现持续集成与持续部署平台。<br><br>​生产环境主机数量最多，且运行大量重要应用，对外提供服务。因此需要借助Ansible或Saltstack等自动化运维工具，以更安全高效的形式自动完成日常管理、软件部署、配置修改、安全加固等工作。为了实时监控生产环境架构中的多个集群服务器，使用Zabbix、Prometheus等监控软件实现分布式检验平台。对于多种软件产生的海量日志，可使用Elastic <span class="hljs-built_in">Stack</span>进行日志统一收集与展示。<br><br>​关于以上自动化运维所需工具的架构需要根据业务要求选择搭建。<br></code></pre></td></tr></table></figure><h2 id="2、搭建pxc集群"><a href="#2、搭建pxc集群" class="headerlink" title="2、搭建pxc集群"></a>2、搭建pxc集群</h2><p>在之前的Mysql集群架构文章中，演示了多主架构，其具有容易数据不一致、同时进行某一操作会互相锁死的问题。而PXC架构则即具有多主架构的特点，又通过特殊的机制解决了上述问题。</p><p>PXC的特点</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">全称Percona Xtradb <span class="hljs-keyword">Cluster</span>，是Galera Cluste方案的一种版本，与MariaDB <span class="hljs-keyword">Cluster</span>类似。Galera本身是具有多主特性的，即采用multi-master的集群架构，是一个既稳健，又在数据一致性、完整性及高性能方面有出色表现的高可用解决方案。<br><br>​Galera <span class="hljs-keyword">Cluster</span>的优点有：实现多节点读写，节点间无延迟同步复制，故障切换方便，热插拔，自动克隆数据使新增节点或有节点停机时不需要人工备份。<br><br>​缺点：为了防止冲突，使用DDL语句时需要全局验证，集群性能由集群中最差性能节点决定。全量拷贝数据时，提供数据的donor节点无法对外提供读写服务。<br></code></pre></td></tr></table></figure><h3 id="搭建PXC集群"><a href="#搭建PXC集群" class="headerlink" title="搭建PXC集群"></a>搭建PXC集群</h3><p>​    使用软件版本：Percona XtraDB Cluster 5.7 （不支持CentOS8，与Mysql不兼容）</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">#若yum源中没有该软件，可添加国内镜像站点percona路径<br>#分别在3台主机上安装<br>[root@localhost ~]$yum install Percona-XtraDB-Cluster-57 -y<br><br>#修改配置文件<br>#位置/etc/percona-xtradb-cluster.conf.d   /etc/my.cnf<br>[root@localhost ~]$ls /etc/percona-xtradb-cluster.conf.d<br>mysqld.cnf  mysqld_safe.cnf  wsrep.cnf<br><br>#第一个节点<br>[root@localhost ~]$vim /etc/percona-xtradb-cluster.conf.d/wsrep.cnf<br>#添加集群节点<br>wsrep<span class="hljs-emphasis">_cluster_address=gcomm://10.0.0.152,10.0.0.154,10.0.0.155 </span><br><span class="hljs-emphasis">#指定当前节点IP</span><br><span class="hljs-emphasis">wsrep_node_address=10.0.0.152</span><br><span class="hljs-emphasis">#在SST传输时需要用到的认证凭据，格式为：&quot;用户：密码&quot;，实际使用时需要修改为更安全的密码</span><br><span class="hljs-emphasis">wsrep_sst_auth=&quot;sstuser:s3cretPass&quot;</span><br><span class="hljs-emphasis">#当前节点名 If wsrep_node_name is not specified,  then system hostname will be used</span><br><span class="hljs-emphasis">wsrep_node_</span>name=pxc-cluster-node-n67024<br><br>#第二个节点 未提及则同上<br>wsrep<span class="hljs-emphasis">_node_address=10.0.0.154</span><br><span class="hljs-emphasis">wsrep_node_</span>name=pxc-cluster-node-n67025<br><br>#第三个节点<br>wsrep<span class="hljs-emphasis">_node_address=10.0.0.155</span><br><span class="hljs-emphasis">wsrep_node_</span>name=pxc-cluster-node-n67026<br><br><br>#启动<br>[root@localhost ~]$systemctl enable --now mysql@bootstrap.service<br>#通过4567端口进行集群内节点间连接，通过3306端口对外服务<br>[root@localhost ~]$ss -ntul<br>Netid State      Recv-Q Send-Q                         Local Address:Port                                        Peer Address:Port              <br><span class="hljs-code">    </span><br>tcp   LISTEN     0      128                                        <span class="hljs-strong">*:4567                                                   *:*</span>                  <br><span class="hljs-code">                  </span><br>tcp   LISTEN     0      80                                      [::]:3306                                                [::]:*                  <br><br>#设置密码<br>#使用临时密码登录<br>[root@localhost ~]$grep &quot;temporary password&quot; /var/log/mysqld.log<br>2022-07-26T07:06:53.895451Z 1 [Note] A temporary password is generated for root@localhost: 4&amp;g<span class="hljs-strong">*HTiU*xkd</span><br><span class="hljs-strong">[root@localhost ~]$mysql -uroot -p&#x27;4&amp;g*HTiU*xkd&#x27;</span><br><span class="hljs-strong">mysql&gt; alter user root@localhost identified by &quot;12345&quot;;</span><br><span class="hljs-strong">#创建SST传输用户账号，并授权</span><br><span class="hljs-strong">mysql&gt; create user &#x27;sstuser&#x27;@&#x27;localhost&#x27; identified by &#x27;s3cretPass&#x27;;</span><br><span class="hljs-strong">mysql&gt; grant all on *.*</span> to sstuser@localhost;<br><br>#可通过变量信息查看当前节点状态<br>mysql&gt; show status like <span class="hljs-emphasis">&#x27;wsrep%&#x27;</span>;<br>#查看SST是否完成，若为Joiner，则不可以加新节点<br>| wsrep<span class="hljs-emphasis">_local_state_comment | Synced                               |</span><br><span class="hljs-emphasis">#集群规模</span><br><span class="hljs-emphasis">| wsrep_cluster_size         | 1                                   |</span><br><span class="hljs-emphasis">#是否已完全连接</span><br><span class="hljs-emphasis">| wsrep_cluster_</span>status       | Primary                             |<br><br>#其他节点上启动集群<br>[root@localhost ~]$systemctl start mysql<br>#可观察到规模变化<br>mysql&gt; show status like <span class="hljs-emphasis">&#x27;wsrep%&#x27;</span>;<br>| wsrep<span class="hljs-emphasis">_cluster_size               | 2                                    |</span><br><span class="hljs-emphasis">mysql&gt; show status like &#x27;wsrep%&#x27;;</span><br><span class="hljs-emphasis">| wsrep_cluster_</span>size               | 3                                    |<br><br>#节点1<br><span class="hljs-section">mysql&gt;  SHOW VARIABLES LIKE &#x27;wsrep_node_name&#x27;;</span><br><span class="hljs-section">+-----------------+-------------------------+</span><br><span class="hljs-section">| Variable_name   | Value                   |</span><br><span class="hljs-section">+-----------------+-------------------------+</span><br><span class="hljs-section">| wsrep_node_name | pxc-cluster-node-n67024 |</span><br><span class="hljs-section">+-----------------+-------------------------+</span><br><span class="hljs-section">mysql&gt;  SHOW VARIABLES LIKE &#x27;wsrep_node_address&#x27;;</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| Variable_name      | Value      |</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| wsrep_node_address | 10.0.0.152 |</span><br><span class="hljs-section">+--------------------+------------+</span><br>#节点2<br>[root@localhost ~]$mysql -uroot -p12345<br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;wsrep_node_name&#x27;;</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">| Variable_name   | Value                     |</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">| wsrep_node_name | pxc-cluster-node-1-n67025 |</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;wsrep_node_address&#x27;;</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| Variable_name      | Value      |</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| wsrep_node_address | 10.0.0.154 |</span><br><span class="hljs-section">+--------------------+------------+</span><br>#节点3<br>[root@localhost ~]$mysql -uroot -p12345<br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;wsrep_node_name&#x27;;</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">| Variable_name   | Value                     |</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">| wsrep_node_name | pxc-cluster-node-1-n67026 |</span><br><span class="hljs-section">+-----------------+---------------------------+</span><br><span class="hljs-section">mysql&gt; SHOW VARIABLES LIKE &#x27;wsrep_node_address&#x27;;</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| Variable_name      | Value      |</span><br><span class="hljs-section">+--------------------+------------+</span><br><span class="hljs-section">| wsrep_node_address | 10.0.0.155 |</span><br><span class="hljs-section">+--------------------+------------+</span><br></code></pre></td></tr></table></figure><p>验证：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">测试是否均可读写：<br><span class="hljs-comment">#节点1</span><br>mysql&gt; show databases;<br>+--------------------+<br>|<span class="hljs-string"> Database           </span>|<br>+--------------------+<br>|<span class="hljs-string"> information_schema </span>|<br>|<span class="hljs-string"> mysql              </span>|<br>|<span class="hljs-string"> performance_schema </span>|<br>|<span class="hljs-string"> sys                </span>|<br>+--------------------+<br>mysql&gt; create database test;<br><span class="hljs-comment">#节点2</span><br>mysql&gt; show databases;<br>+--------------------+<br>|<span class="hljs-string"> Database           </span>|<br>+--------------------+<br>|<span class="hljs-string"> information_schema </span>|<br>|<span class="hljs-string"> mysql              </span>|<br>|<span class="hljs-string"> performance_schema </span>|<br>|<span class="hljs-string"> sys                </span>|<br>|<span class="hljs-string"> test               </span>|<br>+--------------------+<br>mysql&gt; create database test2;<br><span class="hljs-comment">#节点3</span><br>mysql&gt; show databases;<br>+--------------------+<br>|<span class="hljs-string"> Database           </span>|<br>+--------------------+<br>|<span class="hljs-string"> information_schema </span>|<br>|<span class="hljs-string"> mysql              </span>|<br>|<span class="hljs-string"> performance_schema </span>|<br>|<span class="hljs-string"> sys                </span>|<br>|<span class="hljs-string"> test               </span>|<br>|<span class="hljs-string"> test2              </span>|<br>+--------------------+<br>mysql&gt; create database test3;<br><span class="hljs-comment">#节点1</span><br>mysql&gt; show databases;<br>+--------------------+<br>|<span class="hljs-string"> Database           </span>|<br>+--------------------+<br>|<span class="hljs-string"> information_schema </span>|<br>|<span class="hljs-string"> mysql              </span>|<br>|<span class="hljs-string"> performance_schema </span>|<br>|<span class="hljs-string"> sys                </span>|<br>|<span class="hljs-string"> test               </span>|<br>|<span class="hljs-string"> test2              </span>|<br>|<span class="hljs-string"> test3              </span>|<br>+--------------------+<br><br></code></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs subunit">测试同时输入相同操作是否产生冲突：<br>在控制终端中打开撰写栏，选择发送到所有会话<br><br>#第一个节点<br>mysql&gt; create database test4;<br><span class="hljs-keyword">ERROR </span>1007 (HY000): Can&#x27;t create database &#x27;test4&#x27;; database exists<br>#第二个节点<br>mysql&gt; create database test4;<br>Query OK, 1 row affected (0.00 sec)<br>#第三个节点<br>mysql&gt; create database test4;<br><span class="hljs-keyword">ERROR </span>1007 (HY000): Can&#x27;t create database &#x27;test4&#x27;; database exists<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">数据库成功创建并且没有卡死，在三个节点上也能查看到test4数据库。说明PXC集群解决了多主架构的冲突问题。<br><br>​若想要扩展新的节点也很简单，只要在新主机上安装并修改配置文件即可加入集群，需要注意由于Galare集群数据同步的特性将完全覆盖原有数据。<br></code></pre></td></tr></table></figure><h2 id="3、playbook常用模块总结；一个简单的playbook完成安装httpd服务。"><a href="#3、playbook常用模块总结；一个简单的playbook完成安装httpd服务。" class="headerlink" title="3、playbook常用模块总结；一个简单的playbook完成安装httpd服务。"></a>3、playbook常用模块总结；一个简单的playbook完成安装httpd服务。</h2><h3 id="playbook常用模块"><a href="#playbook常用模块" class="headerlink" title="playbook常用模块"></a>playbook常用模块</h3><p><strong>Ping模块： 测试受控主机SSH连接是否可行</strong></p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dos">ansible all -m <span class="hljs-built_in">ping</span><br><span class="hljs-built_in">Copy</span><br></code></pre></td></tr></table></figure><p><strong>Shell模块 ：在远端主机用shell执行命令，不具有幂等性，绝大多数命令可由专门模块完成，使用较少。</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">ansible websrvs -m <span class="hljs-keyword">shell</span><span class="language-bash"> -a <span class="hljs-string">&#x27;echo $HOSTNAME&#x27;</span></span><br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p><strong>Copy模块 ：从ansible服务器主控端复制文件到远程主机，默认覆盖 注意: src=file 如果是没指明路径,则为当前目录或当前目录下的files目录下的file文件</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">#如目标存在，默认覆盖，此处指定先备份<br>ansible websrvs -<span class="hljs-keyword">m</span> <span class="hljs-keyword">copy</span> -<span class="hljs-keyword">a</span> <span class="hljs-comment">&quot;src=/root/test1.sh dest=/tmp/test2.sh   owner=wang </span><br><span class="hljs-keyword">mode</span>=<span class="hljs-number">600</span> backup=yes<span class="hljs-comment">&quot;</span><br>#复制/etc/下的文件，不包括/etc/目录自身,注意/etc/后面有/<br>ansible websrvs -<span class="hljs-keyword">m</span> <span class="hljs-keyword">copy</span> -<span class="hljs-keyword">a</span> <span class="hljs-comment">&quot;src=/etc/ dest=/backup</span><br>Copy<br></code></pre></td></tr></table></figure><p><strong>Get_url模块 : 用于将文件从http、https或ftp下载到被管理机节点上</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ansible</span> websrvs -m get_url -a &#x27;url=http://nginx.org/download/nginx-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span>.tar.gz dest=/usr/local/src/nginx.tar.gz&#x27;<br><span class="hljs-attribute">Copy</span><br></code></pre></td></tr></table></figure><p><strong>File 模块：相当于shell中文件管理命令，设置文件属性,创建软链接等</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-comment">#state可指定创建目录或文件、删除、软连接等操作</span><br>ansible <span class="hljs-literal">all</span> -m file  -a &#x27;path=/data/test.txt <span class="hljs-keyword">state</span>=touch&#x27;<br><span class="hljs-comment">#创建软链接</span><br>ansible <span class="hljs-literal">all</span> -m file -a &#x27;src=/data/testfile path|dest|name=/data/testfile-link <span class="hljs-keyword">state</span>=link&#x27;<br>Copy<br></code></pre></td></tr></table></figure><p><strong>stat 模块：检查文件或文件系统的状态</strong></p><p>#<strong>返回值exists： 判断是否存在 isuid： 调用用户的ID与所有者ID是否匹配</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ansible</span> <span class="hljs-number">127.0.0.1</span> -m stat -a <span class="hljs-string">&#x27;path=/etc/passwd&#x27;</span><br>Copy<br></code></pre></td></tr></table></figure><p><strong>Unarchive模块 ：解包解压缩 将ansible主机上的压缩包传到远程主机后解压缩至特定目录</strong><br><strong>Archive模块：打包压缩</strong><br><strong>#选项remote_src：和copy功能一样且互斥，yes表示在远程主机，不在ansible主机，no表示文件在ansible主机上</strong></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">ansible websrvs -<span class="hljs-keyword">m</span> unarchive -a&#x27;src=https:<span class="hljs-comment">//releases.ansible.com/ansible/ansible-2.1.6.0-0.1.rc1.tar.gz dest=/data/   owner=root remote_src=yes&#x27;</span><br>ansible websrvs -<span class="hljs-keyword">m</span> archive  -a &#x27;path=/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/ dest=/data/<span class="hljs-keyword">log</span>.tar.bz2 <span class="hljs-keyword">format</span>=bz2 <br>owner=wang mode=0600&#x27;<br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p><strong>Cron模块 ：在远程主机创建定时任务</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#创建任务</span><br><span class="hljs-attribute">ansible</span> <span class="hljs-number">10.0.0.8</span> -m cron -a &#x27;hour=<span class="hljs-number">2</span> minute=<span class="hljs-number">30</span> weekday=<span class="hljs-number">1</span>-<span class="hljs-number">5</span> name=<span class="hljs-string">&quot;backup mysql&quot;</span> job=/root/mysql_backup.sh&#x27; #删除任务<br><span class="hljs-attribute">ansible</span> websrvs -m cron -a <span class="hljs-string">&quot;name=&#x27;backup mysql&#x27; state=absent&quot;</span><br><span class="hljs-attribute">Copy</span><br></code></pre></td></tr></table></figure><p><strong>Yum/Apt模块： 可以安装、更新软件</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pf">ansible websrvs -m yum -a &#x27;name=httpd <span class="hljs-keyword">state</span>=present&#x27;  <span class="hljs-comment">#安装</span><br>ansible websrvs -m yum -a &#x27;name=* <span class="hljs-keyword">state</span>=lastest exclude=kernel*,foo*&#x27; <span class="hljs-comment">#升级除</span><br>kernel和foo开头以外的所有包<br>Copy<br></code></pre></td></tr></table></figure><p><strong>yum_repository 模块： 生成yum仓库文件 ，将仓库文件中的关键信息用键值对的形式表示</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#playbook中写法</span><br>范例：<br> tasks:<br><br>   - name: Add multiple repositories into the same file <br>     yum_repository:<br>      name: test<br>      description: EPEL YUM repo<br>      file: external_repos<br>      baseurl: https:<span class="hljs-regexp">//</span>download.fedoraproject.org<span class="hljs-regexp">/pub/</span>epel<span class="hljs-regexp">/$releasever/</span><span class="hljs-variable">$basearch</span>/<br>Copy<br></code></pre></td></tr></table></figure><p><strong>service模块： 相当于systemctl</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pf">ansible <span class="hljs-literal">all</span> -m service -a &#x27;name=httpd <span class="hljs-keyword">state</span>=started enabled=yes&#x27;<br>ansible <span class="hljs-literal">all</span> -m service -a &#x27;name=httpd <span class="hljs-keyword">state</span>=stopped&#x27;<br>ansible <span class="hljs-literal">all</span> -m service -a &#x27;name=httpd <span class="hljs-keyword">state</span>=reloaded&#x27;<br>Copy<br></code></pre></td></tr></table></figure><p><strong>User模块，Group模块 ： 进行用户和用户组管理，uid、gid、家目录、名字等使用键值对表示</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">ansible all -m <span class="hljs-keyword">user</span> <span class="hljs-title">-a</span> &#x27;<span class="hljs-attr">name=</span>user1 <span class="hljs-attr">comment=</span><span class="hljs-string">&quot;test user&quot;</span> <span class="hljs-attr">uid=</span><span class="hljs-number">2048</span> <span class="hljs-attr">home=</span>/app/user1 <span class="hljs-attr">group=</span>root&#x27;<br>ansible websrvs -m <span class="hljs-keyword">group</span>  <span class="hljs-title">-a</span> &#x27;<span class="hljs-attr">name=</span>nginx <span class="hljs-attr">gid=</span><span class="hljs-number">88</span> <span class="hljs-attr">system=</span>yes&#x27;<br>Copy<br></code></pre></td></tr></table></figure><p><strong>Setup 模块 : 收集主机的系统信息，可使用filter过滤</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">ansible <span class="hljs-keyword">all</span> <span class="hljs-operator">-</span>m setup <span class="hljs-operator">-</span>a <span class="hljs-string">&#x27;filter=ansible_python_version&#x27;</span><br><span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p><strong>debug 模块 ：此模块可以用于输出信息,并且通过 msg 定制输出的信息内容</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#可输出变量</span><br><span class="hljs-attr">tasks:</span> <br><br>   <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">output</span> <span class="hljs-string">variables</span><br>     <span class="hljs-attr">debug:</span><br>     <span class="hljs-attr">msg:</span> <span class="hljs-string">Host</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_nodename &#125;&#125;</span>&quot;</span> <span class="hljs-string">Ip</span>  <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; ansible_default_ipv4.address </span></span><br><span class="hljs-template-variable"><span class="hljs-string">     &#125;&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h3 id="编写playbook，完成安装httpd服务"><a href="#编写playbook，完成安装httpd服务" class="headerlink" title="编写playbook，完成安装httpd服务"></a>编写playbook，完成安装httpd服务</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-comment">#install httpd</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">websrvs</span><br> <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br> <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span><br> <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Instal1</span> <span class="hljs-string">httpd</span><br>      <span class="hljs-attr">yum:</span> <span class="hljs-string">name=httpd</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Modify</span> <span class="hljs-string">config</span> <span class="hljs-string">list</span> <span class="hljs-string">port</span><br>      <span class="hljs-attr">lineinfile:</span> <br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span> <br>        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^Listen&#x27;</span><br>        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;Listen 8080&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Modify</span> <span class="hljs-string">config</span> <span class="hljs-string">data1</span><br>      <span class="hljs-attr">lineinfile:</span> <br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span> <br>        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^DocumentRoot &quot;/var/www/html&quot;&#x27;</span><br>        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;DocumentRoot &quot;/data/html&quot;&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Modify</span> <span class="hljs-string">config</span> <span class="hljs-string">data2</span><br>      <span class="hljs-attr">lineinfile:</span> <br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/httpd/conf/httpd.conf</span> <br>        <span class="hljs-attr">regexp:</span> <span class="hljs-string">&#x27;^&lt;Directory &quot;/var/www/html&quot;&gt;&#x27;</span><br>        <span class="hljs-attr">line:</span> <span class="hljs-string">&#x27;&lt;Directory &quot;/data/html&quot;&gt;&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Mkdir</span> <span class="hljs-string">website</span> <span class="hljs-string">dir</span><br>      <span class="hljs-attr">file:</span> <span class="hljs-string">path=/data/html</span> <span class="hljs-string">state=directory</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Web</span> <span class="hljs-string">html</span><br>      <span class="hljs-attr">copy:</span> <span class="hljs-string">src=files/index.html</span> <span class="hljs-string">dest=/data/html/</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Start</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=httpd</span> <span class="hljs-string">state=started</span> <span class="hljs-string">enabled=yes</span><br></code></pre></td></tr></table></figure><h2 id="4、httpd协议的工作过程。"><a href="#4、httpd协议的工作过程。" class="headerlink" title="4、httpd协议的工作过程。"></a>4、httpd协议的工作过程。</h2><h3 id="一次完整的http请求处理过程"><a href="#一次完整的http请求处理过程" class="headerlink" title="一次完整的http请求处理过程"></a>一次完整的http请求处理过程</h3><p><img src="image-20220814225533528.png" alt="image-20220814225533528"></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-number">1</span>、建立连接：接收或拒绝连接请求<br><span class="hljs-number">2</span>、接收请求：接收客户端请求报文中对某资源的一次请求的过程<br><span class="hljs-number">3</span>、处理请求：服务器对请求报文进行解析，并获取请求的资源及请求方法等相关信息，根据方法，资<br>源，首部和可选的主体部分对请求进行处理<br>常用请求<span class="hljs-keyword">Method</span>: GET、POST、HEAD、PUT、DELETE、TRACE、OPTIONS<br><span class="hljs-number">4</span>、访问资源：<br> 服务器获取请求报文中请求的资源web服务器，即存放了web资源的服务器，负责向请求者提供对方<br>请求的静态资源，或动态运行后生成的资源<br><span class="hljs-number">5</span>、构建响应报文：<br> 一旦Web服务器识别除了资源，就执行请求方法中描述的动作，并返回响应报文。响应报文中 包含<br>有响应状态码、响应首部，如果生成了响应主体的话，还包括响应主体<br><span class="hljs-number">6</span>、发送响应报文<br> Web服务器通过连接发送数据时也会面临与接收数据一样的问题。服务器可能有很多条到各个客户<br>端的连接，有些是空闲的，有些在向服务器发送数据，还有一些在向客户端回送响应数据。服务器要记<br>录连接的状态，还要特别注意对持久连接的处理。对非持久连接而言，服务器应该在发送了整条报文之<br>后，关闭自己这一端的连接。对持久连接来说，连接可能仍保持打开状态，在这种情况下，服务器要正<br>确地计算Content-Length首部，不然客户端就无法知道响应什么时候结束<br><span class="hljs-number">7</span>、记录日志<br> 最后，当事务结束时，Web服务器会在日志文件中添加一个条目，来描述已执行的事务<br></code></pre></td></tr></table></figure><h2 id="5、以apache-lamp架构，借助ansible实现自动化运维小案例。"><a href="#5、以apache-lamp架构，借助ansible实现自动化运维小案例。" class="headerlink" title="5、以apache/lamp架构，借助ansible实现自动化运维小案例。"></a>5、以apache/lamp架构，借助ansible实现自动化运维小案例。</h2><h2 id="6、一键安装，配置更新，站点版本发布，程序更新版本，以这些功能形成不同的playbook。"><a href="#6、一键安装，配置更新，站点版本发布，程序更新版本，以这些功能形成不同的playbook。" class="headerlink" title="6、一键安装，配置更新，站点版本发布，程序更新版本，以这些功能形成不同的playbook。"></a>6、一键安装，配置更新，站点版本发布，程序更新版本，以这些功能形成不同的playbook。</h2>]]></content>
    
    
    
    <tags>
      
      <tag>ANSIBLE运维自动化以及http协议</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第六周作业-2022-7-20</title>
    <link href="/2022/07/19/%E7%AC%AC%E5%85%AD%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-20/"/>
    <url>/2022/07/19/%E7%AC%AC%E5%85%AD%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-20/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第二十三天、第二十四天、第二十五天、第二十六天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>第二十三天<br>Mysql数据库一<br>1、Mysql安装和安全加固<br>2、Mysql的基本使用和二进制安装<br>3、Mysql的编译安装和SQL语言介绍<br>4、Mysql多实例和SQL语句分类<br>5、SQL的数据库管理和表创建<br>6、DML和DQL语句<br>7、SQL的单表和多表查询”<br>“第二十四天：<br>Mysql数据库二<br>1、Mysql的视图函数存储过程触发器和事件管理<br>2、Mysql用户和权限管理<br>3、Mysql架构和存储引擎<br>4、Mysql的索引结构<br>5、Mysql索引管理和相关工具<br>6、Mysql锁管理和事务<br>7、事务日志管理和报错日志”<br>“第二十五天<br>Mysql数据库三<br>1、Mysql的通用日志和慢查询日志及二进制日志<br>2、Mysql二进制日志管理<br>3、Mysql备份类型和原理<br>4、Mysql备份和还原<br>5、Mysql备份还原实战<br>6、xtrabackup备份工具实战<br>7、Mysql主从复制原理和实现”<br>“第二十六天：<br>Mysql数据库四<br>1、Mysql主从复制实现和故障排错<br>2、Mysql级联复制和主主复制架构实现<br>3、Mysql的半同步复制和复制过滤器<br>4、Mysql主从复制问题和Mysql分库分表原理<br>5、MYCAT实现Mysql读写分离<br>6、MHA实现Mysql的高可用性”    </p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><h2 id="1、简述DDL-DML-DCL-DQL，并且说明mysql各个关键字查询时候的先后顺序"><a href="#1、简述DDL-DML-DCL-DQL，并且说明mysql各个关键字查询时候的先后顺序" class="headerlink" title="1、简述DDL,DML,DCL,DQL，并且说明mysql各个关键字查询时候的先后顺序"></a>1、简述DDL,DML,DCL,DQL，并且说明mysql各个关键字查询时候的先后顺序</h2><p>DDL:  Data Defination Language 数据定义语言。<br> 包含的命令有 CREATE，DROP，ALTER。分别用于创建、删除和修改数据库、表、用户或其它对象。</p><p>DML: Data Manipulation Language 数据操纵语言。<br>包含的命令有 INSERT，DELETE，UPDATE。 软件开发：CRUD。主要用来编辑某个表的数据，分别用于插入、删除、修改记录。</p><p>DCL：Data Control Language 数据控制语言。<br> 包含的命令有GRANT，REVOKE。分别用于授权和吊销用户的权限，可以授权用户将权限转授予其他用户。</p><p>DQL：Data Query Language 数据查询语言<br>最常用的是 SELECT，用于查看表和变量中的数据，也可以配合关键字对表中 数据进行搜索、过滤。</p><p>关键字包含：</p><p>WHERE：按数值过滤查找相应行。</p><p>GROUP BY：根据指定的条件把查询结果进行“分组”以用于做“聚合”运算，一旦分组，select语句后只跟分组的字段和聚合函。</p><p>HAVING:   对分组聚合运算后的结果指定过滤条件。</p><p>LIMIT[[offset,]row_count]:  对查询的结果进行输出行数数量限制，跳过offet，显示row_count。</p><p>SELECT 语句处理的顺序：</p><figure class="highlight sas"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">FROM</span> Clause --&gt; <span class="hljs-keyword">WHERE</span> Clause --&gt; <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> --&gt; <span class="hljs-keyword">HAVING</span> Clause --&gt; SELECCT --&gt; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> --&gt; LIMIT <br></code></pre></td></tr></table></figure><p><img src="image-20220808210700319.png" alt="image-20220808210700319"></p><h2 id="2、自行设计10个sql查询语句，需要用到关键字-GROUP-BY-HAVING-ORDER-BY-LIMIT-，至少同时用到两个。"><a href="#2、自行设计10个sql查询语句，需要用到关键字-GROUP-BY-HAVING-ORDER-BY-LIMIT-，至少同时用到两个。" class="headerlink" title="2、自行设计10个sql查询语句，需要用到关键字[GROUP BY/HAVING/ORDER BY/LIMIT]，至少同时用到两个。"></a>2、自行设计10个sql查询语句，需要用到关键字[GROUP BY/HAVING/ORDER BY/LIMIT]，至少同时用到两个。</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; use hellodb;<br>Database changed<br>mysql&gt; show tables;<br>+-------------------+<br>|<span class="hljs-string"> Tables_in_hellodb </span>|<br>+-------------------+<br>|<span class="hljs-string"> classes           </span>|<br>|<span class="hljs-string"> coc               </span>|<br>|<span class="hljs-string"> courses           </span>|<br>|<span class="hljs-string"> scores            </span>|<br>|<span class="hljs-string"> students          </span>|<br>|<span class="hljs-string"> teachers          </span>|<br>|<span class="hljs-string"> toc               </span>|<br>+-------------------+<br>7 rows in set (0.00 sec)<br>mysql&gt; select <span class="hljs-symbol">*</span> from students;<br>+-------+---------------+-----+--------+---------+-----------+<br>|<span class="hljs-string"> StuID </span>|<span class="hljs-string"> Name          </span>|<span class="hljs-string"> Age </span>|<span class="hljs-string"> Gender </span>|<span class="hljs-string"> ClassID </span>|<span class="hljs-string"> TeacherID </span>|<br>+-------+---------------+-----+--------+---------+-----------+<br>|<span class="hljs-string">     1 </span>|<span class="hljs-string"> Shi Zhongyu   </span>|<span class="hljs-string">  22 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       2 </span>|<span class="hljs-string">         3 </span>|<br>|<span class="hljs-string">     2 </span>|<span class="hljs-string"> Shi Potian    </span>|<span class="hljs-string">  22 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       1 </span>|<span class="hljs-string">         7 </span>|<br>|<span class="hljs-string">     3 </span>|<span class="hljs-string"> Xie Yanke     </span>|<span class="hljs-string">  53 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       2 </span>|<span class="hljs-string">        16 </span>|<br>|<span class="hljs-string">     4 </span>|<span class="hljs-string"> Ding Dian     </span>|<span class="hljs-string">  32 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       4 </span>|<span class="hljs-string">         4 </span>|<br>|<span class="hljs-string">     5 </span>|<span class="hljs-string"> Yu Yutong     </span>|<span class="hljs-string">  26 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       3 </span>|<span class="hljs-string">         1 </span>|<br>|<span class="hljs-string">     6 </span>|<span class="hljs-string"> Shi Qing      </span>|<span class="hljs-string">  46 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       5 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">     7 </span>|<span class="hljs-string"> Xi Ren        </span>|<span class="hljs-string">  19 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       3 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">     8 </span>|<span class="hljs-string"> Lin Daiyu     </span>|<span class="hljs-string">  17 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       7 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">     9 </span>|<span class="hljs-string"> Ren Yingying  </span>|<span class="hljs-string">  20 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       6 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    10 </span>|<span class="hljs-string"> Yue Lingshan  </span>|<span class="hljs-string">  19 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       3 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    11 </span>|<span class="hljs-string"> Yuan Chengzhi </span>|<span class="hljs-string">  23 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       6 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    12 </span>|<span class="hljs-string"> Wen Qingqing  </span>|<span class="hljs-string">  19 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       1 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    13 </span>|<span class="hljs-string"> Tian Boguang  </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       2 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    14 </span>|<span class="hljs-string"> Lu Wushuang   </span>|<span class="hljs-string">  17 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       3 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    15 </span>|<span class="hljs-string"> Duan Yu       </span>|<span class="hljs-string">  19 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       4 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    16 </span>|<span class="hljs-string"> Xu Zhu        </span>|<span class="hljs-string">  21 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       1 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    17 </span>|<span class="hljs-string"> Lin Chong     </span>|<span class="hljs-string">  25 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       4 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    18 </span>|<span class="hljs-string"> Hua Rong      </span>|<span class="hljs-string">  23 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       7 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    19 </span>|<span class="hljs-string"> Xue Baochai   </span>|<span class="hljs-string">  18 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       6 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    20 </span>|<span class="hljs-string"> Diao Chan     </span>|<span class="hljs-string">  19 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       7 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    21 </span>|<span class="hljs-string"> Huang Yueying </span>|<span class="hljs-string">  22 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       6 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    22 </span>|<span class="hljs-string"> Xiao Qiao     </span>|<span class="hljs-string">  20 </span>|<span class="hljs-string"> F      </span>|<span class="hljs-string">       1 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    23 </span>|<span class="hljs-string"> Ma Chao       </span>|<span class="hljs-string">  23 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       4 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    24 </span>|<span class="hljs-string"> Xu Xian       </span>|<span class="hljs-string">  27 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">    NULL </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">    25 </span>|<span class="hljs-string"> Sun Dasheng   </span>|<span class="hljs-string"> 100 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">    NULL </span>|<span class="hljs-string">      NULL </span>|<br>+-------+---------------+-----+--------+---------+-----------+<br>25 rows in set (0.00 sec)<br><br>mysql&gt; show tables;<br>+-------------------+<br>|<span class="hljs-string"> Tables_in_hellodb </span>|<br>+-------------------+<br>|<span class="hljs-string"> classes           </span>|<br>|<span class="hljs-string"> coc               </span>|<br>|<span class="hljs-string"> courses           </span>|<br>|<span class="hljs-string"> scores            </span>|<br>|<span class="hljs-string"> students          </span>|<br>|<span class="hljs-string"> teachers          </span>|<br>|<span class="hljs-string"> toc               </span>|<br>+-------------------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt; select <span class="hljs-symbol">*</span> from scores;<br>+----+-------+----------+-------+<br>|<span class="hljs-string"> ID </span>|<span class="hljs-string"> StuID </span>|<span class="hljs-string"> CourseID </span>|<span class="hljs-string"> Score </span>|<br>+----+-------+----------+-------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string">     1 </span>|<span class="hljs-string">        2 </span>|<span class="hljs-string">    77 </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string">     1 </span>|<span class="hljs-string">        6 </span>|<span class="hljs-string">    93 </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string">     2 </span>|<span class="hljs-string">        2 </span>|<span class="hljs-string">    47 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string">     2 </span>|<span class="hljs-string">        5 </span>|<span class="hljs-string">    97 </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string">     3 </span>|<span class="hljs-string">        2 </span>|<span class="hljs-string">    88 </span>|<br>|<span class="hljs-string">  6 </span>|<span class="hljs-string">     3 </span>|<span class="hljs-string">        6 </span>|<span class="hljs-string">    75 </span>|<br>|<span class="hljs-string">  7 </span>|<span class="hljs-string">     4 </span>|<span class="hljs-string">        5 </span>|<span class="hljs-string">    71 </span>|<br>|<span class="hljs-string">  8 </span>|<span class="hljs-string">     4 </span>|<span class="hljs-string">        2 </span>|<span class="hljs-string">    89 </span>|<br>|<span class="hljs-string">  9 </span>|<span class="hljs-string">     5 </span>|<span class="hljs-string">        1 </span>|<span class="hljs-string">    39 </span>|<br>|<span class="hljs-string"> 10 </span>|<span class="hljs-string">     5 </span>|<span class="hljs-string">        7 </span>|<span class="hljs-string">    63 </span>|<br>|<span class="hljs-string"> 11 </span>|<span class="hljs-string">     6 </span>|<span class="hljs-string">        1 </span>|<span class="hljs-string">    96 </span>|<br>|<span class="hljs-string"> 12 </span>|<span class="hljs-string">     7 </span>|<span class="hljs-string">        1 </span>|<span class="hljs-string">    86 </span>|<br>|<span class="hljs-string"> 13 </span>|<span class="hljs-string">     7 </span>|<span class="hljs-string">        7 </span>|<span class="hljs-string">    83 </span>|<br>|<span class="hljs-string"> 14 </span>|<span class="hljs-string">     8 </span>|<span class="hljs-string">        4 </span>|<span class="hljs-string">    57 </span>|<br>|<span class="hljs-string"> 15 </span>|<span class="hljs-string">     8 </span>|<span class="hljs-string">        3 </span>|<span class="hljs-string">    93 </span>|<br>+----+-------+----------+-------+<br>15 rows in set (0.00 sec)<br><br><span class="hljs-comment">#在students表中，查询年龄大于25岁，且为男性的同学的名字和年龄，年龄从小到大进行排序</span><br>mysql&gt; select name,age from students where age&gt;25 and gender=&#x27;M&#x27; order by age;<br>+--------------+-----+<br>|<span class="hljs-string"> name         </span>|<span class="hljs-string"> age </span>|<br>+--------------+-----+<br>|<span class="hljs-string"> Yu Yutong    </span>|<span class="hljs-string">  26 </span>|<br>|<span class="hljs-string"> Xu Xian      </span>|<span class="hljs-string">  27 </span>|<br>|<span class="hljs-string"> Ding Dian    </span>|<span class="hljs-string">  32 </span>|<br>|<span class="hljs-string"> Tian Boguang </span>|<span class="hljs-string">  33 </span>|<br>|<span class="hljs-string"> Shi Qing     </span>|<span class="hljs-string">  46 </span>|<br>|<span class="hljs-string"> Xie Yanke    </span>|<span class="hljs-string">  53 </span>|<br>|<span class="hljs-string"> Sun Dasheng  </span>|<span class="hljs-string"> 100 </span>|<br>+--------------+-----+<br>7 rows in set (0.00 sec)<br><br><span class="hljs-comment"># 以ClassID为分组依据，显示每组的平均年龄，且只查看平均年龄大于30的班级</span><br>mysql&gt; select classid,avg(age) from students group by classid having avg(age)&gt;30;<br>+---------+----------+<br>|<span class="hljs-string"> classid </span>|<span class="hljs-string"> avg(age) </span>|<br>+---------+----------+<br>|<span class="hljs-string">    NULL </span>|<span class="hljs-string">  63.5000 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">  36.0000 </span>|<br>|<span class="hljs-string">       5 </span>|<span class="hljs-string">  46.0000 </span>|<br>+---------+----------+<br>3 rows in set (0.00 sec)<br><br><br>mysql&gt; select avg(age) from students;<br>+----------+<br>|<span class="hljs-string"> avg(age) </span>|<br>+----------+<br>|<span class="hljs-string">  27.4000 </span>|<br>+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select <span class="hljs-symbol">*</span> from students where age &gt; (select avg(age) from students) order by Age;<br>+-------+--------------+-----+--------+---------+-----------+<br>|<span class="hljs-string"> StuID </span>|<span class="hljs-string"> Name         </span>|<span class="hljs-string"> Age </span>|<span class="hljs-string"> Gender </span>|<span class="hljs-string"> ClassID </span>|<span class="hljs-string"> TeacherID </span>|<br>+-------+--------------+-----+--------+---------+-----------+<br>|<span class="hljs-string">     4 </span>|<span class="hljs-string"> Ding Dian    </span>|<span class="hljs-string">  32 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       4 </span>|<span class="hljs-string">         4 </span>|<br>|<span class="hljs-string">    13 </span>|<span class="hljs-string"> Tian Boguang </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       2 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">     6 </span>|<span class="hljs-string"> Shi Qing     </span>|<span class="hljs-string">  46 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       5 </span>|<span class="hljs-string">      NULL </span>|<br>|<span class="hljs-string">     3 </span>|<span class="hljs-string"> Xie Yanke    </span>|<span class="hljs-string">  53 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">       2 </span>|<span class="hljs-string">        16 </span>|<br>|<span class="hljs-string">    25 </span>|<span class="hljs-string"> Sun Dasheng  </span>|<span class="hljs-string"> 100 </span>|<span class="hljs-string"> M      </span>|<span class="hljs-string">    NULL </span>|<span class="hljs-string">      NULL </span>|<br>+-------+--------------+-----+--------+---------+-----------+<br>5 rows in set (0.00 sec)<br><br><span class="hljs-comment">#查看年龄大于平均年龄的同学的姓名、年龄、班级，且年龄从小到大列出；</span><br>mysql&gt; select name,age,classid from students where age &gt; (select avg(age) from students) order by Age;<br>+--------------+-----+---------+<br>|<span class="hljs-string"> name         </span>|<span class="hljs-string"> age </span>|<span class="hljs-string"> classid </span>|<br>+--------------+-----+---------+<br>|<span class="hljs-string"> Ding Dian    </span>|<span class="hljs-string">  32 </span>|<span class="hljs-string">       4 </span>|<br>|<span class="hljs-string"> Tian Boguang </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string">       2 </span>|<br>|<span class="hljs-string"> Shi Qing     </span>|<span class="hljs-string">  46 </span>|<span class="hljs-string">       5 </span>|<br>|<span class="hljs-string"> Xie Yanke    </span>|<span class="hljs-string">  53 </span>|<span class="hljs-string">       2 </span>|<br>|<span class="hljs-string"> Sun Dasheng  </span>|<span class="hljs-string"> 100 </span>|<span class="hljs-string">    NULL </span>|<br>+--------------+-----+---------+<br>5 rows in set (0.00 sec)<br><br><span class="hljs-comment">#以ClassID分组，显示每班的同学的人数，只看最多人的5个班</span><br>mysql&gt; select classid, count(<span class="hljs-symbol">*</span>) from students group by classid order by count(<span class="hljs-symbol">*</span>) desc limit 5;<br>+---------+----------+<br>|<span class="hljs-string"> classid </span>|<span class="hljs-string"> count(*) </span>|<br>+---------+----------+<br>|<span class="hljs-string">       1 </span>|<span class="hljs-string">        4 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string">        4 </span>|<br>|<span class="hljs-string">       3 </span>|<span class="hljs-string">        4 </span>|<br>|<span class="hljs-string">       6 </span>|<span class="hljs-string">        4 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">        3 </span>|<br>+---------+----------+<br>5 rows in set (0.00 sec)<br><br><span class="hljs-comment"># 查看未成年人都有哪些？</span><br>mysql&gt; select classid,age from students where Age <span class="hljs-variable">&lt; 18;</span><br><span class="hljs-variable">+---------+-----+</span><br><span class="hljs-variable">| classid | age |</span><br><span class="hljs-variable">+---------+-----+</span><br><span class="hljs-variable">|       7 |  17 |</span><br><span class="hljs-variable">|       3 |  17 |</span><br><span class="hljs-variable">+---------+-----+</span><br><span class="hljs-variable">2 rows in set (0.00 sec)</span><br><span class="hljs-variable"></span><br><span class="hljs-variable"></span><br></code></pre></td></tr></table></figure><h2 id="3、xtrabackup备份和还原数据库练习"><a href="#3、xtrabackup备份和还原数据库练习" class="headerlink" title="3、xtrabackup备份和还原数据库练习"></a>3、xtrabackup备份和还原数据库练习</h2><p>xtrabackup：由Percona提供支持对InnoDB做热备(物理备份)的工具，支持完全备份、增量备份，是惟一开源的能够对innodb和xtradb数据库进行热备的工具。</p><p>利用xtrabackup8.0 完全，增量备份及还原MySQL：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-number">1</span> 备份过程<br><span class="hljs-number">1</span>）完全备份：<br>[root@centos8 ~]#yum -y install percona-xtrabackup-<span class="hljs-number">24</span>-<span class="hljs-number">2.4</span>.<span class="hljs-number">20</span>-<span class="hljs-number">1</span>.el8.x86_64.rpm<br>[root@centos8 ~]#mkdir <span class="hljs-regexp">/backup/</span><br>[root@centos8 ~]#xtrabackup -uroot -pmagedu --backup --target-dir=<span class="hljs-regexp">/backup/</span>base<br><span class="hljs-number">2</span>）第一次修改数据<br><span class="hljs-number">3</span>）第一次增量备份<br>[root@centos8 ~]#xtrabackup -uroot -pmagedu --backup --target-dir=<span class="hljs-regexp">/backup/i</span>nc1 --<br>incremental-basedir=<span class="hljs-regexp">/backup/</span>base<br><span class="hljs-number">4</span>）第二次修改数据<br><span class="hljs-number">5</span>）第二次增量<br>[root@centos8 ~]#xtrabackup -uroot -pmagedu --backup --target-dir=<span class="hljs-regexp">/backup/i</span>nc2 --<br>incremental-basedir=<span class="hljs-regexp">/backup/i</span>nc1<br><span class="hljs-number">6</span>）[root@centos8 ~]#scp -r <span class="hljs-regexp">/backup/</span>* 目标主机:<span class="hljs-regexp">/backup/</span><br>#备份过程生成三个备份目录<br><span class="hljs-regexp">/backup/</span>&#123;base，inc1，inc2&#125;<br><span class="hljs-number">2</span>还原过程<br><span class="hljs-number">1</span>）预准备完成备份，此选项--apply-log-only 阻止回滚未完成的事务<br>[root@centos8 ~]#yum -y install percona-xtrabackup-<span class="hljs-number">24</span>-<span class="hljs-number">2.4</span>.<span class="hljs-number">20</span>-<span class="hljs-number">1</span>.el8.x86_64.rpm<br>[root@centos8 ~]#xtrabackup --prepare --apply-log-only --target-dir=<span class="hljs-regexp">/backup/</span>base<br><span class="hljs-number">2</span>）合并第<span class="hljs-number">1</span>次增量备份到完全备份<br>[root@centos8 ~]#xtrabackup --prepare --apply-log-only --target-dir=<span class="hljs-regexp">/backup/</span>base <br>--incremental-dir=<span class="hljs-regexp">/backup/i</span>nc1<br><span class="hljs-number">3</span>）合并第<span class="hljs-number">2</span>次增量备份到完全备份：最后一次还原不需要加选项--apply-log-only<br>[root@centos8 ~]#xtrabackup --prepare --target-dir=<span class="hljs-regexp">/backup/</span>base --incrementaldir=<span class="hljs-regexp">/backup/i</span>nc2<br><span class="hljs-number">4</span>）复制到数据库目录，注意数据库目录必须为空，MySQL服务不能启动<br>[root@centos8 ~]#xtrabackup --<span class="hljs-keyword">copy</span>-back --target-dir=<span class="hljs-regexp">/backup/</span>base<br><span class="hljs-number">5</span>）还原属性：<br>[root@centos8 ~]#chown -R mysql:mysql <span class="hljs-regexp">/var/</span>lib/mysql<br><span class="hljs-number">6</span>）启动服务：<br>[root@centos8 ~]#service mysqld start <br></code></pre></td></tr></table></figure><h2 id="4、实现mysql主从复制，主主复制和半同步复制"><a href="#4、实现mysql主从复制，主主复制和半同步复制" class="headerlink" title="4、实现mysql主从复制，主主复制和半同步复制"></a>4、实现mysql主从复制，主主复制和半同步复制</h2><h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><p>主从架构实现读写分离，主节点只负责写，从节点只负责读，每个节点都有相同的数据集，向外扩展，基于二进制日志的单向复制</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">#主节点<br>#修改主节点配置文件<br>[root@centos8 ~]$vim /etc/my.cnf<br><span class="hljs-meta">[mysqld]</span><br>server-id=150  <br>log-bin       #确保启用二进制日志<br>[root@centos8 ~]$systemctl restart mysqld<br><br>#查看二进制文件和位置<br><span class="hljs-section">mysql&gt; show master logs;</span><br><span class="hljs-section">+--------------------+-----------+-----------+</span><br><span class="hljs-section">| Log_name           | File_size | Encrypted |</span><br><span class="hljs-section">+--------------------+-----------+-----------+</span><br>| centos8-bin.000001 |       179 | No        |<br><span class="hljs-section">| centos8-bin.000002 |       156 | No        |</span><br><span class="hljs-section">+--------------------+-----------+-----------+</span><br><br>#创建用于主从复制的用户（此步也被记录在二进制文件中，从节点可省去此步）<br>mysql&gt;create user <span class="hljs-emphasis">&#x27;repl&#x27;</span>@<span class="hljs-emphasis">&#x27;10.0.0.%&#x27;</span>;<br>mysql&gt;grant replication slave on <span class="hljs-strong">*.*</span> to <span class="hljs-emphasis">&#x27;repl&#x27;</span>@<span class="hljs-emphasis">&#x27;10.0.0.%&#x27;</span>;<br><br><br>#从节点<br>#修改从节点配置文件<br>[root@centos8 ~]$vim /etc/my.cnf<br><span class="hljs-meta">[mysqld]</span><br>server-id=157<br>log-bin <br>read_only=ON<br>[root@centos8 ~]$systemctl restart mysqld<br><br>#在mysql中配置主从复制，需要与上述信息对应<br>#一般情况还需要在master<span class="hljs-emphasis">_password中指定复制账号的密码，本次实验中未设置密码，所以省略</span><br><span class="hljs-emphasis">mysql&gt; change master to master_host=&#x27;10.0.0.150&#x27;, master_user=&#x27;repl&#x27; , master_port=3306, master_log_file=&#x27;centos8-bin.000002&#x27;,  master_log_</span>pos=156;<br><br>#查看是否成功<br>mysql&gt; start slave;<br>mysql&gt; show slave status\G<br><span class="hljs-bullet">*************************** </span>1. row <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**<br><span class="hljs-code">               Slave_IO_State: Waiting for source to send event</span><br><span class="hljs-code">                  Master_Host: 10.0.0.150</span><br><span class="hljs-code">                  Master_User: repl</span><br><span class="hljs-code">                  Master_Port: 3306</span><br><span class="hljs-code">                Connect_Retry: 60</span><br><span class="hljs-code">              Master_Log_File: centos8-bin.000002</span><br><span class="hljs-code">          Read_Master_Log_Pos: 612</span><br><span class="hljs-code">               Relay_Log_File: centos8-relay-bin.000002</span><br><span class="hljs-code">                Relay_Log_Pos: 782</span><br><span class="hljs-code">        Relay_Master_Log_File: centos8-bin.000002</span><br><span class="hljs-code">             Slave_IO_Running: Yes#主从复制需要这两项线程</span><br><span class="hljs-code">            Slave_SQL_Running: Yes#查看是否启动可判定配置是否成功</span><br><br>#验证数据同步<br>#从节点<br><span class="hljs-section">mysql&gt; show databases;</span><br><span class="hljs-section">+--------------------+</span><br><span class="hljs-section">| Database           |</span><br><span class="hljs-section">+--------------------+</span><br>| information<span class="hljs-emphasis">_schema |</span><br><span class="hljs-emphasis">| mysql              |</span><br><span class="hljs-emphasis">| performance_</span>schema |<br><span class="hljs-section">| sys                |</span><br><span class="hljs-section">+--------------------+</span><br><br>#主节点<br>mysql&gt; create database hellodb;<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; use hellodb;<br>Database changed<br>mysql&gt; create table students(stuid int,name varchar(20),age tinyint);<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; insert students values(1,<span class="hljs-emphasis">&#x27;zhangsan&#x27;</span>,20);<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; insert students values(2,<span class="hljs-emphasis">&#x27;lisi&#x27;</span>,22);<br>Query OK, 1 row affected (0.01 sec)<br><br>#从节点<br>mysql&gt; use hellodb;<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br><span class="hljs-section">mysql&gt; select * from students;</span><br><span class="hljs-section">+-------+----------+------+</span><br><span class="hljs-section">| stuid | name     | age  |</span><br><span class="hljs-section">+-------+----------+------+</span><br>|     1 | zhangsan |   20 |<br><span class="hljs-section">|     2 | lisi     |   22 |</span><br><span class="hljs-section">+-------+----------+------+</span><br><br></code></pre></td></tr></table></figure><h3 id="主主复制"><a href="#主主复制" class="headerlink" title="主主复制"></a>主主复制</h3><p>两个节点都可以读写数据，并且互相同步。相当于两个节点互为主从。</p><p>​    双主架构容易产生数据不一致问题，同时进行某一操作时会导致产生冲突，之后无法进行任何操作。因此数据库实际使用时不会开启多个主节点，仅在主节点故障时启用另一个主节点替换。</p><p>​    配置过程类似主从架构</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#第一个主节点</span><br>[root@centos8 ~]<span class="hljs-variable">$vim</span> /etc/my.cnf<br>[mysqld]<br><span class="hljs-attribute">server-id</span>=150<br>log-bin<br><span class="hljs-attribute">auto_increment_offset</span>=1         #设置自动增长id间隔<br><span class="hljs-attribute">auto_increment_increment</span>=2      #并不能完全解决双主冲突问题  <br>[root@centos8 ~]<span class="hljs-variable">$systemctl</span> restart mysqld<br><br><span class="hljs-comment">#查看二进制文件和位置</span><br>mysql&gt; show master logs;<br>+--------------------+-----------+-----------+<br>| Log_name           | File_size | Encrypted |<br>+--------------------+-----------+-----------+<br>| centos8-bin.000001 |       179 | <span class="hljs-literal">No</span>        |<br>| centos8-bin.000002 |       156 | <span class="hljs-literal">No</span>        |<br>+--------------------+-----------+-----------+<br><br><span class="hljs-comment">#创建用于主从复制的用户（此步也被记录在二进制文件中，从节点可省去此步）</span><br>mysql&gt;create<span class="hljs-built_in"> user </span><span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br>mysql&gt;grant replication slave on *.* <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br><br><span class="hljs-comment">#第二个主节点</span><br>[root@centos8 ~]<span class="hljs-variable">$vim</span> /etc/my.cnf<br>[mysqld]<br><span class="hljs-attribute">server-id</span>=157<br>log-bin <br><span class="hljs-attribute">auto_increment_offset</span>=1        <br><span class="hljs-attribute">auto_increment_increment</span>=2        <br>[root@centos8 ~]<span class="hljs-variable">$systemctl</span> restart mysqld<br><br>mysql&gt; change master <span class="hljs-keyword">to</span> <span class="hljs-attribute">master_host</span>=<span class="hljs-string">&#x27;10.0.0.150&#x27;</span>, <span class="hljs-attribute">master_user</span>=<span class="hljs-string">&#x27;repl&#x27;</span> , <span class="hljs-attribute">master_port</span>=3306, <span class="hljs-attribute">master_log_file</span>=<span class="hljs-string">&#x27;centos8-bin.000002&#x27;</span>,  <span class="hljs-attribute">master_log_pos</span>=156;<br>mysql&gt; start slave;<br><span class="hljs-comment">#查看二进制文件和位置</span><br>mysql&gt; show master logs;<br>+---------------+-----------+-----------+<br>| Log_name      | File_size | Encrypted |<br>+---------------+-----------+-----------+<br>| binlog.000001 |       674 | <span class="hljs-literal">No</span>        |<br>+---------------+-----------+-----------+<br><br><br><span class="hljs-comment">#第一个主节点</span><br>mysql&gt; change master <span class="hljs-keyword">to</span> <span class="hljs-attribute">master_host</span>=<span class="hljs-string">&#x27;10.0.0.157&#x27;</span>, <span class="hljs-attribute">master_user</span>=<span class="hljs-string">&#x27;repl&#x27;</span> , <span class="hljs-attribute">master_port</span>=3306, <span class="hljs-attribute">master_log_file</span>=<span class="hljs-string">&#x27;binlog.000001&#x27;</span>,  <span class="hljs-attribute">master_log_pos</span>=674;<br>mysql&gt; start slave;<br><br><span class="hljs-comment">#此时已完成双主架构，可互相同步对方修改数据，但若在两个服务器上同时执行某个操作就会互相冲突，导致数据库瘫痪。</span><br></code></pre></td></tr></table></figure><h3 id="半同步复制"><a href="#半同步复制" class="headerlink" title="半同步复制"></a>半同步复制</h3><p>​    默认情况下，MySQL的复制功能是异步的，主库把binlog日志发送给从库即结束，并不验证从库是否接收完毕。这意味着当主服务器或从服务器端发生故障时，有可能从服务器没有接收到主服务器发送过来的binlog日志，这就会造成主服务器和从服务器的数据不一致，甚至在恢复时造成数据的丢失。</p><p>​    若采用同步复制，即等到所有从库确认接收完毕后才告知用户成功则等待时间过长，性能不佳。综合考虑安全性和性能则采用半同步，则只要有一个从库确认接收完毕就判断复制成功，若等待时间过长超过设定的阈值也先告知用户成功。</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment">#半同步复制可直接在上述主从架构的基础上建立，仅需安装相关插件并修改配置文件</span><br><br><span class="hljs-comment">#安装插件</span><br><span class="hljs-comment">#主节点</span><br>mysql&gt; INSTALL PLUGIN rpl_semi_sync_master SONAME &#x27;semisync_master.so&#x27;;<br>mysql&gt; SET GLOBAL rpl_semi_sync_master_enabled=1;<span class="hljs-comment">#临时修改</span><br>mysql&gt; SET GLOBAL rpl_semi_sync_master_timeout = 3000;  <span class="hljs-comment">#时间阈值3s</span><br>mysql&gt; SHOW GLOBAL VARIABLES LIKE &#x27;%semi%&#x27;;<br>+-------------------------------------------+------------+<br>|<span class="hljs-string"> Variable_name                             </span>|<span class="hljs-string"> Value      </span>|<br>+-------------------------------------------+------------+<br>|<span class="hljs-string"> rpl_semi_sync_master_enabled              </span>|<span class="hljs-string"> ON         </span>|<br>|<span class="hljs-string"> rpl_semi_sync_master_timeout              </span>|<span class="hljs-string"> 3000       </span>|<br>|<span class="hljs-string"> rpl_semi_sync_master_trace_level          </span>|<span class="hljs-string"> 32         </span>|<br>|<span class="hljs-string"> rpl_semi_sync_master_wait_for_slave_count </span>|<span class="hljs-string"> 1          </span>|<br>|<span class="hljs-string"> rpl_semi_sync_master_wait_no_slave        </span>|<span class="hljs-string"> ON         </span>|<br>|<span class="hljs-string"> rpl_semi_sync_master_wait_point           </span>|<span class="hljs-string"> AFTER_SYNC </span>|<br>+-------------------------------------------+------------+<br><span class="hljs-comment">#从节点</span><br>mysql&gt; install plugin rpl_semi_sync_slave SONAME &#x27;semisync_slave.so&#x27;;<br>mysql&gt; SET GLOBAL rpl_semi_sync_slave_enabled=1;<br>mysql&gt;  SHOW GLOBAL VARIABLES LIKE &#x27;%semi%&#x27;;<br>+---------------------------------+-------+<br>|<span class="hljs-string"> Variable_name                   </span>|<span class="hljs-string"> Value </span>|<br>+---------------------------------+-------+<br>|<span class="hljs-string"> rpl_semi_sync_slave_enabled     </span>|<span class="hljs-string"> ON    </span>|<br>|<span class="hljs-string"> rpl_semi_sync_slave_trace_level </span>|<span class="hljs-string"> 32    </span>|<br>+---------------------------------+-------+<br><br><br><span class="hljs-comment">#修改配置，在上述主从架构的配置文件中添加2条插件配置</span><br><span class="hljs-comment">#主节点</span><br>[root<span class="hljs-meta">@centos8</span> ~]$vim /etc/my.cnf<br>[mysqld]<br>server-id=150<br>log-bin<br>rpl_semi_sync_master_enabled=ON <span class="hljs-comment">#修改此行,需要先安装semisync_master.so插件后,再重启,否</span><br>则无法启动<br>rpl_semi_sync_master_timeout=3000   <span class="hljs-comment">#设置3s内无法同步，也将返回成功信息给客户端</span><br><br><span class="hljs-comment">#从节点</span><br>[root<span class="hljs-meta">@centos8</span> ~]$vim /etc/my.cnf<br>[mysqld]<br>server-id=157<br>log-bin<br>rpl_semi_sync_slave_enabled=ON <br><br><span class="hljs-comment">#修改配置后重启mysql服务生效</span><br><span class="hljs-comment">#从节点还需要重启slave</span><br>mysql&gt; stop slave;<br>mysql&gt; start slave;<br>mysql&gt; SHOW GLOBAL STATUS LIKE &#x27;%semi%&#x27;;<br>+----------------------------+-------+<br>|<span class="hljs-string"> Variable_name              </span>|<span class="hljs-string"> Value </span>|<br>+----------------------------+-------+<br>|<span class="hljs-string"> Rpl_semi_sync_slave_status </span>|<span class="hljs-string"> ON    </span>|<br>+----------------------------+-------+<br></code></pre></td></tr></table></figure><h2 id="5、用mycat实现mysql的读写分离"><a href="#5、用mycat实现mysql的读写分离" class="headerlink" title="5、用mycat实现mysql的读写分离"></a>5、用mycat实现mysql的读写分离</h2><p>​    Mycat是一个开源的分布式数据库系统，是一个实现了MySQL协议的服务器，前端用户可以把它看作是</p><p>一个数据库代理（类似于Mysql Proxy），用MySQL客户端工具和命令行访问，而其后端可以用MySQL</p><p>原生协议与多个MySQL服务器通信，也可以用JDBC协议与大多数主流数据库服务器通信，其核心功能是</p><p>分表分库，即将一个大表水平分割为N个小表，存储在后端MySQL服务器里或者其他数据库里。</p><h3 id="Mycat安装和配置"><a href="#Mycat安装和配置" class="headerlink" title="Mycat安装和配置"></a>Mycat安装和配置</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@localhost ~]$yum install -y java<br>[root@localhost ~]$wget http://dl.mycat.org.cn/<span class="hljs-number">1.6</span><span class="hljs-number">.7</span><span class="hljs-number">.6</span>/<span class="hljs-number">20210303094759</span>/Mycat-<span class="hljs-keyword">server</span><span class="hljs-number">-1.6</span><span class="hljs-number">.7</span><span class="hljs-number">.6</span>-<span class="hljs-keyword">release</span><span class="hljs-number">-20210303094759</span>-linux.tar.gz<br>[root@localhost ~]$mkdir /apps<br>[root@localhost ~]$tar xvf Mycat-<span class="hljs-keyword">server</span><span class="hljs-number">-1.6</span><span class="hljs-number">.7</span><span class="hljs-number">.6</span>-<span class="hljs-keyword">release</span><span class="hljs-number">-20210303094759</span>-linux.tar.gz -C /apps/<br><br>#配置环境变量<br>[root@localhost ~]$echo <span class="hljs-string">&#x27;PATH=/apps/mycat/bin:$PATH&#x27;</span> &gt; /etc/profile.d/mycat.sh<br>[root@localhost ~]$source /etc/profile.d/mycat.sh<br>#查看日志确定启动是否成功<br>[root@localhost ~]$mycat <span class="hljs-keyword">start</span><br>[root@localhost ~]$tail /apps/mycat/logs/<span class="hljs-keyword">wrapper</span>.<span class="hljs-keyword">log</span><br><span class="hljs-keyword">INFO</span>   | jvm <span class="hljs-number">1</span>    | <span class="hljs-number">2022</span>/<span class="hljs-number">07</span>/<span class="hljs-number">20</span> <span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">55</span> | MyCAT <span class="hljs-keyword">Server</span> startup successfully. see logs <span class="hljs-keyword">in</span> logs/mycat.<span class="hljs-keyword">log</span><br><br>#此时其他客户端主机已可访问Mycat<br>[root@rhel ~]# mysql -uroot -p123456  -h <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.152</span> -P8066 <span class="hljs-comment">--default_auth=mysql_native_password</span><br>mysql: [<span class="hljs-built_in">Warning</span>] <span class="hljs-keyword">Using</span> a <span class="hljs-keyword">password</span> <span class="hljs-keyword">on</span> the command <span class="hljs-type">line</span> interface can be insecure.<br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br>Your MySQL <span class="hljs-keyword">connection</span> id <span class="hljs-keyword">is</span> <span class="hljs-number">6</span><br><span class="hljs-keyword">Server</span> <span class="hljs-keyword">version</span>: <span class="hljs-number">5.6</span><span class="hljs-number">.29</span>-mycat<span class="hljs-number">-1.6</span><span class="hljs-number">.7</span><span class="hljs-number">.6</span>-<span class="hljs-keyword">release</span><span class="hljs-number">-20210303094759</span> MyCat <span class="hljs-keyword">Server</span> (OpenCloudDB)<br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2018</span>, Oracle <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> its affiliates. <span class="hljs-keyword">All</span> rights reserved.<br><br>Oracle <span class="hljs-keyword">is</span> a registered trademark <span class="hljs-keyword">of</span> Oracle Corporation <span class="hljs-keyword">and</span>/<span class="hljs-keyword">or</span> its<br>affiliates. Other names may be trademarks <span class="hljs-keyword">of</span> their respective<br>owners.<br><br><span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;help;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> help. <span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;\c&#x27;</span> <span class="hljs-keyword">to</span> clear the <span class="hljs-keyword">current</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">statement</span>.<br>#此时看到的数据库在完成后续配置后将成为主从数据库的映射。用户访问看到的是主从服务器的内容<br>mysql&gt; <span class="hljs-keyword">show</span> databases;<br>+<span class="hljs-comment">----------+</span><br>| <span class="hljs-keyword">DATABASE</span> |<br>+<span class="hljs-comment">----------+</span><br>| TESTDB   |<br>+<span class="hljs-comment">----------+</span><br></code></pre></td></tr></table></figure><h3 id="在mycat-服务器上修改server-xml文件配置Mycat的连接信息"><a href="#在mycat-服务器上修改server-xml文件配置Mycat的连接信息" class="headerlink" title="在mycat 服务器上修改server.xml文件配置Mycat的连接信息"></a>在mycat 服务器上修改server.xml文件配置Mycat的连接信息</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@localhost ~]$vim /apps/mycat/conf/server.xml<br>...省略...<br>#修改下面行的8066改为3306复制到到独立非注释行<br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;serverPort&quot;</span>&gt;</span>3306<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;handlelDistributedTransactions&quot;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> #将上面行放在此行前面<br>#或者删除注释,并修改下面行的8066改为3306<br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;serverPort&quot;</span>&gt;</span>3306<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;managerPort&quot;</span>&gt;</span>9066<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;idleTimeout&quot;</span>&gt;</span>300000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authTimeout&quot;</span>&gt;</span>15000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bindIp&quot;</span>&gt;</span>0.0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataNodeIdleCheckPeriod&quot;</span>&gt;</span>300000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> #5 * 60 * 1000L; //连<br>接空闲检查 删除#后面此部分<br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;frontWriteQueueSize&quot;</span>&gt;</span>4096<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">property</span> </span><br><span class="hljs-tag"><span class="hljs-attr">name</span>=<span class="hljs-string">&quot;processors&quot;</span>&gt;</span>32<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> #--&gt; 删除#后面此部分<br> .....<br><span class="hljs-tag">&lt;<span class="hljs-name">user</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>                                       #连接Mycat的用户名<br>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>magedu<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>          #连接Mycat的密码<br>   <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;schemas&quot;</span>&gt;</span>TESTDB<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>           #数据库名要和schema.xml相对应<br></code></pre></td></tr></table></figure><h3 id="修改schema-xml实现读写分离策略"><a href="#修改schema-xml实现读写分离策略" class="headerlink" title="修改schema.xml实现读写分离策略"></a>修改schema.xml实现读写分离策略</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml">#修改多行后最终如下<br>[root@localhost ~]$vim /apps/mycat/conf/schema.xml<br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mycat</span>:schema <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;schema.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mycat:schema</span> <span class="hljs-attr">xmlns:mycat</span>=<span class="hljs-string">&quot;http://io.mycat/&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TESTDB&quot;</span> <span class="hljs-attr">checkSQLschema</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">sqlMaxLimit</span>=<span class="hljs-string">&quot;100&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">dataNode</span>=<span class="hljs-string">&quot;dn1&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">schema</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">dataNode</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dn1&quot;</span> <span class="hljs-attr">dataHost</span>=<span class="hljs-string">&quot;localhost1&quot;</span> <span class="hljs-attr">database</span>=<span class="hljs-string">&quot;hellodb&quot;</span> /&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">dataHost</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;localhost1&quot;</span> <span class="hljs-attr">maxCon</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">minCon</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">balance</span>=<span class="hljs-string">&quot;1&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">writeType</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">dbType</span>=<span class="hljs-string">&quot;mysql&quot;</span> <span class="hljs-attr">dbDriver</span>=<span class="hljs-string">&quot;native&quot;</span> <span class="hljs-attr">switchType</span>=<span class="hljs-string">&quot;1&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">slaveThreshold</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">heartbeat</span>&gt;</span>select user()<span class="hljs-tag">&lt;/<span class="hljs-name">heartbeat</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">writeHost</span> <span class="hljs-attr">host</span>=<span class="hljs-string">&quot;host1&quot;</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;10.0.0.18:3306&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;root&quot;</span></span><br><span class="hljs-tag">   <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;123456&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">readHost</span> <span class="hljs-attr">host</span>=<span class="hljs-string">&quot;host2&quot;</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;10.0.0.28:3306&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;root&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">password</span>=<span class="hljs-string">&quot;123456&quot;</span> /&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">writeHost</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">dataHost</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mycat:schema</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="主从节点配置"><a href="#主从节点配置" class="headerlink" title="主从节点配置"></a>主从节点配置</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#主服务器为mycat服务创建账号并授权<br>#由于主从复制机制，从服务器上也进行了以下操作<br>mysql&gt; <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> root@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br>mysql&gt; <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br>mysql&gt; flush <span class="hljs-keyword">privileges</span>;<br></code></pre></td></tr></table></figure><h3 id="在Mycat服务器上连接并测试"><a href="#在Mycat服务器上连接并测试" class="headerlink" title="在Mycat服务器上连接并测试"></a>在Mycat服务器上连接并测试</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment">#此时已完成Mycat读写分离，客户端主机访问Mycat主机</span><br>[root<span class="hljs-meta">@rhel</span> ~]<span class="hljs-comment"># mysql -uroot -p123456  -h 10.0.0.152 --default_auth=mysql_native_password</span><br>mysql&gt; use TESTDB;<br><span class="hljs-comment">#进行查询，读操作实际访问从节点</span><br>MySQL&gt; select @<span class="hljs-meta">@server_id;</span><br>+-------------+<br>|<span class="hljs-string"> @@server_id </span>|<br>+-------------+<br>|<span class="hljs-string">         157 </span>|<br>+-------------+<br><span class="hljs-comment">#修改数据，读操作实际访问主节点，可以在/var/lib/mysql/master.log中查看到相应记录</span><br><span class="hljs-comment">#需要先开启通用日志，持续生效可修改配置文件</span><br>[root<span class="hljs-meta">@centos8</span> ~]$mysql<br>mysql&gt; set global  general_log=1;<br><br><br><span class="hljs-comment">#停止从节点，Mycat自动调度读请求至主节点</span><br>[root<span class="hljs-meta">@centos8</span> ~]$systemctl stop mysqld<br>[root<span class="hljs-meta">@rhel</span> ~]<span class="hljs-comment"># mysql -uroot -p123456  -h 10.0.0.152 --default_auth=mysql_native_password</span><br>MySQL&gt; select @<span class="hljs-meta">@server_id;</span><br>+-------------+<br>|<span class="hljs-string"> @@server_id </span>|<br>+-------------+<br>|<span class="hljs-string">         150 </span>|<br>+-------------+<br><br><span class="hljs-comment">#从节点无法代替主节点</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql数据库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭建chrony服务完成多个主机的时间同步</title>
    <link href="/2022/07/17/%E6%90%AD%E5%BB%BAchrony%E6%9C%8D%E5%8A%A1%E5%AE%8C%E6%88%90%E5%A4%9A%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%9A%84%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    <url>/2022/07/17/%E6%90%AD%E5%BB%BAchrony%E6%9C%8D%E5%8A%A1%E5%AE%8C%E6%88%90%E5%A4%9A%E4%B8%AA%E4%B8%BB%E6%9C%BA%E7%9A%84%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="时间同步-19-2"><a href="#时间同步-19-2" class="headerlink" title="时间同步 19.2"></a>时间同步 19.2</h1><span id="more"></span><p>多主机协同工作时，时间同步很重要，各个主机的时间不一致，会造成很多重要应用的故障，如：加密协议，日志，集群等。</p><p>利用NTP（Network Time Protocol） 协议，可使网络中的各个计算机的时间达到同步。目前NTP协议属于运维基础架构中必备的基本服务之一。</p><p> Chrony是实现NTP协议的的自由软件。</p><h2 id="服务器端配置"><a href="#服务器端配置" class="headerlink" title="服务器端配置"></a>服务器端配置</h2><figure class="highlight tap"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># cat /etc/chrony.conf |grep -v ^#</span><br>server 0.centos.pool.ntp.org iburst<br>server 1.centos.pool.ntp.org iburst<br>server 2.centos.pool.ntp.org iburst<br>server 3.centos.pool.ntp.org iburst<br>Server ntp.aliyun.com iburst<br>Server ntp1.aliyun.com iburst<br>Server ntp2.aliyun.com iburst<br><br>driftfile /var/lib/chrony/drift<br><br>makestep 1.0 3<br><br>rtcsync<br><br>allow 192.168.23.0/24               // 指定允许同步的网段<br><br>logdir /var/log/chrony<br>[root@node1 ~]<span class="hljs-comment"># systemctl restart chronyd</span><br>[root@node1 ~]<span class="hljs-comment"># systemctl satus chronyd</span><br>Unknown operation &#x27;satus&#x27;.<br>[root@node1 ~]<span class="hljs-comment"># date</span><br>Tue Jul<span class="hljs-number"> 12 </span>20:59:14 CST 2022<br><br><span class="hljs-comment">#服务启动后会打开端口123/udp</span><br>[root@node1 ~]<span class="hljs-comment"># ss -ntlu</span><br>Netid  State      Recv-Q Send-Q          Local Address:Port                         Peer Address:Port              <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:46551                                   *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:68                                      *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:123                                     *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                  127.0.0.1:323                                     *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                        ::1:323                                    :::*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>                        *:22                                      *:*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>                127.0.0.1:25                                      *:*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>                       :::22                                     :::*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>                      ::1:25                                     :::*            <br>[root@node1 ~]<span class="hljs-comment"># chronyc</span><br>chrony version 3.2<br>Copyright (C) 1997-2003, 2007, 2009-2017 Richard P. Curnow and others<br>chrony comes with ABSOLUTELY NO WARRANTY.  This is free software, and<br>you are welcome to redistribute it under certain conditions.  See the<br>GNU General Public License version<span class="hljs-number"> 2 </span>for details.<br><br>chronyc&gt; clients<br>Hostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last<br>===============================================================================<br>192.168.23.103                <span class="hljs-number"> 10 </span>    <span class="hljs-number"> 0 </span> <span class="hljs-number"> 6 </span>  -   <span class="hljs-number"> 46 </span>     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>  -     -<br>192.168.23.102                 <span class="hljs-number"> 7 </span>    <span class="hljs-number"> 0 </span> <span class="hljs-number"> 6 </span>  -   <span class="hljs-number"> 15 </span>     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>  -     -<br><br><br></code></pre></td></tr></table></figure><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@node2 ~]<span class="hljs-comment"># grep -v ^# /etc/chrony.conf </span><br>server <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span> iburst <br>driftfile /<span class="hljs-keyword">var</span>/lib/chrony/drift<br>makestep <span class="hljs-number">1.0</span> <span class="hljs-number">3</span><br>rtcsync<br>logdir /<span class="hljs-keyword">var</span>/log/chrony<br>[root@node2 ~]<span class="hljs-comment"># systemctl restart chronyd</span><br>[root@node2 ~]<span class="hljs-comment"># chronyc sources -v</span><br><span class="hljs-number">210</span> <span class="hljs-built_in">Number</span> <span class="hljs-keyword">of</span> sources = <span class="hljs-number">1</span><br><br>  .-- Source mode  <span class="hljs-string">&#x27;^&#x27;</span> = server, <span class="hljs-string">&#x27;=&#x27;</span> = peer, <span class="hljs-string">&#x27;#&#x27;</span> = local clock.<br> / .- Source state <span class="hljs-string">&#x27;*&#x27;</span> = current synced, <span class="hljs-string">&#x27;+&#x27;</span> = combined , <span class="hljs-string">&#x27;-&#x27;</span> = <span class="hljs-keyword">not</span> combined,<br>| /   <span class="hljs-string">&#x27;?&#x27;</span> = unreachable, <span class="hljs-string">&#x27;x&#x27;</span> = time may be <span class="hljs-keyword">in</span> error, <span class="hljs-string">&#x27;~&#x27;</span> = time too variable.<br>||                                                 .- xxxx [ yyyy ] +/- zzzz<br>||      Reachability register (octal) -.           |  xxxx = adjusted offset,<br>||      Log2(Polling interval) --.      |          |  yyyy = measured offset,<br>||                                <span class="hljs-string">\</span>     |          |  zzzz = estimated error.<br>||                                 |    |           <span class="hljs-string">\</span><br>MS Name/IP address         Stratum Poll Reach LastRx Last sample               <br>===============================================================================<br>^* <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span>                <span class="hljs-number">3</span>   <span class="hljs-number">6</span>    <span class="hljs-number">17</span>    <span class="hljs-number">28</span>    +<span class="hljs-number">14us</span>[  +<span class="hljs-number">11us</span>] +<span class="hljs-regexp">/-   21ms               /</span>/为* 号时，表示跟服务器同步了<br>[root@node2 ~]<span class="hljs-comment"># date</span><br>Tue Jul <span class="hljs-number">12</span> <span class="hljs-number">09</span>:<span class="hljs-number">02</span>:<span class="hljs-number">15</span> EDT <span class="hljs-number">2022</span><br></code></pre></td></tr></table></figure><h2 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h2><p>此时客户端的时间，显示不是24小时制</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:45:07 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">America/New_York</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br><span class="hljs-string">You</span> <span class="hljs-string">have</span> <span class="hljs-string">new</span> <span class="hljs-string">mail</span> <span class="hljs-string">in</span> <span class="hljs-string">/var/spool/mail/root</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl set-timezone Asia/Shanghai</span><br><span class="hljs-string">You</span> <span class="hljs-string">have</span> <span class="hljs-string">new</span> <span class="hljs-string">mail</span> <span class="hljs-string">in</span> <span class="hljs-string">/var/spool/mail/root</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:17 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:17 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:18</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># </span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:29 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># date</span><br><span class="hljs-string">Tue</span> <span class="hljs-string">Jul</span> <span class="hljs-number">12</span> <span class="hljs-number">21</span><span class="hljs-string">:47:33</span> <span class="hljs-string">CST</span> <span class="hljs-number">2022</span><br><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 09:45:07 </span><span class="hljs-string">EDT</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">America/New_York</span> <span class="hljs-string">(EDT,</span> <span class="hljs-number">-0400</span><span class="hljs-string">)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">Last DST change:</span> <span class="hljs-string">DST</span> <span class="hljs-string">began</span> <span class="hljs-string">at</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-03-13 01:59:59 </span><span class="hljs-string">EST</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-03-13 03:00:00 </span><span class="hljs-string">EDT</span><br> <span class="hljs-attr">Next DST change:</span> <span class="hljs-string">DST</span> <span class="hljs-string">ends</span> <span class="hljs-string">(the</span> <span class="hljs-string">clock</span> <span class="hljs-string">jumps</span> <span class="hljs-string">one</span> <span class="hljs-string">hour</span> <span class="hljs-string">backwards)</span> <span class="hljs-string">at</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-11-06 01:59:59 </span><span class="hljs-string">EDT</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-11-06 01:00:00 </span><span class="hljs-string">EST</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl set-timezone Asia/Shanghai         // 修改时区</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:17 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:17 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:18</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># </span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:29 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># date                                         // 修改时区后，变成了正确时间</span><br><span class="hljs-string">Tue</span> <span class="hljs-string">Jul</span> <span class="hljs-number">12</span> <span class="hljs-number">21</span><span class="hljs-string">:47:33</span> <span class="hljs-string">CST</span> <span class="hljs-number">2022</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>云计算就业-王晓春</category>
      
    </categories>
    
    
    <tags>
      
      <tag>时间同步</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>自动安装系统</title>
    <link href="/2022/07/17/%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F/"/>
    <url>/2022/07/17/%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="自动化部署-19-4"><a href="#自动化部署-19-4" class="headerlink" title="自动化部署 19.4"></a>自动化部署 19.4</h1><span id="more"></span><h3 id="自制光盘方式"><a href="#自制光盘方式" class="headerlink" title="自制光盘方式"></a>自制光盘方式</h3><p>（1）制作引导光盘</p><figure class="highlight gradle"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# mount <span class="hljs-regexp">/dev/</span>cdrom <span class="hljs-regexp">/mnt/</span><br>mount: <span class="hljs-regexp">/dev/</span>sr0 is <span class="hljs-keyword">write</span>-<span class="hljs-keyword">protected</span>, mounting <span class="hljs-keyword">read</span>-only<br>[root@node1 ~]# mkdir -p <span class="hljs-regexp">/data/myi</span>so<br>[root@node1 ~]# cp -r <span class="hljs-regexp">/mnt/i</span>solinux<span class="hljs-regexp">/ /</span>data<span class="hljs-regexp">/myiso/</span><br>[root@node1 ~]# tree <span class="hljs-regexp">/data/myi</span>so/<br><span class="hljs-regexp">/data/myi</span>so/<br>└── isolinux<br>    ├── boot.cat<br>    ├── boot.msg<br>    ├── grub.conf<br>    ├── initrd.img<br>    ├── isolinux.bin<br>    ├── isolinux.cfg<br>    ├── memtest<br>    ├── splash.png<br>    ├── TRANS.TBL<br>    ├── vesamenu.c32<br>    └── vmlinuz<br><br><span class="hljs-number">1</span> directory, <span class="hljs-number">11</span> files<br><br>[root@node1 ~]# vim <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/i</span>solinux.cfg <br><br>label linux<br>  menu label ^Auto Install CentOS <span class="hljs-number">7</span><br>  kernel vmlinuz<br>  initrd=initrd.img text ks=cdrom:/myks.cfg<br></code></pre></td></tr></table></figure><p>（2）创建kickstart应答文件</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[root@node1 ~]<span class="hljs-comment"># vim /data/myiso/myks.cfg </span><br><br><span class="hljs-comment">#platform=x86, AMD64, or Intel EM64T</span><br><span class="hljs-comment">#version=DEVEL</span><br><span class="hljs-comment"># Install OS instead of upgrade</span><br>install<br><span class="hljs-comment"># Keyboard layouts</span><br>keyboard &#x27;us&#x27;<br><span class="hljs-comment"># Root password</span><br>rootpw <span class="hljs-params">--plaintext</span> 123456         <span class="hljs-string">//</span> 明文的密码<br><span class="hljs-comment"># System language</span><br>lang en_US<br><span class="hljs-comment"># System authorization information</span><br>auth  <span class="hljs-params">--useshadow</span>  <span class="hljs-params">--passalgo=md5</span><br><span class="hljs-comment"># Use text mode install</span><br>text                            <span class="hljs-string">//</span> 文本安装<br>firstboot <span class="hljs-params">--disable</span><br><span class="hljs-comment"># SELinux configuration</span><br>selinux <span class="hljs-params">--disabled</span>               <span class="hljs-string">//</span> 禁用selinux<br><br><br><span class="hljs-comment"># Firewall configuration</span><br>firewall <span class="hljs-params">--disabled</span>              <span class="hljs-string">//</span> 禁用防火墙<br><span class="hljs-comment"># Network information</span><br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth1</span>   <br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth0</span><br><span class="hljs-comment"># Reboot after installation</span><br>reboot<br><span class="hljs-comment"># System timezone</span><br>timezone Africa/Abidjan<br><span class="hljs-comment"># Use network installation</span><br>url <span class="hljs-params">--url=</span><span class="hljs-string">&quot;http://192.168.23.101/centos/7/os/x86_64/&quot;</span>    <span class="hljs-string">//</span> yum仓库路径<br><span class="hljs-comment"># System bootloader configuration</span><br>bootloader <span class="hljs-params">--append=</span><span class="hljs-string">&quot;net.ifnames=0&quot;</span> <span class="hljs-params">--location=mbr</span>     <span class="hljs-string">//</span> bootloader的内核参数加上了，网卡名称是eth了<br><span class="hljs-comment"># Clear the Master Boot Record</span><br>zerombr<br><span class="hljs-comment"># Partition clearing information</span><br>clearpart <span class="hljs-params">--all</span><br><span class="hljs-comment"># Disk partitioning information</span><br>part / <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=10000</span><br>part <span class="hljs-string">/boot</span> <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=1000</span><br>part swap <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;swap&quot;</span> <span class="hljs-params">--size=2048</span><br><br>%post<br>mkdir <span class="hljs-string">/etc/yum.repos.d/bak</span><br>mv <span class="hljs-string">/etc/yum.repos.d/</span>*<span class="hljs-string">.repo</span> <span class="hljs-string">/etc/yum.repos.d/bak</span><br>cat &gt; <span class="hljs-string">/etc/yum.repos.d/base.repo</span> &lt;&lt;EOF                 <span class="hljs-string">//</span> 在文件中增加了yum配置文件的内容<br>[base]<br>name=CentOS-$releasever - Base<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-$releasever - Updates<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-$releasever - Extras<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-$releasever - Plus<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span><br>gpgcheck=1<br>enabled=0<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br>EOF<br>mkdir <span class="hljs-string">/root/.ssh/</span> -m 700                            <span class="hljs-string">//</span>配置基于key验证登录系统<br>cat &gt; <span class="hljs-string">/root/.ssh/authorized_keys</span> &lt;&lt;EOF<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXHaEV3kmyS7qCYw+OcYjBEAXPJ+CLLB+cI/0Az2sASKXXEMk7KwTHrqgC9YEsDLKn4zMU9i1qt3jzdqExigs8y7S7FAe0xFpkJhumywIMHXKgiYiSSw3mI94hVp3x2recGkMXoQrvaY2iPj3iKBZCINQxQ1+sO+JbLlTEWAH+drwDGuCe+MZGcYYCHJw4f2l+hifhKIGDIFB2/rxvEBG8sqTuZrD5RKeMiTodnJREyf2gchrwMb3fUIu0K3kNafN9eR8IQch3AGoe524k9Rvm0S37iQHOft6jgJI59IHBjDqQQUiLba/FDAo7PaS0rFo2XsAYmQZ0FHLqwvIoAYBH root@node1<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDciEtJ5mQ7qEKcGSkdxYRzl2vsEDaDDo0Xr+QIRm8Fw7YjTK3QClTiAmiKMpxk3hwovxIgtyOGwuu/<span class="hljs-string">/umXdJs3jvUGyaOXx6AOOzF4gvMInA94YBN0OeVFwVdgmxl3BpqIINAeK6</span>+UVeaF2RfP6aiXNNohZ8z5tuKp/3bhpsv9V4G1X8Xff5TXVwlwr6R1IPVxtjoj5CwjmQrgjMmxfPkrlZUKfxtcGHqsg9Q9kCKaa6H9e+Ur9owjiu5xe+dnqxDUbbFa1MsJ9PK9U4PWig1mPuKaExd8TwmTgk50LyYnA4NyDg9rq0j8KmOmjtp1buEpPlxGvYV1/tPxyd3qorqP root@node1<br>EOF<br>chmod 600 <span class="hljs-string">/root/.ssh/authorized_keys</span><br>useradd linux44                                   <span class="hljs-string">//</span> 创建账号<br><span class="hljs-keyword">echo</span> 123456 |passwd <span class="hljs-params">--stdin</span> linux44<br>%end<br><br>%packages<br>@development<br><br>%end<br>[root@node1 ~]<span class="hljs-comment"># ksvalidator /data/myiso/myks.cfg                // 检查是否有语法错误</span><br></code></pre></td></tr></table></figure><p>(3) 生成自制光盘</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-type">##</span>使用<span class="hljs-variable">mkisofs</span>命令生成自制光盘<br><span class="hljs-punctuation">[</span><span class="hljs-variable">root</span><span class="hljs-operator">@</span><span class="hljs-variable">node1</span> <span class="hljs-operator">~</span><span class="hljs-punctuation">]</span><span class="hljs-type">#</span> <span class="hljs-variable">mkisofs</span> <span class="hljs-operator">-</span><span class="hljs-variable">R</span> <span class="hljs-operator">-</span><span class="hljs-variable">J</span> <span class="hljs-operator">-</span><span class="hljs-variable">T</span> <span class="hljs-operator">-</span><span class="hljs-variable">v</span> <span class="hljs-operator">--</span><span class="hljs-variable">no</span><span class="hljs-operator">-</span><span class="hljs-variable">emul</span><span class="hljs-operator">-</span><span class="hljs-variable">boot</span> <span class="hljs-operator">--</span><span class="hljs-variable">boot</span><span class="hljs-operator">-</span><span class="hljs-variable">load</span><span class="hljs-operator">-</span><span class="hljs-variable">size</span> <span class="hljs-number">4</span> <span class="hljs-operator">--</span><span class="hljs-variable">boot</span><span class="hljs-operator">-</span><span class="hljs-variable">info</span><span class="hljs-operator">-</span><span class="hljs-variable">table</span> <span class="hljs-operator">-</span><span class="hljs-variable">V</span> <span class="hljs-string">&quot;centos 7.6 x86_64 boot&quot;</span> <span class="hljs-operator">-</span><span class="hljs-variable">b</span> <span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">.</span><span class="hljs-variable">bin</span> <span class="hljs-operator">-</span><span class="hljs-variable">c</span> <span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">boot</span><span class="hljs-operator">.</span><span class="hljs-variable">cat</span> <span class="hljs-operator">-</span><span class="hljs-variable">o</span> <span class="hljs-operator">/</span><span class="hljs-variable">root</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">.</span><span class="hljs-variable">iso</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><br><span class="hljs-built_in">I</span><span class="hljs-operator">:</span> <span class="hljs-operator">-</span><span class="hljs-variable">input</span><span class="hljs-operator">-</span><span class="hljs-variable">charset</span> <span class="hljs-variable">not</span> <span class="hljs-variable">specified</span><span class="hljs-operator">,</span> <span class="hljs-variable">using</span> <span class="hljs-variable">utf</span><span class="hljs-operator">-</span><span class="hljs-number">8</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">detected</span> <span class="hljs-variable">in</span> <span class="hljs-variable">locale</span> <span class="hljs-variable">settings</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">genisoimage</span> <span class="hljs-number">1.1</span><span class="hljs-number">.11</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Linux</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">Scanning</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><br><span class="hljs-variable">Scanning</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><br><span class="hljs-variable">Excluded</span> <span class="hljs-variable">by</span> <span class="hljs-variable">match</span><span class="hljs-operator">:</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">boot</span><span class="hljs-operator">.</span><span class="hljs-variable">cat</span><br><span class="hljs-variable">Excluded</span><span class="hljs-operator">:</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">TRANS</span><span class="hljs-operator">.</span><span class="hljs-variable">TBL</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Initial</span> <span class="hljs-variable">Padblock</span>                        <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">0</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Initial</span> <span class="hljs-variable">Padblock</span>                        <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">16</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Primary</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>               <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">16</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Primary</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>               <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Eltorito</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>              <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">17</span><br><span class="hljs-variable">Size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">boot</span> <span class="hljs-variable">image</span> <span class="hljs-variable">is</span> <span class="hljs-number">4</span> <span class="hljs-variable">sectors</span> <span class="hljs-operator">-&gt;</span> <span class="hljs-variable">No</span> <span class="hljs-variable">emulation</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Eltorito</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>              <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">18</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">End</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                   <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">19</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">End</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                   <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Version</span> <span class="hljs-variable">block</span>                           <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">20</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Version</span> <span class="hljs-variable">block</span>                           <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span>                              <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">21</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span>                              <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">4</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-variable">path</span> <span class="hljs-variable">table</span>                       <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">25</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-variable">path</span> <span class="hljs-variable">table</span>                       <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">4</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span>                          <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">29</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span>                          <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">2</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">tree</span>                   <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">31</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">tree</span>                   <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">2</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span> <span class="hljs-variable">cleanup</span>                  <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">33</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span> <span class="hljs-variable">cleanup</span>                  <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">0</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Extension</span> <span class="hljs-variable">record</span>                        <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">33</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Extension</span> <span class="hljs-variable">record</span>                        <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">The</span> <span class="hljs-built_in">File</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>                             <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">34</span><br> <span class="hljs-number">17.11</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">13</span><span class="hljs-operator">:</span><span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">17</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">34.15</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">13</span><span class="hljs-operator">:</span><span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">17</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">51.24</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">13</span><span class="hljs-operator">:</span><span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">17</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">68.28</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">13</span><span class="hljs-operator">:</span><span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">17</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">85.38</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">13</span><span class="hljs-operator">:</span><span class="hljs-number">19</span><span class="hljs-operator">:</span><span class="hljs-number">17</span> <span class="hljs-number">2022</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">translation</span> <span class="hljs-variable">table</span> <span class="hljs-variable">size</span><span class="hljs-operator">:</span> <span class="hljs-number">4703</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">rockridge</span> <span class="hljs-variable">attributes</span> <span class="hljs-variable">bytes</span><span class="hljs-operator">:</span> <span class="hljs-number">1440</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">bytes</span><span class="hljs-operator">:</span> <span class="hljs-number">2048</span><br><span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span> <span class="hljs-variable">size</span><span class="hljs-punctuation">(</span><span class="hljs-variable">bytes</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> <span class="hljs-number">26</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">The</span> <span class="hljs-built_in">File</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>                             <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">29112</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Ending</span> <span class="hljs-variable">Padblock</span>                         <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">29146</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Ending</span> <span class="hljs-variable">Padblock</span>                         <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">150</span><br><span class="hljs-built_in">Max</span> <span class="hljs-variable">brk</span> <span class="hljs-variable">space</span> <span class="hljs-variable">used</span> <span class="hljs-number">0</span><br><span class="hljs-number">29296</span> <span class="hljs-variable">extents</span> <span class="hljs-variable">written</span> <span class="hljs-punctuation">(</span><span class="hljs-number">57</span> <span class="hljs-variable">MB</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">[</span><span class="hljs-variable">root</span><span class="hljs-operator">@</span><span class="hljs-variable">node1</span> <span class="hljs-operator">~</span><span class="hljs-punctuation">]</span><span class="hljs-type">#</span> <span class="hljs-variable">ll</span><br><span class="hljs-variable">total</span> <span class="hljs-number">58600</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-------.</span> <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span>     <span class="hljs-number">1420</span> <span class="hljs-variable">Jun</span> <span class="hljs-number">29</span> <span class="hljs-number">05</span><span class="hljs-operator">:</span><span class="hljs-number">55</span> <span class="hljs-variable">anaconda</span><span class="hljs-operator">-</span><span class="hljs-variable">ks</span><span class="hljs-operator">.</span><span class="hljs-variable">cfg</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span>  <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span>     <span class="hljs-number">3332</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">16</span> <span class="hljs-number">18</span><span class="hljs-operator">:</span><span class="hljs-number">31</span> <span class="hljs-variable">ks7</span><span class="hljs-operator">.</span><span class="hljs-variable">cfg</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span>  <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span> <span class="hljs-number">59994112</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span> <span class="hljs-variable">myiso</span><span class="hljs-operator">.</span><span class="hljs-variable">iso</span><br></code></pre></td></tr></table></figure><p>在新建虚拟时选择自制光盘镜像文件myiso.iso，启动后效果如图</p><p><img src="image-20220717132136349.png" alt="image-20220717132136349"></p><p><img src="image-20220717140332441.png" alt="image-20220717140332441"></p><p>安装异常停止了。</p><h3 id="PXE方式"><a href="#PXE方式" class="headerlink" title="PXE方式"></a>PXE方式</h3><p>(1) 准备PXE启动相关文件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# cp <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/</span>&#123;vmlinuz,initrd.img&#125; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>[root@node1 ~]# cp <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/</span><span class="hljs-regexp">/isolinux.cfg /</span>var<span class="hljs-regexp">/lib/</span>tftpboot<span class="hljs-regexp">/pxelinux.cfg/</span><span class="hljs-keyword">default</span><br>[root@node1 ~]# ll <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>total <span class="hljs-number">57928</span><br>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">52584760</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">18</span> initrd.img<br>-rw-r--r-- <span class="hljs-number">1</span> root root    <span class="hljs-number">55140</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">15</span> menu.c32<br>-rw-r--r-- <span class="hljs-number">1</span> root root    <span class="hljs-number">26759</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">15</span> pxelinux.<span class="hljs-number">0</span><br>drwxr-xr-x <span class="hljs-number">2</span> root root       <span class="hljs-number">21</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">19</span> pxelinux.cfg<br>-rwxr-xr-x <span class="hljs-number">1</span> root root  <span class="hljs-number">6639904</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">18</span> vmlinuz<br>[root@node1 ~]# tree <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>├── initrd.img<br>├── menu.c32<br>├── pxelinux.<span class="hljs-number">0</span><br>├── pxelinux.cfg<br>│   └── <span class="hljs-keyword">default</span><br>└── vmlinuz<br><br><span class="hljs-number">1</span> directory, <span class="hljs-number">5</span> files<br></code></pre></td></tr></table></figure><p>(2) 准备启动菜单</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 ~]# yum install <span class="hljs-keyword">system</span>-config-kickstart     // 一个图形化的工具，可以生成kickstart`配置文件，需要安装一下，<span class="hljs-number">100</span>多个包<br>[root@node1 ~]# <span class="hljs-keyword">system</span>-config-kickstart                // 在linux系统不能直接打开，<br>Could <span class="hljs-keyword">not</span> <span class="hljs-keyword">open</span> display because <span class="hljs-keyword">no</span> X <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> running.<br>Try running <span class="hljs-string">&#x27;system-config-kickstart --help&#x27;</span> <span class="hljs-keyword">for</span> a list <span class="hljs-keyword">of</span> <span class="hljs-keyword">options</span>.<br><br>在linux里打开一个图形界面，在windows系统显示:<br>[root@node1 ~]# export DISPLAY=<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.9</span>:<span class="hljs-number">0.0</span><br>You have <span class="hljs-built_in">new</span> mail <span class="hljs-keyword">in</span> /var/spool/mail/root<br>[root@node1 ~]# <span class="hljs-keyword">system</span>-config-kickstart <br>/usr/<span class="hljs-keyword">share</span>/<span class="hljs-keyword">system</span>-config-kickstart/kickstartGui.py:<span class="hljs-number">104</span>: GtkWarning: GtkSpinButton: setting an adjustment <span class="hljs-keyword">with</span> non-zero page size <span class="hljs-keyword">is</span> deprecated<br>  <span class="hljs-type">xml</span> = gtk.glade.XML (&quot;/usr/share/system-config-kickstart/system-config-kickstart.glade&quot;, <span class="hljs-keyword">domain</span>=&quot;system-config-kickstart&quot;)<br>Loaded plugins: fastestmirror<br></code></pre></td></tr></table></figure><p><img src="image-20220716153229566.png" alt="image-20220716153229566"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# systemctl start httpd<br>[root@node1 ~]# mkidr -p <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os<span class="hljs-regexp">/x86_64/</span><br>[root@node1 ~]# tree -L <span class="hljs-number">4</span> <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span> <br><span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span><br>└── centos<br>    ├── <span class="hljs-number">6</span><br>    │   └── os<br>    │       └── x86_64<br>    ├── <span class="hljs-number">7</span><br>    │   └── os<br>    │       └── x86_64<br>    └── <span class="hljs-number">8</span><br>        └── os<br>            └── x86_64<br><br><span class="hljs-number">10</span> directories, <span class="hljs-number">0</span> files<br>[root@node1 ~]# vim <span class="hljs-regexp">/etc/</span>fstab <br><span class="hljs-regexp">/dev/</span>cdrom  <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os<span class="hljs-regexp">/x86_64/</span>   iso9660 defaults<span class="hljs-number">0</span> <span class="hljs-number">0</span><br>[root@node1 ~]# mount -a<br>mount: <span class="hljs-regexp">/dev/</span>sr0 is <span class="hljs-keyword">write</span>-<span class="hljs-keyword">protected</span>, mounting <span class="hljs-keyword">read</span>-only<br>[root@node1 ~]# df -h<br>Filesystem                   <span class="hljs-keyword">Size</span>  Used Avail Use% Mounted on<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root       17G  1.7G   16G  10% /</span><br>devtmpfs                     <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                        <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                        <span class="hljs-number">487</span>M   <span class="hljs-number">14</span>M  <span class="hljs-number">473</span>M   <span class="hljs-number">3</span>% /run<br>tmpfs                        <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/</span>sda1                   <span class="hljs-number">1014</span>M  <span class="hljs-number">133</span>M  <span class="hljs-number">882</span>M  <span class="hljs-number">14</span>% /boot<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/vg_data-lv_data  976M  509M  400M  57% /</span>home<br>tmpfs                         <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/</span>sr0                     <span class="hljs-number">4.3</span>G  <span class="hljs-number">4.3</span>G     <span class="hljs-number">0</span> <span class="hljs-number">100</span>% <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os/x86_64<br></code></pre></td></tr></table></figure><p>至此，仓库已准备好</p><p><img src="image-20220716160716779.png" alt="image-20220716160716779"></p><p><img src="image-20220716160913498.png" alt="image-20220716160913498"></p><p><img src="image-20220716161928275.png" alt="image-20220716161928275"></p><p>在图形界面大概配置完成后，保存生成ks7.cfg文件。图形界面修改yum的配置不是很方便，可以继续在文件里做配置修改。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[root@node1 ~]<span class="hljs-comment"># vim /root/ks7.cfg </span><br><br><span class="hljs-comment">#platform=x86, AMD64, or Intel EM64T</span><br><span class="hljs-comment">#version=DEVEL</span><br><span class="hljs-comment"># Install OS instead of upgrade</span><br>install<br><span class="hljs-comment"># Keyboard layouts</span><br>keyboard &#x27;us&#x27;<br><span class="hljs-comment"># Root password</span><br>rootpw <span class="hljs-params">--plaintext</span> 123456         <span class="hljs-string">//</span> 明文的密码<br><span class="hljs-comment"># System language</span><br>lang en_US<br><span class="hljs-comment"># System authorization information</span><br>auth  <span class="hljs-params">--useshadow</span>  <span class="hljs-params">--passalgo=md5</span><br><span class="hljs-comment"># Use text mode install</span><br>text                            <span class="hljs-string">//</span> 文本安装<br>firstboot <span class="hljs-params">--disable</span><br><span class="hljs-comment"># SELinux configuration</span><br>selinux <span class="hljs-params">--disabled</span>               <span class="hljs-string">//</span> 禁用selinux<br><br><br><span class="hljs-comment"># Firewall configuration</span><br>firewall <span class="hljs-params">--disabled</span>              <span class="hljs-string">//</span> 禁用防火墙<br><span class="hljs-comment"># Network information</span><br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth1</span>   <br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth0</span><br><span class="hljs-comment"># Reboot after installation</span><br>reboot<br><span class="hljs-comment"># System timezone</span><br>timezone Africa/Abidjan<br><span class="hljs-comment"># Use network installation</span><br>url <span class="hljs-params">--url=</span><span class="hljs-string">&quot;http://192.168.23.101/centos/7/os/x86_64/&quot;</span>    <span class="hljs-string">//</span> yum仓库路径<br><span class="hljs-comment"># System bootloader configuration</span><br>bootloader <span class="hljs-params">--append=</span><span class="hljs-string">&quot;net.ifnames=0&quot;</span> <span class="hljs-params">--location=mbr</span>     <span class="hljs-string">//</span> bootloader的内核参数加上了，网卡名称是eth了<br><span class="hljs-comment"># Clear the Master Boot Record</span><br>zerombr<br><span class="hljs-comment"># Partition clearing information</span><br>clearpart <span class="hljs-params">--all</span><br><span class="hljs-comment"># Disk partitioning information</span><br>part / <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=10000</span><br>part <span class="hljs-string">/boot</span> <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=1000</span><br>part swap <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;swap&quot;</span> <span class="hljs-params">--size=2048</span><br><br>%post<br>mkdir <span class="hljs-string">/etc/yum.repos.d/bak</span><br>mv <span class="hljs-string">/etc/yum.repos.d/</span>*<span class="hljs-string">.repo</span> <span class="hljs-string">/etc/yum.repos.d/bak</span><br>cat &gt; <span class="hljs-string">/etc/yum.repos.d/base.repo</span> &lt;&lt;EOF                 <span class="hljs-string">//</span> 在文件中增加了yum配置文件的内容<br>[base]<br>name=CentOS-$releasever - Base<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-$releasever - Updates<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-$releasever - Extras<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-$releasever - Plus<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span><br>gpgcheck=1<br>enabled=0<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br>EOF<br>mkdir <span class="hljs-string">/root/.ssh/</span> -m 700                            <span class="hljs-string">//</span>配置基于key验证登录系统<br>cat &gt; <span class="hljs-string">/root/.ssh/authorized_keys</span> &lt;&lt;EOF<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXHaEV3kmyS7qCYw+OcYjBEAXPJ+CLLB+cI/0Az2sASKXXEMk7KwTHrqgC9YEsDLKn4zMU9i1qt3jzdqExigs8y7S7FAe0xFpkJhumywIMHXKgiYiSSw3mI94hVp3x2recGkMXoQrvaY2iPj3iKBZCINQxQ1+sO+JbLlTEWAH+drwDGuCe+MZGcYYCHJw4f2l+hifhKIGDIFB2/rxvEBG8sqTuZrD5RKeMiTodnJREyf2gchrwMb3fUIu0K3kNafN9eR8IQch3AGoe524k9Rvm0S37iQHOft6jgJI59IHBjDqQQUiLba/FDAo7PaS0rFo2XsAYmQZ0FHLqwvIoAYBH root@node1<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDciEtJ5mQ7qEKcGSkdxYRzl2vsEDaDDo0Xr+QIRm8Fw7YjTK3QClTiAmiKMpxk3hwovxIgtyOGwuu/<span class="hljs-string">/umXdJs3jvUGyaOXx6AOOzF4gvMInA94YBN0OeVFwVdgmxl3BpqIINAeK6</span>+UVeaF2RfP6aiXNNohZ8z5tuKp/3bhpsv9V4G1X8Xff5TXVwlwr6R1IPVxtjoj5CwjmQrgjMmxfPkrlZUKfxtcGHqsg9Q9kCKaa6H9e+Ur9owjiu5xe+dnqxDUbbFa1MsJ9PK9U4PWig1mPuKaExd8TwmTgk50LyYnA4NyDg9rq0j8KmOmjtp1buEpPlxGvYV1/tPxyd3qorqP root@node1<br>EOF<br>chmod 600 <span class="hljs-string">/root/.ssh/authorized_keys</span><br>useradd linux44                                   <span class="hljs-string">//</span> 创建账号<br><span class="hljs-keyword">echo</span> 123456 |passwd <span class="hljs-params">--stdin</span> linux44<br>%end<br><br>%packages<br>@development<br><br>%end<br>[root@node1 ~]<span class="hljs-comment"># ksvalidator ks7.cfg                // 检查是否有语法错误</span><br></code></pre></td></tr></table></figure><p>应答文件中有语法错误的范例：</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs julia">[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># ksvalidator ks7.cfg </span><br>The following problem occurred on line <span class="hljs-number">89</span> of the kickstart file:<br><br>Section %post does not <span class="hljs-keyword">end</span> with %<span class="hljs-keyword">end</span>.<br><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -5 ks7.cfg </span><br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -7 ks7.cfg </span><br>useradd <span class="hljs-number">123456</span> |passwd --<span class="hljs-literal">stdin</span> linux44<br><span class="hljs-keyword">end</span>                                         // 前面少了一个%<br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># vim ks7.cfg </span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -7 ks7.cfg </span><br>useradd <span class="hljs-number">123456</span> |passwd --<span class="hljs-literal">stdin</span> linux44<br>%<span class="hljs-keyword">end</span><br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># ksvalidator ks7.cfg            // 加上之后，在检查就没有报错了。</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[root@node1 ~]</span># ll /<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/ks/<br>total <span class="hljs-number">4</span><br>-rw-r<span class="hljs-attr">--r--</span> <span class="hljs-number">1</span> root root <span class="hljs-number">3335</span> Jul <span class="hljs-number">16</span> <span class="hljs-number">18</span>:<span class="hljs-number">02</span> ks7.cfg<br></code></pre></td></tr></table></figure><p><img src="image-20220716180339254.png" alt="image-20220716180339254"></p><p>保证应答文件能访问</p><p><img src="image-20220716180453972.png" alt="image-20220716180453972"></p><p><img src="image-20220716180526477.png" alt="image-20220716180526477"></p><p><img src="image-20220716181130801.png" alt="image-20220716181130801"></p><p><img src="image-20220716183850547.png" alt="image-20220716183850547"></p><p>这时候会自动通过网络，从搭建的服务器上下载ks7.cfg这个应答文件，从而自动安装系统。</p><p><img src="image-20220716181520061.png" alt="image-20220716181520061"></p><p>系统启动后，环境验证</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pf">[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.10</span><br>The authenticity of host &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span> (<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>)&#x27; can&#x27;t be established.<br>ECDSA key fingerprint is SHA256:XaE+xPJC5Wg+o+<span class="hljs-number">2</span>/c27tNKbZSJ7iQbKzUZrFv23mMVs.<br>ECDSA key fingerprint is MD5:<span class="hljs-number">6</span>b:f8:<span class="hljs-number">30</span>:<span class="hljs-number">77</span>:<span class="hljs-number">62</span>:<span class="hljs-number">6</span>f:<span class="hljs-number">3</span>d:<span class="hljs-number">22</span>:<span class="hljs-number">3</span>c:<span class="hljs-number">5</span>a:e3:<span class="hljs-number">8</span>d:<span class="hljs-number">6</span>a:<span class="hljs-number">5</span>f:<span class="hljs-number">89</span>:<span class="hljs-number">07</span>.<br>Are you sure you want <span class="hljs-keyword">to</span> continue connecting (yes/<span class="hljs-keyword">no</span>)? yes<br>Warning: Permanently added &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>&#x27; (ECDSA) <span class="hljs-keyword">to</span> the list of known hosts.<br>Last login: Sat Jul <span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">00</span>:<span class="hljs-number">26</span> <span class="hljs-number">2022</span><br>[root@localhost ~]<span class="hljs-comment"># ip a</span><br><span class="hljs-number">1</span>: lo: <span class="hljs-variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">65536</span> qdisc noqueue <span class="hljs-keyword">state</span> UNKNOWN <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    <span class="hljs-keyword">inet6</span> ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: <span class="hljs-variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">1500</span> qdisc pfifo_fast <span class="hljs-keyword">state</span> UP <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">04</span>:<span class="hljs-number">96</span>:b8 brd ff:ff:ff:ff:ff:ff<br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168</span>.<span class="hljs-number">23.255</span> scope <span class="hljs-keyword">global</span> noprefixroute dynamic eth0<br>       valid_lft <span class="hljs-number">1575</span>sec preferred_lft <span class="hljs-number">1575</span>sec<br>    <span class="hljs-keyword">inet6</span> fe80::cbf8:<span class="hljs-number">3</span>ae0:<span class="hljs-number">364</span>f:<span class="hljs-number">527</span>e/<span class="hljs-number">64</span> scope link noprefixroute <br>       valid_lft forever preferred_lft forever<br>[root@localhost ~]<span class="hljs-comment"># getenforce</span><br>Disabled<br>[root@localhost ~]<span class="hljs-comment"># cat /etc/selinux/config |grep SELINUX</span><br><span class="hljs-comment"># SELINUX= can take one of these three values:</span><br>SELINUX=disabled<br><span class="hljs-comment"># SELINUXTYPE= can take one of three values:</span><br>SELINUXTYPE=targeted<br>[root@localhost ~]<span class="hljs-comment"># service status firewalld</span><br>The service command supports only <span class="hljs-keyword">basic</span> LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try <span class="hljs-keyword">to</span> use systemctl.<br>[root@localhost ~]<span class="hljs-comment"># systemctl status firewalld</span><br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br>[root@localhost ~]<span class="hljs-comment"># service firewalld status</span><br>Redirecting <span class="hljs-keyword">to</span> /bin/systemctl status firewalld.service<br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br>[root@localhost ~]<span class="hljs-comment"># id linux44</span><br>uid=<span class="hljs-number">1000</span>(linux44) gid=<span class="hljs-number">1000</span>(linux44) groups=<span class="hljs-number">1000</span>(linux44)<br></code></pre></td></tr></table></figure><h3 id="Cobbler方式"><a href="#Cobbler方式" class="headerlink" title="Cobbler方式"></a>Cobbler方式</h3><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3>]]></content>
    
    
    <categories>
      
      <category>云计算就业-王晓春</category>
      
    </categories>
    
    
    <tags>
      
      <tag>自动化部署</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>多节点之间免密登录</title>
    <link href="/2022/07/09/%E5%A4%9A%E8%8A%82%E7%82%B9%E4%B9%8B%E9%97%B4%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/"/>
    <url>/2022/07/09/%E5%A4%9A%E8%8A%82%E7%82%B9%E4%B9%8B%E9%97%B4%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="18-4"><a href="#18-4" class="headerlink" title="18.4"></a>18.4</h1><span id="more"></span><p>需求：</p><p>1、多个节点之间，互相ssh，都不需要输入对方的系统账号密码，以提高管理、部署的效率；<br>2、避免因为泄露了一台服务器的密码，而导致其它所有服务器都被暴漏的危险，以保证一定的安全性；</p><p>多个节点公用一个密钥对，可以实现互相免密登录；<br>对私钥进行加密，并且启动代理，在登录后、登出之前，只输入一次私钥密码，即可满足操作的方便、以及账号的安全；</p><p><img src="image-20220710003251923.png" alt="image-20220710003251923"></p><figure class="highlight applescript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><pre><code class="hljs applescript">[root@node1 ~]<span class="hljs-comment"># ssh-keygen</span><br>[root@node1 ~]<span class="hljs-comment"># ssh-copy-id 127.0.0.1</span><br>/usr/bin/ssh-<span class="hljs-keyword">copy</span>-<span class="hljs-built_in">id</span>: INFO: Source <span class="hljs-keyword">of</span> key(s) <span class="hljs-keyword">to</span> be installed: <span class="hljs-string">&quot;/root/.ssh/id_rsa.pub&quot;</span><br>The authenticity <span class="hljs-keyword">of</span> host &#x27;<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> (<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>)&#x27; can&#x27;t be established.<br>ECDSA key fingerprint <span class="hljs-keyword">is</span> SHA256:/AaL9QiN7JWUr8LZsqaGeKWO+DfRswsVJVakIyoOHLM.<br>ECDSA key fingerprint <span class="hljs-keyword">is</span> MD5:<span class="hljs-number">29</span>:<span class="hljs-number">79</span>:<span class="hljs-number">27</span>:f9:a6:f0:<span class="hljs-number">08</span>:ff:<span class="hljs-number">37</span>:fa:<span class="hljs-number">59</span>:<span class="hljs-number">0</span>a:<span class="hljs-number">0</span>f:a1:ff:<span class="hljs-number">0</span>d.<br>Are you sure you want <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> connecting (yes/no)? yes<br>/usr/bin/ssh-<span class="hljs-keyword">copy</span>-<span class="hljs-built_in">id</span>: INFO: attempting <span class="hljs-keyword">to</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> new key(s), <span class="hljs-keyword">to</span> filter out any <span class="hljs-keyword">that</span> are already installed<br>/usr/bin/ssh-<span class="hljs-keyword">copy</span>-<span class="hljs-built_in">id</span>: INFO: <span class="hljs-number">1</span> key(s) remain <span class="hljs-keyword">to</span> be installed <span class="hljs-comment">-- if you are prompted now it is to install the new keys</span><br>root@<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>&#x27;s password: <br>Permission denied, please <span class="hljs-keyword">try</span> again.<br>root@<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>&#x27;s password: <br><br>Number <span class="hljs-keyword">of</span> key(s) added: <span class="hljs-number">1</span><br><br>Now <span class="hljs-keyword">try</span> logging <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> machine, <span class="hljs-keyword">with</span>:   <span class="hljs-string">&quot;ssh &#x27;127.0.0.1&#x27;&quot;</span><br><span class="hljs-keyword">and</span> check <span class="hljs-keyword">to</span> make sure <span class="hljs-keyword">that</span> only <span class="hljs-keyword">the</span> key(s) you wanted were added.<br></code></pre></td></tr></table></figure><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@node1 ~]<span class="hljs-comment"># for i in `cat /test/hosts.txt`;do scp -rp .ssh $i:/root;done</span><br>[root@node2 ~]<span class="hljs-comment"># ssh 192.168.23.105</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">09</span>:<span class="hljs-number">13</span>:<span class="hljs-number">32</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span><br>[root@node5 ~]<span class="hljs-comment"># ssh 192.168.23.106</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">09</span>:<span class="hljs-number">13</span>:<span class="hljs-number">37</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span><br>[root@node6 ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.106</span> closed.<br>[root@node5 ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.105</span> closed.<br></code></pre></td></tr></table></figure><p>对私钥进行加密</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@node1 ~]<span class="hljs-comment"># ssh-keygen -p</span><br>Enter file <span class="hljs-keyword">in</span> which the key <span class="hljs-keyword">is</span> (<span class="hljs-regexp">/root/</span>.ssh/id_rsa): <span class="hljs-number">123456</span><br><span class="hljs-number">123456</span>: No such file <span class="hljs-keyword">or</span> directory<br>[root@node1 ~]<span class="hljs-comment"># cd .ssh/</span><br>[root@node1 .ssh]<span class="hljs-comment"># ll</span><br>total <span class="hljs-number">16</span><br>-rw------- <span class="hljs-number">1</span> root root  <span class="hljs-number">392</span> Jul <span class="hljs-number">10</span> <span class="hljs-number">00</span>:<span class="hljs-number">17</span> authorized_keys<br>-rw------- <span class="hljs-number">1</span> root root <span class="hljs-number">1675</span> Jul  <span class="hljs-number">9</span> <span class="hljs-number">20</span>:<span class="hljs-number">54</span> id_rsa<br>-rw-r--r-- <span class="hljs-number">1</span> root root  <span class="hljs-number">392</span> Jul  <span class="hljs-number">9</span> <span class="hljs-number">20</span>:<span class="hljs-number">54</span> id_rsa.pub<br>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">1051</span> Jul <span class="hljs-number">10</span> <span class="hljs-number">00</span>:<span class="hljs-number">16</span> known_hosts<br><br>[root@node1 .ssh]<span class="hljs-comment"># ssh-keygen -p</span><br>Enter file <span class="hljs-keyword">in</span> which the key <span class="hljs-keyword">is</span> (<span class="hljs-regexp">/root/</span>.ssh/id_rsa): <br>Enter <span class="hljs-keyword">new</span> passphrase (empty <span class="hljs-keyword">for</span> <span class="hljs-literal">no</span> passphrase):                   <span class="hljs-regexp">//</span>输入要设置的私钥密码<br>Enter same passphrase again: <br>Your identification has been saved <span class="hljs-keyword">with</span> the <span class="hljs-keyword">new</span> passphrase.<br></code></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">root@node1 .ssh</span>]<span class="hljs-meta"># ssh 192.168.23.102</span><br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;/root/.ssh/id_rsa&#x27;</span>: <br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">09</span>:<span class="hljs-number">12</span>:<span class="hljs-number">46</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.101</span><br>[<span class="hljs-meta">root@node2 ~</span>]<span class="hljs-meta"># ssh 192.168.23.104</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">28</span>:<span class="hljs-number">17</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.102</span><br>[<span class="hljs-meta">root@node4 ~</span>]<span class="hljs-meta"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.104</span> closed.<br>[<span class="hljs-meta">root@node2 ~</span>]<span class="hljs-meta"># ssh 192.168.23.106</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">28</span>:<span class="hljs-number">38</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.105</span><br>[<span class="hljs-meta">root@node6 ~</span>]<span class="hljs-meta"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.106</span> closed.<br>[<span class="hljs-meta">root@node2 ~</span>]<span class="hljs-meta"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.102</span> closed.<br>You have <span class="hljs-keyword">new</span> mail <span class="hljs-keyword">in</span> /<span class="hljs-keyword">var</span>/spool/mail/root<br>[<span class="hljs-meta">root@node1 .ssh</span>]<span class="hljs-meta"># ssh 192.168.23.105</span><br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;/root/.ssh/id_rsa&#x27;</span>:                <span class="hljs-comment">//此时，仍需要输入私钥密码</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">28</span>:<span class="hljs-number">22</span> <span class="hljs-number">2022</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.102</span><br>[<span class="hljs-meta">root@node5 ~</span>]<span class="hljs-meta"># </span><br></code></pre></td></tr></table></figure><p>是每个节点上都要做私钥加密吗？目前测试，只在node1上做了私钥加密，其它节点间还是免密登录。</p><p>代理：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 ~]<span class="hljs-comment"># ssh-agent bash</span><br>[root@node1 ~]<span class="hljs-comment"># ssh-add</span><br>Enter passphrase <span class="hljs-keyword">for</span> <span class="hljs-regexp">/root/</span>.ssh/id_rsa: <br>Identity added: <span class="hljs-regexp">/root/</span>.ssh<span class="hljs-regexp">/id_rsa (/</span>root<span class="hljs-regexp">/.ssh/i</span>d_rsa)<br></code></pre></td></tr></table></figure><p>启动代理之后的使用</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.102</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">33</span> <span class="hljs-number">2022</span> from <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span><br>[root@node2 ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span>.<span class="hljs-number">23.102</span> closed.<br>You have new mail <span class="hljs-keyword">in</span> <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/mail/</span>root<br>[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.104</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">44</span>:<span class="hljs-number">41</span> <span class="hljs-number">2022</span> from <span class="hljs-number">192.168</span>.<span class="hljs-number">23.103</span><br>[root@node4 ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span>.<span class="hljs-number">23.104</span> closed.<br>[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.106</span><br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">44</span>:<span class="hljs-number">08</span> <span class="hljs-number">2022</span> from <span class="hljs-number">192.168</span>.<span class="hljs-number">23.104</span><br>[root@node6 ~]<span class="hljs-comment"># exit</span><br>logout<br>Connection to <span class="hljs-number">192.168</span>.<span class="hljs-number">23.106</span> closed.<br>[root@node1 ~]<span class="hljs-comment"># exit</span><br><span class="hljs-keyword">exit</span><br>You have new mail <span class="hljs-keyword">in</span> <span class="hljs-regexp">/var/</span>spool<span class="hljs-regexp">/mail/</span>root<br>[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.102                   </span><br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;/root/.ssh/id_rsa&#x27;</span>:                   <span class="hljs-regexp">//</span>登出之后，再次ssh时，需要输入私钥<br>Last login: Sat Jul  <span class="hljs-number">9</span> <span class="hljs-number">12</span>:<span class="hljs-number">48</span>:<span class="hljs-number">55</span> <span class="hljs-number">2022</span> from <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span><br>[root@node2 ~]<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>云计算就业-王晓春</category>
      
    </categories>
    
    
    <tags>
      
      <tag>加密安全-ssh基于key验证</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>i6000</title>
    <link href="/2022/07/09/i6000/"/>
    <url>/2022/07/09/i6000/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><p> 利用expect实现ssh key的批量部署</p><figure class="highlight perl"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><pre><code class="hljs perl">[root@node1 test]<span class="hljs-comment"># cat ssh_push_kye_expect.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>COLOR=<span class="hljs-string">&quot;echo -e \E[1;32m&quot;</span><br>END=<span class="hljs-string">&quot;\E[0m&quot;</span><br>PASSWORD=<span class="hljs-string">&quot;New_4&amp;5*oA&quot;</span><br>IPLIST=<span class="hljs-string">&quot;</span><br><span class="hljs-string">192.168.23.102</span><br><span class="hljs-string">192.168.23.103</span><br><span class="hljs-string">192.168.23.104</span><br><span class="hljs-string">192.168.23.105</span><br><span class="hljs-string">192.168.23.106</span><br><span class="hljs-string">&quot;</span><br><br>[ ! -f ~<span class="hljs-regexp">/.ssh/id</span>_rsa ] &amp;&amp; ssh-keygen -P <span class="hljs-string">&quot;&quot;</span> -f ~<span class="hljs-regexp">/.ssh/id</span>_rsa &amp;&gt;<span class="hljs-regexp">/dev/null</span><br>rpm -<span class="hljs-keyword">q</span> expect &amp;&gt; <span class="hljs-regexp">/dev/null</span> || yum -<span class="hljs-keyword">y</span> -<span class="hljs-keyword">q</span> install expect &amp;&gt;<span class="hljs-regexp">/dev/null</span><br><span class="hljs-keyword">for</span> ip in $IPLIST ;<span class="hljs-keyword">do</span><br>&#123;    <br>expect &lt;&lt;EOF<br>set timeout <span class="hljs-number">60</span><br>spawn ssh-copy-id $ip<br>expect &#123;<br>        <span class="hljs-string">&quot;yes/no&quot;</span> &#123; <span class="hljs-keyword">send</span> <span class="hljs-string">&quot;yes\r&quot;</span>;exp_continue &#125;<br>        <span class="hljs-string">&quot;password:&quot;</span> &#123; <span class="hljs-keyword">send</span> <span class="hljs-string">&quot;$PASSWORD\r&quot;</span> &#125;<br>&#125;<br>expect <span class="hljs-keyword">eof</span><br>EOF<br>$COLOR<span class="hljs-string">&quot;$ip is ready&quot;</span>$END<br>&#125;&amp;<br>done<br><span class="hljs-keyword">wait</span><br>$COLOR<span class="hljs-string">&quot;Push ssh key is finished!&quot;</span>$END<br></code></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[root@node1 test]</span># cat hosts.txt <br><span class="hljs-number">192.168.23.102</span><br><span class="hljs-number">192.168.23.103</span><br><span class="hljs-number">192.168.23.104</span><br><span class="hljs-number">192.168.23.105</span><br><span class="hljs-number">192.168.23.106</span><br></code></pre></td></tr></table></figure><p>远程批量执行某一条命令：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[root@node1 test]</span># for i in `cat hosts.txt`;do ssh $i hostname -I;done<br><span class="hljs-number">192.168.23.102</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">23</span>.<span class="hljs-number">4</span> <br><span class="hljs-number">192.168.23.103</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">23</span>.<span class="hljs-number">5</span> <br><span class="hljs-number">192.168.23.104</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">23</span>.<span class="hljs-number">6</span> <br><span class="hljs-number">192.168.23.105</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">23</span>.<span class="hljs-number">7</span> <br><span class="hljs-number">192.168.23.106</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">23</span>.<span class="hljs-number">8</span> <br></code></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 test]<span class="hljs-comment"># for i in `cat hosts.txt`;do ssh $i free -m;done</span><br>              total        used        free      shared  buff/cache   available<br>Mem:           <span class="hljs-number"> 972 </span>       <span class="hljs-number"> 104 </span>       <span class="hljs-number"> 693 </span>         <span class="hljs-number"> 7 </span>       <span class="hljs-number"> 174 </span>        693<br>Swap:         <span class="hljs-number"> 2047 </span>         <span class="hljs-number"> 0 </span>       2047<br>              total        used        free      shared  buff/cache   available<br>Mem:           <span class="hljs-number"> 972 </span>        <span class="hljs-number"> 88 </span>       <span class="hljs-number"> 765 </span>         <span class="hljs-number"> 7 </span>       <span class="hljs-number"> 118 </span>        739<br>Swap:         <span class="hljs-number"> 2047 </span>         <span class="hljs-number"> 0 </span>       2047<br>              total        used        free      shared  buff/cache   available<br>Mem:           <span class="hljs-number"> 972 </span>        <span class="hljs-number"> 86 </span>       <span class="hljs-number"> 766 </span>         <span class="hljs-number"> 7 </span>       <span class="hljs-number"> 119 </span>        740<br>Swap:         <span class="hljs-number"> 2047 </span>         <span class="hljs-number"> 0 </span>       2047<br>              total        used        free      shared  buff/cache   available<br>Mem:           <span class="hljs-number"> 972 </span>        <span class="hljs-number"> 93 </span>       <span class="hljs-number"> 759 </span>         <span class="hljs-number"> 7 </span>       <span class="hljs-number"> 119 </span>        734<br>Swap:         <span class="hljs-number"> 2047 </span>         <span class="hljs-number"> 0 </span>       2047<br>              total        used        free      shared  buff/cache   available<br>Mem:           <span class="hljs-number"> 972 </span>        <span class="hljs-number"> 93 </span>       <span class="hljs-number"> 760 </span>         <span class="hljs-number"> 7 </span>       <span class="hljs-number"> 118 </span>        734<br>Swap:         <span class="hljs-number"> 2047 </span>         <span class="hljs-number"> 0 </span>       2047<br></code></pre></td></tr></table></figure><p>拷贝部署包到其它采集服务器：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata">[root@node1 <span class="hljs-keyword">test</span>]# <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-keyword">cat</span> hosts.txt`;<span class="hljs-keyword">do</span> scp ssh_push_kye_expect.<span class="hljs-keyword">sh</span> <span class="hljs-variable">$i</span>:/<span class="hljs-keyword">test</span>;done<br>ssh_push_kye_expect.<span class="hljs-keyword">sh</span>                                                            100%  567   105.2KB/s   00:00    <br>ssh_push_kye_expect.<span class="hljs-keyword">sh</span>                                                            100%  567   192.7KB/s   00:00    <br>ssh_push_kye_expect.<span class="hljs-keyword">sh</span>                                                            100%  567   106.2KB/s   00:00    <br>ssh_push_kye_expect.<span class="hljs-keyword">sh</span>                                                            100%  567    91.9KB/s   00:00    <br>ssh_push_kye_expect.<span class="hljs-keyword">sh</span>                                                            100%  567    93.1KB/s   00:00    <br></code></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[root@node1 test]</span># for i in `cat hosts.txt`;do scp ssh_push_kye_expect.sh $i:/test &amp;&amp; echo $i is copyed！;done<br>ssh_push_kye_expect.sh                                                                                                                       <span class="hljs-number">100</span>%  <span class="hljs-number">567</span>   <span class="hljs-number">185</span>.1KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>    <br><span class="hljs-number">192.168.23.102</span> is copyed！<br>ssh_push_kye_expect.sh                                                                                                                       <span class="hljs-number">100</span>%  <span class="hljs-number">567</span>   <span class="hljs-number">164</span>.8KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>    <br><span class="hljs-number">192.168.23.103</span> is copyed！<br>ssh_push_kye_expect.sh                                                                                                                       <span class="hljs-number">100</span>%  <span class="hljs-number">567</span>   <span class="hljs-number">291</span>.8KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>    <br><span class="hljs-number">192.168.23.104</span> is copyed！<br>ssh_push_kye_expect.sh                                                                                                                       <span class="hljs-number">100</span>%  <span class="hljs-number">567</span>   <span class="hljs-number">239</span>.9KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>    <br><span class="hljs-number">192.168.23.105</span> is copyed！<br>ssh_push_kye_expect.sh                                                                                                                       <span class="hljs-number">100</span>%  <span class="hljs-number">567</span>   <span class="hljs-number">154</span>.7KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>    <br><span class="hljs-number">192.168.23.106</span> is copyed！<br></code></pre></td></tr></table></figure><h2 id="批量部署采集服务器："><a href="#批量部署采集服务器：" class="headerlink" title="批量部署采集服务器："></a>批量部署采集服务器：</h2><p> 利用expect实现ssh key的批量部署</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@node1 test]<span class="hljs-comment"># cat ssh_push_kye_expect.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>COLOR=<span class="hljs-string">&quot;echo -e \E[1;32m&quot;</span><br>END=<span class="hljs-string">&quot;\E[0m&quot;</span><br>PASSWORD=<span class="hljs-string">&quot;New_4&amp;5*oA&quot;</span><br>IPLIST=<span class="hljs-string">&quot;</span><br><span class="hljs-string">20.2.85.192</span><br><span class="hljs-string">20.2.85.193</span><br><span class="hljs-string">20.2.85.194</span><br><span class="hljs-string">20.2.85.195</span><br><span class="hljs-string">20.2.85.196</span><br><span class="hljs-string">20.2.85.197</span><br><span class="hljs-string">20.2.85.198</span><br><span class="hljs-string">20.2.85.199</span><br><span class="hljs-string">20.2.85.200</span><br><span class="hljs-string">20.2.85.201</span><br><span class="hljs-string">20.2.85.202</span><br><span class="hljs-string">20.2.85.203</span><br><span class="hljs-string">&quot;</span><br><br>[ ! -f ~<span class="hljs-regexp">/.ssh/id</span>_rsa ] &amp;&amp; ssh-keygen -P <span class="hljs-string">&quot;&quot;</span> -f ~<span class="hljs-regexp">/.ssh/id</span>_rsa &amp;&gt;<span class="hljs-regexp">/dev/null</span><br>rpm -<span class="hljs-keyword">q</span> expect &amp;&gt; <span class="hljs-regexp">/dev/null</span> || yum -<span class="hljs-keyword">y</span> -<span class="hljs-keyword">q</span> install expect &amp;&gt;<span class="hljs-regexp">/dev/null</span><br><span class="hljs-keyword">for</span> ip in $IPLIST ;<span class="hljs-keyword">do</span><br>&#123;    <br>expect &lt;&lt;EOF<br>set timeout <span class="hljs-number">60</span><br>spawn ssh-copy-id $ip<br>expect &#123;<br>        <span class="hljs-string">&quot;yes/no&quot;</span> &#123; <span class="hljs-keyword">send</span> <span class="hljs-string">&quot;yes\r&quot;</span>;exp_continue &#125;<br>        <span class="hljs-string">&quot;password:&quot;</span> &#123; <span class="hljs-keyword">send</span> <span class="hljs-string">&quot;$PASSWORD\r&quot;</span> &#125;<br>&#125;<br>expect <span class="hljs-keyword">eof</span><br>EOF<br>$COLOR<span class="hljs-string">&quot;$ip is ready&quot;</span>$END<br>&#125;&amp;<br>done<br><span class="hljs-keyword">wait</span><br>$COLOR<span class="hljs-string">&quot;Push ssh key is finished!&quot;</span>$END<br></code></pre></td></tr></table></figure><p>1、添加要部署的服务器地址</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"> cat hosts.txt <br><span class="hljs-number">20.2.85.192</span><br><span class="hljs-number">20.2.85.193</span><br><span class="hljs-number">20.2.85.194</span><br><span class="hljs-number">20.2.85.195</span><br><span class="hljs-number">20.2.85.196</span><br><span class="hljs-number">20.2.85.197</span><br><span class="hljs-number">20.2.85.198</span><br><span class="hljs-number">20.2.85.199</span><br><span class="hljs-number">20.2.85.200</span><br><span class="hljs-number">20.2.85.201</span><br><span class="hljs-number">20.2.85.202</span><br><span class="hljs-number">20.2.85.203</span><br></code></pre></td></tr></table></figure><p>2、拷贝部署包到各服务器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> hosts.txt`;<span class="hljs-keyword">do</span> scp -rp /home/nms/NmsInsideCollectServer <span class="hljs-variable">$i</span>:/home/nms/ &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> is copyed！;<span class="hljs-keyword">done</span></span><br></code></pre></td></tr></table></figure><p>3、修改start.sh文件中个性配置</p><p>使用wincp，修改start.sh文件中的采集集群和节点。</p><p>4、启动nms服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">cat</span> hosts.txt`;<span class="hljs-keyword">do</span> ssh <span class="hljs-variable">$i</span> /home/nms/NmsInsideCollectServer/stat.sh;<span class="hljs-keyword">done</span></span><br></code></pre></td></tr></table></figure><p>==============</p><p>为防止泄露一台服务器的密码，而导致其它服务器也被暴漏。可对私钥进行加密，并且可以设置代理，每次登录，输入一次私钥密码，后期在登出之前再操作就不用输入私钥的秘密了。</p><p>其他人再次登录时，仍然是需要输入私钥的密码，才可以免密登录其他服务器，这样就提升了安全性。</p>]]></content>
    
    
    <categories>
      
      <category>检修</category>
      
    </categories>
    
    
    <tags>
      
      <tag>批量部署</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第五周作业-2022-7-5</title>
    <link href="/2022/07/05/%E7%AC%AC%E4%BA%94%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-5/"/>
    <url>/2022/07/05/%E7%AC%AC%E4%BA%94%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-7-5/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第十九天、第十六天、第二十天 、第二十一天、第二十二天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>“第十九天：<br>时间同步及自动化部署<br>1、pam实现资源限制和google的MFA验证<br>2、时间同步服务和SELinux安全管理<br>3、自动化运维和光盘启动文件<br>4、系统的自动化安装应答文件制作<br>5、dhcp和tftp服务管理<br>6、基于PXE实现自动化的系统安装<br>7、cobbler实现系统自动化部署”<br>“第二十天：<br>域名系统 DNS服务<br>1、名称解析服务和DNS服务实现原理<br>2、dns服务基础配置实现互联网访问<br>3、实现正向解析dns服务<br>4、实现反向dns解析和从dns服务器<br>5、实现子域委派和转发查询<br>6、GSLB和CDN服务工作原理”<br>“第二十一天：<br>Linux防火墙<br>1、Linux防火墙介绍<br>2、iptables的基本用法<br>3、iptables的扩展模块用法<br>4、iptables的扩展模块用法<br>5、iptables的规则保存和自定义链<br>6、iptables实现网络防火墙<br>7、iptables实现NAT原理和实战”<br>“第二十二天<br> VPN服务<br>1、firewalld和最新技术nft实现防火墙功能<br>2、open-v-p-n介绍和环境准备<br>3、open-v-p-n实现CA证书<br>4、open-v-p-n服务和客户端实现<br>5、open-v-p-n高级管理功能<br>6、阿里云释放资源<br>7、数据库基础原理<br>8、关系型数据库理论”</p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><h2 id="1、搭建chrony服务完成多个主机的时间同步。"><a href="#1、搭建chrony服务完成多个主机的时间同步。" class="headerlink" title="1、搭建chrony服务完成多个主机的时间同步。"></a>1、搭建chrony服务完成多个主机的时间同步。</h2><p>多主机协同工作时，时间同步很重要，各个主机的时间不一致，会造成很多重要应用的故障，如：加密协议，日志，集群等。</p><p>利用NTP（Network Time Protocol） 协议，可使网络中的各个计算机的时间达到同步。目前NTP协议属于运维基础架构中必备的基本服务之一。</p><p>Chrony是实现NTP协议的的自由软件。</p><h3 id="服务器端配置"><a href="#服务器端配置" class="headerlink" title="服务器端配置"></a>服务器端配置</h3><figure class="highlight tap"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># cat /etc/chrony.conf |grep -v ^#</span><br>server 0.centos.pool.ntp.org iburst<br>server 1.centos.pool.ntp.org iburst<br>server 2.centos.pool.ntp.org iburst<br>server 3.centos.pool.ntp.org iburst<br>Server ntp.aliyun.com iburst<br>Server ntp1.aliyun.com iburst<br>Server ntp2.aliyun.com iburst<br><br>driftfile /var/lib/chrony/drift<br><br>makestep 1.0 3<br><br>rtcsync<br><br>allow 192.168.23.0/24               // 指定允许同步的网段<br><br>logdir /var/log/chrony<br>[root@node1 ~]<span class="hljs-comment"># systemctl restart chronyd</span><br>[root@node1 ~]<span class="hljs-comment"># systemctl satus chronyd</span><br>Unknown operation &#x27;satus&#x27;.<br>[root@node1 ~]<span class="hljs-comment"># date</span><br>Tue Jul<span class="hljs-number"> 12 </span>20:59:14 CST 2022<br><br><span class="hljs-comment">#服务启动后会打开端口123/udp</span><br>[root@node1 ~]<span class="hljs-comment"># ss -ntlu</span><br>Netid  State      Recv-Q Send-Q          Local Address:Port                         Peer Address:Port              <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:46551                                   *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:68                                      *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                          *:123                                     *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                  127.0.0.1:323                                     *:*                  <br>udp    UNCONN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>                        ::1:323                                    :::*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>                        *:22                                      *:*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>                127.0.0.1:25                                      *:*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 128 </span>                       :::22                                     :::*                  <br>tcp    LISTEN    <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 100 </span>                      ::1:25                                     :::*            <br>[root@node1 ~]<span class="hljs-comment"># chronyc</span><br>chrony version 3.2<br>Copyright (C) 1997-2003, 2007, 2009-2017 Richard P. Curnow and others<br>chrony comes with ABSOLUTELY NO WARRANTY.  This is free software, and<br>you are welcome to redistribute it under certain conditions.  See the<br>GNU General Public License version<span class="hljs-number"> 2 </span>for details.<br><br>chronyc&gt; clients<br>Hostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last<br>===============================================================================<br>192.168.23.103                <span class="hljs-number"> 10 </span>    <span class="hljs-number"> 0 </span> <span class="hljs-number"> 6 </span>  -   <span class="hljs-number"> 46 </span>     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>  -     -<br>192.168.23.102                 <span class="hljs-number"> 7 </span>    <span class="hljs-number"> 0 </span> <span class="hljs-number"> 6 </span>  -   <span class="hljs-number"> 15 </span>     <span class="hljs-number"> 0 </span>    <span class="hljs-number"> 0 </span>  -     -<br><br><br>Copy<br></code></pre></td></tr></table></figure><h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@node2 ~]<span class="hljs-comment"># grep -v ^# /etc/chrony.conf </span><br>server <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span> iburst <br>driftfile /<span class="hljs-keyword">var</span>/lib/chrony/drift<br>makestep <span class="hljs-number">1.0</span> <span class="hljs-number">3</span><br>rtcsync<br>logdir /<span class="hljs-keyword">var</span>/log/chrony<br>[root@node2 ~]<span class="hljs-comment"># systemctl restart chronyd</span><br>[root@node2 ~]<span class="hljs-comment"># chronyc sources -v</span><br><span class="hljs-number">210</span> <span class="hljs-built_in">Number</span> <span class="hljs-keyword">of</span> sources = <span class="hljs-number">1</span><br><br>  .-- Source mode  <span class="hljs-string">&#x27;^&#x27;</span> = server, <span class="hljs-string">&#x27;=&#x27;</span> = peer, <span class="hljs-string">&#x27;#&#x27;</span> = local clock.<br> / .- Source state <span class="hljs-string">&#x27;*&#x27;</span> = current synced, <span class="hljs-string">&#x27;+&#x27;</span> = combined , <span class="hljs-string">&#x27;-&#x27;</span> = <span class="hljs-keyword">not</span> combined,<br>| /   <span class="hljs-string">&#x27;?&#x27;</span> = unreachable, <span class="hljs-string">&#x27;x&#x27;</span> = time may be <span class="hljs-keyword">in</span> error, <span class="hljs-string">&#x27;~&#x27;</span> = time too variable.<br>||                                                 .- xxxx [ yyyy ] +/- zzzz<br>||      Reachability register (octal) -.           |  xxxx = adjusted offset,<br>||      Log2(Polling interval) --.      |          |  yyyy = measured offset,<br>||                                <span class="hljs-string">\</span>     |          |  zzzz = estimated error.<br>||                                 |    |           <span class="hljs-string">\</span><br>MS Name/IP address         Stratum Poll Reach LastRx Last sample               <br>===============================================================================<br>^* <span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span>                <span class="hljs-number">3</span>   <span class="hljs-number">6</span>    <span class="hljs-number">17</span>    <span class="hljs-number">28</span>    +<span class="hljs-number">14us</span>[  +<span class="hljs-number">11us</span>] +<span class="hljs-regexp">/-   21ms               /</span>/为* 号时，表示跟服务器同步了<br>[root@node2 ~]<span class="hljs-comment"># date</span><br>Tue Jul <span class="hljs-number">12</span> <span class="hljs-number">09</span>:<span class="hljs-number">02</span>:<span class="hljs-number">15</span> EDT <span class="hljs-number">2022</span><br>Copy<br></code></pre></td></tr></table></figure><h3 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h3><p>此时客户端的时间，显示不是24小时制</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:45:07 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">America/New_York</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br><span class="hljs-string">You</span> <span class="hljs-string">have</span> <span class="hljs-string">new</span> <span class="hljs-string">mail</span> <span class="hljs-string">in</span> <span class="hljs-string">/var/spool/mail/root</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl set-timezone Asia/Shanghai</span><br><span class="hljs-string">You</span> <span class="hljs-string">have</span> <span class="hljs-string">new</span> <span class="hljs-string">mail</span> <span class="hljs-string">in</span> <span class="hljs-string">/var/spool/mail/root</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:17 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:17 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:18</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># </span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:29 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># date</span><br><span class="hljs-string">Tue</span> <span class="hljs-string">Jul</span> <span class="hljs-number">12</span> <span class="hljs-number">21</span><span class="hljs-string">:47:33</span> <span class="hljs-string">CST</span> <span class="hljs-number">2022</span><br><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 09:45:07 </span><span class="hljs-string">EDT</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:45:07</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">America/New_York</span> <span class="hljs-string">(EDT,</span> <span class="hljs-number">-0400</span><span class="hljs-string">)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">Last DST change:</span> <span class="hljs-string">DST</span> <span class="hljs-string">began</span> <span class="hljs-string">at</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-03-13 01:59:59 </span><span class="hljs-string">EST</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-03-13 03:00:00 </span><span class="hljs-string">EDT</span><br> <span class="hljs-attr">Next DST change:</span> <span class="hljs-string">DST</span> <span class="hljs-string">ends</span> <span class="hljs-string">(the</span> <span class="hljs-string">clock</span> <span class="hljs-string">jumps</span> <span class="hljs-string">one</span> <span class="hljs-string">hour</span> <span class="hljs-string">backwards)</span> <span class="hljs-string">at</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-11-06 01:59:59 </span><span class="hljs-string">EDT</span><br>                  <span class="hljs-string">Sun</span> <span class="hljs-number">2022-11-06 01:00:00 </span><span class="hljs-string">EST</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl set-timezone Asia/Shanghai         // 修改时区</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:17 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:17 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:18</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># </span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># timedatectl </span><br>      <span class="hljs-attr">Local time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 21:47:29 </span><span class="hljs-string">CST</span><br>  <span class="hljs-attr">Universal time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29 </span><span class="hljs-string">UTC</span><br>        <span class="hljs-attr">RTC time:</span> <span class="hljs-string">Tue</span> <span class="hljs-number">2022-07-12 13:47:29</span><br>       <span class="hljs-attr">Time zone:</span> <span class="hljs-string">Asia/Shanghai</span> <span class="hljs-string">(CST,</span> <span class="hljs-string">+0800)</span><br>     <span class="hljs-attr">NTP enabled:</span> <span class="hljs-literal">yes</span><br><span class="hljs-attr">NTP synchronized:</span> <span class="hljs-literal">yes</span><br> <span class="hljs-attr">RTC in local TZ:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">DST active:</span> <span class="hljs-string">n/a</span><br>[<span class="hljs-string">root@node2</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># date                                         // 修改时区后，变成了正确时间</span><br><span class="hljs-string">Tue</span> <span class="hljs-string">Jul</span> <span class="hljs-number">12</span> <span class="hljs-number">21</span><span class="hljs-string">:47:33</span> <span class="hljs-string">CST</span> <span class="hljs-number">2022</span><br></code></pre></td></tr></table></figure><h2 id="2、自动安装系统"><a href="#2、自动安装系统" class="headerlink" title="2、自动安装系统"></a>2、自动安装系统</h2><!--more--><h3 id="自制光盘方式"><a href="#自制光盘方式" class="headerlink" title="自制光盘方式"></a>自制光盘方式</h3><p>（1）制作引导光盘</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# mount <span class="hljs-regexp">/dev/</span>cdrom <span class="hljs-regexp">/mnt/</span><br>mount: <span class="hljs-regexp">/dev/</span>sr0 is <span class="hljs-keyword">write</span>-<span class="hljs-keyword">protected</span>, mounting <span class="hljs-keyword">read</span>-only<br>[root@node1 ~]# mkdir -p <span class="hljs-regexp">/data/myi</span>so<br>[root@node1 ~]# cp -r <span class="hljs-regexp">/mnt/i</span>solinux<span class="hljs-regexp">/ /</span>data<span class="hljs-regexp">/myiso/</span><br>[root@node1 ~]# tree <span class="hljs-regexp">/data/myi</span>so/<br><span class="hljs-regexp">/data/myi</span>so/<br>└── isolinux<br>    ├── boot.cat<br>    ├── boot.msg<br>    ├── grub.conf<br>    ├── initrd.img<br>    ├── isolinux.bin<br>    ├── isolinux.cfg<br>    ├── memtest<br>    ├── splash.png<br>    ├── TRANS.TBL<br>    ├── vesamenu.c32<br>    └── vmlinuz<br><br><span class="hljs-number">1</span> directory, <span class="hljs-number">11</span> files<br><br>[root@node1 ~]# vim <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/i</span>solinux.cfg <br><br>label linux<br>  menu label ^Install CentOS <span class="hljs-number">7</span><br>  kernel vmlinuz<br>  #<span class="hljs-keyword">append</span> initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet<br>  <span class="hljs-keyword">append</span> initrd=initrd.img text ks=cdrom:/myks.cfg<br></code></pre></td></tr></table></figure><p>（2）创建kickstart应答文件</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[root@node1 ~]<span class="hljs-comment"># vim /root/myks.cfg </span><br><br><span class="hljs-comment">#platform=x86, AMD64, or Intel EM64T</span><br><span class="hljs-comment">#version=DEVEL</span><br><span class="hljs-comment"># Install OS instead of upgrade</span><br>install<br><span class="hljs-comment"># Keyboard layouts</span><br>keyboard &#x27;us&#x27;<br><span class="hljs-comment"># Root password</span><br>rootpw <span class="hljs-params">--plaintext</span> 123456         <span class="hljs-string">//</span> 明文的密码<br><span class="hljs-comment"># System language</span><br>lang en_US<br><span class="hljs-comment"># System authorization information</span><br>auth  <span class="hljs-params">--useshadow</span>  <span class="hljs-params">--passalgo=md5</span><br><span class="hljs-comment"># Use text mode install</span><br>text                            <span class="hljs-string">//</span> 文本安装<br>firstboot <span class="hljs-params">--disable</span><br><span class="hljs-comment"># SELinux configuration</span><br>selinux <span class="hljs-params">--disabled</span>               <span class="hljs-string">//</span> 禁用selinux<br><br><br><span class="hljs-comment"># Firewall configuration</span><br>firewall <span class="hljs-params">--disabled</span>              <span class="hljs-string">//</span> 禁用防火墙<br><span class="hljs-comment"># Network information</span><br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth1</span>   <br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth0</span><br><span class="hljs-comment"># Reboot after installation</span><br>reboot<br><span class="hljs-comment"># System timezone</span><br>timezone Africa/Abidjan<br><span class="hljs-comment"># Use network installation</span><br>url <span class="hljs-params">--url=</span><span class="hljs-string">&quot;http://192.168.23.101/centos/7/os/x86_64/&quot;</span>    <span class="hljs-string">//</span> yum仓库路径<br><span class="hljs-comment"># System bootloader configuration</span><br>bootloader <span class="hljs-params">--append=</span><span class="hljs-string">&quot;net.ifnames=0&quot;</span> <span class="hljs-params">--location=mbr</span>     <span class="hljs-string">//</span> bootloader的内核参数加上了，网卡名称是eth了<br><span class="hljs-comment"># Clear the Master Boot Record</span><br>zerombr<br><span class="hljs-comment"># Partition clearing information</span><br>clearpart <span class="hljs-params">--all</span><br><span class="hljs-comment"># Disk partitioning information</span><br>part / <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=10000</span><br>part <span class="hljs-string">/boot</span> <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=1000</span><br>part swap <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;swap&quot;</span> <span class="hljs-params">--size=2048</span><br><br>%post<br>mkdir <span class="hljs-string">/etc/yum.repos.d/bak</span><br>mv <span class="hljs-string">/etc/yum.repos.d/</span>*<span class="hljs-string">.repo</span> <span class="hljs-string">/etc/yum.repos.d/bak</span><br>cat &gt; <span class="hljs-string">/etc/yum.repos.d/base.repo</span> &lt;&lt;EOF                 <span class="hljs-string">//</span> 在文件中增加了yum配置文件的内容<br>[base]<br>name=CentOS-$releasever - Base<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-$releasever - Updates<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-$releasever - Extras<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-$releasever - Plus<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span><br>gpgcheck=1<br>enabled=0<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br>EOF<br>mkdir <span class="hljs-string">/root/.ssh/</span> -m 700                            <span class="hljs-string">//</span>配置基于key验证登录系统<br>cat &gt; <span class="hljs-string">/root/.ssh/authorized_keys</span> &lt;&lt;EOF<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXHaEV3kmyS7qCYw+OcYjBEAXPJ+CLLB+cI/0Az2sASKXXEMk7KwTHrqgC9YEsDLKn4zMU9i1qt3jzdqExigs8y7S7FAe0xFpkJhumywIMHXKgiYiSSw3mI94hVp3x2recGkMXoQrvaY2iPj3iKBZCINQxQ1+sO+JbLlTEWAH+drwDGuCe+MZGcYYCHJw4f2l+hifhKIGDIFB2/rxvEBG8sqTuZrD5RKeMiTodnJREyf2gchrwMb3fUIu0K3kNafN9eR8IQch3AGoe524k9Rvm0S37iQHOft6jgJI59IHBjDqQQUiLba/FDAo7PaS0rFo2XsAYmQZ0FHLqwvIoAYBH root@node1<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDciEtJ5mQ7qEKcGSkdxYRzl2vsEDaDDo0Xr+QIRm8Fw7YjTK3QClTiAmiKMpxk3hwovxIgtyOGwuu/<span class="hljs-string">/umXdJs3jvUGyaOXx6AOOzF4gvMInA94YBN0OeVFwVdgmxl3BpqIINAeK6</span>+UVeaF2RfP6aiXNNohZ8z5tuKp/3bhpsv9V4G1X8Xff5TXVwlwr6R1IPVxtjoj5CwjmQrgjMmxfPkrlZUKfxtcGHqsg9Q9kCKaa6H9e+Ur9owjiu5xe+dnqxDUbbFa1MsJ9PK9U4PWig1mPuKaExd8TwmTgk50LyYnA4NyDg9rq0j8KmOmjtp1buEpPlxGvYV1/tPxyd3qorqP root@node1<br>EOF<br>chmod 600 <span class="hljs-string">/root/.ssh/authorized_keys</span><br>useradd linux44                                   <span class="hljs-string">//</span> 创建账号<br><span class="hljs-keyword">echo</span> 123456 |passwd <span class="hljs-params">--stdin</span> linux44<br>%end<br><br>%packages<br>@development<br><br>%end<br>[root@node1 ~]<span class="hljs-comment"># ksvalidator ks7.cfg                // 检查是否有语法错误</span><br></code></pre></td></tr></table></figure><p>(3) 生成自制光盘</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-type">##</span>使用<span class="hljs-variable">mkisofs</span>命令生成自制光盘<br><span class="hljs-punctuation">[</span><span class="hljs-variable">root</span><span class="hljs-operator">@</span><span class="hljs-variable">node1</span> <span class="hljs-operator">~</span><span class="hljs-punctuation">]</span><span class="hljs-type">#</span> <span class="hljs-variable">mkisofs</span> <span class="hljs-operator">-</span><span class="hljs-variable">R</span> <span class="hljs-operator">-</span><span class="hljs-variable">J</span> <span class="hljs-operator">-</span><span class="hljs-variable">T</span> <span class="hljs-operator">-</span><span class="hljs-variable">v</span> <span class="hljs-operator">--</span><span class="hljs-variable">no</span><span class="hljs-operator">-</span><span class="hljs-variable">emul</span><span class="hljs-operator">-</span><span class="hljs-variable">boot</span> <span class="hljs-operator">--</span><span class="hljs-variable">boot</span><span class="hljs-operator">-</span><span class="hljs-variable">load</span><span class="hljs-operator">-</span><span class="hljs-variable">size</span> <span class="hljs-number">4</span> <span class="hljs-operator">--</span><span class="hljs-variable">boot</span><span class="hljs-operator">-</span><span class="hljs-variable">info</span><span class="hljs-operator">-</span><span class="hljs-variable">table</span> <span class="hljs-operator">-</span><span class="hljs-variable">V</span> <span class="hljs-string">&quot;Centos 7.6 x86_64 boot&quot;</span> <span class="hljs-operator">-</span><span class="hljs-variable">b</span> <span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">.</span><span class="hljs-variable">bin</span> <span class="hljs-operator">-</span><span class="hljs-variable">c</span> <span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">boot</span><span class="hljs-operator">.</span><span class="hljs-variable">cat</span> <span class="hljs-operator">-</span><span class="hljs-variable">o</span> <span class="hljs-operator">/</span><span class="hljs-variable">root</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">.</span><span class="hljs-variable">iso</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><br><span class="hljs-built_in">I</span><span class="hljs-operator">:</span> <span class="hljs-operator">-</span><span class="hljs-variable">input</span><span class="hljs-operator">-</span><span class="hljs-variable">charset</span> <span class="hljs-variable">not</span> <span class="hljs-variable">specified</span><span class="hljs-operator">,</span> <span class="hljs-variable">using</span> <span class="hljs-variable">utf</span><span class="hljs-operator">-</span><span class="hljs-number">8</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">detected</span> <span class="hljs-variable">in</span> <span class="hljs-variable">locale</span> <span class="hljs-variable">settings</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">genisoimage</span> <span class="hljs-number">1.1</span><span class="hljs-number">.11</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Linux</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">Scanning</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><br><span class="hljs-variable">Scanning</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><br><span class="hljs-variable">Excluded</span> <span class="hljs-variable">by</span> <span class="hljs-variable">match</span><span class="hljs-operator">:</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">boot</span><span class="hljs-operator">.</span><span class="hljs-variable">cat</span><br><span class="hljs-variable">Excluded</span><span class="hljs-operator">:</span> <span class="hljs-operator">/</span><span class="hljs-variable">data</span><span class="hljs-operator">/</span><span class="hljs-variable">myiso</span><span class="hljs-operator">/</span><span class="hljs-variable">isolinux</span><span class="hljs-operator">/</span><span class="hljs-variable">TRANS</span><span class="hljs-operator">.</span><span class="hljs-variable">TBL</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Initial</span> <span class="hljs-variable">Padblock</span>                        <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">0</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Initial</span> <span class="hljs-variable">Padblock</span>                        <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">16</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Primary</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>               <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">16</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Primary</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>               <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Eltorito</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>              <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">17</span><br><span class="hljs-variable">Size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">boot</span> <span class="hljs-variable">image</span> <span class="hljs-variable">is</span> <span class="hljs-number">4</span> <span class="hljs-variable">sectors</span> <span class="hljs-operator">-&gt;</span> <span class="hljs-variable">No</span> <span class="hljs-variable">emulation</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Eltorito</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>              <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">18</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">End</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                   <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">19</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">End</span> <span class="hljs-built_in">Volume</span> <span class="hljs-variable">Descriptor</span>                   <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Version</span> <span class="hljs-variable">block</span>                           <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">20</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Version</span> <span class="hljs-variable">block</span>                           <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span>                              <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">21</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span>                              <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">4</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-variable">path</span> <span class="hljs-variable">table</span>                       <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">25</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-variable">path</span> <span class="hljs-variable">table</span>                       <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">4</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span>                          <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">29</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span>                          <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">2</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Joliet</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">tree</span>                   <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">31</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Joliet</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">tree</span>                   <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">2</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span> <span class="hljs-variable">cleanup</span>                  <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">33</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Directory</span> <span class="hljs-variable">tree</span> <span class="hljs-variable">cleanup</span>                  <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">0</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-built_in">Extension</span> <span class="hljs-variable">record</span>                        <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">33</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Extension</span> <span class="hljs-variable">record</span>                        <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">1</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">The</span> <span class="hljs-built_in">File</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>                             <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">34</span><br> <span class="hljs-number">17.10</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span><span class="hljs-operator">:</span><span class="hljs-number">04</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">34.14</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span><span class="hljs-operator">:</span><span class="hljs-number">06</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">51.24</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span><span class="hljs-operator">:</span><span class="hljs-number">05</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">68.28</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span><span class="hljs-operator">:</span><span class="hljs-number">05</span> <span class="hljs-number">2022</span><br> <span class="hljs-number">85.38</span><span class="hljs-operator">%</span> <span class="hljs-variable">done</span><span class="hljs-operator">,</span> <span class="hljs-variable">estimate</span> <span class="hljs-variable">finish</span> <span class="hljs-variable">Sun</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span><span class="hljs-operator">:</span><span class="hljs-number">05</span> <span class="hljs-number">2022</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">translation</span> <span class="hljs-variable">table</span> <span class="hljs-variable">size</span><span class="hljs-operator">:</span> <span class="hljs-number">4483</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">rockridge</span> <span class="hljs-variable">attributes</span> <span class="hljs-variable">bytes</span><span class="hljs-operator">:</span> <span class="hljs-number">1360</span><br><span class="hljs-built_in">Total</span> <span class="hljs-variable">directory</span> <span class="hljs-variable">bytes</span><span class="hljs-operator">:</span> <span class="hljs-number">2048</span><br><span class="hljs-built_in">Path</span> <span class="hljs-variable">table</span> <span class="hljs-variable">size</span><span class="hljs-punctuation">(</span><span class="hljs-variable">bytes</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> <span class="hljs-number">26</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">The</span> <span class="hljs-built_in">File</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>                             <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">29110</span><br><span class="hljs-variable">Writing</span><span class="hljs-operator">:</span>   <span class="hljs-variable">Ending</span> <span class="hljs-variable">Padblock</span>                         <span class="hljs-variable">Start</span> <span class="hljs-built_in">Block</span> <span class="hljs-number">29144</span><br><span class="hljs-variable">Done</span> <span class="hljs-variable">with</span><span class="hljs-operator">:</span> <span class="hljs-variable">Ending</span> <span class="hljs-variable">Padblock</span>                         <span class="hljs-built_in">Block</span><span class="hljs-punctuation">(</span><span class="hljs-variable">s</span><span class="hljs-punctuation">)</span>    <span class="hljs-number">150</span><br><span class="hljs-built_in">Max</span> <span class="hljs-variable">brk</span> <span class="hljs-variable">space</span> <span class="hljs-variable">used</span> <span class="hljs-number">0</span><br><span class="hljs-number">29294</span> <span class="hljs-variable">extents</span> <span class="hljs-variable">written</span> <span class="hljs-punctuation">(</span><span class="hljs-number">57</span> <span class="hljs-variable">MB</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">You</span> <span class="hljs-variable">have</span> <span class="hljs-variable">new</span> <span class="hljs-variable">mail</span> <span class="hljs-variable">in</span> <span class="hljs-operator">/</span><span class="hljs-variable">var</span><span class="hljs-operator">/</span><span class="hljs-variable">spool</span><span class="hljs-operator">/</span><span class="hljs-variable">mail</span><span class="hljs-operator">/</span><span class="hljs-variable">root</span><br><span class="hljs-punctuation">[</span><span class="hljs-variable">root</span><span class="hljs-operator">@</span><span class="hljs-variable">node1</span> <span class="hljs-operator">~</span><span class="hljs-punctuation">]</span><span class="hljs-type">#</span> <span class="hljs-variable">ll</span><br><span class="hljs-variable">total</span> <span class="hljs-number">58600</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-------.</span> <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span>     <span class="hljs-number">1420</span> <span class="hljs-variable">Jun</span> <span class="hljs-number">29</span> <span class="hljs-number">05</span><span class="hljs-operator">:</span><span class="hljs-number">55</span> <span class="hljs-variable">anaconda</span><span class="hljs-operator">-</span><span class="hljs-variable">ks</span><span class="hljs-operator">.</span><span class="hljs-variable">cfg</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span>  <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span>     <span class="hljs-number">3332</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">16</span> <span class="hljs-number">18</span><span class="hljs-operator">:</span><span class="hljs-number">31</span> <span class="hljs-variable">ks7</span><span class="hljs-operator">.</span><span class="hljs-variable">cfg</span><br><span class="hljs-operator">-</span><span class="hljs-variable">rw</span><span class="hljs-operator">-</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span><span class="hljs-variable">r</span><span class="hljs-operator">--</span>  <span class="hljs-number">1</span> <span class="hljs-variable">root</span> <span class="hljs-variable">root</span> <span class="hljs-number">59994112</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">17</span> <span class="hljs-number">00</span><span class="hljs-operator">:</span><span class="hljs-number">04</span> <span class="hljs-variable">myiso</span><span class="hljs-operator">.</span><span class="hljs-variable">iso</span><br></code></pre></td></tr></table></figure><p>在新建虚拟时选择自制光盘，启动后效果如图</p><p><img src="image-20220717132136349.png" alt="image-20220717132136349"></p><p><img src="image-20220717140332441.png" alt="image-20220717140332441"></p><p>安装异常停止了。</p><h3 id="PXE方式"><a href="#PXE方式" class="headerlink" title="PXE方式"></a>PXE方式</h3><h4 id="（1）安装前准备"><a href="#（1）安装前准备" class="headerlink" title="（1）安装前准备"></a>（1）安装前准备</h4><p>关闭防火墙和SELINUX，关闭Vmware软件中的DHCP服务，DHCP服务器静态IP </p><h4 id="（2）-安装相关软件包并启动服务"><a href="#（2）-安装相关软件包并启动服务" class="headerlink" title="（2） 安装相关软件包并启动服务"></a>（2） 安装相关软件包并启动服务</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@node1 ~]<span class="hljs-comment"># yum -y install httpd tftp-server dhcp syslinux system-config</span><br>[root@node1 ~]<span class="hljs-comment"># systemctl enable --now httpd tftp dhcpd</span><br>注意：由于dhcp还没有配置，此时还无法立即启动<br></code></pre></td></tr></table></figure><h4 id="（3）准备yum源和相关目录"><a href="#（3）准备yum源和相关目录" class="headerlink" title="（3）准备yum源和相关目录"></a>（3）准备yum源和相关目录</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# mkidr -p <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os<span class="hljs-regexp">/x86_64/</span><br>[root@node1 ~]# tree -L <span class="hljs-number">4</span> <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span> <br><span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span><br>└── centos<br>    ├── <span class="hljs-number">6</span><br>    │   └── os<br>    │       └── x86_64<br>    ├── <span class="hljs-number">7</span><br>    │   └── os<br>    │       └── x86_64<br>    └── <span class="hljs-number">8</span><br>        └── os<br>            └── x86_64<br><br><span class="hljs-number">10</span> directories, <span class="hljs-number">0</span> files<br>[root@node1 ~]# vim <span class="hljs-regexp">/etc/</span>fstab <br><span class="hljs-regexp">/dev/</span>cdrom  <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os<span class="hljs-regexp">/x86_64/</span>   iso9660 defaults<span class="hljs-number">0</span> <span class="hljs-number">0</span><br>[root@node1 ~]# mount -a<br>mount: <span class="hljs-regexp">/dev/</span>sr0 is <span class="hljs-keyword">write</span>-<span class="hljs-keyword">protected</span>, mounting <span class="hljs-keyword">read</span>-only<br>[root@node1 ~]# df -h<br>Filesystem                   <span class="hljs-keyword">Size</span>  Used Avail Use% Mounted on<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root       17G  1.7G   16G  10% /</span><br>devtmpfs                     <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                        <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                        <span class="hljs-number">487</span>M   <span class="hljs-number">14</span>M  <span class="hljs-number">473</span>M   <span class="hljs-number">3</span>% /run<br>tmpfs                        <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/</span>sda1                   <span class="hljs-number">1014</span>M  <span class="hljs-number">133</span>M  <span class="hljs-number">882</span>M  <span class="hljs-number">14</span>% /boot<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/vg_data-lv_data  976M  509M  400M  57% /</span>home<br>tmpfs                         <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/</span>sr0                     <span class="hljs-number">4.3</span>G  <span class="hljs-number">4.3</span>G     <span class="hljs-number">0</span> <span class="hljs-number">100</span>% <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>centos<span class="hljs-regexp">/7/</span>os/x86_64<br></code></pre></td></tr></table></figure><p>至此，yum仓库已准备好</p><p><img src="image-20220716160716779-16580239922792.png" alt="image-20220716160716779"></p><h4 id="（4）准备kickstart应答文件"><a href="#（4）准备kickstart应答文件" class="headerlink" title="（4）准备kickstart应答文件"></a>（4）准备kickstart应答文件</h4><p>system-config-kickstart，是一个图形化的工具，可以生成kickstart`配置文件，需要安装一下，100多个包。在linux里打开一个图形界面，在windows系统显示，可以借助Xmanager，先运行Xmanager - Passive后，再执行system-config-kickstart 命令。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 ~]# yum install <span class="hljs-keyword">system</span>-config-kickstart    <br>[root@node1 ~]# <span class="hljs-keyword">system</span>-config-kickstart                // 在linux系统不能直接打开，<br>Could <span class="hljs-keyword">not</span> <span class="hljs-keyword">open</span> display because <span class="hljs-keyword">no</span> X <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> running.<br>Try running <span class="hljs-string">&#x27;system-config-kickstart --help&#x27;</span> <span class="hljs-keyword">for</span> a list <span class="hljs-keyword">of</span> <span class="hljs-keyword">options</span>.<br><br>在linux里打开一个图形界面，在windows系统显示:<br>[root@node1 ~]# export DISPLAY=<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.9</span>:<span class="hljs-number">0.0</span><br>[root@node1 ~]# <span class="hljs-keyword">system</span>-config-kickstart <br>/usr/<span class="hljs-keyword">share</span>/<span class="hljs-keyword">system</span>-config-kickstart/kickstartGui.py:<span class="hljs-number">104</span>: GtkWarning: GtkSpinButton: setting an adjustment <span class="hljs-keyword">with</span> non-zero page size <span class="hljs-keyword">is</span> deprecated<br>  <span class="hljs-type">xml</span> = gtk.glade.XML (&quot;/usr/share/system-config-kickstart/system-config-kickstart.glade&quot;, <span class="hljs-keyword">domain</span>=&quot;system-config-kickstart&quot;)<br>Loaded plugins: fastestmirror<br></code></pre></td></tr></table></figure><p>以下是通过system-config-kickstart的图形化界面，所做的安装系统时的相关配置，可随时保存生成一个.cfg 文件，后续就可以在文件里做配置修改了。</p><p><img src="image-20220716153229566-16580239922791.png" alt="image-20220716153229566"></p><p><img src="image-20220716160913498-16580239922793.png" alt="image-20220716160913498"></p><p><img src="image-20220716161928275-16580239922794.png" alt="image-20220716161928275"></p><p>在图形界面大概配置完成后，保存生成ks7.cfg文件。图形界面修改yum的配置不是很方便，可以继续在文件里做配置修改。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[root@node1 ~]<span class="hljs-comment"># vim /root/ks7.cfg </span><br><br><span class="hljs-comment">#platform=x86, AMD64, or Intel EM64T</span><br><span class="hljs-comment">#version=DEVEL</span><br><span class="hljs-comment"># Install OS instead of upgrade</span><br>install<br><span class="hljs-comment"># Keyboard layouts</span><br>keyboard &#x27;us&#x27;<br><span class="hljs-comment"># Root password</span><br>rootpw <span class="hljs-params">--plaintext</span> 123456         <span class="hljs-string">//</span> 明文的密码<br><span class="hljs-comment"># System language</span><br>lang en_US<br><span class="hljs-comment"># System authorization information</span><br>auth  <span class="hljs-params">--useshadow</span>  <span class="hljs-params">--passalgo=md5</span><br><span class="hljs-comment"># Use text mode install</span><br>text                            <span class="hljs-string">//</span> 文本安装<br>firstboot <span class="hljs-params">--disable</span><br><span class="hljs-comment"># SELinux configuration</span><br>selinux <span class="hljs-params">--disabled</span>               <span class="hljs-string">//</span> 禁用selinux<br><br><br><span class="hljs-comment"># Firewall configuration</span><br>firewall <span class="hljs-params">--disabled</span>              <span class="hljs-string">//</span> 禁用防火墙<br><span class="hljs-comment"># Network information</span><br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth1</span>   <br>network  <span class="hljs-params">--bootproto=dhcp</span> <span class="hljs-params">--device=eth0</span><br><span class="hljs-comment"># Reboot after installation</span><br>reboot<br><span class="hljs-comment"># System timezone</span><br>timezone Africa/Abidjan<br><span class="hljs-comment"># Use network installation</span><br>url <span class="hljs-params">--url=</span><span class="hljs-string">&quot;http://192.168.23.101/centos/7/os/x86_64/&quot;</span>    <span class="hljs-string">//</span> yum仓库路径<br><span class="hljs-comment"># System bootloader configuration</span><br>bootloader <span class="hljs-params">--append=</span><span class="hljs-string">&quot;net.ifnames=0&quot;</span> <span class="hljs-params">--location=mbr</span>     <span class="hljs-string">//</span> bootloader的内核参数加上了，网卡名称是eth了<br><span class="hljs-comment"># Clear the Master Boot Record</span><br>zerombr<br><span class="hljs-comment"># Partition clearing information</span><br>clearpart <span class="hljs-params">--all</span><br><span class="hljs-comment"># Disk partitioning information</span><br>part / <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=10000</span><br>part <span class="hljs-string">/boot</span> <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;xfs&quot;</span> <span class="hljs-params">--size=1000</span><br>part swap <span class="hljs-params">--fstype=</span><span class="hljs-string">&quot;swap&quot;</span> <span class="hljs-params">--size=2048</span><br><br>%post<br>mkdir <span class="hljs-string">/etc/yum.repos.d/bak</span><br>mv <span class="hljs-string">/etc/yum.repos.d/</span>*<span class="hljs-string">.repo</span> <span class="hljs-string">/etc/yum.repos.d/bak</span><br>cat &gt; <span class="hljs-string">/etc/yum.repos.d/base.repo</span> &lt;&lt;EOF                 <span class="hljs-string">//</span> 在文件中增加了yum配置文件的内容<br>[base]<br>name=CentOS-$releasever - Base<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-$releasever - Updates<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-$releasever - Extras<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span><br>gpgcheck=1<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-$releasever - Plus<br>mirrorlist=http:<span class="hljs-string">//mirrorlist.centos.org/</span>?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra<br><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span><br>gpgcheck=1<br>enabled=0<br>gpgkey=file:<span class="hljs-string">///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><br>EOF<br>mkdir <span class="hljs-string">/root/.ssh/</span> -m 700                            <span class="hljs-string">//</span>配置基于key验证登录系统<br>cat &gt; <span class="hljs-string">/root/.ssh/authorized_keys</span> &lt;&lt;EOF<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXHaEV3kmyS7qCYw+OcYjBEAXPJ+CLLB+cI/0Az2sASKXXEMk7KwTHrqgC9YEsDLKn4zMU9i1qt3jzdqExigs8y7S7FAe0xFpkJhumywIMHXKgiYiSSw3mI94hVp3x2recGkMXoQrvaY2iPj3iKBZCINQxQ1+sO+JbLlTEWAH+drwDGuCe+MZGcYYCHJw4f2l+hifhKIGDIFB2/rxvEBG8sqTuZrD5RKeMiTodnJREyf2gchrwMb3fUIu0K3kNafN9eR8IQch3AGoe524k9Rvm0S37iQHOft6jgJI59IHBjDqQQUiLba/FDAo7PaS0rFo2XsAYmQZ0FHLqwvIoAYBH root@node1<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDciEtJ5mQ7qEKcGSkdxYRzl2vsEDaDDo0Xr+QIRm8Fw7YjTK3QClTiAmiKMpxk3hwovxIgtyOGwuu/<span class="hljs-string">/umXdJs3jvUGyaOXx6AOOzF4gvMInA94YBN0OeVFwVdgmxl3BpqIINAeK6</span>+UVeaF2RfP6aiXNNohZ8z5tuKp/3bhpsv9V4G1X8Xff5TXVwlwr6R1IPVxtjoj5CwjmQrgjMmxfPkrlZUKfxtcGHqsg9Q9kCKaa6H9e+Ur9owjiu5xe+dnqxDUbbFa1MsJ9PK9U4PWig1mPuKaExd8TwmTgk50LyYnA4NyDg9rq0j8KmOmjtp1buEpPlxGvYV1/tPxyd3qorqP root@node1<br>EOF<br>chmod 600 <span class="hljs-string">/root/.ssh/authorized_keys</span><br>useradd linux44                                   <span class="hljs-string">//</span> 创建账号<br><span class="hljs-keyword">echo</span> 123456 |passwd <span class="hljs-params">--stdin</span> linux44<br>%end<br><br>%packages<br>@development<br><br>%end<br>[root@node1 ~]<span class="hljs-comment"># ksvalidator ks7.cfg                // 检查是否有语法错误</span><br></code></pre></td></tr></table></figure><p>应答文件中有语法错误的范例：</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs julia">[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># ksvalidator ks7.cfg </span><br>The following problem occurred on line <span class="hljs-number">89</span> of the kickstart file:<br><br>Section %post does not <span class="hljs-keyword">end</span> with %<span class="hljs-keyword">end</span>.<br><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -5 ks7.cfg </span><br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -7 ks7.cfg </span><br>useradd <span class="hljs-number">123456</span> |passwd --<span class="hljs-literal">stdin</span> linux44<br><span class="hljs-keyword">end</span>                                         // 前面少了一个%<br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># vim ks7.cfg </span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># tail -7 ks7.cfg </span><br>useradd <span class="hljs-number">123456</span> |passwd --<span class="hljs-literal">stdin</span> linux44<br>%<span class="hljs-keyword">end</span><br><br>%packages<br><span class="hljs-meta">@development</span><br><br>%<span class="hljs-keyword">end</span><br>[root<span class="hljs-meta">@node1</span> ~]<span class="hljs-comment"># ksvalidator ks7.cfg            // 加上之后，在检查就没有报错了。</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[root@node1 ~]</span># ll /<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/ks/<br>total <span class="hljs-number">4</span><br>-rw-r<span class="hljs-attr">--r--</span> <span class="hljs-number">1</span> root root <span class="hljs-number">3335</span> Jul <span class="hljs-number">16</span> <span class="hljs-number">18</span>:<span class="hljs-number">02</span> ks7.cfg<br></code></pre></td></tr></table></figure><p><img src="image-20220716180339254-16580239922805.png" alt="image-20220716180339254"></p><p>保证应答文件能访问</p><p><img src="image-20220716180453972-16580239922806.png" alt="image-20220716180453972"></p><p><img src="image-20220716180526477-16580239922807.png" alt="image-20220716180526477"></p><h4 id="（5）准备PXE启动相关文件"><a href="#（5）准备PXE启动相关文件" class="headerlink" title="（5）准备PXE启动相关文件"></a>（5）准备PXE启动相关文件</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# mkdir <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span>pxelinux.cfg/<br>[root@node1 ~]# cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/syslinux/</span>&#123;pxelinux.<span class="hljs-number">0</span>,menu.c32&#125; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span> <br>[root@node1 ~]# cp <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/</span>&#123;vmlinuz,initrd.img&#125; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>[root@node1 ~]# cp <span class="hljs-regexp">/data/myi</span>so<span class="hljs-regexp">/isolinux/</span><span class="hljs-regexp">/isolinux.cfg /</span>var<span class="hljs-regexp">/lib/</span>tftpboot<span class="hljs-regexp">/pxelinux.cfg/</span><span class="hljs-keyword">default</span><br>[root@node1 ~]# ll <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>total <span class="hljs-number">57928</span><br>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">52584760</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">18</span> initrd.img<br>-rw-r--r-- <span class="hljs-number">1</span> root root    <span class="hljs-number">55140</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">15</span> menu.c32<br>-rw-r--r-- <span class="hljs-number">1</span> root root    <span class="hljs-number">26759</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">15</span> pxelinux.<span class="hljs-number">0</span><br>drwxr-xr-x <span class="hljs-number">2</span> root root       <span class="hljs-number">21</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">19</span> pxelinux.cfg<br>-rwxr-xr-x <span class="hljs-number">1</span> root root  <span class="hljs-number">6639904</span> Jul <span class="hljs-number">17</span> <span class="hljs-number">01</span>:<span class="hljs-number">18</span> vmlinuz<br>[root@node1 ~]# tree <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>├── initrd.img<br>├── menu.c32<br>├── pxelinux.<span class="hljs-number">0</span><br>├── pxelinux.cfg<br>│   └── <span class="hljs-keyword">default</span><br>└── vmlinuz<br><br><span class="hljs-number">1</span> directory, <span class="hljs-number">5</span> files<br></code></pre></td></tr></table></figure><h4 id="（6）准备启动菜单"><a href="#（6）准备启动菜单" class="headerlink" title="（6）准备启动菜单"></a>（6）准备启动菜单</h4><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs delphi">[root@node1 ~]# Vim /<span class="hljs-keyword">var</span>/lib/tftpboot/pxelinux.cfg/<span class="hljs-keyword">default</span><br><span class="hljs-keyword">default</span> menu.c32<br>timeout <span class="hljs-number">600</span><br>menu title PXE INSTALL MENU<br><span class="hljs-keyword">label</span> auto<br> menu <span class="hljs-keyword">label</span> ^Auto Install CentOS <span class="hljs-number">7</span><br> kernel vmlinuz<br> append initrd=initrd.img ks=http:<span class="hljs-comment">//192.168.23.101/ks/centos7.cfg </span><br><span class="hljs-keyword">label</span> manual<br> menu <span class="hljs-keyword">label</span> ^Manual Install CentOS <span class="hljs-number">7</span><br> kernel vmlinuz<br> append initrd=initrd.img inst.repo=http:<span class="hljs-comment">//192.168.23.101/centos/7/os/x86_64</span><br><span class="hljs-keyword">label</span> <span class="hljs-keyword">local</span>   <br>   menu <span class="hljs-keyword">default</span> <br>   menu <span class="hljs-keyword">label</span> ^Boot from <span class="hljs-keyword">local</span> drive<br>   localboot <span class="hljs-number">0</span>xffff<br><br></code></pre></td></tr></table></figure><h4 id="（7）配置DHCP服务"><a href="#（7）配置DHCP服务" class="headerlink" title="（7）配置DHCP服务"></a>（7）配置DHCP服务</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># DHCP服务器配置文件<br>[root@node1 ks]# vim <span class="hljs-regexp">/etc/</span>dhcp/dhcpd.conf <br>#<br># DHCP Server Configuration <span class="hljs-keyword">file</span>.<br>#   see <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>dhcp*/dhcpd.conf.example<br>#   see dhcpd.conf(<span class="hljs-number">5</span>) man page<br>#<br>option domain-name <span class="hljs-string">&quot;magedu.org&quot;</span>;<br><span class="hljs-keyword">default</span>-lease-time <span class="hljs-number">600</span>;<br>max-lease-time <span class="hljs-number">7200</span>;<br>subnet <span class="hljs-number">10.0</span>.<span class="hljs-number">23.0</span> netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> &#123;<br>        range <span class="hljs-number">10.0</span>.<span class="hljs-number">23.100</span> <span class="hljs-number">10.0</span>.<span class="hljs-number">23.150</span>;<br>        option routers <span class="hljs-number">10.0</span>.<span class="hljs-number">23.254</span>;<br>        <span class="hljs-keyword">next</span>-server <span class="hljs-number">10.0</span>.<span class="hljs-number">23.101</span>;            <span class="hljs-comment">// TFTP服务器地址，提供引导文件</span><br>        filename <span class="hljs-string">&quot;pxelinux.0&quot;</span>;              <span class="hljs-comment">// bootloader启动文件的名称</span><br>&#125;<br><br>[root@node1 ks]# service dhcpd start<br>\Redirecting to <span class="hljs-regexp">/bin/</span>systemctl start dhcpd.service<br>[root@node1 ks]# service dhcpd status<br>Redirecting to <span class="hljs-regexp">/bin/</span>systemctl status dhcpd.service<br>● dhcpd.service - DHCPv4 Server Daemon<br>   Loaded: loaded (<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/dhcpd.service; enabled; vendor preset: disabled)<br>   Active: active (running) since Sun <span class="hljs-number">2022</span>-<span class="hljs-number">07</span>-<span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> CST; <span class="hljs-number">5</span>s ago<br>     Docs: man:dhcpd(<span class="hljs-number">8</span>)<br>           man:dhcpd.conf(<span class="hljs-number">5</span>)<br> Main PID: <span class="hljs-number">8185</span> (dhcpd)<br>   Status: <span class="hljs-string">&quot;Dispatching packets...&quot;</span><br>   CGroup: <span class="hljs-regexp">/system.slice/</span>dhcpd.service<br>           └─<span class="hljs-number">8185</span> <span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/dhcpd -f -cf /</span>etc<span class="hljs-regexp">/dhcp/</span>dhcpd.conf -user dhcpd -<span class="hljs-keyword">group</span> dhcpd --no-pid<br><br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: nt<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: nt<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: No subnet declaration <span class="hljs-keyword">for</span> eth0 (<span class="hljs-number">192.168</span>.<span class="hljs-number">23.101</span>).<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: ** Ignoring requests on eth0.  <span class="hljs-keyword">If</span> <span class="hljs-keyword">this</span> is not what<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]:    you want, please <span class="hljs-keyword">write</span> a subnet declaration<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]:    in your dhcpd.conf <span class="hljs-keyword">file</span> <span class="hljs-keyword">for</span> the network segment<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]:    to which <span class="hljs-keyword">interface</span> eth0 is attached. **<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: nt<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 dhcpd[<span class="hljs-number">8185</span>]: Sending on   Socket<span class="hljs-regexp">/fallback/</span>fallback-net<br>Jul <span class="hljs-number">17</span> <span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span> node1 systemd[<span class="hljs-number">1</span>]: Started DHCPv4 Server Daemon.<br></code></pre></td></tr></table></figure><h4 id="（8）试客户端基于PXE实现自动安装"><a href="#（8）试客户端基于PXE实现自动安装" class="headerlink" title="（8）试客户端基于PXE实现自动安装"></a>（8）试客户端基于PXE实现自动安装</h4><p><img src="image-20220716181130801-16580239922808.png" alt="image-20220716181130801"></p><p><img src="image-20220716183850547-165802399228010.png" alt="image-20220716183850547"></p><p>这时候会自动通过网络，从搭建的服务器上下载应答文件，从而自动安装系统。</p><p><img src="image-20220716181520061-16580239922809.png" alt="image-20220716181520061"></p><h4 id="（8）系统启动后，环境验证"><a href="#（8）系统启动后，环境验证" class="headerlink" title="（8）系统启动后，环境验证"></a>（8）系统启动后，环境验证</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pf">[root@node1 ~]<span class="hljs-comment"># ssh 192.168.23.10</span><br>The authenticity of host &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span> (<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>)&#x27; can&#x27;t be established.<br>ECDSA key fingerprint is SHA256:XaE+xPJC5Wg+o+<span class="hljs-number">2</span>/c27tNKbZSJ7iQbKzUZrFv23mMVs.<br>ECDSA key fingerprint is MD5:<span class="hljs-number">6</span>b:f8:<span class="hljs-number">30</span>:<span class="hljs-number">77</span>:<span class="hljs-number">62</span>:<span class="hljs-number">6</span>f:<span class="hljs-number">3</span>d:<span class="hljs-number">22</span>:<span class="hljs-number">3</span>c:<span class="hljs-number">5</span>a:e3:<span class="hljs-number">8</span>d:<span class="hljs-number">6</span>a:<span class="hljs-number">5</span>f:<span class="hljs-number">89</span>:<span class="hljs-number">07</span>.<br>Are you sure you want <span class="hljs-keyword">to</span> continue connecting (yes/<span class="hljs-keyword">no</span>)? yes<br>Warning: Permanently added &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>&#x27; (ECDSA) <span class="hljs-keyword">to</span> the list of known hosts.<br>Last login: Sat Jul <span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">00</span>:<span class="hljs-number">26</span> <span class="hljs-number">2022</span><br>[root@localhost ~]<span class="hljs-comment"># ip a</span><br><span class="hljs-number">1</span>: lo: <span class="hljs-variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">65536</span> qdisc noqueue <span class="hljs-keyword">state</span> UNKNOWN <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    <span class="hljs-keyword">inet6</span> ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: <span class="hljs-variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">1500</span> qdisc pfifo_fast <span class="hljs-keyword">state</span> UP <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">04</span>:<span class="hljs-number">96</span>:b8 brd ff:ff:ff:ff:ff:ff<br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.10</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168</span>.<span class="hljs-number">23.255</span> scope <span class="hljs-keyword">global</span> noprefixroute dynamic eth0<br>       valid_lft <span class="hljs-number">1575</span>sec preferred_lft <span class="hljs-number">1575</span>sec<br>    <span class="hljs-keyword">inet6</span> fe80::cbf8:<span class="hljs-number">3</span>ae0:<span class="hljs-number">364</span>f:<span class="hljs-number">527</span>e/<span class="hljs-number">64</span> scope link noprefixroute <br>       valid_lft forever preferred_lft forever<br>[root@localhost ~]<span class="hljs-comment"># getenforce</span><br>Disabled<br>[root@localhost ~]<span class="hljs-comment"># cat /etc/selinux/config |grep SELINUX</span><br><span class="hljs-comment"># SELINUX= can take one of these three values:</span><br>SELINUX=disabled<br><span class="hljs-comment"># SELINUXTYPE= can take one of three values:</span><br>SELINUXTYPE=targeted<br>[root@localhost ~]<span class="hljs-comment"># service status firewalld</span><br>The service command supports only <span class="hljs-keyword">basic</span> LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try <span class="hljs-keyword">to</span> use systemctl.<br>[root@localhost ~]<span class="hljs-comment"># systemctl status firewalld</span><br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br>[root@localhost ~]<span class="hljs-comment"># service firewalld status</span><br>Redirecting <span class="hljs-keyword">to</span> /bin/systemctl status firewalld.service<br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br>[root@localhost ~]<span class="hljs-comment"># id linux44</span><br>uid=<span class="hljs-number">1000</span>(linux44) gid=<span class="hljs-number">1000</span>(linux44) groups=<span class="hljs-number">1000</span>(linux44)<br></code></pre></td></tr></table></figure><h3 id="Cobbler方式"><a href="#Cobbler方式" class="headerlink" title="Cobbler方式"></a>Cobbler方式</h3><p>Cobbler实质是PXE的二次封装，将多种安装参数封装到一起，并提供统一的管理方法。</p><p>CentOS8没有提供cobbler相关包。</p><h4 id="（1）环境准备"><a href="#（1）环境准备" class="headerlink" title="（1）环境准备"></a>（1）环境准备</h4><p>两台主机<br>一台主机：CentOS 7 充当 Cobbler，http，dhcp，tftp 服务器，并关闭防火墙和SELinux<br>一台主机：充当测试机，用于实现自动化安装Linux系统<br>网络要求：关闭Vmware软件中的NAT模式中的DHCP服务，两个主机网卡基于NAT模式</p><h4 id="（2）安装Cobbler及其相关的服务和组件"><a href="#（2）安装Cobbler及其相关的服务和组件" class="headerlink" title="（2）安装Cobbler及其相关的服务和组件"></a>（2）安装Cobbler及其相关的服务和组件</h4><p>Cobbler所依赖的服务包括HTTPD,TFTP,DHCP等，如果有web界面要求，还需要安装相关的组件 CentOS 8 目前还没有提供Cobbler相关包</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node2 ~]<span class="hljs-comment"># yum install dhcp cobbler cobbler-web pykickstart -y</span><br>[root@node2 ~]<span class="hljs-comment"># systemctl enable --now cobblerd httpd tftp dhcpd</span><br>Created symlink from <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/cobblerd.service to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>cobblerd.service.<br>Created symlink from <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/httpd.service to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>httpd.service.<br>Created symlink from <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>sockets.target.wants<span class="hljs-regexp">/tftp.socket to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>tftp.socket.<br>Created symlink from <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/dhcpd.service to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>dhcpd.service.<br>Job <span class="hljs-keyword">for</span> dhcpd.service failed because the control process exited with error code. See <span class="hljs-string">&quot;systemctl status dhcpd.service&quot;</span> and <span class="hljs-string">&quot;journalctl -xe&quot;</span> <span class="hljs-keyword">for</span> details.<br></code></pre></td></tr></table></figure><p>相关包说明</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">httpd：提供yum源，并配合cobbler-web使得cobbler可以通过web网页界面进行配置管理<br>tftp-server：提供启动和菜单等相关文件网络下载功能<br>cobbler-web : 提供基于web的cobbler管理界面<br>pykickstart.noarch : 基于python的管理kickstart文件的库<br>说明：<br>Cobbler依赖于epel源，在安装cobbler之前需要配置epel源<br>[root@centos7 ~]<span class="hljs-comment">#yum -y install dhcp cobbler cobbler-web pykickstart </span><br>[root@centos7 ~]<span class="hljs-comment">#systemctl enable --now cobblerd httpd tftp dhcpd </span><br>在安装cobbler时会自因为依赖而安装httpd,tftp-server相关包<br></code></pre></td></tr></table></figure><h4 id="（3）修改cobbler相关的配置"><a href="#（3）修改cobbler相关的配置" class="headerlink" title="（3）修改cobbler相关的配置"></a>（3）修改cobbler相关的配置</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@node2 ~]# cobbler check<br>The following are potential configuration <span class="hljs-built_in">items</span> that you may want <span class="hljs-keyword">to</span> <span class="hljs-keyword">fix</span>:<br><br><span class="hljs-number">1</span> : The <span class="hljs-string">&#x27;server&#x27;</span> field in /etc/cobbler/settings must <span class="hljs-keyword">be</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> something other than localhost, <span class="hljs-built_in">or</span> kickstarting features will not work.  This should <span class="hljs-keyword">be</span> <span class="hljs-keyword">a</span> resolvable <span class="hljs-built_in">hostname</span> <span class="hljs-built_in">or</span> IP <span class="hljs-keyword">for</span> the boot server <span class="hljs-keyword">as</span> reachable by <span class="hljs-keyword">all</span> machines that will use it.<br><span class="hljs-number">2</span> : For PXE <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> functional, the <span class="hljs-string">&#x27;next_server&#x27;</span> field in /etc/cobbler/settings must <span class="hljs-keyword">be</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> something other than <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>, <span class="hljs-built_in">and</span> should <span class="hljs-keyword">match</span> the IP of the boot server <span class="hljs-keyword">on</span> the PXE network.<br><span class="hljs-number">3</span> : <span class="hljs-keyword">change</span> <span class="hljs-string">&#x27;disable&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;no&#x27;</span> in /etc/xinetd.d/tftp<br><span class="hljs-number">4</span> : Some network boot-loaders are missing from /var/lib/cobbler/loaders.  If you <span class="hljs-keyword">only</span> want <span class="hljs-keyword">to</span> handle x86/x86_64 netbooting, you may ensure that you have installed <span class="hljs-keyword">a</span> *recent* <span class="hljs-keyword">version</span> of the syslinux package installed <span class="hljs-built_in">and</span> can ignore this message entirely.  Files in this directory, should you want <span class="hljs-keyword">to</span> support <span class="hljs-keyword">all</span> architectures, should include pxelinux.<span class="hljs-number">0</span>, <span class="hljs-keyword">menu</span>.c32, elilo.efi, <span class="hljs-built_in">and</span> yaboot.<br><span class="hljs-number">5</span> : enable <span class="hljs-built_in">and</span> start rsyncd.service with systemctl<br><span class="hljs-number">6</span> : debmirror package <span class="hljs-keyword">is</span> not installed, it will <span class="hljs-keyword">be</span> required <span class="hljs-keyword">to</span> manage debian deployments <span class="hljs-built_in">and</span> repositories<br><span class="hljs-number">7</span> : The default password used by the sample templates <span class="hljs-keyword">for</span> newly installed machines (default_password_crypted in /etc/cobbler/settings) <span class="hljs-keyword">is</span> still <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;cobbler&#x27;</span> <span class="hljs-built_in">and</span> should <span class="hljs-keyword">be</span> changed, <span class="hljs-keyword">try</span>: <span class="hljs-string">&quot;openssl passwd -1 -salt &#x27;random-phrase-here&#x27; &#x27;your-password-here&#x27;&quot;</span> <span class="hljs-keyword">to</span> generate <span class="hljs-keyword">new</span> one<br><span class="hljs-number">8</span> : fencing tools were not found, <span class="hljs-built_in">and</span> are required <span class="hljs-keyword">to</span> use the (optional) power management features. install cman <span class="hljs-built_in">or</span> fence-agents <span class="hljs-keyword">to</span> use them<br><br>Restart cobblerd <span class="hljs-built_in">and</span> then run <span class="hljs-string">&#x27;cobbler sync&#x27;</span> <span class="hljs-keyword">to</span> apply <span class="hljs-keyword">changes</span>.<br><br>#生成新密码，默认安装好的系统root密码为cobbler<br>[root@node2 ~]# openssl passwd -<span class="hljs-number">1</span> <span class="hljs-string">&#x27;magedu&#x27;</span><br>$<span class="hljs-number">1</span>$MtMo9VRb$moWvGZeA5KGhGy8UjcS0O/<br><br>#根据以上提示，只需要做<span class="hljs-number">1</span>，<span class="hljs-number">2</span>，<span class="hljs-number">8</span>这三项即可，修改下面四行<br>[root@centos7 ~]#vim /etc/cobbler/settings <br>default_password_crypted: <span class="hljs-string">&quot;$1$MtMo9VRb$moWvGZeA5KGhGy8UjcS0O/&quot;</span><br>next_server：<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>           //  &lt; tftp服务器的 IP 地址&gt;<br>server：：<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>              // &lt;cobbler服务器的 IP 地址&gt;<br>manage_dhcp：<span class="hljs-number">1</span>                   // 设置为<span class="hljs-number">1</span>，表示通过cobbler生成dhcpd.<span class="hljs-keyword">conf</span>配置文件<br>pxe_just_once: <span class="hljs-number">1</span>                 // 设置为<span class="hljs-number">1</span>,防止重复安装系统<br>[root@centos7 ~]#systemctl restart cobblerd <br></code></pre></td></tr></table></figure><p>（4）实现DHCP服务</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#修改dhcp的模版文件下面的行，用来生成dhcp的配置文件</span><br>subnet <span class="hljs-number">192.168</span>.<span class="hljs-number">23.0</span> netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> &#123;<br>     option routers             <span class="hljs-number">192.168</span>.<span class="hljs-number">23.254</span>;<br>     option domain-name-servers <span class="hljs-number">192.168</span>.<span class="hljs-number">23.1</span>;<br>     option subnet-mask         <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span>;<br>     range dynamic-bootp        <span class="hljs-number">192.168</span>.<span class="hljs-number">23.100</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">23.200</span>;<br>[root@node2 ~]<span class="hljs-comment"># less /etc/dhcp/dhcpd.conf </span><br><br><span class="hljs-comment">#自动生成dhcp配置文件并启动</span><br>[root@node2 ~]<span class="hljs-comment"># cobbler sync</span><br>task started: <span class="hljs-number">2022</span>-<span class="hljs-number">07</span>-<span class="hljs-number">17</span>_235413_sync<br>task started (id=Sync, time=Sun Jul <span class="hljs-number">17</span> <span class="hljs-number">23</span>:<span class="hljs-number">54</span>:<span class="hljs-number">13</span> <span class="hljs-number">2022</span>)<br>running pre-sync triggers<br>cleaning trees<br>removing: <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/g</span>rub/images<br>copying bootloaders<br>trying hardlink <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/syslinux/</span>pxelinux.<span class="hljs-number">0</span> -&gt; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span>pxelinux.<span class="hljs-number">0</span><br>trying hardlink <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/syslinux/m</span>enu.c32 -&gt; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/m</span>enu.c32<br>trying hardlink <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/syslinux/m</span>emdisk -&gt; <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/m</span>emdisk<br>copying distros to tftpboot<br>copying images<br>generating PXE configuration files<br>generating PXE menu structure<br>rendering DHCP files<br>generating <span class="hljs-regexp">/etc/</span>dhcp/dhcpd.conf<br>rendering TFTPD files<br>generating <span class="hljs-regexp">/etc/</span>xinetd.d/tftp<br>cleaning link caches<br>running post-sync triggers<br>running python triggers from <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cobbler/</span>triggers<span class="hljs-regexp">/sync/</span>post/*<br>running python trigger cobbler.modules.sync_post_restart_services<br>running: dhcpd -t -q<br>received on stdout: <br>received on stderr: <br>running: service dhcpd restart<br>received on stdout: <br>received on stderr: Redirecting to <span class="hljs-regexp">/bin/</span>systemctl restart dhcpd.service<br><br>running shell triggers from <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cobbler/</span>triggers<span class="hljs-regexp">/sync/</span>post/*<br>running python triggers from <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cobbler/</span>triggers<span class="hljs-regexp">/change/</span>*<br>running python trigger cobbler.modules.manage_genders<br>running python trigger cobbler.modules.scm_track<br>running shell triggers from <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cobbler/</span>triggers<span class="hljs-regexp">/change/</span>*<br>*** TASK COMPLETE ***<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node2 ~]# cat /etc/dhcp/dhcpd.conf <br># ******************************************************************<br># Cobbler managed dhcpd.conf file<br># <span class="hljs-keyword">generated</span> <span class="hljs-keyword">from</span> cobbler dhcp.conf <span class="hljs-keyword">template</span> (Sun Jul <span class="hljs-number">17</span> <span class="hljs-number">15</span>:<span class="hljs-number">54</span>:<span class="hljs-number">14</span> <span class="hljs-number">2022</span>)<br># <span class="hljs-keyword">Do</span> <span class="hljs-keyword">NOT</span> make changes <span class="hljs-keyword">to</span> /etc/dhcpd.conf. <span class="hljs-keyword">Instead</span>, make your changes<br># <span class="hljs-keyword">in</span> /etc/cobbler/dhcp.<span class="hljs-keyword">template</span>, <span class="hljs-keyword">as</span> /etc/dhcpd.conf will be<br># overwritten.<br># ******************************************************************<br><br>ddns-<span class="hljs-keyword">update</span>-style interim;<br><br>allow booting;<br>allow bootp;<br><br>ignore client-updates;<br><span class="hljs-keyword">set</span> vendorclass = <span class="hljs-keyword">option</span> vendor-<span class="hljs-keyword">class</span>-identifier;<br><br><span class="hljs-keyword">option</span> pxe-<span class="hljs-keyword">system</span>-<span class="hljs-keyword">type</span> code <span class="hljs-number">93</span> = unsigned <span class="hljs-type">integer</span> <span class="hljs-number">16</span>;<br><br>subnet <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.0</span> netmask <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span> &#123;<br>     <span class="hljs-keyword">option</span> routers             <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.254</span>;<br>     <span class="hljs-keyword">option</span> <span class="hljs-keyword">domain</span>-<span class="hljs-type">name</span>-servers <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.1</span>;<br>     <span class="hljs-keyword">option</span> subnet-mask         <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span>;<br>     range dynamic-bootp        <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.100</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.200</span>;<br>     <span class="hljs-keyword">default</span>-lease-<span class="hljs-type">time</span>         <span class="hljs-number">21600</span>;<br>     max-lease-<span class="hljs-type">time</span>             <span class="hljs-number">43200</span>;<br>     next-<span class="hljs-keyword">server</span>                <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>;<br>     <span class="hljs-keyword">class</span> &quot;pxeclients&quot; &#123;<br>          match <span class="hljs-keyword">if</span> substring (<span class="hljs-keyword">option</span> vendor-<span class="hljs-keyword">class</span>-identifier, <span class="hljs-number">0</span>, <span class="hljs-number">9</span>) = &quot;PXEClient&quot;;<br>          <span class="hljs-keyword">if</span> <span class="hljs-keyword">option</span> pxe-<span class="hljs-keyword">system</span>-<span class="hljs-keyword">type</span> = <span class="hljs-number">00</span>:<span class="hljs-number">02</span> &#123;<br>                  filename &quot;ia64/elilo.efi&quot;;<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">option</span> pxe-<span class="hljs-keyword">system</span>-<span class="hljs-keyword">type</span> = <span class="hljs-number">00</span>:<span class="hljs-number">06</span> &#123;<br>                  filename &quot;grub/grub-x86.efi&quot;;<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">option</span> pxe-<span class="hljs-keyword">system</span>-<span class="hljs-keyword">type</span> = <span class="hljs-number">00</span>:<span class="hljs-number">07</span> &#123;<br>                  filename &quot;grub/grub-x86_64.efi&quot;;<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">option</span> pxe-<span class="hljs-keyword">system</span>-<span class="hljs-keyword">type</span> = <span class="hljs-number">00</span>:<span class="hljs-number">09</span> &#123;<br>                  filename &quot;grub/grub-x86_64.efi&quot;;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>                  filename &quot;pxelinux.0&quot;;<br>          &#125;<br>     &#125;<br><br>&#125;<br><br># <span class="hljs-keyword">group</span> <span class="hljs-keyword">for</span> Cobbler DHCP tag: <span class="hljs-keyword">default</span><br><span class="hljs-keyword">group</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>（4） 下载启动的相关文件</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">[<span class="hljs-string">root</span>@<span class="hljs-string">node2</span> ~]<span class="hljs-comment"># cobbler get-loaders</span><br><span class="hljs-string">No</span> <span class="hljs-string">such</span> <span class="hljs-string">command</span>: <span class="hljs-built_in">get-loaders</span>             // 如何安装这个命令？<br></code></pre></td></tr></table></figure><p>（5）7 导入CentOS系统的安装文件，生成相应的YUM源</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node2 ~]# cobbler <span class="hljs-keyword">import</span> --name=centos7.<span class="hljs-number">6</span>-x86_64 --path=<span class="hljs-regexp">/misc/</span>cd --arch=x86_64<br><span class="hljs-keyword">task</span> started: <span class="hljs-number">2022</span>-<span class="hljs-number">07</span>-<span class="hljs-number">19</span>_072018_import<br><span class="hljs-keyword">task</span> started (id=Media <span class="hljs-keyword">import</span>, time=Tue Jul <span class="hljs-number">19</span> <span class="hljs-number">07</span>:<span class="hljs-number">20</span>:<span class="hljs-number">18</span> <span class="hljs-number">2022</span>)<br>Exception occured: &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;cobbler.cexceptions.CX&#x27;</span>&gt;<br>Exception value: <span class="hljs-string">&#x27;Command failed&#x27;</span><br>Exception Info:<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/cobbler/remote.py&quot;</span>, line <span class="hljs-number">82</span>, in run<br>    rc = self._run(self)<br>   <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/cobbler/remote.py&quot;</span>, line <span class="hljs-number">219</span>, in runner<br>    self.logger<br>   <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/cobbler/api.py&quot;</span>, line <span class="hljs-number">862</span>, in import_tree<br>    utils.run_this(rsync_cmd, (spacer, mirror_url, path), self.logger)<br>   <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/cobbler/utils.py&quot;</span>, line <span class="hljs-number">899</span>, in run_this<br>    die(logger,<span class="hljs-string">&quot;Command failed&quot;</span>)<br>   <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;/usr/lib/python2.7/site-packages/cobbler/utils.py&quot;</span>, line <span class="hljs-number">114</span>, in die<br>    raise CX(msg)<br><br>!!! <span class="hljs-keyword">TASK</span> FAILED !!!<br><br>[root@node2 ~]# mount <span class="hljs-regexp">/dev/</span>sr1 <span class="hljs-regexp">/mnt/</span><br>mount: special device <span class="hljs-regexp">/dev/</span>sr1 does not exist<br>[root@node2 ~]# mount <span class="hljs-regexp">/dev/</span>sr0 <span class="hljs-regexp">/mnt/</span><br>mount: <span class="hljs-regexp">/dev/</span>sr0 is <span class="hljs-keyword">write</span>-<span class="hljs-keyword">protected</span>, mounting <span class="hljs-keyword">read</span>-only<br>[root@node2 ~]# df -hT<br>Filesystem                  Type      <span class="hljs-keyword">Size</span>  Used Avail Use% Mounted on<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root     xfs        17G  1.5G   16G   9% /</span><br>devtmpfs                    devtmpfs  <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                       tmpfs     <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                       tmpfs     <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                       tmpfs     <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/</span>sda1                   xfs      <span class="hljs-number">1014</span>M  <span class="hljs-number">133</span>M  <span class="hljs-number">882</span>M  <span class="hljs-number">14</span>% /boot<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/vg_data-lv_data ext4      985M  505M  414M  55% /</span>home<br>tmpfs                       tmpfs      <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/</span>sr0                    iso9660   <span class="hljs-number">4.3</span>G  <span class="hljs-number">4.3</span>G     <span class="hljs-number">0</span> <span class="hljs-number">100</span>% /mnt<br></code></pre></td></tr></table></figure><h2 id="3、搭建配置主从DNS服务器，实现区域传送，并实现智能DNS。"><a href="#3、搭建配置主从DNS服务器，实现区域传送，并实现智能DNS。" class="headerlink" title="3、搭建配置主从DNS服务器，实现区域传送，并实现智能DNS。"></a>3、搭建配置主从DNS服务器，实现区域传送，并实现智能DNS。</h2><h3 id="主DNS服务器端配置"><a href="#主DNS服务器端配置" class="headerlink" title="主DNS服务器端配置"></a>主DNS服务器端配置</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[root@node2 ~]yum <span class="hljs-keyword">install </span><span class="hljs-keyword">bind </span>-y<br></code></pre></td></tr></table></figure><p>修改bind 配置文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node2 ~]vim <span class="hljs-regexp">/etc/</span>named.conf             <br><span class="hljs-comment">#注释掉下面两行</span><br><span class="hljs-regexp">//</span> listen-on port <span class="hljs-number">53</span> &#123; <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>; &#125;;<br><span class="hljs-regexp">//</span> allow-query     &#123; localhost; &#125;;<br>    allow-transfer &#123;<span class="hljs-number">10.0</span>.<span class="hljs-number">23.101</span>;&#125;;          <span class="hljs-regexp">//</span>只允许此从服务器进行区域传输<br><br>[root@node2 ~]vim <span class="hljs-regexp">/etc/</span>named.rfc1912.zones    <br><span class="hljs-comment">#加上下面内容</span><br>zone <span class="hljs-string">&quot;magedu.org&quot;</span> IN &#123;<br>   type master;<br>   file  <span class="hljs-string">&quot;magedu.org.zone&quot;</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#DNS区域数据库文件</span><br>cp -p /var/named/named.localhost /var/named/magedu.org.zone<br>[root@node2 network-scripts]<span class="hljs-comment"># cat /var/named/magedu.org.zone </span><br>$TTL <span class="hljs-number">1</span>D<br>@ <span class="hljs-keyword">IN</span> SOA <span class="hljs-keyword">master</span> <span class="hljs-title">admin</span>.magedu.org. (<br> <span class="hljs-number">0</span> ; serial<br> <span class="hljs-number">1</span>D ; refresh<br> <span class="hljs-number">1H</span> ; retry<br> <span class="hljs-number">1</span>W ; expire<br> <span class="hljs-number">3H</span> ) ; minimum<br>       NS <span class="hljs-keyword">master</span><br>           <span class="hljs-title">NS</span> <span class="hljs-literal">slave</span><br><span class="hljs-keyword">master</span>     <span class="hljs-title">A</span>    <span class="hljs-number">10.0</span>.<span class="hljs-number">23.102</span><br><span class="hljs-literal">slave</span>       A    <span class="hljs-number">10.0</span>.<span class="hljs-number">23.101</span><br></code></pre></td></tr></table></figure><p> 检查配置文件和数据库文件格式，并启动服务</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@node2 ~]<span class="hljs-comment"># named-checkconf                                            //检查主配置文件语法</span><br>[root@node2 ~]<span class="hljs-comment"># named-checkzone magedu.org /var/named/magedu.org.zone      //检查解析库文件语法</span><br>zone magedu.org/IN: loaded serial <span class="hljs-number">0</span><br>OK<br>[root@node2 ~]<span class="hljs-comment"># systemctl status named</span><br>● named.service - Berkeley Internet Name Domain (DNS)<br>   Loaded: loaded (<span class="hljs-regexp">/usr/li</span>b/systemd/<span class="hljs-keyword">system</span>/named.service; disabled; vendor preset: disabled)<br>   Active: inactive (dead)<br>[root@node2 ~]<span class="hljs-comment"># systemctl start named     // 第一次启动</span><br><br>服务已启动，使配置生效：<br>[root@node2 ~]<span class="hljs-comment"># rndc reload</span><br>server reload successful<br>[root@node2 ~]<span class="hljs-comment"># systemctl reload named</span><br>[root@node2 ~]<span class="hljs-comment"># service named reload</span><br>Redirecting to /bin/systemctl reload named.service<br></code></pre></td></tr></table></figure><h3 id="从DNS服务器配置"><a href="#从DNS服务器配置" class="headerlink" title="从DNS服务器配置"></a>从DNS服务器配置</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs awk">yum install bind -y<br><br>vim <span class="hljs-regexp">/etc/</span>named.conf<br><span class="hljs-regexp">//</span> listen-on port <span class="hljs-number">53</span> &#123; <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>; &#125;;<br><span class="hljs-regexp">//</span> allow-query     &#123; localhost; &#125;;<br><span class="hljs-comment">#不允许其它主机进行区域传输</span><br>   allow-transfer &#123; none;&#125;;<br><br>vim <span class="hljs-regexp">/etc/</span>named.rfc1912.zones<br>zone <span class="hljs-string">&quot;magedu.org&quot;</span> &#123;<br>type slave;<br>masters &#123;<span class="hljs-number">10.0</span>.<span class="hljs-number">23.102</span>;&#125;;<br>file <span class="hljs-string">&quot;slaves/magedu.org.slave&quot;</span>;<br>&#125;;<br>[root@node1 network-scripts]<span class="hljs-comment"># rndc reload</span><br>server reload successful<br>[root@node1 network-scripts]<span class="hljs-comment"># ls /var/named/slaves/magedu.org.slave </span><br><span class="hljs-regexp">/var/</span>named<span class="hljs-regexp">/slaves/m</span>agedu.org.slave<br></code></pre></td></tr></table></figure><p>客户端测试主从DNS服务架构</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node1</span> <span class="hljs-string">network-scripts</span>]<span class="hljs-comment"># cat ifcfg-eth2</span><br><span class="hljs-string">TYPE=Ethernet</span><br><span class="hljs-string">BOOTPROTO=static</span><br><span class="hljs-string">IPADDR=10.0.23.101</span><br><span class="hljs-string">NETMASK=255.255.255.0</span><br><span class="hljs-string">GATEWAY=10.0.23.254</span><br><span class="hljs-string">NAME=eth2</span><br><span class="hljs-string">DEVICE=eth2</span><br><span class="hljs-string">ONBOOT=yes</span><br><span class="hljs-string">DNS1=10.0.23.102</span>    <span class="hljs-string">//</span> <span class="hljs-string">主服务器</span><br><span class="hljs-string">DNS2=10.0.23.101</span>    <span class="hljs-string">//</span> <span class="hljs-string">从服务器</span><br><br><br><span class="hljs-comment">#验证从DNS服务器是否可以查询：</span><br><span class="hljs-string">root@node1</span> <span class="hljs-string">network-scripts]#</span> <span class="hljs-string">dig</span> <span class="hljs-string">www.magedu.org</span><br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.9</span><span class="hljs-number">.4</span><span class="hljs-string">-RedHat-9.9.4-72.el7</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">www.magedu.org</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">48385</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;www.magedu.org.</span><span class="hljs-string">IN</span><span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">www.magedu.org.</span><span class="hljs-number">5</span><span class="hljs-string">IN</span><span class="hljs-string">A</span><span class="hljs-number">160.121</span><span class="hljs-number">.140</span><span class="hljs-number">.246</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">37</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.23</span><span class="hljs-number">.254</span><span class="hljs-comment">#53(192.168.23.254)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Jul</span> <span class="hljs-number">20</span> <span class="hljs-number">23</span><span class="hljs-string">:31:30</span> <span class="hljs-string">CST</span> <span class="hljs-number">2022</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">48</span><br><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">network-scripts</span>]<span class="hljs-comment"># curl www.magedu.org</span><br><span class="hljs-attr">curl:</span> <span class="hljs-string">(7)</span> <span class="hljs-attr">Failed to connect to 160.121.140.246:</span> <span class="hljs-string">Network</span> <span class="hljs-string">is</span> <span class="hljs-string">unreachable</span>    <span class="hljs-string">//160.121.140.246这个地址是哪里的呀？</span><br></code></pre></td></tr></table></figure><h2 id="4、linux防火墙"><a href="#4、linux防火墙" class="headerlink" title="4、linux防火墙"></a>4、linux防火墙</h2><p>配置iptables 打开常用端口加固linux。使用iptables DNAT完成暴露内网端口，使用SNAT,让内网可以上网。并抓包分析过程。 可以尝试firewalld实现iptables的结果。</p><p>iptables命令格式详解：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">iptables   <span class="hljs-comment">[-t table]</span>   SUBCOMMAND   chain   <span class="hljs-comment">[-m matchname <span class="hljs-comment">[per-match-options]</span>]</span> -j targetname <span class="hljs-comment">[per-target-options]</span><br></code></pre></td></tr></table></figure><p>SUBCOMMAND：子命令</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs diff">链管理类：<br><span class="hljs-deletion">-N：new, 自定义一条新的规则链</span><br><span class="hljs-deletion">-E：重命名自定义链；引用计数不为0的自定义链不能够被重命名，也不能被删除</span><br><span class="hljs-deletion">-X：delete，删除自定义的空的规则链</span><br><span class="hljs-deletion">-P：Policy，设置默认策略；对filter表中的链而言，其默认策略有：ACCEPT：接受, DROP：丢弃</span><br><br>规则管理类：<br><span class="hljs-deletion">-A：append，追加</span><br><span class="hljs-deletion">-I：insert, 插入，要指明插入至的规则编号，默认为第一条</span><br><span class="hljs-deletion">-D：delete，删除</span><br>(1) 指明规则序号<br>(2) 指明规则本身<br><span class="hljs-deletion">-R：replace，替换指定链上的指定规则编号</span><br><span class="hljs-deletion">-F：flush，清空指定的规则链</span><br></code></pre></td></tr></table></figure><p>常用的端口：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">服务</span>         <span class="hljs-string">端口号</span><span class="hljs-string">说明</span><br><span class="hljs-string">FTP</span>            <span class="hljs-number">20</span>  <span class="hljs-string">用于上传、下载文件</span><br><span class="hljs-string">FTP</span>            <span class="hljs-number">21</span>  <span class="hljs-string">用于FTP的登陆认证</span><br><span class="hljs-string">SSH、SFTP</span> <span class="hljs-string">、</span>  <span class="hljs-number">22</span><span class="hljs-string">加密的远程登录，文件传输</span><br><span class="hljs-string">Telnet</span><span class="hljs-number">23</span>  <span class="hljs-string">远程登录（在本地主机上使用此端口与远程服务器的22/3389端口连接）</span><br><span class="hljs-string">SMTP</span><span class="hljs-number">25</span>  <span class="hljs-string">用于发送邮件</span><br><span class="hljs-string">DNS</span><span class="hljs-number">53</span>  <span class="hljs-string">域名解析</span><br><span class="hljs-string">HTTP</span><span class="hljs-number">80</span>  <span class="hljs-string">用于网页浏览</span><br><span class="hljs-string">POP3</span><span class="hljs-number">110</span>  <span class="hljs-string">SUN公司的RPC服务所有端口</span><br><span class="hljs-string">SMTP</span><span class="hljs-number">161</span>   <span class="hljs-string">Simple</span> <span class="hljs-string">Network</span> <span class="hljs-string">Management</span> <span class="hljs-string">Protocol，简单网络管理协议</span><br><span class="hljs-string">SNMP</span> <span class="hljs-string">Trap</span><span class="hljs-number">160</span><span class="hljs-string">、162</span><span class="hljs-string">SNMP协议</span><br><span class="hljs-string">HTTPS</span><span class="hljs-number">443</span>    <span class="hljs-string">加密的网页浏览端口</span><br><span class="hljs-string">CIFS</span><span class="hljs-number">445</span>    <span class="hljs-string">公共Internet文件系统</span><br><span class="hljs-string">Oracle</span><span class="hljs-number">1521</span><span class="hljs-string">数据库</span><br><span class="hljs-string">NFS</span><span class="hljs-number">2049</span><span class="hljs-string">通过网络，让不同的机器、不同的操作系统实现文件共享</span><br><span class="hljs-string">MySQL</span><span class="hljs-number">3306</span><span class="hljs-string">数据库</span><br><span class="hljs-string">WIN2003远程登录</span> <span class="hljs-number">3389</span><span class="hljs-string">Windows</span> <span class="hljs-number">2000</span><span class="hljs-string">(2003)</span> <span class="hljs-string">Server远程桌面的服务端口，本地服务器开放此端口，去连接到远程的服务器</span><br><span class="hljs-string">WebLogic</span><span class="hljs-number">7001</span><span class="hljs-string">一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器</span><br><span class="hljs-string">TOMCAT</span><span class="hljs-number">8080</span><span class="hljs-string">WWW代理开放此端口</span><br></code></pre></td></tr></table></figure><h3 id="打开指定的常用端口："><a href="#打开指定的常用端口：" class="headerlink" title="打开指定的常用端口："></a>打开指定的常用端口：</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmake">[root@node1 ~]<span class="hljs-comment"># iptables -A INPUT  -i eth0 -m multiport -p tcp --dports 20,21,22,23,80,443,3306 -j ACCEPT</span><br>[root@node1 ~]<span class="hljs-comment"># iptables -L</span><br>Chain INPUT (<span class="hljs-keyword">policy</span> ACCEPT)<br><span class="hljs-keyword">target</span>     prot opt source               destination         <br>ACCEPT     tcp  --  anywhere             anywhere             multiport dports ftp-data,ftp,ssh,telnet,http,https,mysql<br><br>Chain FORWARD (<span class="hljs-keyword">policy</span> ACCEPT)<br><span class="hljs-keyword">target</span>     prot opt source               destination         <br><br>Chain OUTPUT (<span class="hljs-keyword">policy</span> ACCEPT)<br><span class="hljs-keyword">target</span>     prot opt source               destination<br></code></pre></td></tr></table></figure><h3 id="加固linux"><a href="#加固linux" class="headerlink" title="加固linux"></a>加固linux</h3><p>仅允许指定网段主机尝试远程登录</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[root@node1 ~]</span># iptables -<span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">192.168</span>.<span class="hljs-number">26.102</span> -<span class="hljs-selector-tag">p</span> tcp -m multiport <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT<br><span class="hljs-selector-attr">[root@node1 ~]</span># iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span>  -<span class="hljs-selector-tag">p</span> tcp -m multiport <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j REJECT<br>You have new mail in /<span class="hljs-selector-tag">var</span>/spool/mail/root<br><span class="hljs-selector-attr">[root@node1 ~]</span># iptables -L<br>Chain <span class="hljs-selector-tag">INPUT</span> (policy ACCEPT)<br>target     prot opt source               destination         <br>ACCEPT     tcp  --  <span class="hljs-number">192.168</span>.<span class="hljs-number">26.102</span>       anywhere             multiport dports ssh<br>ACCEPT     tcp  --  anywhere             anywhere             multiport dports ftp-data,ftp,ssh,telnet,http,https,mysql<br>REJECT     tcp  --  anywhere             anywhere             multiport dports ssh reject-with icmp-port-unreachable<br><br>Chain FORWARD (policy ACCEPT)<br>target     prot opt source               destination         <br><br>Chain OUTPUT (policy ACCEPT)<br>target     prot opt source               destination  <br></code></pre></td></tr></table></figure><h2 id="5、脚本实现openvpn的一键安装，日常管理：加用户，吊销用户等。"><a href="#5、脚本实现openvpn的一键安装，日常管理：加用户，吊销用户等。" class="headerlink" title="5、脚本实现openvpn的一键安装，日常管理：加用户，吊销用户等。"></a>5、脚本实现openvpn的一键安装，日常管理：加用户，吊销用户等。</h2><h3 id="脚本实现openvpn的一键安装"><a href="#脚本实现openvpn的一键安装" class="headerlink" title="脚本实现openvpn的一键安装"></a>脚本实现openvpn的一键安装</h3><p>包括：创建CA、生成自签名证书、生成dh密钥、修改配置文件、防火墙设置ip转发</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#!<span class="hljs-regexp">/bin/</span>bash<br>yum -y install openvpn easy-rsa<br><br>cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>openvpn<span class="hljs-regexp">/sample/</span>sample-config-files<span class="hljs-regexp">/server.conf /</span>etc<span class="hljs-regexp">/openvpn/</span><br>cp -r <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span> <span class="hljs-regexp">/etc/</span>openvpn/easy-rsa-server<br>cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>easy-rsa<span class="hljs-regexp">/vars.example /</span>etc<span class="hljs-regexp">/openvpn/</span>easy-rsa-server<span class="hljs-regexp">/3/</span>vars<br><br>cd <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span>/<br>./easyrsa init-pki<br><br>expect &lt;&lt;EOF<br>set timeout <span class="hljs-number">60</span><br>spawn ./easyrsa build-ca nopass<br>expect &#123;<br>        <span class="hljs-string">&quot; [Easy-RSA CA]&quot;</span> &#123; send <span class="hljs-string">&quot;\n&quot;</span> &#125;<br>&#125;<br>expect eof<br>EOF<br><br>expect &lt;&lt;EOF<br>set timeout <span class="hljs-number">60</span><br>spawn ./easyrsa gen-req server nopass <br>expect &#123;<br>        <span class="hljs-string">&quot; [server]&quot;</span> &#123; send <span class="hljs-string">&quot;\n&quot;</span> &#125;<br>&#125;<br>expect eof<br>EOF<br><br>expect &lt;&lt;EOF<br>set timeout <span class="hljs-number">60</span><br>spawn ./easyrsa sign server server<br>expect &#123;<br>        <span class="hljs-string">&quot;Confirm request details:&quot;</span> &#123; send <span class="hljs-string">&quot;yes\n&quot;</span> &#125;<br>&#125;<br>expect eof<br>EOF<br><br>./easyrsa gen-dh<br><br>mkdir <span class="hljs-regexp">/etc/</span>openvpn/certs<br>cp <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>ca.crt <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span><br>cp <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/i</span>ssued<span class="hljs-regexp">/server.crt /</span>etc<span class="hljs-regexp">/openvpn/</span>certs/ <br>cp <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span><span class="hljs-keyword">private</span>/server.key<br><span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span><br>cp <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>dh.pem <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span><br><br>cat &gt; <span class="hljs-regexp">/etc/</span>openvpn/server.conf &lt;&lt;EOF<br>port <span class="hljs-number">1194</span><br>proto tcp<br>dev tun<br>ca <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span>ca.crt<br>cert <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span>server.crt<br>key <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span>server.key  # <span class="hljs-keyword">This</span> <span class="hljs-keyword">file</span> should be kept secret<br>dh <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/certs/</span>dh.pem<br>server <span class="hljs-number">10.8</span>.<span class="hljs-number">0.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-keyword">push</span> <span class="hljs-string">&quot;route 172.30.0.0 255.255.255.0&quot;</span><br>keepalive <span class="hljs-number">10</span> <span class="hljs-number">120</span><br>cipher AES-<span class="hljs-number">256</span>-CBC<br>compress lz4-v2<br><span class="hljs-keyword">push</span> <span class="hljs-string">&quot;compress lz4-v2&quot;</span><br>max-clients <span class="hljs-number">2048</span><br>user openvpn<br><span class="hljs-keyword">group</span> openvpn<br>status <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span>openvpn-status.log<br>log-<span class="hljs-keyword">append</span> <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/openvpn/</span>openvpn.log<br>verb <span class="hljs-number">3</span><br>mute <span class="hljs-number">20</span><br>crl-verify <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>crl.pem<br>EOF<br><br>echo net.ipv4.ip_forward = <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br>echo <span class="hljs-string">&#x27;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j MASQUERADE&#x27;</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>rc.d/rc.local<br><br>#启动服务，CentOS8缺失unit文件，需要创建<br><br><span class="hljs-keyword">if</span> [ `cat <span class="hljs-regexp">/etc/</span>redhat-release | awk  <span class="hljs-string">&#x27;&#123; print$4 &#125;&#x27;</span> | awk -F. <span class="hljs-string">&#x27;&#123;print$1&#125;&#x27;</span>` -eq <span class="hljs-number">8</span> ];then<br>cat &gt; <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/openvpn@.service &lt;&lt;EOF<br>[Unit]<br><span class="hljs-keyword">Description</span>=OpenVPN Robust And Highly Flexible Tunneling Application On %I<br>After=network.target<br>[Service]<br>Type=notify<br>PrivateTmp=<span class="hljs-keyword">true</span><br>ExecStart=<span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/openvpn --cd /</span>etc<span class="hljs-regexp">/openvpn/</span> --config %i.conf<br>[Install]<br>WantedBy=multi-user.target<br>EOF<br>fi<br><br>systemctl daemon-reload <br>systemctl enable --now openvpn@server<br></code></pre></td></tr></table></figure><h3 id="增加新用户"><a href="#增加新用户" class="headerlink" title="增加新用户"></a>增加新用户</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/bin/bash</span><br>read -p <span class="hljs-string">&quot;请输入用户的姓名拼音: &quot;</span> NAME<br><br>[ -e <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span> ] || cp -r <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/easy-rsa/</span> <span class="hljs-regexp">/etc/</span>openvpn/easy-rsa-client<br>cd <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span><br>./easyrsa gen-req <span class="hljs-variable">$&#123;NAME&#125;</span> nopass &lt;&lt;EOF<br>EOF<br><br>cd <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><br>.<span class="hljs-regexp">/easyrsa import-req /</span>etc<span class="hljs-regexp">/openvpn/</span>easy-rsa-client<span class="hljs-regexp">/3/</span>pki<span class="hljs-regexp">/reqs/</span><span class="hljs-variable">$&#123;NAME&#125;</span>.req <span class="hljs-variable">$&#123;NAME&#125;</span><br>./easyrsa sign client <span class="hljs-variable">$&#123;NAME&#125;</span> &lt;&lt;EOF<br>yes<br>EOF<br><br><span class="hljs-comment">#证书文件复制到服务器client目录下</span><br>mkdir <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span><span class="hljs-variable">$&#123;NAME&#125;</span>/<br>cp &#123;<span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-client/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>private<span class="hljs-regexp">/$&#123;NAME&#125;.key , /</span>etc<span class="hljs-regexp">/openvpn/</span>easy-rsa-server<span class="hljs-regexp">/3/</span>pki<span class="hljs-regexp">/issued/</span><span class="hljs-variable">$&#123;NAME&#125;</span>.crt , <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/easy-rsa-server/</span><span class="hljs-number">3</span><span class="hljs-regexp">/pki/</span>ca.crt &#125; <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span><span class="hljs-variable">$&#123;NAME&#125;</span>/<br></code></pre></td></tr></table></figure><h3 id="吊销用户"><a href="#吊销用户" class="headerlink" title="吊销用户"></a>吊销用户</h3><p>第一次吊销证时需要编辑配置文件调用吊销证书的文件,后续吊销无需此步。每次吊销证书后,都需要重新启动服务才能生效。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入吊销用户的姓名拼音: &quot;</span> NAME<br><span class="hljs-built_in">cd</span> /etc/openvpn/easy-rsa-server/3<br>./easyrsa revoke <span class="hljs-variable">$&#123;NAME&#125;</span> &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">yes</span><br><span class="hljs-string">EOF</span><br><br>./easyrsa gen-crl<br><br>[[ `<span class="hljs-built_in">cat</span> /etc/openvpn/server.conf` =~ .*crl-verify.* ]] || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;crl-verify /etc/openvpn/easy-rsa-server/3/pki/crl.pem&quot;</span> &gt;&gt; /etc/openvpn/server.conf<br><br>systemctl restart openvpn@server.service<br></code></pre></td></tr></table></figure><h2 id="6、日常阿里云操作"><a href="#6、日常阿里云操作" class="headerlink" title="6、日常阿里云操作"></a>6、日常阿里云操作</h2><p>购买ECS, 做快照，重装系统，购买SLB，mysql. 在阿里上基于SLB, mysql,完成部署LAMP。</p><h2 id="7、总结数据库原理。"><a href="#7、总结数据库原理。" class="headerlink" title="7、总结数据库原理。"></a>7、总结数据库原理。</h2><h3 id="数据的分类"><a href="#数据的分类" class="headerlink" title="数据的分类"></a>数据的分类</h3><p>结构化的数据：即有固定格式和有限长度的数据。例如填的表格就是结构化的数据，国籍：中华人 民共和国，民族：汉，性别：男，这都叫结构化数据。 </p><p>非结构化的数据：非结构化的数据越来越多，就是不定长、无固定格式的数据，例如: 网页,图片文 件，有时候非常大，有时候很小；例如语音，视频都是非结构化的数据 。</p><p>半结构化数据：比如：XML或者HTML的格式的数据。</p><h3 id="数据库系统发展阶段"><a href="#数据库系统发展阶段" class="headerlink" title="数据库系统发展阶段"></a>数据库系统发展阶段</h3><p>萌芽阶段：文件系统<br>使用磁盘文件来存储数据 </p><p>初级阶段：第一代数据库<br>出现了网状模型、层次模型的数据库 </p><p>中级阶段：第二代数据库<br>关系型数据库和结构化查询语言 </p><p>高级阶段：新一代数据库<br>“关系-对象”型数据库 </p><h3 id="DBMS数据库管理系统"><a href="#DBMS数据库管理系统" class="headerlink" title="DBMS数据库管理系统"></a>DBMS数据库管理系统</h3><p>Database：数据库是数据的汇集，它以一定的组织形式存于存储介质上。</p><p>DBMS：Database Management System, 是管理数据库的系统软件，它实现数据库系统的各种功 能。是数据库系统的核心 。</p><p>DBA：Database Administrator, 数据库管理员，负责数据库的规划、设计、协调、维护和管理等工作 。</p><p>Application：应用程序,指以数据库为基础的应用程序。</p><h3 id="数据库管理系统的基本功能"><a href="#数据库管理系统的基本功能" class="headerlink" title="数据库管理系统的基本功能"></a>数据库管理系统的基本功能</h3><p>数据定义 </p><p>数据处理 </p><p>数据安全 </p><p>数据备份</p><h3 id="关系型数据库理论"><a href="#关系型数据库理论" class="headerlink" title="关系型数据库理论"></a>关系型数据库理论</h3><h4 id="关系统型数据库相关概念"><a href="#关系统型数据库相关概念" class="headerlink" title="关系统型数据库相关概念"></a><strong>关系统型数据库相关概念</strong></h4><p>关系Relational ：关系就是二维表，其中：表中的行、列次序并不重要。</p><p> 行row：表中的每一行，又称为一条记录record。</p><p> 列column：表中的每一列，称为属性，字段，域field。</p><p> 主键Primary key：PK ,一个或多个字段的组合, 用于惟一确定一个记录的字段，一张表只有一个主键, 主键字段不能为空NULL。</p><p> 唯一键Unique key: 一个或多个字段的组合,用于惟一确定一个记录的字段,一张表可以有多个UK,而且UK字段可以为NULL。</p><p> 域domain：属性的取值范围，如，性别只能是’男’和’女’两个值，人类的年龄只能0-150。</p><h4 id="实体-联系模型E-R"><a href="#实体-联系模型E-R" class="headerlink" title="实体-联系模型E-R"></a>实体-联系模型E-R</h4><p>E-R模型即实体-关系模型﹐E-R模型就是描述数据库存储数据的结构模<br>对于大型公司开发项目﹐需要根据产品经理的设计﹐先使用建模工具,如:power designer ,db desinger 等这些软件来画出实体-关系模型(E-R模型)</p><p>实体Entity：客观存在并可以相互区分的客观事物或抽象事件称为实体即表,在E-R图中用矩形表示 实体，把实体名写在框内 。<br>属性Attribute：实体所具有的特征或性质,描述实体里面的单个信息, 使用椭圆形表示 。<br>联系Relationship：描述了实体的属性之间的关联规则 • 实体内部的联系：指组成同一个实体内的各属性之间的联系。如职工实体中，职工号和部门经理 号之间有一种关联关系 • 实体之间的联系：指不同实体之间的属性的联系。例：学生选课实体和学生基本信息实体之间 • 实体之间的联系用菱形框表示。</p><h4 id="联系类型"><a href="#联系类型" class="headerlink" title="联系类型"></a><strong>联系类型</strong></h4><p> 一对一联系(1:1): 在表A或表B中创建一个字段﹐存储另一个表的主键值 如: 一个人只有一个身份证。</p><p> 一对多联系(1:n)：外键, 如: 部门和员工。</p><p> 多对多联系(m:n)：增加第三张表, 如: 学生和课程。</p><h4 id="数据的操作"><a href="#数据的操作" class="headerlink" title="数据的操作"></a>数据的操作</h4><p>开发工程师 CRUD (增加Create、查询Retrieve或 Read、更新Update、 删除Delete) </p><p>数据提取：在数据集合中提取感兴趣的内容。SELECT 。<br>数据更新：变更数据库中的数据。INSERT、DELETE、UPDATE。</p><h4 id="数据库的正规化分析"><a href="#数据库的正规化分析" class="headerlink" title="数据库的正规化分析"></a>数据库的正规化分析</h4><p>数据库规范化，又称数据库或资料库的正规化、标准化，是数据库设计中的一系列原理和技术，以减少 数据库中数据冗余，增进数据的一致性。</p><p>设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，不同的规范要求被称为不同范 式，各种范式呈递次规范，越高的范式数据库冗余越小。</p><p>目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴德斯科范式 （BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。</p><p>满足最低要求的范式是第一范式 （1NF）。在第一范式的基础上进一步满足更多规范要求的称为第二范式（2NF），其余范式以次类 推。一般数据库只需满足第三范式(3NF）即可。</p><p>规则是死的,人是活的,所以范式是否必须遵守,要看业务需要而定 掌握范式的目的是为了在合适的场景下违反范式。</p><p> <strong>第一范式：</strong>1NF</p><p> 无重复的列，，同一列中不能有多个值，即实体中的某个属性不能有多个值或者不能有重复的属性，确保每一列的原子性。关系数据库的基础，不满足就不是关系型数据库。</p><p> <strong>第二范式：</strong>2NF</p><p> 第二范式必须先满足第一范式，且非PK的字段需要与整个PK有直接相关性,即非PK的字段不能依赖于部</p><p>分主键。</p><p> 例如：班级号和班级内序号作为复合主键，学生ID需要整个主键确定，若学生ID仅依赖于班级号或者说班级内序号，则违反了第二范式。</p><p> <strong>第三范式：</strong>3NF</p><p> 满足第三范式必须先满足第二范式属性。第三范式要求一个数据表中不包含已在其它表中已包含的非主关键字信息，非PK的字段间不能有从属关系。</p><p> 例如：上个例子中，若还存在学生姓名，则非主键元素学生姓名和学生ID存在依赖关系，违反第三范式。</p><h4 id="数据约束"><a href="#数据约束" class="headerlink" title="数据约束"></a>数据约束</h4><p>约束：constraint，表中的数据在数据类型限定的基础上额外要遵守的限制 </p><p>常见约束如下: </p><p>非空not null:此字段不允许填写空值.。</p><p>主键primary key ：一个或多个字段的组合，填入的数据必须能在本表中唯一标识本行；必须提供 数据，即NOT NULL，一个表只能有一个。</p><p> 惟一键unique：一个或多个字段的组合，填入的数据必须能在本表中唯一标识本行；允许为 NULL，一个表可以存在多个。</p><p> 默认 default：当不填写字段对应的值会使用默认值﹐如果填写时以填写为准。</p><p> 外键foreign key：一个表中的某字段可填入的数据取决于另一个表的主键或唯一键已有的数据 。</p><p> 检查：字段值在一定范围内,如年龄在0到150之间。</p>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第四周作业-2022-6-29</title>
    <link href="/2022/06/28/%E7%AC%AC%E5%9B%9B%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-29/"/>
    <url>/2022/06/28/%E7%AC%AC%E5%9B%9B%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-29/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第十五天、第十六天、第十七天 、第十八天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>第十五天：进程和计划任务<br>1、shell脚本编程进阶符串切片和高级变量<br>2、Linux进程和内存管理<br>3、进程状态和相关概念<br>4、进程管理工具<br>5、性能相关工具<br>6、进程的前后执行和并发执行<br>7、任务计划管理”<br>第十六天：文本处理awk 内核管理<br>1、文本处理三剑客之awk基本用法<br>2、文本处理三剑客之awk基本用法<br>3、文本处理三剑客之awk高级用法<br>4、Linux启动流程和grub管理<br>5、Linux启动流程和服务管理<br>6、Linux的内核参数配置<br>7、systemd特性和内核编译安装”<br>第十七天：加密安全<br>1、systemd的服务service文件实现<br>2、target管理和grub2故障排错<br>3、安全机制和各种攻击方式实战<br>4、对称和非对称算法及单向哈希算法<br>5、加密综合应用及证书和CA<br>6、私有CA和openss配置文件详解<br>第十八天：加密安全2<br>1、实现私有CA和证书申请<br>2、证书管理和ssh服务工作原理<br>3、ssh客户端使用<br>4、ssh基于key验证<br>5、ssh高级用法及自动运维工具<br>6、sudo进行权限委派<br>7、pam模块功能和常用模块”</p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><h2 id="1、自定义写出10个定时任务的示例："><a href="#1、自定义写出10个定时任务的示例：" class="headerlink" title="1、自定义写出10个定时任务的示例："></a>1、自定义写出10个定时任务的示例：</h2><p>比如每周三凌晨三点执行data命令<br>要求尽量的覆盖各种场景</p><p>（1）每天8点对系统所有磁盘分区的磁盘使用率进行一次巡检，如有大于80%的，则立即发送告警邮件。</p><figure class="highlight bash"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs bash">[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># cat /test/disk_check.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>warning=80<br>used=`<span class="hljs-built_in">df</span> |grep -Eo <span class="hljs-string">&#x27;[0-9]+%&#x27;</span>|grep -Eo [0-9]+ |<span class="hljs-built_in">sort</span> -rn|<span class="hljs-built_in">head</span> -1`<br>[ <span class="hljs-variable">$used</span> -gt <span class="hljs-variable">$warning</span> ] &amp;&amp; <span class="hljs-built_in">echo</span> Disk will be full! |mail -s <span class="hljs-string">&#x27;diskwarning&#x27;</span> 253494546@qq.com<br><br>[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># chmod +x disk_check.sh</span><br>[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># crontab -l</span><br>* 9 * * * /test/disk_check.sh<br></code></pre></td></tr></table></figure><p>（2）因为查看业务软件日志对故障进行分析时，希望日志里显示的就是当时的实际时间，所以需要每周进行一次时钟同步，以保证时间的准确性。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@node1 test]<span class="hljs-comment"># ntpdate ntp.ntsc.ac.cn</span><br> <span class="hljs-number">2</span> Jul <span class="hljs-number">21</span>:<span class="hljs-number">26</span>:<span class="hljs-number">00</span> ntpdate[<span class="hljs-number">11012</span>]: adjust <span class="hljs-keyword">time</span> server <span class="hljs-number">114.118</span>.<span class="hljs-number">7.161</span> offset -<span class="hljs-number">0</span>.<span class="hljs-number">01</span>9675 sec<br>[root@node1 test]<span class="hljs-comment"># date</span><br>Sat Jul  <span class="hljs-number">2</span> <span class="hljs-number">21</span>:<span class="hljs-number">26</span>:<span class="hljs-number">03</span> CST <span class="hljs-number">2022</span><br>[root@node1 test]<span class="hljs-comment"># crontab -l</span><br>* * * * */<span class="hljs-number">1</span> ntpdate ntp.ntsc.ac.cn<br></code></pre></td></tr></table></figure><p>（3）每周五23：50自动备份zookeeper的日志到/bak目录下 ，并以日期命名； </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># cat zklog_backup.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>[ -d /bak ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Backup is ready&quot;</span> || <span class="hljs-built_in">mkdir</span> /bak &gt; /dev/null<br>tar -cf /bak/`<span class="hljs-built_in">date</span> +%F_%T`_zookeeper.out.tar.gz /home/gw/software/zookeeper/zookeeper.out &amp;&gt; /dev/null<br><span class="hljs-built_in">ls</span> -lrt /bak|<span class="hljs-built_in">tail</span> -1<br>[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># chmod +x zklog_backup.sh</span><br>[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># bash zklog_backup.sh </span><br>Backup is ready<br>-rw-r--r--. 1 root root 860160 Jul  2 22:36 2022-07-02_22:36:22_zookeeper.out.tar.gz<br><br>[root@node1 <span class="hljs-built_in">test</span>]<span class="hljs-comment"># crontab -l</span><br>50 23 * * 5 /test/zklog_backup.sh<br><br></code></pre></td></tr></table></figure><p>(4) 一般都是周六进行检修，周三可能就做一些检修的准备工作，备份配置文件就是准备工作之一，可制定每周二8：30进行备份。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 test]<span class="hljs-comment"># crontab -l</span><br><span class="hljs-number">30</span> <span class="hljs-number">8</span> * * <span class="hljs-number">2</span> <span class="hljs-regexp">/test/</span>config_backup.sh<br><br><br></code></pre></td></tr></table></figure><p>（5）每15分钟进行一次计算机资源监测，包括内存使用率、cpu使用率</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 test]<span class="hljs-comment"># crontab -l</span><br>*<span class="hljs-regexp">/15 * * * * /</span>test/monitor.sh<br></code></pre></td></tr></table></figure><p>（6）</p><p>（7）</p><p>（8）</p><p>（9）</p><p>（10）</p><h2 id="2、图文并茂说明Linux进程和内存概念"><a href="#2、图文并茂说明Linux进程和内存概念" class="headerlink" title="2、图文并茂说明Linux进程和内存概念"></a>2、图文并茂说明Linux进程和内存概念</h2><p>内存：<br>内存是计算机中重要的部件之一， 由内存芯片、电路板、金手指等部分组成，它是与CPU进行沟通的桥梁。<br>内存(Memory)也被称为内存储器，其作用是用于暂时存放CPU中的运算数据，以及与硬盘等外部存储器交换的数据。<br>计算机中所有程序的运行都是在内存中进行的，因此内存的性能对计算机的影响非常大。<br>只要计算机在运行中，CPU就会把需要运算的数据调到内存中进行运算，当运算完成后CPU再将结果传送出来，内存的运行也决定了计算机的稳定运行。</p><p><img src="1656514610098.png" alt="1656514610098"></p><p>进程：</p><p>进程是一个正在执行的程序；计算机中正在运行的程序实例；可以分配给处理器并由处理器执行的一个实体；由单一顺序的执行显示，一个当前状态和一组相关的系统资源所描述的活动单元。 </p><h2 id="3、图文并茂说明Linux启动流程"><a href="#3、图文并茂说明Linux启动流程" class="headerlink" title="3、图文并茂说明Linux启动流程"></a>3、图文并茂说明Linux启动流程</h2><p>操作系统的启动分为两个阶段：引导boot和启动startup。<br>引导阶段开始于打开电源开关，结束于内核初始化完成和 systemd 进程成功运行。<br>启动阶段接管了剩余工作，直到操作系统进入可操作状态。 </p><p>linux系统的启动流程可以分为以下步骤： POST（加电自检）–&gt;加载BIOS（Basic  Input/Outpu System)–&gt;确定启动设备（Boot sequence)、加载Boot  Loader–&gt;加载内核（kernel）初始化initrd–&gt;运行/sbin/init初始化系统–&gt;打印用户登录提示符 </p><p><img src="1656775025615.png" alt="1656775025615"></p><p> （1）POST开机自检<br>linux开机加电后，系统开始开机自检，该过程主要对计算机各种硬件设备进行检测，如CPU、内存、主板、硬盘、CMOS芯片等，如果出现致命故障则停机，并且由于初始化过程还没完成，所以不会出现任何提示信号；如果出现一般故障则会发出声音等提示信号，等待故障清除；若未出现故障，加电自检完成。 </p><p>（2）开机自检完成，查找可启动设备，加载主引导目录（MBR)<br>开机自检完成后，CPU首先读取位于CMOS中的BIOS程序，按照BIOS中设定的启动次序（Boot Sequence)逐一查找可启动设备,找到可启动的设备后，去该设备的第一个扇区 中读取MBR，那么MBR是什么哪？它又有什么作用哪？ MBR存在于可启动磁盘的0磁道0扇区，占用512字节，它主要用来告诉计算机从选定的可启动设备的哪个分区来加载引导加载程序（Boot loader)。<br>MBR中存在如下内容： 1、 Boot Loader 占用446字节，存储有操作系统（OS）相关信息，如操作系统名称，操作系统内核位置等，它的主要功能是加载内核到内存中运行。 2、 Partition Table 分区表，占用64字节，每个主分区占用16字节（这就是为啥一块硬盘只能有4个主分区啦^_^）  3、分区表有效性标记占用2字节  CPU将MBR读取至内存，运行GRUB(Boot Loader常用的有GRUB和LILO两种，现在常用的是GRUB），GRUB会把内核加载到内存去执行。 </p><p>（3）加载内核，初始化initrd<br>GRUB把内核加载到内存后展开并运行， 此时GRUB的任务已经完成，接下来内核将会接管并完成  探测硬件–&gt;加载驱动–&gt;挂载根文件系统–&gt;切换至根文件系统（rootfs）–&gt;运行/sbin/init完成系统初始化。GRUB在加载内核同时，也把initrd加载到内存中并运行。</p><p>（4）运行/sbin/init，进行系统初始化<br>内核并加载进内存运行并以读写方式挂载完根文件系统后，执行第一个用户进程init，init首先运行/etc/init/rcS.conf脚本，  init执行完/etc/rc.d/rc.sysinit后，将会执行/etc/inittab来设定系统运行的默认级别： linux中共有[0-6]七个运行级别，而我自己系统的默认运行级别是3. </p><p><img src="1656776015730.png" alt="1656776015730"></p><p> （5）打印登录提示符** 系统初始化完成后，init给出用户登 录提示符（login）或者图形化登录界面，用户输入用户和密码登陆后，系统会为用户分配一个用户ID（uid）和组ID（gid），这两个ID是用户的 <a href="https://cloud.tencent.com/solution/tb-digitalid?from=10680">身份标识</a>，用于检测用户运行程序时的<a href="https://cloud.tencent.com/product/mfas?from=10680">身份验证</a>。登录成功后，整个系统启动流程运行完毕！ </p><h2 id="4、自定义一个systemd服务"><a href="#4、自定义一个systemd服务" class="headerlink" title="4、自定义一个systemd服务"></a>4、自定义一个systemd服务</h2><p>定时去其他服务器上检查/tmp/下文件的个数，如果发现数量有变化就记录变化情况到文件中。</p><h2 id="5、写Linux内核编译安装博客"><a href="#5、写Linux内核编译安装博客" class="headerlink" title="5、写Linux内核编译安装博客"></a>5、写Linux内核编译安装博客</h2><h2 id="6、总结5个自我觉得比较有用的awk的使用场景，"><a href="#6、总结5个自我觉得比较有用的awk的使用场景，" class="headerlink" title="6、总结5个自我觉得比较有用的awk的使用场景，"></a>6、总结5个自我觉得比较有用的awk的使用场景，</h2><p>比如在什么情况下用awk处理文本效率最高，发散题，至少写1个。”</p><p>  (1)   计算VSZ和RSS各自的和 并以M单位显示。 VSZ 表示进程分配的虚拟内存。RSS 是常驻内存集（Resident Set Size），表示该进程分配的内存大小。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">[root@node1 ~]# ps aux | awk &#x27;BEGIN&#123;i=0&#125;NR&gt;=2&#123;VSZ+=<span class="hljs-variable">$5</span>;RSS+=<span class="hljs-variable">$6</span>;i++&#125;END&#123;<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;process count = &quot;</span>i; <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;VSZ total = &quot;</span>VSZ/1024<span class="hljs-string">&quot;M&quot;</span> ; <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;RSS total = &quot;</span>RSS/1024<span class="hljs-string">&quot;M&quot;</span>&#125;&#x27;<br>process <span class="hljs-keyword">count</span> = 109<br>VSZ <span class="hljs-keyword">total</span> = 4026.38M<br>RSS <span class="hljs-keyword">total</span> = 109.633M<br></code></pre></td></tr></table></figure><p>（2）  统计系统中管理员、系统用户、普通用户的数量</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs swift">[root<span class="hljs-meta">@node1</span> <span class="hljs-operator">~</span>]# awk <span class="hljs-operator">-</span><span class="hljs-type">F</span>: &#x27;<span class="hljs-type">BEGIN</span>&#123;x<span class="hljs-operator">=</span><span class="hljs-number">0</span>;y<span class="hljs-operator">=</span><span class="hljs-number">0</span>;x<span class="hljs-operator">=</span><span class="hljs-number">0</span>&#125;&#123;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$3</span><span class="hljs-operator">==</span><span class="hljs-number">0</span>)print <span class="hljs-variable">$1</span><span class="hljs-string">&quot;<span class="hljs-subst">\t</span>&quot;</span><span class="hljs-string">&quot;ADMIN&quot;</span> x<span class="hljs-operator">++</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$3</span><span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-variable">$3</span><span class="hljs-operator">&lt;</span><span class="hljs-number">500</span>) print <span class="hljs-variable">$1</span><span class="hljs-string">&quot;<span class="hljs-subst">\t</span>&quot;</span><span class="hljs-string">&quot;SYSUSER&quot;</span> y<span class="hljs-operator">++</span>;<span class="hljs-keyword">else</span> print <span class="hljs-variable">$1</span><span class="hljs-string">&quot;<span class="hljs-subst">\t</span>&quot;</span><span class="hljs-string">&quot;USER&quot;</span> z<span class="hljs-operator">++</span>&#125;<span class="hljs-type">END</span>&#123;print <span class="hljs-string">&quot;ADMIN COUNT = &quot;</span>x ; print <span class="hljs-string">&quot;SYSUSER COUNT = &quot;</span>y ; print <span class="hljs-string">&quot;USER COUNT = &quot;</span>z&#125;&#x27; <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>passwd<br>root<span class="hljs-type">ADMIN0</span><br>bin<span class="hljs-type">SYSUSER0</span><br>daemon<span class="hljs-type">SYSUSER1</span><br>adm<span class="hljs-type">SYSUSER2</span><br>lp<span class="hljs-type">SYSUSER3</span><br>sync<span class="hljs-type">SYSUSER4</span><br>shutdown<span class="hljs-type">SYSUSER5</span><br>halt<span class="hljs-type">SYSUSER6</span><br>mail<span class="hljs-type">SYSUSER7</span><br><span class="hljs-keyword">operator</span><span class="hljs-type">SYSUSER8</span><br>games<span class="hljs-type">SYSUSER9</span><br>ftp<span class="hljs-type">SYSUSER10</span><br>nobody<span class="hljs-type">SYSUSER11</span><br>systemd<span class="hljs-operator">-</span>network<span class="hljs-type">SYSUSER12</span><br>dbus<span class="hljs-type">SYSUSER13</span><br>polkitd<span class="hljs-type">USER0</span><br>sshd<span class="hljs-type">SYSUSER14</span><br><span class="hljs-keyword">postfix</span><span class="hljs-type">SYSUSER15</span><br>chrony<span class="hljs-type">USER1</span><br>tyh<span class="hljs-type">USER2</span><br>ntp<span class="hljs-type">SYSUSER16</span><br><span class="hljs-type">ADMIN</span> <span class="hljs-type">COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><span class="hljs-type">SYSUSER</span> <span class="hljs-type">COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">17</span><br><span class="hljs-type">USER</span> <span class="hljs-type">COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>初始化系统环境</title>
    <link href="/2022/06/26/%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83/"/>
    <url>/2022/06/26/%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h1 id="修改网卡名称"><a href="#修改网卡名称" class="headerlink" title="修改网卡名称"></a>修改网卡名称</h1><figure class="highlight gradle"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs gradle">[root@localhost network-scripts]# sed -Ei.bak <span class="hljs-string">&#x27;/GRUB_CMDLINE_LINUX=/s/quiet.*$/quiet net.ifnames=0 biosdevname=0&quot;/&#x27;</span> <span class="hljs-regexp">/etc/</span><span class="hljs-keyword">default</span>/grub<br>[root@localhost network-scripts]# cat <span class="hljs-regexp">/etc/</span><span class="hljs-keyword">default</span>/grub<br>GRUB_TIMEOUT=<span class="hljs-number">5</span><br>GRUB_DISTRIBUTOR=<span class="hljs-string">&quot;$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)&quot;</span><br>GRUB_DEFAULT=saved<br>GRUB_DISABLE_SUBMENU=<span class="hljs-keyword">true</span><br>GRUB_TERMINAL_OUTPUT=<span class="hljs-string">&quot;console&quot;</span><br>GRUB_CMDLINE_LINUX=<span class="hljs-string">&quot;crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0&quot;</span><br>GRUB_DISABLE_RECOVERY=<span class="hljs-string">&quot;true&quot;</span><br>[root@localhost network-scripts]# ll <span class="hljs-regexp">/etc/</span><span class="hljs-keyword">default</span>/<br>total <span class="hljs-number">16</span><br>-rw-r--r--. <span class="hljs-number">1</span> root root  <span class="hljs-number">307</span> Jun <span class="hljs-number">28</span> <span class="hljs-number">11</span>:<span class="hljs-number">45</span> grub<br>-rw-r--r--. <span class="hljs-number">1</span> root root  <span class="hljs-number">293</span> Jun <span class="hljs-number">28</span> <span class="hljs-number">10</span>:<span class="hljs-number">09</span> grub.bak<br>-rw-r--r--. <span class="hljs-number">1</span> root root <span class="hljs-number">1756</span> Oct <span class="hljs-number">30</span>  <span class="hljs-number">2018</span> nss<br>-rw-r--r--. <span class="hljs-number">1</span> root root  <span class="hljs-number">119</span> Oct <span class="hljs-number">30</span>  <span class="hljs-number">2018</span> useradd<br>[root@localhost network-scripts]# grub2-mkconfig -o <span class="hljs-regexp">/boot/g</span>rub2/grub.cfg<br>Generating grub configuration <span class="hljs-keyword">file</span> ...<br>Found linux image: <span class="hljs-regexp">/boot/</span>vmlinuz-<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">957</span>.el7.x86_64<br>Found initrd image: <span class="hljs-regexp">/boot/i</span>nitramfs-<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">957</span>.el7.x86_64.img<br>Found linux image: <span class="hljs-regexp">/boot/</span>vmlinuz-<span class="hljs-number">0</span>-rescue-<span class="hljs-number">378</span>c51b5339e4dbbb29e0c20e8508196<br>Found initrd image: <span class="hljs-regexp">/boot/i</span>nitramfs-<span class="hljs-number">0</span>-rescue-<span class="hljs-number">378</span>c51b5339e4dbbb29e0c20e8508196.img<br>done<br></code></pre></td></tr></table></figure><h1 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># hostnamectl set-hostname node2</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># hostname</span><br>node2<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat /etc/hostname </span><br>node2<br></code></pre></td></tr></table></figure><h1 id="系统时间"><a href="#系统时间" class="headerlink" title="系统时间"></a>系统时间</h1><h2 id="显示为24小时制"><a href="#显示为24小时制" class="headerlink" title="显示为24小时制"></a>显示为24小时制</h2><p>新部署的Linux服务器是12小时制的 ，使用date命令查看时，分不清是上午还是下午的时间，不利于进行日志分析。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 test]# cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/zoneinfo/</span>Asia<span class="hljs-regexp">/Shanghai /</span>etc/localtime <br>cp: overwrite ‘<span class="hljs-regexp">/etc/</span>localtime’? y<br>[root@node1 test]# date<br>Sat Jul  <span class="hljs-number">2</span> <span class="hljs-number">21</span>:<span class="hljs-number">16</span>:<span class="hljs-number">57</span> CST <span class="hljs-number">2022</span><br></code></pre></td></tr></table></figure><p>国内知名公共 NTP 服务器地址 </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros">国家授时中心<span class="hljs-built_in"> NTP </span>服务器：ntp.ntsc.ac.cn<br>阿里云公共<span class="hljs-built_in"> NTP </span>服务器：<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time1.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time2.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time3.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time4.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time5.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time6.aliyun.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time7.aliyun.com<br>腾讯云公共<span class="hljs-built_in"> NTP </span>服务器：<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time1.cloud.tencent.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time2.cloud.tencent.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time3.cloud.tencent.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time4.cloud.tencent.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>time5.cloud.tencent.com<br>[root@node1 test]# ntpdate ntp.ntsc.ac.cn<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>系统环境</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第三周作业-2022-6-20</title>
    <link href="/2022/06/20/%E7%AC%AC%E4%B8%89%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-20/"/>
    <url>/2022/06/20/%E7%AC%AC%E4%B8%89%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-20/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第十一天、第十二天、第十三天 、第十四天。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx%E3%80%82">https://www.wjx.top/vj/POHTQOH.aspx。</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>第十一天：<br>软件管理2<br>1、ubunut软件管理<br>2、磁盘类型和结构<br>3、MBR和GPT分区类型<br>4、文件系统管理<br>5、挂载管理和swap空间管理<br>6、移动设备和raid初步<br>7、raid工作原理和特性”<br>第十二天：<br>磁盘存储和文件系统管理<br>1、逻辑卷工作原理和创建<br>2、逻辑卷扩容和缩容及快照管理<br>3、网络和OSI分层结构<br>4、局域网及网络线缆<br>5、网络设备和局域网技术<br>6、tcpip协议和tcp详解<br>7、tcp协议三次握手和四次挥手详解”<br>第十三天：<br>网络协议和管理配置<br>1、udp和internet层协议<br>2、ip地址组成和分类<br>3、网络地址规划和子网划分<br>4、网卡配置文件和命令<br>5、网络路由和配置<br>6、多网卡绑定bond和team<br>7、网桥实现和网络工具”<br>第十四天：<br>shell脚本进阶<br>1、ununtu网络配置<br>2、shell脚本编程进阶while循环和控制<br>3、shell脚本进阶shift和select<br>4、shell脚本进阶函数实现<br>5、shell脚本进阶函数递归和信号捕捉<br>6、shell脚本进阶常用工具<br>7、shell脚本进阶数组”</p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><h2 id="1、图文并茂说明raid0-raid1-raid10-raid01-raid5等原理。"><a href="#1、图文并茂说明raid0-raid1-raid10-raid01-raid5等原理。" class="headerlink" title="1、图文并茂说明raid0,raid1, raid10, raid01, raid5等原理。"></a>1、图文并茂说明raid0,raid1, raid10, raid01, raid5等原理。</h2><p>独立硬盘冗余阵列（RAID, Redundant Array of Independent Disks），旧称廉价磁盘冗余阵列 （Redundant Array of Inexpensive Disks），简称磁盘阵列。利用虚拟化存储技术把多个硬盘组合起 来，成为一个或多个硬盘阵列组，目的为提升性能或数据冗余，或是两者同时提升。 </p><p>RAID功能实现：1、 提高IO能力，磁盘并行读写 ；2、提高耐用性，磁盘冗余算法来实现。 </p><p>（1）raid0,  条带集</p><p>以 chunk 单位,读写数据,因为读写时都可以并行处理，所以在所有的级别中，RAID 0的速度是最快的。 但是RAID 0既没有冗余功能，也不具备容错能力，如果一个磁盘（物理）损坏，所有数据都会丢失 .</p><p>磁盘利用率：100%</p><p>优点：读写速度快</p><p>缺点：不容错</p><p>硬盘个数：2+</p><p><img src="1656763185363.png" alt="1656763185363"></p><p>（2）raid1, 镜像集</p><p>也称为镜像, 两组以上的N个磁盘相互作镜像，在一些多线程操作系统中能有很好的读取速度，理论上读 取速度等于硬盘数量的倍数，与RAID 0相同。另外写入速度有微小的降低。 </p><p>磁盘利用率：50%</p><p>优点：读写速率一般，容错</p><p>硬盘个数：2</p><p><img src="1656763499122.png" alt="1656763499122"></p><p>（3）raid10, 先镜像后条带（RAID1的安全+RAID0的高速）</p><p>磁盘利用率：50%</p><p>优点：读写速率快，容错</p><p>硬盘个数：4</p><p><img src="1656763529259.png" alt="1656763529259"></p><p>（4）raid01, 先条带后镜像</p><p><img src="1656763543110.png" alt="1656763543110"></p><p>（5）raid5 ，带奇偶校验的条带集</p><p>磁盘利用率：(n-1)/n</p><p>优点：读写速率快，容错，允许坏一块硬盘</p><p>硬盘个数：3,3+</p><p><img src="1656763572737.png" alt="1656763572737"></p><p>（6）raid6，带奇偶校验的条带集（双份校验位,算法更复杂 ）</p><p>磁盘利用率：(n-2)/n</p><p>优点：读写速率快，容错，允许坏两块硬盘</p><p>硬盘个数：4,4+</p><p><img src="1656763589189.png" alt="1656763589189"></p><h2 id="2、创建一个至少有两个PV组成的大小为20G的名为testvg的VG，要求PE大小为16M，而后在卷组中创建大小为5G的逻辑卷testlv-挂载至-users目录"><a href="#2、创建一个至少有两个PV组成的大小为20G的名为testvg的VG，要求PE大小为16M，而后在卷组中创建大小为5G的逻辑卷testlv-挂载至-users目录" class="headerlink" title="2、创建一个至少有两个PV组成的大小为20G的名为testvg的VG，要求PE大小为16M，而后在卷组中创建大小为5G的逻辑卷testlv;挂载至/users目录"></a>2、创建一个至少有两个PV组成的大小为20G的名为testvg的VG，要求PE大小为16M，而后在卷组中创建大小为5G的逻辑卷testlv;挂载至/users目录</h2><p>（1）添加硬盘</p><p><img src="1656763749199.png" alt="1656763749199"></p><p>（2）此时系统还没有识别到新增加的硬盘 ，需要使用命令进行扫描硬盘</p><figure class="highlight tap"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><pre><code class="hljs tap">[root@node1 test]<span class="hljs-comment"># echo &#x27;- - -&#x27; &gt; /sys/class/scsi_host/host0/scan </span><br>[root@node1 test]<span class="hljs-comment"># ll /dev/sd*</span><br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 0 </span>Jun<span class="hljs-number"> 19 </span>07:45 /dev/sda<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 1 </span>Jun<span class="hljs-number"> 19 </span>07:45 /dev/sda1<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 2 </span>Jun<span class="hljs-number"> 19 </span>07:45 /dev/sda2<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 16 </span>Jun<span class="hljs-number"> 19 </span>07:45 /dev/sdb<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 32 </span>Jun<span class="hljs-number"> 20 </span>10:16 /dev/sdc<br>[root@node1 test]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm  /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm  [SWAP]<br>sdb               8:16  <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>disk <br>sdc               8:32  <span class="hljs-number"> 0 </span>  18G <span class="hljs-number"> 0 </span>disk <br>sr0              11:0   <span class="hljs-number"> 1 </span> 4.4G <span class="hljs-number"> 0 </span>rom<br></code></pre></td></tr></table></figure><p>（3）创建PV</p><figure class="highlight irpf90"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs irpf90">[root@node1 test]# pvcreate /dev/sdb <br>  Physical volume <span class="hljs-string">&quot;/dev/sdb&quot;</span> successfully created.<br>   <br>[root@node1 test]# pvcreate /dev/sdc <br>  Physical volume <span class="hljs-string">&quot;/dev/sdc&quot;</span> successfully created.<br>  <br>[root@node1 test]# pvdisplay<br>  --- Physical volume ---<br>  PV <span class="hljs-keyword">Name</span>               /dev/sda2<br>  VG <span class="hljs-keyword">Name</span>               centos<br>  PV <span class="hljs-built_in">Size</span>               &lt;<span class="hljs-number">19.00</span> GiB / not usable <span class="hljs-number">3.00</span> MiB<br>  <span class="hljs-keyword">Allocatable</span>           yes (but full)<br>  PE <span class="hljs-built_in">Size</span>               <span class="hljs-number">4.00</span> MiB<br>  Total PE              <span class="hljs-number">4863</span><br>  <span class="hljs-keyword">Free</span> PE               <span class="hljs-number">0</span><br>  <span class="hljs-built_in">Allocated</span> PE          <span class="hljs-number">4863</span><br>  PV UUID               Pcy8Mo-duHv-KVJI-NGLy-CCln-pDEl-zUOaPV<br>   <br>  <span class="hljs-string">&quot;/dev/sdb&quot;</span> is a new physical volume of <span class="hljs-string">&quot;2.00 GiB&quot;</span><br>  --- NEW Physical volume ---<br>  PV <span class="hljs-keyword">Name</span>               /dev/sdb<br>  VG <span class="hljs-keyword">Name</span>               <br>  PV <span class="hljs-built_in">Size</span>               <span class="hljs-number">2.00</span> GiB<br>  <span class="hljs-keyword">Allocatable</span>           NO<br>  PE <span class="hljs-built_in">Size</span>               <span class="hljs-number">0</span>   <br>  Total PE              <span class="hljs-number">0</span><br>  <span class="hljs-keyword">Free</span> PE               <span class="hljs-number">0</span><br>  <span class="hljs-built_in">Allocated</span> PE          <span class="hljs-number">0</span><br>  PV UUID               sCiC1O-wM9v-ecWQ-Knx3-JCEx-jX4E-rLTmQ1<br>   <br>  <span class="hljs-string">&quot;/dev/sdc&quot;</span> is a new physical volume of <span class="hljs-string">&quot;18.00 GiB&quot;</span><br>  --- NEW Physical volume ---<br>  PV <span class="hljs-keyword">Name</span>               /dev/sdc<br>  VG <span class="hljs-keyword">Name</span>               <br>  PV <span class="hljs-built_in">Size</span>               <span class="hljs-number">18.00</span> GiB<br>  <span class="hljs-keyword">Allocatable</span>           NO<br>  PE <span class="hljs-built_in">Size</span>               <span class="hljs-number">0</span>   <br>  Total PE              <span class="hljs-number">0</span><br>  <span class="hljs-keyword">Free</span> PE               <span class="hljs-number">0</span><br>  <span class="hljs-built_in">Allocated</span> PE          <span class="hljs-number">0</span><br>  PV UUID               dsIn9M-LD1O-jD8R-<span class="hljs-number">6</span>S9b-i7ts-sJmG-GOz45s<br>  <br>  [root@node1 test]# pvs<br>  PV         VG     <span class="hljs-keyword">Fmt</span>  Attr PSize   PFree <br>  /dev/sda2  centos lvm2 a--  &lt;<span class="hljs-number">19.00</span>g     <span class="hljs-number">0</span> <br>  /dev/sdb          lvm2 ---    <span class="hljs-number">2.00</span>g  <span class="hljs-number">2.00</span>g<br>  /dev/sdc          lvm2 ---   <span class="hljs-number">18.00</span>g <span class="hljs-number">18.00</span>g<br></code></pre></td></tr></table></figure><p>（4）创建VG</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 test]# vgcreate -s <span class="hljs-number">16</span>M testvg /dev/sdb /dev/sdc<br>  Volume <span class="hljs-keyword">group</span> &quot;testvg&quot; successfully created<br>  <br>[root@node1 test]# vgs<br>  VG     #PV #LV #SN Attr   VSize   VFree  <br>  centos   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">0</span> wz<span class="hljs-comment">--n- &lt;19.00g      0 </span><br>  testvg   <span class="hljs-number">2</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span> wz<span class="hljs-comment">--n- &lt;19.97g &lt;19.97g</span><br>  <br>[root@node1 test]# vgdisplay<br>  <span class="hljs-comment">--- Volume group ---</span><br>  VG <span class="hljs-type">Name</span>               centos<br>  <span class="hljs-keyword">System</span> ID             <br>  <span class="hljs-keyword">Format</span>                lvm2<br>  Metadata Areas        <span class="hljs-number">1</span><br>  Metadata <span class="hljs-keyword">Sequence</span> <span class="hljs-keyword">No</span>  <span class="hljs-number">3</span><br>  VG <span class="hljs-keyword">Access</span>             <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  VG Status             resizable<br>  MAX LV                <span class="hljs-number">0</span><br>  Cur LV                <span class="hljs-number">2</span><br>  <span class="hljs-keyword">Open</span> LV               <span class="hljs-number">2</span><br>  Max PV                <span class="hljs-number">0</span><br>  Cur PV                <span class="hljs-number">1</span><br>  Act PV                <span class="hljs-number">1</span><br>  VG Size               &lt;<span class="hljs-number">19.00</span> GiB<br>  PE Size               <span class="hljs-number">4.00</span> MiB<br>  Total PE              <span class="hljs-number">4863</span><br>  Alloc PE / Size       <span class="hljs-number">4863</span> / &lt;<span class="hljs-number">19.00</span> GiB<br>  Free  PE / Size       <span class="hljs-number">0</span> / <span class="hljs-number">0</span>   <br>  VG <span class="hljs-type">UUID</span>               <span class="hljs-number">9</span>KnTtD<span class="hljs-number">-88</span>ve-B3cy-Ftc7-TplO-oVwc<span class="hljs-number">-5</span>SfeZh<br>   <br>  <span class="hljs-comment">--- Volume group ---</span><br>  VG <span class="hljs-type">Name</span>               testvg<br>  <span class="hljs-keyword">System</span> ID             <br>  <span class="hljs-keyword">Format</span>                lvm2<br>  Metadata Areas        <span class="hljs-number">2</span><br>  Metadata <span class="hljs-keyword">Sequence</span> <span class="hljs-keyword">No</span>  <span class="hljs-number">1</span><br>  VG <span class="hljs-keyword">Access</span>             <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  VG Status             resizable<br>  MAX LV                <span class="hljs-number">0</span><br>  Cur LV                <span class="hljs-number">0</span><br>  <span class="hljs-keyword">Open</span> LV               <span class="hljs-number">0</span><br>  Max PV                <span class="hljs-number">0</span><br>  Cur PV                <span class="hljs-number">2</span><br>  Act PV                <span class="hljs-number">2</span><br>  VG Size               &lt;<span class="hljs-number">19.97</span> GiB<br>  PE Size               <span class="hljs-number">16.00</span> MiB<br>  Total PE              <span class="hljs-number">1278</span><br>  Alloc PE / Size       <span class="hljs-number">0</span> / <span class="hljs-number">0</span>   <br>  Free  PE / Size       <span class="hljs-number">1278</span> / &lt;<span class="hljs-number">19.97</span> GiB<br>  VG <span class="hljs-type">UUID</span>               Jp1YqS-l0O0-vboZ-eLyu<span class="hljs-number">-4</span>w4M-pAGj-USbKEU<br></code></pre></td></tr></table></figure><p>（5）创建LV</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 test]# lvcreate -L <span class="hljs-number">5</span>G -n testlv testvg<br>  Logical volume &quot;testlv&quot; created.<br>  <br>[root@node1 test]# lvs<br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  <span class="hljs-keyword">Move</span> <span class="hljs-keyword">Log</span> Cpy%Sync Convert<br>  root   centos -wi-ao<span class="hljs-comment">---- &lt;17.00g                                                    </span><br>  swap   centos -wi-ao<span class="hljs-comment">----   2.00g                                                    </span><br>  testlv testvg -wi-a<span class="hljs-comment">-----   5.00g     </span><br>  <br>[root@node1 test]# lvdisplay<br>  <span class="hljs-comment">--- Logical volume ---</span><br>  LV <span class="hljs-type">Path</span>                /dev/centos/swap<br>  LV <span class="hljs-type">Name</span>                swap<br>  VG <span class="hljs-type">Name</span>                centos<br>  LV <span class="hljs-type">UUID</span>                <span class="hljs-number">4</span>mNwDD-vOdz-y4WI<span class="hljs-number">-9</span>FlR-FufL-bt5c-Kh6gOq<br>  LV <span class="hljs-keyword">Write</span> <span class="hljs-keyword">Access</span>        <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  LV Creation host, <span class="hljs-type">time</span> localhost, <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-08</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">57</span> <span class="hljs-number">-0400</span><br>  LV Status              available<br>  # <span class="hljs-keyword">open</span>                 <span class="hljs-number">2</span><br>  LV Size                <span class="hljs-number">2.00</span> GiB<br>  <span class="hljs-keyword">Current</span> LE             <span class="hljs-number">512</span><br>  Segments               <span class="hljs-number">1</span><br>  Allocation             <span class="hljs-keyword">inherit</span><br>  <span class="hljs-keyword">Read</span> ahead sectors     auto<br>  - currently <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span>     <span class="hljs-number">256</span><br>  Block device           <span class="hljs-number">253</span>:<span class="hljs-number">1</span><br>   <br>  <span class="hljs-comment">--- Logical volume ---</span><br>  LV <span class="hljs-type">Path</span>                /dev/centos/root<br>  LV <span class="hljs-type">Name</span>                root<br>  VG <span class="hljs-type">Name</span>                centos<br>  LV <span class="hljs-type">UUID</span>                <span class="hljs-number">8</span>O7iWh-vgrE-dDPW<span class="hljs-number">-3</span>f6S-ofbX-pZPK-Eed0tV<br>  LV <span class="hljs-keyword">Write</span> <span class="hljs-keyword">Access</span>        <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  LV Creation host, <span class="hljs-type">time</span> localhost, <span class="hljs-number">2021</span><span class="hljs-number">-08</span><span class="hljs-number">-08</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">57</span> <span class="hljs-number">-0400</span><br>  LV Status              available<br>  # <span class="hljs-keyword">open</span>                 <span class="hljs-number">1</span><br>  LV Size                &lt;<span class="hljs-number">17.00</span> GiB<br>  <span class="hljs-keyword">Current</span> LE             <span class="hljs-number">4351</span><br>  Segments               <span class="hljs-number">1</span><br>  Allocation             <span class="hljs-keyword">inherit</span><br>  <span class="hljs-keyword">Read</span> ahead sectors     auto<br>  - currently <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span>     <span class="hljs-number">256</span><br>  Block device           <span class="hljs-number">253</span>:<span class="hljs-number">0</span><br>   <br>  <span class="hljs-comment">--- Logical volume ---</span><br>  LV <span class="hljs-type">Path</span>                /dev/testvg/testlv<br>  LV <span class="hljs-type">Name</span>                testlv<br>  VG <span class="hljs-type">Name</span>                testvg<br>  LV <span class="hljs-type">UUID</span>                xXdpZU-KAj3<span class="hljs-number">-1</span>MGn-HVeO-lVWh<span class="hljs-number">-3</span>wTQ<span class="hljs-number">-10</span>x2b1<br>  LV <span class="hljs-keyword">Write</span> <span class="hljs-keyword">Access</span>        <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  LV Creation host, <span class="hljs-type">time</span> node1, <span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-20</span> <span class="hljs-number">10</span>:<span class="hljs-number">30</span>:<span class="hljs-number">33</span> <span class="hljs-number">-0400</span><br>  LV Status              available<br>  # <span class="hljs-keyword">open</span>                 <span class="hljs-number">0</span><br>  LV Size                <span class="hljs-number">5.00</span> GiB<br>  <span class="hljs-keyword">Current</span> LE             <span class="hljs-number">320</span><br>  Segments               <span class="hljs-number">1</span><br>  Allocation             <span class="hljs-keyword">inherit</span><br>  <span class="hljs-keyword">Read</span> ahead sectors     auto<br>  - currently <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span>     <span class="hljs-number">256</span><br>  Block device           <span class="hljs-number">253</span>:<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>（6）格式化并挂载文件系统</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 test]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm  /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm  [SWAP]<br>sdb               8:16  <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>disk <br>sdc               8:32  <span class="hljs-number"> 0 </span>  18G <span class="hljs-number"> 0 </span>disk <br>└─testvg-testlv 253:2   <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>lvm  <br>sr0              11:0   <span class="hljs-number"> 1 </span> 4.4G <span class="hljs-number"> 0 </span>rom  <br>[root@node1 test]<span class="hljs-comment"># df -h</span><br>Filesystem               Size  Used Avail Use% Mounted on<br>devtmpfs                 475M    <span class="hljs-number"> 0 </span> 475M   0% /dev<br>tmpfs                    487M    <span class="hljs-number"> 0 </span> 487M   0% /dev/shm<br>tmpfs                    487M  7.8M  479M   2% /run<br>tmpfs                    487M    <span class="hljs-number"> 0 </span> 487M   0% /sys/fs/cgroup<br>/dev/mapper/centos-root   17G  1.3G   16G   8% /<br>/dev/sda1               1014M  138M  877M  14% /boot<br>tmpfs                     98M    <span class="hljs-number"> 0 </span>  98M   0% /run/user/0<br><br>[root@node1 test]<span class="hljs-comment"># ll /dev/testvg/testlv</span><br>lrwxrwxrwx<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 7 </span>Jun<span class="hljs-number"> 20 </span>10:30 /dev/testvg/testlv -&gt; ../dm-2<br><br>[root@node1 test]<span class="hljs-comment"># mkfs.ext4 /dev/testvg/testlv </span><br>mke2fs 1.42.9 (28-Dec-2013)<br>Filesystem label=<br>OS type: Linux<br>Block size=4096 (log=2)<br>Fragment size=4096 (log=2)<br>Stride=0 blocks, Stripe width=0 blocks<br>327680 inodes,<span class="hljs-number"> 1310720 </span>blocks<br>65536 blocks (5.00%) reserved for the super user<br>First data block=0<br>Maximum filesystem blocks=1342177280<br>40 block groups<br>32768 blocks per group,<span class="hljs-number"> 32768 </span>fragments per group<br>8192 inodes per group<br>Superblock backups stored on blocks: <br>32768, 98304, 163840, 229376, 294912, 819200, 884736<br><br>Allocating group tables: done                            <br>Writing inode tables: done                            <br>Creating journal (32768 blocks): done<br>Writing superblocks and filesystem accounting information: done <br><br>[root@node1 test]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm  /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm  [SWAP]<br>sdb               8:16  <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>disk <br>sdc               8:32  <span class="hljs-number"> 0 </span>  18G <span class="hljs-number"> 0 </span>disk <br>└─testvg-testlv 253:2   <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>lvm  <br>sr0              11:0   <span class="hljs-number"> 1 </span> 4.4G <span class="hljs-number"> 0 </span>rom <br><br>[root@node1 test]<span class="hljs-comment"># mkdir /users</span><br>[root@node1 test]<span class="hljs-comment"># mount /dev/testvg/testlv /users/</span><br>[root@node1 test]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   475M    <span class="hljs-number"> 0 </span> 475M   0% /dev<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /dev/shm<br>tmpfs                      487M  7.8M  479M   2% /run<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /sys/fs/cgroup<br>/dev/mapper/centos-root     17G  1.3G   16G   8% /<br>/dev/sda1                 1014M  138M  877M  14% /boot<br>tmpfs                       98M    <span class="hljs-number"> 0 </span>  98M   0% /run/user/0<br>/dev/mapper/testvg-testlv  4.8G   20M  4.6G   1% /users<br></code></pre></td></tr></table></figure><h2 id="3、新建用户archlinux-要求其家目录为-users-archlinux，而后su切换至archlinux用户，复制-etc-pam-d-目录至自己的家目录。"><a href="#3、新建用户archlinux-要求其家目录为-users-archlinux，而后su切换至archlinux用户，复制-etc-pam-d-目录至自己的家目录。" class="headerlink" title="3、新建用户archlinux,要求其家目录为/users/archlinux，而后su切换至archlinux用户，复制/etc/pam.d/目录至自己的家目录。"></a>3、新建用户archlinux,要求其家目录为/users/archlinux，而后su切换至archlinux用户，复制/etc/pam.d/目录至自己的家目录。</h2><p>（1）新建用户</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ruby">[root<span class="hljs-variable">@node1</span> test]<span class="hljs-comment"># useradd -d /users/archlinux archlinux</span><br>[root<span class="hljs-variable">@node1</span> test]<span class="hljs-comment"># id archlinux</span><br>uid=<span class="hljs-number">1000</span>(archlinux) gid=<span class="hljs-number">1000</span>(archlinux) groups=<span class="hljs-number">1000</span>(archlinux)<br>[root<span class="hljs-variable">@node1</span> test]<span class="hljs-comment"># grep archlinux /etc/passwd</span><br><span class="hljs-symbol">archlinux:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/users/archlinux</span><span class="hljs-symbol">:/bin/bash</span><br>[root<span class="hljs-variable">@node1</span> test]<span class="hljs-comment"># ls /users/archlinux/</span><br>[root<span class="hljs-variable">@node1</span> test]<span class="hljs-comment"># ll -d /users/archlinux/</span><br>drwx------ <span class="hljs-number">2</span> archlinux archlinux <span class="hljs-number">4096</span> Jun <span class="hljs-number">20</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span> /users/archlinux/<br></code></pre></td></tr></table></figure><p>（2）复制/etc/pam.d/目录至自己的家目录。</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs tap">[archlinux@node1 ~]$ echo $HOME<br>/users/archlinux<br>[archlinux@node1 ~]$ cp -rp /etc/pam.d/ $HOME<br>[archlinux@node1 ~]$ ll $HOME<br>total 4<br>drwxr-xr-x<span class="hljs-number"> 2 </span>archlinux archlinux<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>pam.d<br>[archlinux@node1 ~]$ ll $HOME/pam.d <br>total 100<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 192 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>chfn<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 192 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>chsh<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 232 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>config-util<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 287 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2019 </span>crond<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 19 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>fingerprint-auth -&gt; fingerprint-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 702 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>fingerprint-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 796 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>login<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 154 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>other<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 188 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>passwd<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 16 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>password-auth -&gt; password-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux<span class="hljs-number"> 1033 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>password-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 155 </span>Apr <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>polkit-1<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 12 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>postlogin -&gt; postlogin-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 330 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>postlogin-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 681 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>remote<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 143 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>runuser<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 138 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>runuser-l<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 17 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smartcard-auth -&gt; smartcard-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 752 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smartcard-auth-ac<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 25 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smtp -&gt; /etc/alternatives/mta-pam<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 76 </span>Apr <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>smtp.postfix<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 904 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2019 </span>sshd<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 540 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>su<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 200 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>sudo<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 178 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>sudo-i<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 137 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>su-l<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 14 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>system-auth -&gt; system-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux<span class="hljs-number"> 1031 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>system-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 129 </span>Oct <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>systemd-user<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 84 </span>Oct<span class="hljs-number"> 30 </span><span class="hljs-number"> 2018 </span>vlock<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 278 </span>Oct <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>vmtoolsd<br></code></pre></td></tr></table></figure><h2 id="4、扩展testlv至7G，要求archlinux用户的文件不能丢失"><a href="#4、扩展testlv至7G，要求archlinux用户的文件不能丢失" class="headerlink" title="4、扩展testlv至7G，要求archlinux用户的文件不能丢失"></a>4、扩展testlv至7G，要求archlinux用户的文件不能丢失</h2><p>（1）在线扩展逻辑卷至7G</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># lvs</span><br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root   centos -wi-ao---- &lt;17.00g                                                    <br>  swap   centos -wi-ao----   2.00g                                                    <br>  testlv testvg -wi-ao----   5.00g  <br><br>[root@node1 ~]<span class="hljs-comment"># lvextend -L 7G /dev/testvg/testlv </span><br>  Size of logical volume testvg/testlv changed from 5.00 GiB (320 extents) to 7.00 GiB (448 extents).<br>  Logical volume testvg/testlv successfully resized.<br>[root@node1 ~]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm  /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm  [SWAP]<br>sdb               8:16  <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>disk <br>sdc               8:32  <span class="hljs-number"> 0 </span>  18G <span class="hljs-number"> 0 </span>disk <br>└─testvg-testlv 253:2   <span class="hljs-number"> 0 </span>   7G <span class="hljs-number"> 0 </span>lvm  /users<br>sr0              11:0   <span class="hljs-number"> 1 </span> 4.4G <span class="hljs-number"> 0 </span>rom  <br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   475M    <span class="hljs-number"> 0 </span> 475M   0% /dev<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /dev/shm<br>tmpfs                      487M  7.8M  479M   2% /run<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /sys/fs/cgroup<br>/dev/mapper/centos-root     17G  1.3G   16G   8% /<br>/dev/sda1                 1014M  138M  877M  14% /boot<br>tmpfs                       98M    <span class="hljs-number"> 0 </span>  98M   0% /run/user/0<br>/dev/mapper/testvg-testlv  4.8G   21M  4.6G   1% /users<br><br>[root@node1 ~]<span class="hljs-comment"># lvs</span><br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root   centos -wi-ao---- &lt;17.00g                                                    <br>  swap   centos -wi-ao----   2.00g                                                    <br>  testlv testvg -wi-ao----   7.00g  <br></code></pre></td></tr></table></figure><p>（2）扩展文件系统</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># resize2fs /dev/testvg/testlv </span><br>resize2fs 1.42.9 (28-Dec-2013)<br>Filesystem at /dev/testvg/testlv is mounted on /users; on-line resizing required<br>old_desc_blocks = 1, new_desc_blocks = 1<br>The filesystem on /dev/testvg/testlv is now<span class="hljs-number"> 1835008 </span>blocks long.<br><br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   475M    <span class="hljs-number"> 0 </span> 475M   0% /dev<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /dev/shm<br>tmpfs                      487M  7.8M  479M   2% /run<br>tmpfs                      487M    <span class="hljs-number"> 0 </span> 487M   0% /sys/fs/cgroup<br>/dev/mapper/centos-root     17G  1.3G   16G   8% /<br>/dev/sda1                 1014M  138M  877M  14% /boot<br>tmpfs                       98M    <span class="hljs-number"> 0 </span>  98M   0% /run/user/0<br>/dev/mapper/testvg-testlv  6.8G   23M  6.4G   1% /users<br><br>[root@node1 ~]<span class="hljs-comment"># ll /users/archlinux/pam.d/</span><br>total 100<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 192 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>chfn<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 192 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>chsh<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 232 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>config-util<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 287 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2019 </span>crond<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 19 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>fingerprint-auth -&gt; fingerprint-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 702 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>fingerprint-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 796 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>login<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 154 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>other<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 188 </span>Mar<span class="hljs-number"> 31 </span><span class="hljs-number"> 2020 </span>passwd<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 16 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>password-auth -&gt; password-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux<span class="hljs-number"> 1033 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>password-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 155 </span>Apr <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>polkit-1<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 12 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>postlogin -&gt; postlogin-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 330 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>postlogin-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 681 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>remote<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 143 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>runuser<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 138 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>runuser-l<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 17 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smartcard-auth -&gt; smartcard-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 752 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smartcard-auth-ac<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 25 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>smtp -&gt; /etc/alternatives/mta-pam<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 76 </span>Apr <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>smtp.postfix<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 904 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2019 </span>sshd<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 540 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>su<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 200 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>sudo<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 178 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>sudo-i<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 137 </span>Sep<span class="hljs-number"> 30 </span><span class="hljs-number"> 2020 </span>su-l<br>lrwxrwxrwx<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 14 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>system-auth -&gt; system-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux<span class="hljs-number"> 1031 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>system-auth-ac<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 129 </span>Oct <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>systemd-user<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux  <span class="hljs-number"> 84 </span>Oct<span class="hljs-number"> 30 </span><span class="hljs-number"> 2018 </span>vlock<br>-rw-r--r--<span class="hljs-number"> 1 </span>archlinux archlinux <span class="hljs-number"> 278 </span>Oct <span class="hljs-number"> 1 </span><span class="hljs-number"> 2020 </span>vmtoolsd<br></code></pre></td></tr></table></figure><h2 id="5、收缩testlv至3G，要求archlinux用户的文件不能丢失"><a href="#5、收缩testlv至3G，要求archlinux用户的文件不能丢失" class="headerlink" title="5、收缩testlv至3G，要求archlinux用户的文件不能丢失"></a>5、收缩testlv至3G，要求archlinux用户的文件不能丢失</h2><p>注意：缩减有数据损坏的风险，建议先备份再缩减，xfs文件系统不支持缩减 </p><p>（1）备份数据</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">[root@node1 ~]<span class="hljs-comment"># tar -cf /tmp/user.tar /users/</span><br>tar: Removing leading `/&#x27; from member names<br><br>[root@node1 ~]<span class="hljs-comment"># ll /tmp/user.tar </span><br>-rw-r<span class="hljs-params">--r--</span> 1 root root 40960 Jun 20 11<span class="hljs-function">:14</span> <span class="hljs-string">/tmp/user.tar</span><br><br>[root@node1 ~]<span class="hljs-comment"># tar -tf /tmp/user.tar </span><br>users/<br>users/lost+found/<br>users/archlinux/<br>users/archlinux/<span class="hljs-string">.bashrc</span><br>users/archlinux/pam.d/<br>users/archlinux/pam.d/login<br>users/archlinux/pam.d/config-util<br>users/archlinux/pam.d/crond<br>users/archlinux/pam.d/sudo-i<br>users/archlinux/pam.d/chsh<br>users/archlinux/pam.d/postlogin-ac<br>users/archlinux/pam.d/system-auth<br>users/archlinux/pam.d/su-l<br>users/archlinux/pam.d/vmtoolsd<br>users/archlinux/pam.d/runuser-l<br>users/archlinux/pam.d/other<br>users/archlinux/pam.d/password-auth-ac<br>users/archlinux/pam.d/postlogin<br>users/archlinux/pam.d/smartcard-auth-ac<br>users/archlinux/pam.d/su<br>users/archlinux/pam.d/fingerprint-auth-ac<br>users/archlinux/pam.d/fingerprint-auth<br>users/archlinux/pam.d/smtp<br>users/archlinux/pam.d/remote<br>users/archlinux/pam.d/systemd-user<br>users/archlinux/pam.d/passwd<br>users/archlinux/pam.d/sudo<br>users/archlinux/pam.d/runuser<br>users/archlinux/pam.d/smtp.postfix<br>users/archlinux/pam.d/sshd<br>users/archlinux/pam.d/smartcard-auth<br>users/archlinux/pam.d/vlock<br>users/archlinux/pam.d/polkit-1<br>users/archlinux/pam.d/system-auth-ac<br>users/archlinux/pam.d/chfn<br>users/archlinux/pam.d/password-auth<br>users/archlinux/<span class="hljs-string">.bash_logout</span><br>users/archlinux/<span class="hljs-string">.bash_profile</span><br></code></pre></td></tr></table></figure><p>（2）卸载要缩容的逻辑卷上的文件系统</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                      <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                      <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                      <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root     17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1                 <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                       <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv  6.8G   23M  6.4G   1% /u</span>sers<br><br>[root@node1 ~]<span class="hljs-comment"># umount /users</span><br>umount: /users: target is busy.<br>        (In some cases useful info about processes that use<br>         the device is found by lsof(<span class="hljs-number">8</span>) or fuser(<span class="hljs-number">1</span>))<br>         <br>         [root@node1 ~]<span class="hljs-comment"># umount /dev/testvg/testlv              卸载失败了怎么办？重启系统后，自动卸载掉了</span><br>umount: /users: target is busy.<br>        (In some cases useful info about processes that use<br>         the device is found by lsof(<span class="hljs-number">8</span>) or fuser(<span class="hljs-number">1</span>))<br>         <br></code></pre></td></tr></table></figure><p>（3）</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# umount <span class="hljs-regexp">/users/</span><br>[root@node1 ~]# df -h<br>Filesystem               <span class="hljs-keyword">Size</span>  Used Avail Use% Mounted on<br>devtmpfs                 <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                    <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root   17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1               <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                     <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br>[root@node1 ~]# resize2fs <span class="hljs-regexp">/dev/</span>testvg/testlv <span class="hljs-number">3</span>G<br>resize2fs <span class="hljs-number">1.42</span>.<span class="hljs-number">9</span> (<span class="hljs-number">28</span>-Dec-<span class="hljs-number">2013</span>)<br>Please run <span class="hljs-string">&#x27;e2fsck -f /dev/testvg/testlv&#x27;</span> first.<br></code></pre></td></tr></table></figure><p>（4）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 ~]<span class="hljs-comment"># fsck -f /dev/testvg/testlv </span><br>fsck from util-linux <span class="hljs-number">2.23</span>.<span class="hljs-number">2</span><br>e2fsck <span class="hljs-number">1.42</span>.<span class="hljs-number">9</span> (<span class="hljs-number">28</span>-Dec-<span class="hljs-number">2013</span>)<br>Pass <span class="hljs-number">1</span>: Checking inodes, blocks, and sizes<br>Pass <span class="hljs-number">2</span>: Checking directory structure<br>Pass <span class="hljs-number">3</span>: Checking directory connectivity<br>Pass <span class="hljs-number">4</span>: Checking reference counts<br>Pass <span class="hljs-number">5</span>: Checking group summary information<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv: 47/</span><span class="hljs-number">458752</span> files (<span class="hljs-number">0.0</span>% non-contiguous), <span class="hljs-number">67357</span>/<span class="hljs-number">1835008</span> blocks<br>[root@node1 ~]<span class="hljs-comment"># resize2fs /dev/testvg/testlv 3G</span><br>resize2fs <span class="hljs-number">1.42</span>.<span class="hljs-number">9</span> (<span class="hljs-number">28</span>-Dec-<span class="hljs-number">2013</span>)<br>Resizing the filesystem on <span class="hljs-regexp">/dev/</span>testvg/testlv to <span class="hljs-number">786432</span> (<span class="hljs-number">4</span>k) blocks.<br>The filesystem on <span class="hljs-regexp">/dev/</span>testvg/testlv is now <span class="hljs-number">786432</span> blocks long.<br><br>[root@node1 ~]<span class="hljs-comment"># lvs</span><br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root   centos -wi-ao---- &lt;<span class="hljs-number">17.00</span>g                                                    <br>  swap   centos -wi-ao----   <span class="hljs-number">2.00</span>g                                                    <br>  testlv testvg -wi-a-----   <span class="hljs-number">7.00</span>g                                                    <br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem               Size  Used Avail Use% Mounted on<br>devtmpfs                 <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                    <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root   17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1               <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                     <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br>[root@node1 ~]<span class="hljs-comment"># cat /etc/fstab </span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># /etc/fstab</span><br><span class="hljs-comment"># Created by anaconda on Sun Aug  8 15:12:58 2021</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="hljs-comment">#</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root /</span>                       xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>UUID=f7d6f590-<span class="hljs-number">611</span>d-<span class="hljs-number">44</span>bb-<span class="hljs-number">8228</span>-bcd7e1a43333 /boot                   xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper/centos-swap swap                    swap    defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>[root@node1 ~]<span class="hljs-comment"># vim /etc/fstab </span><br>-bash: vim: command not found<br>[root@node1 ~]<span class="hljs-comment"># vi /etc/fstab </span><br>[root@node1 ~]<span class="hljs-comment"># cat /etc/fstab </span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># /etc/fstab</span><br><span class="hljs-comment"># Created by anaconda on Sun Aug  8 15:12:58 2021</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="hljs-comment">#</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root /</span>                       xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>UUID=f7d6f590-<span class="hljs-number">611</span>d-<span class="hljs-number">44</span>bb-<span class="hljs-number">8228</span>-bcd7e1a43333 /boot                   xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper/centos-swap swap                    swap    defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/</span>testvg<span class="hljs-regexp">/testlv /u</span>sers/ext4defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>[root@node1 ~]<span class="hljs-comment"># mount -a</span><br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                      <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                      <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                      <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root     17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1                 <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                       <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv  2.9G   16M  2.7G   1% /u</span>sers<br></code></pre></td></tr></table></figure><p>（5）</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># umount /users/</span><br>[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># lvreduce -L 3G /dev/testvg/testlv </span><br>  <span class="hljs-symbol">WARNING:</span> Reducing active logical volume to <span class="hljs-number">3.00</span> GiB.<br>  THIS MAY DESTROY YOUR DATA (filesystem etc.)<br>Do you really want to reduce testvg/testlv? [y/n]: y<br>  Size <span class="hljs-keyword">of</span> logical volume testvg/testlv changed from <span class="hljs-number">7.00</span> GiB (<span class="hljs-number">448</span> extents) to <span class="hljs-number">3.00</span> GiB (<span class="hljs-number">192</span> extents).<br>  Logical volume testvg/testlv successfully resized.<br>[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># lvs</span><br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root   centos -wi-ao---- &lt;<span class="hljs-number">17.00</span>g                                                    <br>  swap   centos -wi-ao----   <span class="hljs-number">2.00</span>g                                                    <br>  testlv testvg -wi-a-----   <span class="hljs-number">3.00</span>g                                                    <br>[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># mount -a</span><br>[root<span class="hljs-variable">@node1</span> ~]<span class="hljs-comment"># df -h</span><br>Filesystem                 Size  Used Avail Use% Mounted on<br>devtmpfs                   <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev</span><br><span class="hljs-regexp">tmpfs                      487M     0  487M   0% /dev</span><span class="hljs-regexp">/shm</span><br><span class="hljs-regexp">tmpfs                      487M  7.8M  479M   2% /run</span><br>tmpfs                      <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/fs</span><span class="hljs-regexp">/cgroup</span><br><span class="hljs-regexp">/dev</span><span class="hljs-regexp">/mapper/centos</span>-root     <span class="hljs-number">17</span>G  <span class="hljs-number">1.3</span>G   <span class="hljs-number">16</span>G   <span class="hljs-number">8</span>% <span class="hljs-regexp">/</span><br><span class="hljs-regexp">/dev</span><span class="hljs-regexp">/sda1                 1014M  138M  877M  14% /boot</span><br>tmpfs                       <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/user</span><span class="hljs-regexp">/0</span><br><span class="hljs-regexp">/dev</span><span class="hljs-regexp">/mapper/testvg</span>-testlv  <span class="hljs-number">2.9</span>G   <span class="hljs-number">16</span>M  <span class="hljs-number">2.7</span>G   <span class="hljs-number">1</span>% <span class="hljs-regexp">/users</span><br></code></pre></td></tr></table></figure><h2 id="6、对testlv创建快照，并尝试基于快照备份数据，验正快照的功能"><a href="#6、对testlv创建快照，并尝试基于快照备份数据，验正快照的功能" class="headerlink" title="6、对testlv创建快照，并尝试基于快照备份数据，验正快照的功能"></a>6、对testlv创建快照，并尝试基于快照备份数据，验正快照的功能</h2><p>（1）为现有逻辑卷/dev/testvg/testlv 创建快照<br>ext4必须使用-p r 实现只读 （否则快照是可以被别人篡改的，那样的话备份就没有意义了）</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 ~]# lvcreate -l <span class="hljs-number">64</span> -s -n <span class="hljs-keyword">user</span>-<span class="hljs-keyword">snapshot</span> -p r /dev/testvg/testlv <br>  Logical volume &quot;user-snapshot&quot; created.<br>[root@node1 ~]# lvs<br>  LV            VG     Attr       LSize   Pool Origin Data%  Meta%  <span class="hljs-keyword">Move</span> <span class="hljs-keyword">Log</span> Cpy%Sync Convert<br>  root          centos -wi-ao<span class="hljs-comment">---- &lt;17.00g                                                    </span><br>  swap          centos -wi-ao<span class="hljs-comment">----   2.00g                                                    </span><br>  testlv        testvg owi-aos<span class="hljs-comment">---   3.00g                                                    </span><br>  <span class="hljs-keyword">user</span>-<span class="hljs-keyword">snapshot</span> testvg sri-a-s<span class="hljs-comment">---   1.00g      testlv 0.01    //创建快照后会多一个逻辑卷</span><br>  <br>[root@node1 ~]# blkid<br>/dev/mapper/testvg-testlv: <span class="hljs-type">UUID</span>=&quot;1db19aff-18f0-42d5-88d2-0f4ea074d33f&quot; <span class="hljs-keyword">TYPE</span>=&quot;ext4&quot; <br>/dev/sda1: <span class="hljs-type">UUID</span>=&quot;f7d6f590-611d-44bb-8228-bcd7e1a43333&quot; <span class="hljs-keyword">TYPE</span>=&quot;xfs&quot; <br>/dev/sda2: <span class="hljs-type">UUID</span>=&quot;Pcy8Mo-duHv-KVJI-NGLy-CCln-pDEl-zUOaPV&quot; <span class="hljs-keyword">TYPE</span>=&quot;LVM2_member&quot; <br>/dev/sdb: <span class="hljs-type">UUID</span>=&quot;sCiC1O-wM9v-ecWQ-Knx3-JCEx-jX4E-rLTmQ1&quot; <span class="hljs-keyword">TYPE</span>=&quot;LVM2_member&quot; <br>/dev/sr0: <span class="hljs-type">UUID</span>=&quot;2020-11-04-11-36-43-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; <span class="hljs-keyword">TYPE</span>=&quot;iso9660&quot; PTTYPE=&quot;dos&quot; <br>/dev/sdc: <span class="hljs-type">UUID</span>=&quot;dsIn9M-LD1O-jD8R-6S9b-i7ts-sJmG-GOz45s&quot; <span class="hljs-keyword">TYPE</span>=&quot;LVM2_member&quot; <br>/dev/mapper/centos-root: <span class="hljs-type">UUID</span>=&quot;21bd96c2-bd2c-4649-b5b0-fbb11870671c&quot; <span class="hljs-keyword">TYPE</span>=&quot;xfs&quot; <br>/dev/mapper/centos-swap: <span class="hljs-type">UUID</span>=&quot;f0fb2d3e-4915-4353-8ef4-decf20ea52a3&quot; <span class="hljs-keyword">TYPE</span>=&quot;swap&quot; <br>/dev/mapper/testvg-<span class="hljs-keyword">user</span><span class="hljs-comment">--snapshot: UUID=&quot;1db19aff-18f0-42d5-88d2-0f4ea074d33f&quot; TYPE=&quot;ext4&quot;   //uuid是一样的</span><br>  <br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@node1 ~]# lvdisplay<br>  <span class="hljs-comment">--- Logical volume ---</span><br>  LV <span class="hljs-type">Path</span>                /dev/testvg/testlv<br>  LV <span class="hljs-type">Name</span>                testlv<br>  VG <span class="hljs-type">Name</span>                testvg<br>  LV <span class="hljs-type">UUID</span>                xXdpZU-KAj3<span class="hljs-number">-1</span>MGn-HVeO-lVWh<span class="hljs-number">-3</span>wTQ<span class="hljs-number">-10</span>x2b1<br>  LV <span class="hljs-keyword">Write</span> <span class="hljs-keyword">Access</span>        <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span><br>  LV Creation host, <span class="hljs-type">time</span> node1, <span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-20</span> <span class="hljs-number">10</span>:<span class="hljs-number">30</span>:<span class="hljs-number">33</span> <span class="hljs-number">-0400</span><br>  LV <span class="hljs-keyword">snapshot</span> status     source <span class="hljs-keyword">of</span><br>                         <span class="hljs-keyword">user</span>-<span class="hljs-keyword">snapshot</span> [active]<br>  LV Status              available<br>  # <span class="hljs-keyword">open</span>                 <span class="hljs-number">1</span><br>  LV Size                <span class="hljs-number">3.00</span> GiB<br>  <span class="hljs-keyword">Current</span> LE             <span class="hljs-number">192</span><br>  Segments               <span class="hljs-number">1</span><br>  Allocation             <span class="hljs-keyword">inherit</span><br>  <span class="hljs-keyword">Read</span> ahead sectors     auto<br>  - currently <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span>     <span class="hljs-number">256</span><br>  Block device           <span class="hljs-number">253</span>:<span class="hljs-number">2</span><br>   <br>  <span class="hljs-comment">--- Logical volume ---</span><br>  LV <span class="hljs-type">Path</span>                /dev/testvg/<span class="hljs-keyword">user</span>-<span class="hljs-keyword">snapshot</span><br>  LV <span class="hljs-type">Name</span>                <span class="hljs-keyword">user</span>-<span class="hljs-keyword">snapshot</span><br>  VG <span class="hljs-type">Name</span>                testvg<br>  LV <span class="hljs-type">UUID</span>                DZzugm-ieN6-yNca-eigO-NSFF-uu6O-L09uqf<br>  LV <span class="hljs-keyword">Write</span> <span class="hljs-keyword">Access</span>        <span class="hljs-keyword">read</span> <span class="hljs-keyword">only</span><br>  LV Creation host, <span class="hljs-type">time</span> node1, <span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-21</span> <span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">26</span> <span class="hljs-number">-0400</span><br>  LV <span class="hljs-keyword">snapshot</span> status     active destination <span class="hljs-keyword">for</span> testlv<br>  LV Status              available<br>  # <span class="hljs-keyword">open</span>                 <span class="hljs-number">0</span><br>  LV Size                <span class="hljs-number">3.00</span> GiB<br>  <span class="hljs-keyword">Current</span> LE             <span class="hljs-number">192</span><br>  COW-<span class="hljs-keyword">table</span> size         <span class="hljs-number">1.00</span> GiB<br>  COW-<span class="hljs-keyword">table</span> LE           <span class="hljs-number">64</span><br>  Allocated <span class="hljs-keyword">to</span> <span class="hljs-keyword">snapshot</span>  <span class="hljs-number">0.01</span>%<br>  <span class="hljs-keyword">Snapshot</span> chunk size    <span class="hljs-number">4.00</span> KiB<br>  Segments               <span class="hljs-number">1</span><br>  Allocation             <span class="hljs-keyword">inherit</span><br>  <span class="hljs-keyword">Read</span> ahead sectors     auto<br>  - currently <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span>     <span class="hljs-number">256</span><br>  Block device           <span class="hljs-number">253</span>:<span class="hljs-number">5</span><br>  <br>[root@node1 snap]# ll<br>total <span class="hljs-number">20</span><br>drwx<span class="hljs-comment">------ 3 archlinux archlinux  4096 Jun 20 10:45 archlinux</span><br>drwx<span class="hljs-comment">------ 2 root      root      16384 Jun 20 10:35 lost+found</span><br><br>快照不能被修改，说明达到了备份的效果<br>[root@node1 snap]# touch <span class="hljs-number">1.</span>txt<br>touch: cannot touch ‘<span class="hljs-number">1.</span>txt’: <span class="hljs-keyword">Read</span>-<span class="hljs-keyword">only</span> file <span class="hljs-keyword">system</span><br></code></pre></td></tr></table></figure><p>（2）挂载快照</p><p>xfs注意要使用-o ro实现只读,访止快照被修改</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 ~]<span class="hljs-comment"># mkdir /mnt/snap</span><br>[root@node1 ~]<span class="hljs-comment"># mount /dev/testvg/user-snapshot /mnt/snap/</span><br>mount: <span class="hljs-regexp">/dev/m</span>apper/testvg-user--snapshot is write-protected, mounting read-only<br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                         Size  Used Avail Use% Mounted on<br>devtmpfs                           <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                              <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root             17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1                         <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                               <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv          2.9G   16M  2.7G   1% /u</span>sers<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-user--snapshot  2.9G   16M  2.7G   1% /m</span>nt/snap<br>[root@node1 ~]<span class="hljs-comment"># ll /mnt/snap/       //这里看到的文件都是虚的</span><br>total <span class="hljs-number">20</span><br>drwx------ <span class="hljs-number">3</span> archlinux archlinux  <span class="hljs-number">4096</span> Jun <span class="hljs-number">20</span> <span class="hljs-number">10</span>:<span class="hljs-number">45</span> archlinux<br>drwx------ <span class="hljs-number">2</span> root      root      <span class="hljs-number">16384</span> Jun <span class="hljs-number">20</span> <span class="hljs-number">10</span>:<span class="hljs-number">35</span> lost+found<br><br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem                         Size  Used Avail Use% Mounted on<br>devtmpfs                           <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                              <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root             17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1                         <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                               <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv          2.9G   16M  2.7G   1% /u</span>sers<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-user--snapshot  2.9G   16M  2.7G   1% /m</span>nt/snap   快照显示的文件大小跟<br></code></pre></td></tr></table></figure><p>（3）验证快照的功能</p><p>对原来的逻辑卷进行修改</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># cd /users/archlinux/</span><br>[root@node1 archlinux]<span class="hljs-comment"># ll</span><br>total 4<br>drwxr-xr-x<span class="hljs-number"> 2 </span>archlinux archlinux<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>pam.d<br>[root@node1 archlinux]<span class="hljs-comment"># mv pam.d/ pum.d</span><br>[root@node1 archlinux]<span class="hljs-comment"># touch file1.txt</span><br>[root@node1 archlinux]<span class="hljs-comment"># ll                           1、新建了一个文件file1.txt 2、给目录pam.d重命名为pum.d</span><br>total 4<br>-rw-r--r--<span class="hljs-number"> 1 </span>root      root        <span class="hljs-number"> 0 </span>Jun<span class="hljs-number"> 21 </span>22:36 file1.txt<br>drwxr-xr-x<span class="hljs-number"> 2 </span>archlinux archlinux<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>pum.d<br>[root@node1 archlinux]<span class="hljs-comment"># pwd</span><br>/users/archlinux<br><br>[root@node1 archlinux]<span class="hljs-comment"># cd /mnt/snap/               //快照里还是原来的东西，说明备份效果体现出来了</span><br>[root@node1 snap]<span class="hljs-comment"># ll archlinux/</span><br>total 4<br>drwxr-xr-x<span class="hljs-number"> 2 </span>archlinux archlinux<span class="hljs-number"> 4096 </span>Aug <span class="hljs-number"> 8 </span><span class="hljs-number"> 2021 </span>pam.d<br></code></pre></td></tr></table></figure><p>利用快照还原原来的逻辑卷</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 snap]<span class="hljs-comment"># df -h</span><br>Filesystem                         Size  Used Avail Use% Mounted on<br>devtmpfs                           <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                              <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                              <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root             17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1                         <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                               <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-testlv          2.9G   16M  2.7G   1% /u</span>sers<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/testvg-user--snapshot  2.9G   16M  2.7G   1% /m</span>nt/snap<br>[root@node1 snap]<span class="hljs-comment"># umount /users/</span><br>umount: /users: target is busy.<br>        (In some cases useful info about processes that use<br>         the device is found by lsof(<span class="hljs-number">8</span>) or fuser(<span class="hljs-number">1</span>))<br>[root@node1 snap]<span class="hljs-comment"># umount /users/</span><br>[root@node1 snap]<span class="hljs-comment"># umount /mnt/snap/                  // 卸载时，应退出访问文件系统的进程</span><br>umount: <span class="hljs-regexp">/mnt/</span>snap: target is busy.<br>        (In some cases useful info about processes that use<br>         the device is found by lsof(<span class="hljs-number">8</span>) or fuser(<span class="hljs-number">1</span>))<br>[root@node1 snap]<span class="hljs-comment"># cd /                         </span><br>[root@node1 <span class="hljs-regexp">/]# umount /m</span>nt<span class="hljs-regexp">/snap/</span><br>[root@node1 /]<span class="hljs-comment"># df -h</span><br>Filesystem               Size  Used Avail Use% Mounted on<br>devtmpfs                 <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                    <span class="hljs-number">487</span>M  <span class="hljs-number">7.8</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root   17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1               <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                     <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@node1 <span class="hljs-regexp">/]# lvconvert --merge /</span>dev<span class="hljs-regexp">/testvg/u</span>ser-snapshot <br>  Merging of volume testvg/user-snapshot started.<br>  testvg/testlv: Merged: <span class="hljs-number">100.00</span>%<br> <br> 在使用快照还原后，快照的逻辑卷就消失了，是一次性的。<br>[root@node1 /]<span class="hljs-comment"># lvs</span><br>  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root   centos -wi-ao---- &lt;<span class="hljs-number">17.00</span>g                                                    <br>  swap   centos -wi-ao----   <span class="hljs-number">2.00</span>g                                                    <br>  testlv testvg -wi-a-----   <span class="hljs-number">3.00</span>g       <br>  <br>[root@node1 <span class="hljs-regexp">/]# mount /</span>dev<span class="hljs-regexp">/testvg/</span>testlv <span class="hljs-regexp">/users/</span><br>[root@node1 <span class="hljs-regexp">/]# ll /u</span>sers/<br>total <span class="hljs-number">20</span><br>drwx------ <span class="hljs-number">3</span> archlinux archlinux  <span class="hljs-number">4096</span> Jun <span class="hljs-number">20</span> <span class="hljs-number">10</span>:<span class="hljs-number">45</span> archlinux<br>drwx------ <span class="hljs-number">2</span> root      root      <span class="hljs-number">16384</span> Jun <span class="hljs-number">20</span> <span class="hljs-number">10</span>:<span class="hljs-number">35</span> lost+found<br>[root@node1 <span class="hljs-regexp">/]# ll /u</span>sers<span class="hljs-regexp">/archlinux/</span>                   <span class="hljs-regexp">//</span> 已还原到原来的样子<br>total <span class="hljs-number">4</span><br>drwxr-xr-x <span class="hljs-number">2</span> archlinux archlinux <span class="hljs-number">4096</span> Aug  <span class="hljs-number">8</span>  <span class="hljs-number">2021</span> pam.d<br></code></pre></td></tr></table></figure><h2 id="7、创建10G的RAID1，要求CHUNK为128K，文件系统为ext4，有一个空闲盘，开机可自动挂载至-backup目录"><a href="#7、创建10G的RAID1，要求CHUNK为128K，文件系统为ext4，有一个空闲盘，开机可自动挂载至-backup目录" class="headerlink" title="7、创建10G的RAID1，要求CHUNK为128K，文件系统为ext4，有一个空闲盘，开机可自动挂载至/backup目录"></a>7、创建10G的RAID1，要求CHUNK为128K，文件系统为ext4，有一个空闲盘，开机可自动挂载至/backup目录</h2><p>（1）、使用VMware添加两块大小均为10G的硬盘，然后在linux使用命令扫描新添加的硬盘。</p><p>（2）、创建RAID1，</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mdadm -C <span class="hljs-regexp">/dev/m</span>d0 -a yes -l <span class="hljs-number">1</span> -n <span class="hljs-number">2</span> -x <span class="hljs-number">1</span> -c <span class="hljs-number">128</span>K <span class="hljs-regexp">/dev/</span>sdb  <span class="hljs-regexp">/dev/</span>sdc<br></code></pre></td></tr></table></figure><p>（3）、格式化磁盘，并挂载文件系统</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@localhost ~]mkfs.ext4 <span class="hljs-regexp">/dev/m</span>d0<br>[root@localhost ~]mkdir /backup<br>[root@localhost ~]<span class="hljs-comment"># vim /etc/fstab </span><br>[root@localhost ~]<span class="hljs-comment"># cat /etc/fstab </span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># /etc/fstab</span><br><span class="hljs-comment"># Created by anaconda on Tue Jun 28 17:51:01 2022</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="hljs-comment">#</span><br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root /</span>                       xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>UUID=<span class="hljs-number">47</span>e57ec3-dc25-<span class="hljs-number">40</span>b5-a567-<span class="hljs-number">619</span>b8697712f /boot                   xfs     defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-regexp">/dev/m</span>d0                    /backup    defaults        <span class="hljs-number">0</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="8、创建一个可用空间为10G的RAID10设备，要求CHUNK为256K，文件系统为ext4，开机可自动挂载至-mydata目录"><a href="#8、创建一个可用空间为10G的RAID10设备，要求CHUNK为256K，文件系统为ext4，开机可自动挂载至-mydata目录" class="headerlink" title="8、创建一个可用空间为10G的RAID10设备，要求CHUNK为256K，文件系统为ext4，开机可自动挂载至/mydata目录"></a>8、创建一个可用空间为10G的RAID10设备，要求CHUNK为256K，文件系统为ext4，开机可自动挂载至/mydata目录</h2><p>（1）、使用VMware添加四块大小均为5G的硬盘，然后在linux使用命令扫描新添加的硬盘。</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@localhost ~]<span class="hljs-comment"># echo &#x27;- - -&#x27;&gt;/sys/class/scsi_host/host0/scan</span><br>[root@localhost ~]<span class="hljs-comment"># ll /dev/sd*</span><br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 0 </span>Jun<span class="hljs-number"> 28 </span>12:38 /dev/sda<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 1 </span>Jun<span class="hljs-number"> 28 </span>12:38 /dev/sda1<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8, <span class="hljs-number"> 2 </span>Jun<span class="hljs-number"> 28 </span>12:38 /dev/sda2<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 16 </span>Jun<span class="hljs-number"> 28 </span>13:03 /dev/sdb<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 32 </span>Jun<span class="hljs-number"> 28 </span>13:03 /dev/sdc<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 48 </span>Jun<span class="hljs-number"> 28 </span>13:03 /dev/sdd<br>brw-rw----.<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 64 </span>Jun<span class="hljs-number"> 28 </span>13:03 /dev/sde<br></code></pre></td></tr></table></figure><p>（2）、创建raid10</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@localhost ~]<span class="hljs-comment"># mdadm -C /dev/md1 -a yes -l 10 -n4 -c 256K /dev/sd&#123;b,c,d,e&#125; </span><br>mdadm: Defaulting to version 1.2 metadata<br>mdadm: array /dev/md1 started.<br>[root@localhost ~]<span class="hljs-comment"># mdadm -D /dev/md1</span><br>/dev/md1:<br>           Version : 1.2<br>     Creation Time : Tue Jun<span class="hljs-number"> 28 </span>13:07:56 2022<br>        Raid Level : raid10<br>        Array Size :<span class="hljs-number"> 10475520 </span>(9.99 GiB 10.73 GB)<br>     Used Dev Size :<span class="hljs-number"> 5237760 </span>(5.00 GiB 5.36 GB)<br>      Raid Devices : 4<br>     Total Devices : 4<br>       Persistence : Superblock is persistent<br><br>       Update Time : Tue Jun<span class="hljs-number"> 28 </span>13:08:10 2022<br>             State : clean, resyncing <br>    Active Devices : 4<br>   Working Devices : 4<br>    Failed Devices : 0<br>     Spare Devices : 0<br><br>            Layout : near=2<br>        Chunk Size : 256K<br><br>Consistency Policy : resync<br><br>     Resync Status : 76% complete<br><br>              Name : localhost.localdomain:1  (local to host localhost.localdomain)<br>              UUID : 81d26fe9:0c024b84:134ca616:d307d1be<br>            Events : 12<br><br>    Number   Major   Minor   RaidDevice State<br>      <span class="hljs-number"> 0 </span>     <span class="hljs-number"> 8 </span>     <span class="hljs-number"> 16 </span>      <span class="hljs-number"> 0 </span>     active sync set-A   /dev/sdb<br>      <span class="hljs-number"> 1 </span>     <span class="hljs-number"> 8 </span>     <span class="hljs-number"> 32 </span>      <span class="hljs-number"> 1 </span>     active sync set-B   /dev/sdc<br>      <span class="hljs-number"> 2 </span>     <span class="hljs-number"> 8 </span>     <span class="hljs-number"> 48 </span>      <span class="hljs-number"> 2 </span>     active sync set-A   /dev/sdd<br>      <span class="hljs-number"> 3 </span>     <span class="hljs-number"> 8 </span>     <span class="hljs-number"> 64 </span>      <span class="hljs-number"> 3 </span>     active sync set-B   /dev/sde<br>       <br>[root@localhost ~]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE   MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk   <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part   /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part   <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm    /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm    [SWAP]<br>sdb               8:16  <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>disk   <br>└─md1             9:1   <span class="hljs-number"> 0 </span>  10G <span class="hljs-number"> 0 </span>raid10 <br>sdc               8:32  <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>disk   <br>└─md1             9:1   <span class="hljs-number"> 0 </span>  10G <span class="hljs-number"> 0 </span>raid10 <br>sdd               8:48  <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>disk   <br>└─md1             9:1   <span class="hljs-number"> 0 </span>  10G <span class="hljs-number"> 0 </span>raid10 <br>sde               8:64  <span class="hljs-number"> 0 </span>   5G <span class="hljs-number"> 0 </span>disk   <br>└─md1             9:1   <span class="hljs-number"> 0 </span>  10G <span class="hljs-number"> 0 </span>raid10 <br>sr0              11:0   <span class="hljs-number"> 1 </span>1024M <span class="hljs-number"> 0 </span>rom    <br></code></pre></td></tr></table></figure><p>（3）、格式化磁盘，并挂载文件系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]<span class="hljs-comment"># mkfs.ext4 /dev/md1</span><br>mke2fs 1.42.9 (28-Dec-2013)<br>Filesystem label=<br>OS <span class="hljs-built_in">type</span>: Linux<br>Block size=4096 (<span class="hljs-built_in">log</span>=2)<br>Fragment size=4096 (<span class="hljs-built_in">log</span>=2)<br>Stride=64 blocks, Stripe width=128 blocks<br>655360 inodes, 2618880 blocks<br>130944 blocks (5.00%) reserved <span class="hljs-keyword">for</span> the super user<br>First data block=0<br>Maximum filesystem blocks=2151677952<br>80 block <span class="hljs-built_in">groups</span><br>32768 blocks per group, 32768 fragments per group<br>8192 inodes per group<br>Superblock backups stored on blocks: <br>32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632<br><br>Allocating group tables: <span class="hljs-keyword">done</span>                            <br>Writing inode tables: <span class="hljs-keyword">done</span>                            <br>Creating journal (32768 blocks): <span class="hljs-keyword">done</span><br>Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span> <br><br>[root@localhost ~]<span class="hljs-comment"># vim /etc/fstab </span><br>[root@localhost ~]<span class="hljs-comment"># cat /etc/fstab </span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># /etc/fstab</span><br><span class="hljs-comment"># Created by anaconda on Tue Jun 28 17:51:01 2022</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><br><span class="hljs-comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="hljs-comment">#</span><br>/dev/mapper/centos-root /                       xfs     defaults        0 0<br>UUID=47e57ec3-dc25-40b5-a567-619b8697712f /boot                   xfs     defaults        0 0<br>/dev/md1                    /mydata    defaults        0 0<br><br><br>[root@localhost ~]<span class="hljs-comment"># mkdir /mydata</span><br><br>[root@localhost ~]<span class="hljs-comment"># mount -a</span><br>[root@localhost ~]<span class="hljs-comment"># df -hT</span><br>Filesystem              Type      Size  Used Avail Use% Mounted on<br>/dev/mapper/centos-root xfs        17G  1.4G   16G   9% /<br>devtmpfs                devtmpfs  475M     0  475M   0% /dev<br>tmpfs                   tmpfs     487M     0  487M   0% /dev/shm<br>tmpfs                   tmpfs     487M  7.7M  479M   2% /run<br>tmpfs                   tmpfs     487M     0  487M   0% /sys/fs/cgroup<br>/dev/sda1               xfs      1014M  133M  882M  14% /boot<br>tmpfs                   tmpfs      98M     0   98M   0% /run/user/0<br>/dev/md1                ext4      9.8G   37M  9.2G   1% /mydata<br></code></pre></td></tr></table></figure><h2 id="9、静态配置网卡IP，centos-ubuntu实现"><a href="#9、静态配置网卡IP，centos-ubuntu实现" class="headerlink" title="9、静态配置网卡IP，centos/ubuntu实现"></a>9、静态配置网卡IP，centos/ubuntu实现</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@localhost network-scripts]# cat /etc/sysconfig/network-scripts/ifcfg-ens37<br><span class="hljs-attribute">TYPE</span>=Ethernet<br><span class="hljs-attribute">BOOTPROTO</span>=static<br><span class="hljs-attribute">NAME</span>=ens37<br><span class="hljs-attribute">DEVICE</span>=ens37<br><span class="hljs-attribute">ONBOOT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPADDR</span>=192.168.23.101<br><span class="hljs-attribute">NETMASK</span>=255.255.255.0<br><span class="hljs-attribute">GATEWAY</span>=192.168.23.254<br><br>tyh@tyh-virtual-machine:/etc/netplan$ vi 01-network-manager-all.yaml<br>network:<br> version: 2<br> renderer: networkd<br> ethernets:<br>   eth0:<br>     addresses: [192.168.23.201/24]  #或者用下面两行,两种格式不能混用<br>     gateway4:192.168.23.254<br></code></pre></td></tr></table></figure><h2 id="10、图文并茂解释TCP-IP-3次握手4次断开。"><a href="#10、图文并茂解释TCP-IP-3次握手4次断开。" class="headerlink" title="10、图文并茂解释TCP/IP 3次握手4次断开。"></a>10、图文并茂解释TCP/IP 3次握手4次断开。</h2><p>(1) TCP/IP的三次握手：<br>①首先 Client 端发送连接请求报文<br>②Server 段接受连接后回复 ACK 报文，并为这次连接分配资源。<br>③Client 端接收到 ACK 报文后也向 Server 段发生 ACK 报文，并分配资源，这样 TCP 连接就建立了。</p><p><img src="1656237530645.png" alt="1656238302242"></p><p><strong>用川航举例子</strong></p><p>①四川8633请求建立连接(SYN)，并且发送出序号。<br>②服务端接受到信号，即有确认号（ACK）,此时并同样返回请求序号Seq<br>③客户端接受到信号，即有确认号（ACK），连接已经建立。<br><img src="20200319134530223.png" alt="在这里插入图片描述"></p><p><strong>小结</strong>：<code>三次握手的关键是要确认对方收到了自己的数据包</code>，这个目标就是通过“确认号（Ack）”字段实现的。计算机会记录下自己发送的数据包序号Seq，待收到对方的数据包后，检测“确认号（Ack）”字段，<code>看Ack = Seq + 1是否成立，如果成立说明对方正确收到了自己的数据包</code>。 </p><p><strong>如果只有两次握手</strong> <code>这个时候客户端没有回应，这样会浪费服务端的资源</code></p><p><img src="20200319135158648.png" alt="在这里插入图片描述"></p><p>为什么需要第三次通信 ？</p><p>1、在第一次通信过程中，A向B发送信息之后，B收到信息后可以确认自己的收信能力和A的发信能力没有问题。<br>2、在第二次通信中，B向A发送信息之后，A可以确认自己的发信能力和B的收信能力没有问题，但是B不知道自己的发信能力到底如何，所以就需要第三次通信。<br>3、在第三次通信中，A向B发送信息之后，B就可以确认自己的发信能力没有问题。<br>4、 小结：3次握手完成两个重要的功能，既要双方做好发送数据的准备工作(双方都知道彼此已准备好)，也要允许双方就初始序列号进行协商，这个序列号在握手过程中被发送和确认。</p><p>————————————————<br>版权声明：本文为CSDN博主「辰兮要努力」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/weixin_45393094/article/details/104965561">https://blog.csdn.net/weixin_45393094/article/details/104965561</a></p><p>(2) TCP/IP的四次挥手：</p><p>建立连接非常重要，它是数据正确传输的前提；断开连接同样重要，它让计算机释放不再使用的资源。如果连接不能正常断开，不仅会造成数据传输错误，还会导致套接字不能关闭，持续占用资源，如果并发量高，服务器压力堪忧。 </p><p>第一次挥手：Clien发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。<br>第二次挥手：Server收到FIN后，发送一个ACK给Client,Server进入CLOSE_WAIT状态。<br>第三次挥手： Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。<br>第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，发送ACK给Server，Server进入CLOSED状态，完成四次握手。</p><p><img src="1656239495710.png" alt="1656239495710"></p><p>川航图举例</p><p>①客户端申请断开连接即FIN （我这边准备断开连接了）<br>②服务端接收信息返回，表示我已经接收到 （收到，请稍等，我这边准备一下）<br>③服务端发送信息表示可以断开连接 (我准备好了，你可以断开连接了）<br>④客户端接受信息，同时返回信息通知服务端自己收到信息，开始断开 连接(好的，拜拜！）</p><p><img src="1656239640058.png" alt="1656239640058"></p><p>数据传输完毕后，双方都可释放连接。最开始的时候，客户端和服务器都是处于ESTABLISHED状态，然后客户端主动关闭，服务器被动关闭。</p><p>为什么连接的时候是三次握手，关闭的时候却是四次握手？</p><p>①因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。<br>②但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，“你发的FIN报文我收到了”。<br>③只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。</p><p><strong>补充问题</strong></p><ul><li><strong>📝TCP的三次握手一定能保证传输可靠吗？</strong><code>不能</code></li><li>三次握手比两次更可靠，但也不是完全可靠，而追加更多次握手也不能使连接更可靠了。因此选择了三次握手。</li><li>世界上不存在完全可靠的通信协议。从通信时间成本空间成本以及可靠度来讲，选择了“三次握手”作为点对点通信的一般规则</li></ul><p>————————————————<br>版权声明：本文为CSDN博主「辰兮要努力」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/weixin_45393094/article/details/104965561">https://blog.csdn.net/weixin_45393094/article/details/104965561</a></p><h2 id="11、网卡绑定bond0的实现"><a href="#11、网卡绑定bond0的实现" class="headerlink" title="11、网卡绑定bond0的实现"></a>11、网卡绑定bond0的实现</h2><p>bond聚合链路模式共7种模式：0-6 Mode </p><p>mod=0 ，即：(balance-rr) Round-robin policy（轮询）聚合口数据报文按包轮询从物理接口转 发。<br>mod=1，即： (active-backup) Active-backup policy（主-备份策略）只有Active状态的物理接口 才转发数据报文。<br>mod=2，即：(balance-xor) XOR policy（平衡策略）聚合口数据报文按源目MAC、源目IP、源目 端口进行异或HASH运算得到一个值，根据该值查找接口转发数据报文 。<br>mod=3，即：broadcast（广播策略）这种模式的特点是一个报文会复制两份往bond下的两个接 口分别发送出去，<br>mod=4，即：(802.3ad) IEEE 802.3ad Dynamic link aggregation（IEEE 802.3ad 动态链接聚 合）<br>mod=5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）<br>mod=6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡）   </p><p>说明：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dns">常用的模式为 <span class="hljs-number">0,1,3,6</span><br>mode <span class="hljs-number">1</span>、<span class="hljs-number">5</span>、<span class="hljs-number">6</span> 不需要交换机设置<br>mode <span class="hljs-number">0、2、3、4</span>需要交换机设置<br>active-backup、balance-tlb 和 balance-alb 模式不需要交换机的任何特殊配置。其他绑定模式需<br>要配置交换机以便整合链接。如：Cisco 交换机需要在模式 <span class="hljs-number">0</span>、<span class="hljs-number">2</span> 和 <span class="hljs-number">3</span> 中使用 EtherChannel，但在模<br>式<span class="hljs-number">4</span>中需要 LACP和 EtherChannel<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@localhost network-scripts]# nmcli conne<br>NAME   UUID                                 <span class="hljs-built_in"> TYPE </span>     DEVICE <br>ens33  4b102f8b-d8e3-498e-a7b0-80b138f80f5f <span class="hljs-built_in"> ethernet </span> ens33  <br>ens37  4a5516a4-dfa4-24af-b1c4-e843e312e2fd <span class="hljs-built_in"> ethernet </span> ens37  <br>[root@localhost network-scripts]# nmcli conn<br>NAME   UUID                                 <span class="hljs-built_in"> TYPE </span>     DEVICE <br>ens33  4b102f8b-d8e3-498e-a7b0-80b138f80f5f <span class="hljs-built_in"> ethernet </span> ens33  <br>ens37  4a5516a4-dfa4-24af-b1c4-e843e312e2fd <span class="hljs-built_in"> ethernet </span> ens37  <br><br>[root@localhost network-scripts]# nmcli<span class="hljs-built_in"> connection </span><span class="hljs-built_in">add</span> con-name mybond0 ifname bond0<span class="hljs-built_in"> type </span>bond mode active-backup ipv4.method<span class="hljs-built_in"> manual </span>ipv4.address 192.168.23.101/24<span class="hljs-built_in"></span><br><span class="hljs-built_in">Connection </span><span class="hljs-string">&#x27;mybond0&#x27;</span> (69f8a919-2ef4-4c69-816d-9c401cc67425) successfully added.<br><br>[root@localhost network-scripts]# ls<br>ifcfg-ens33    ifdown-bnep  ifdown-post    ifdown-TeamPort  ifup-eth   ifup-plusb   ifup-Team         network-functions<br>ifcfg-ens37    ifdown-eth   ifdown-ppp     ifdown-tunnel    ifup-ippp  ifup-post    ifup-TeamPort     network-functions-ipv6<br>ifcfg-lo       ifdown-ippp  ifdown-routes  ifup             ifup-ipv6  ifup-ppp     ifup-tunnel<br>ifcfg-mybond0  ifdown-ipv6  ifdown-sit     ifup-aliases     ifup-isdn  ifup-routes  ifup-wireless<br>ifdown         ifdown-isdn  ifdown-Team    ifup-bnep        ifup-plip  ifup-sit     init.ipv6-global<br>[root@localhost network-scripts]# cat ifcfg-mybond0 <br><span class="hljs-attribute">BONDING_OPTS</span>=mode=active-backup<br><span class="hljs-attribute">TYPE</span>=Bond<br><span class="hljs-attribute">BONDING_MASTER</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">PROXY_METHOD</span>=none<br><span class="hljs-attribute">BROWSER_ONLY</span>=<span class="hljs-literal">no</span><br><span class="hljs-attribute">BOOTPROTO</span>=none<br><span class="hljs-attribute">IPADDR</span>=192.168.23.101<br><span class="hljs-attribute">PREFIX</span>=24<br><span class="hljs-attribute">DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPV4_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attribute">IPV6INIT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPV6_AUTOCONF</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPV6_DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPV6_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attribute">IPV6_ADDR_GEN_MODE</span>=stable-privacy<br><span class="hljs-attribute">NAME</span>=mybond0<br><span class="hljs-attribute">UUID</span>=69f8a919-2ef4-4c69-816d-9c401cc67425<br><span class="hljs-attribute">DEVICE</span>=bond0<br><span class="hljs-attribute">ONBOOT</span>=<span class="hljs-literal">yes</span><br>[root@localhost network-scripts]# nmcli conn<br>NAME     UUID                                 <span class="hljs-built_in"> TYPE </span>     DEVICE <br>ens33    4b102f8b-d8e3-498e-a7b0-80b138f80f5f <span class="hljs-built_in"> ethernet </span> ens33  <br>ens37    4a5516a4-dfa4-24af-b1c4-e843e312e2fd <span class="hljs-built_in"> ethernet </span> ens37  <br>mybond0  69f8a919-2ef4-4c69-816d-9c401cc67425  bond      bond0  <br><br>[root@localhost network-scripts]# nmcli con <span class="hljs-built_in">add</span><span class="hljs-built_in"> type </span>bond-slave ifname ens33 master bond0<span class="hljs-built_in"></span><br><span class="hljs-built_in">Connection </span><span class="hljs-string">&#x27;bond-slave-ens33&#x27;</span> (c700dceb-866f-4ec2-9d3d-192e60208555) successfully added.<br>[root@localhost network-scripts]# nmcli con <span class="hljs-built_in">add</span><span class="hljs-built_in"> type </span>bond-slave ifname ens37 master bond0<span class="hljs-built_in"></span><br><span class="hljs-built_in">Connection </span><span class="hljs-string">&#x27;bond-slave-ens37&#x27;</span> (a92a8c76-fd96-4647-844c-28941760fee6) successfully added.<br>[root@localhost network-scripts]# nmcli conn<br>NAME              UUID                                 <span class="hljs-built_in"> TYPE </span>     DEVICE <br>ens33             4b102f8b-d8e3-498e-a7b0-80b138f80f5f <span class="hljs-built_in"> ethernet </span> ens33  <br>ens37             4a5516a4-dfa4-24af-b1c4-e843e312e2fd <span class="hljs-built_in"> ethernet </span> ens37  <br>mybond0           69f8a919-2ef4-4c69-816d-9c401cc67425  bond      bond0  <br>bond-slave-ens33  c700dceb-866f-4ec2-9d3d-192e60208555 <span class="hljs-built_in"> ethernet </span> --     <br>bond-slave-ens37  a92a8c76-fd96-4647-844c-28941760fee6 <span class="hljs-built_in"> ethernet </span> --  <br><br>[root@localhost network-scripts]# nmcli conn up bond-slave-ens33<span class="hljs-built_in"></span><br><span class="hljs-built_in">Connection </span>successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/5)<br>[root@localhost network-scripts]# nmcli conn<br>NAME              UUID                                 <span class="hljs-built_in"> TYPE </span>     DEVICE <br>ens33             4b102f8b-d8e3-498e-a7b0-80b138f80f5f <span class="hljs-built_in"> ethernet </span> ens33  <br>mybond0           69f8a919-2ef4-4c69-816d-9c401cc67425  bond      bond0  <br>bond-slave-ens37  a92a8c76-fd96-4647-844c-28941760fee6 <span class="hljs-built_in"> ethernet </span> ens37  <br>bond-slave-ens33  c700dceb-866f-4ec2-9d3d-192e60208555 <span class="hljs-built_in"> ethernet </span> --     <br>bond-slave-eth1   5e9bf4b1-c300-4432-8184-4a94dd47d65e <span class="hljs-built_in"> ethernet </span> --     <br>ethernet-ens37    429edf31-7af6-4375-8b8a-9060d6a9d755 <span class="hljs-built_in"> ethernet </span> --    <br></code></pre></td></tr></table></figure><p>查看两块网卡的主从：</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs tcl">[root@localhost network-scripts]# cat /<span class="hljs-keyword">proc</span>/net/bonding/bond0<span class="hljs-title"> </span><br><span class="hljs-title">Ethernet</span> Channel<span class="hljs-title"> Bonding</span> Driver:<span class="hljs-title"> v3.7.1</span> (April 27, 2011)<span class="hljs-title"></span><br><span class="hljs-title"></span><br><span class="hljs-title">Bonding</span> Mode:<span class="hljs-title"> fault-tolerance</span> (active-backup)           // 使用的模式，主-备份策略<span class="hljs-title"></span><br><span class="hljs-title">Primary</span> Slave:<span class="hljs-title"> None</span><br>Currently<span class="hljs-title"> Active</span> Slave:<span class="hljs-title"> ens37</span>                           //<span class="hljs-title"> ens37现在是干活的，ens33为备用</span><br>MII<span class="hljs-title"> Status:</span> up<span class="hljs-title"></span><br><span class="hljs-title">MII</span> Polling<span class="hljs-title"> Interval</span> (ms): 100<span class="hljs-title"></span><br><span class="hljs-title">Up</span> Delay (ms): 0<span class="hljs-title"></span><br><span class="hljs-title">Down</span> Delay (ms): 0<span class="hljs-title"></span><br><span class="hljs-title"></span><br><span class="hljs-title">Slave</span> Interface:<span class="hljs-title"> ens37</span><br>MII<span class="hljs-title"> Status:</span> up<span class="hljs-title"></span><br><span class="hljs-title">Speed:</span> 1000<span class="hljs-title"> Mbps</span><br>Duplex:<span class="hljs-title"> full</span><br>Link<span class="hljs-title"> Failure</span> Count: 0<span class="hljs-title"></span><br><span class="hljs-title">Permanent</span> HW<span class="hljs-title"> addr:</span> 00:0c:29:32:65:0e<span class="hljs-title"></span><br><span class="hljs-title">Slave</span> queue<span class="hljs-title"> ID:</span> 0<span class="hljs-title"></span><br><span class="hljs-title"></span><br><span class="hljs-title">Slave</span> Interface:<span class="hljs-title"> ens33</span><br>MII<span class="hljs-title"> Status:</span> up<span class="hljs-title"></span><br><span class="hljs-title">Speed:</span> 1000<span class="hljs-title"> Mbps</span><br>Duplex:<span class="hljs-title"> full</span><br>Link<span class="hljs-title"> Failure</span> Count: 0<span class="hljs-title"></span><br><span class="hljs-title">Permanent</span> HW<span class="hljs-title"> addr:</span> 00:0c:29:32:65:04<span class="hljs-title"></span><br><span class="hljs-title">Slave</span> queue<span class="hljs-title"> ID:</span> 0<br></code></pre></td></tr></table></figure><p>12、实现免密登陆脚本, expect登陆远程主机，将生成的密钥写入到目标主机, expect测试远程登陆。<br>     1）通过shift读取脚本参数<br>     2）通过select来选择功能.例如功能有</p><ul><li>安装mysql</li><li>安装apache</li><li>免密钥登陆主机<br>当前我们只实现免密钥登陆主机<br>3）通过函数封装每个功能<br>4）将免密钥登陆的过程可以重复进行, while 循环实现重复，需要有退出过程。当用户输入exit时，退出免密钥功能。<br>5）支持输入一批主机免密钥，使用数组 实现</li></ul><p>[root@localhost ~]# vim ssh.sh<br>[root@localhost ~]# cat ssh.sh<br>#!/bin/bash</p><p>read -p “Which IP address you want to connect to?:” ip<br>read -s -p “and password:” pwd     #-s要在前面表示静默输出，保护密码</p><p>yum -y install openssh expect</p><p>expect &lt;&lt; EOF     #表示里面的内容均由expect命令去执行</p><p>set timeout 30     #设置超时时间为30秒，下面的代码需在30秒钟内完成，如果超过，则退出。用来防止ssh远程主机网络不可达时卡住及在远程主机执行命令宕住</p><p>spawn   ssh-keygen  #激活一个交互式会话，在系统中创建一个进程</p><p>expect     {<br>        “.ssh/id_rsa)”       { send    “\r”;  exp_continue } #捕捉关键字，然后回车<br>        “Overwrite (y/n)?”   { send    “y\r”; exp_continue } #捕捉关键字后输入y然后回车<br>        “no passphrase):”    { send    “\r”;  exp_continue }<br>        “again:”             { send    “\r”;  exp_continue }<br>}</p><p>spawn ssh-copy-id root@$ip</p><p>expect {<br>     “yes/no”   { send “yes\r”;  exp_continue }<br>     “password” { send “$pwd\r”; exp_continue }<br>}<br>EOF</p><p>[root@localhost ~]# ./ssh.sh<br>Which IP address you want to connect to?:192.168.216.200<br>and password:1<br>spawn ssh-keygen<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/root/.ssh/id_rsa):<br>/root/.ssh/id_rsa already exists.<br>Overwrite (y/n)? y<br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in /root/.ssh/id_rsa.<br>Your public key has been saved in /root/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>SHA256:xaplvcpVheYg5sR/JU6QBlg+jMy9hYqxR1k7AiqK9Bk <a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#108;&#x6f;&#x63;&#97;&#108;&#104;&#x6f;&#115;&#x74;&#x2e;&#108;&#x6f;&#x63;&#97;&#x6c;&#x64;&#111;&#x6d;&#97;&#105;&#x6e;">&#114;&#x6f;&#x6f;&#116;&#x40;&#108;&#x6f;&#x63;&#97;&#108;&#104;&#x6f;&#115;&#x74;&#x2e;&#108;&#x6f;&#x63;&#97;&#x6c;&#x64;&#111;&#x6d;&#97;&#105;&#x6e;</a><br>The key’s randomart image is:<br>+—[RSA 2048]—-+<br>|    .  o+…     |<br>|   . +.O +o. .   |<br>|…E. B &amp;.= = o  |<br>|+.. o= * @ * +   |<br>|o  oo o S o =    |<br>|     . +   +     |<br>|      .   o      |<br>|       . o       |<br>|        o        |<br>+—-[SHA256]—–+<br>spawn ssh-copy-id <a href="mailto:&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#x32;&#x31;&#x36;&#x2e;&#50;&#48;&#48;">&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#x32;&#x31;&#x36;&#x2e;&#50;&#48;&#48;</a><br>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: “/root/.ssh/id_rsa.pub”<br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br><a href="mailto:&#114;&#111;&#x6f;&#116;&#x40;&#49;&#57;&#50;&#46;&#x31;&#x36;&#56;&#x2e;&#50;&#x31;&#54;&#46;&#50;&#48;&#48;">&#114;&#111;&#x6f;&#116;&#x40;&#49;&#57;&#50;&#46;&#x31;&#x36;&#56;&#x2e;&#50;&#x31;&#54;&#46;&#50;&#48;&#48;</a>‘s password: </p><p>Number of key(s) added: 1</p><p>Now try logging into the machine, with:   “ssh ‘<a href="mailto:&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x32;&#x31;&#54;&#x2e;&#50;&#x30;&#48;">&#x72;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x32;&#x31;&#54;&#x2e;&#50;&#x30;&#48;</a>‘“<br>and check to make sure that only the key(s) you wanted were added.</p><h2 id="12、免交互实例（免密登陆）"><a href="#12、免交互实例（免密登陆）" class="headerlink" title="12、免交互实例（免密登陆）"></a>12、免交互实例（免密登陆）</h2><p>#!/bin/bash<br>yum -y install expect<br>ip=$1<br>passwd=$2<br>/usr/bin/expect&lt;&lt;EOF<br>spawn ssh-keygen -t rsa<br>expect {<br>        “(/root/.ssh/id_rsa)”<br>        {send “\r”;exp_continue}<br>        “(empty for no passphrase)”<br>        {send “\r”;exp_continue}<br>        “passphrase again”<br>        {send “\r”}<br>}<br>expect eof<br>EOF<br>/usr/bin/expect&lt;&lt;EOF<br>spawn ssh-copy-id $1<br>expect {<br>        “(yes/no)”<br>        {send “yes\r”;exp_continue}<br>        “password”<br>        {send “$2\r”}<br>}<br>expect eof<br>EOF<br>ssh root@$1 </p>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1、计算机基础和linux安装</title>
    <link href="/2022/06/18/1%E3%80%81%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%92%8Clinux%E5%AE%89%E8%A3%85/"/>
    <url>/2022/06/18/1%E3%80%81%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%92%8Clinux%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><span id="more"></span><h1 id="安装linux操作系统"><a href="#安装linux操作系统" class="headerlink" title="安装linux操作系统"></a>安装linux操作系统</h1><p>获取发行版</p><p>CentOS</p><p><a href="https://wiki.centos.org/Download">https://wiki.centos.org/Download</a><br><a href="http://mirrors.aliyun.com/">http://mirrors.aliyun.com</a></p><p><a href="https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/">https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/</a></p><p><a href="http://mirrors.sohu.com/">http://mirrors.sohu.com</a><br><a href="http://mirrors.163.com/">http://mirrors.163.com</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/centos/">https://mirrors.tuna.tsinghua.edu.cn/centos/</a></p><p>Ubuntu</p><p> <a href="http://cdimage.ubuntu.com/releases/">http://cdimage.ubuntu.com/releases/</a>                Server版</p><p> <a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cdimage/releases/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cdimage/releases/</a> <a href="http://releases.ubuntu.com/">http://releases.ubuntu.com/</a> </p><p> <a href="http://mirrors.aliyun.com/ubuntu-releases/">http://mirrors.aliyun.com/ubuntu-releases/</a>      Desktop版 </p><p> <a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/</a> </p><h1 id="linux基础"><a href="#linux基础" class="headerlink" title="linux基础"></a>linux基础</h1><h2 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h2><p><strong>二进制和十进制转换：</strong></p><p>2^0=1=1b<br>2^1=2=10b<br>2^3=8=1000b<br>2^4=16=10000b<br>2^5=32=100000b<br>2^6=64=1000000b<br>2^7=128=10000000b<br>2^8=256=100000000b<br>2^9=512=1000000000b<br>2^10=1024=10000000000b<br>2^11=2048=100000000000b<br>2^12=4096=1000000000000b</p><p>[root@node1 ~]# <strong>yum install bc</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><pre><code class="hljs scala">[root<span class="hljs-meta">@node</span>1 ~]# bc        <span class="hljs-comment">// 交互式使用计算器</span><br>bc <span class="hljs-number">1.06</span><span class="hljs-number">.95</span><br><span class="hljs-type">Copyright</span> <span class="hljs-number">1991</span><span class="hljs-number">-1994</span>, <span class="hljs-number">1997</span>, <span class="hljs-number">1998</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2004</span>, <span class="hljs-number">2006</span> <span class="hljs-type">Free</span> <span class="hljs-type">Software</span> <span class="hljs-type">Foundation</span>, <span class="hljs-type">Inc</span>.<br><span class="hljs-type">This</span> is free software <span class="hljs-keyword">with</span> <span class="hljs-type">ABSOLUTELY</span> <span class="hljs-type">NO</span> <span class="hljs-type">WARRANTY</span>.<br><span class="hljs-type">For</span> details <span class="hljs-class"><span class="hljs-keyword">type</span> `<span class="hljs-title">warranty</span>&#x27;. </span><br><span class="hljs-number">2</span>*<span class="hljs-number">3</span>          <span class="hljs-comment">// 乘法</span><br><span class="hljs-number">6</span><br><span class="hljs-number">2</span>^<span class="hljs-number">3</span>          <span class="hljs-comment">// 2的3次方</span><br><span class="hljs-number">8</span><br>obase=<span class="hljs-number">2</span>      <span class="hljs-comment">// 将输入的值，转换为二进制</span><br><span class="hljs-number">10</span><br><span class="hljs-number">1010</span><br><span class="hljs-number">8</span><br><span class="hljs-number">1000</span><br><br>[root<span class="hljs-meta">@node</span>1 ~]# echo <span class="hljs-string">&quot;obase=2;255&quot;</span>|bc     <span class="hljs-comment">// 非交互式，将输入的默认十进制数字，转换为二进制 </span><br><span class="hljs-number">11111111</span><br><br>[root<span class="hljs-meta">@node</span>1 ~]# echo <span class="hljs-string">&quot;obase=10;8&quot;</span>|bc<br><span class="hljs-number">8</span><br><br><br>[root<span class="hljs-meta">@node</span>1 ~]# echo <span class="hljs-string">&quot;obase=10;ibase=8;377&quot;</span>|bc  <span class="hljs-comment">// 非交互式，将输入的八进制数字，转换为十进制</span><br><span class="hljs-number">255</span><br><br>[root<span class="hljs-meta">@node</span>1 ~]# echo <span class="hljs-string">&quot;obase=10;ibase=2;11111111&quot;</span>|bc  <span class="hljs-comment">// 非交互式，将输入的二进制数字，转换为十进制</span><br><span class="hljs-number">255</span><br><br>[root<span class="hljs-meta">@node</span>1 ~]# echo <span class="hljs-string">&quot;obase=16;ibase=2;11111111&quot;</span>|bc  <span class="hljs-comment">// 非交互式，将输入的二进制数字，转换为十六进制</span><br><span class="hljs-type">FF</span><br></code></pre></td></tr></table></figure><h2 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h2><p>注意： 主机名不支持使用下划线，但支持横线，可使用字母，横线或数字组合 </p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># hostnamectl set-hostname node1</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># hostname</span><br>node1<br>[root<span class="hljs-symbol">@node1</span> ~]<span class="hljs-meta"># cat /etc/hostname </span><br>node1<br></code></pre></td></tr></table></figure><h2 id="查看硬件信息"><a href="#查看硬件信息" class="headerlink" title="查看硬件信息"></a>查看硬件信息</h2><h3 id="查看cpu"><a href="#查看cpu" class="headerlink" title="查看cpu"></a>查看cpu</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs tcl">[root@node1 ~]# lscpu<br>Architecture:          x86_64<br>CPU op-mode(s):        <span class="hljs-number">32</span>-bit, <span class="hljs-number">64</span>-bit<br>Byte Order:            Little Endian<br>CPU(s):                <span class="hljs-number">1</span><br>On-line CPU(s) <span class="hljs-keyword">list</span>:   <span class="hljs-number">0</span><br>Thread(s) per core:    <span class="hljs-number">1</span><br>Core(s) per <span class="hljs-keyword">socket</span>:    <span class="hljs-number">1</span><br>Socket(s):             <span class="hljs-number">1</span><br>NUMA node(s):          <span class="hljs-number">1</span><br>Vendor ID:             GenuineIntel<br>CPU family:            <span class="hljs-number">6</span><br>Model:                 <span class="hljs-number">140</span><br>Model name:            <span class="hljs-number">11</span>th Gen Intel(R) Core(TM) i5<span class="hljs-number">-1135</span>G7 @ <span class="hljs-number">2.40</span>GHz<br>Stepping:              <span class="hljs-number">1</span><br>CPU MHz:               <span class="hljs-number">2419.204</span><br>CPU max MHz:           <span class="hljs-number">0.0000</span><br>CPU min MHz:           <span class="hljs-number">0.0000</span><br>BogoMIPS:              <span class="hljs-number">4838.40</span><br>Hypervisor vendor:     VMware<br>Virtualization type:   full<br>L1d cache:             <span class="hljs-number">48</span>K<br>L1i cache:             <span class="hljs-number">32</span>K<br>L2 cache:              <span class="hljs-number">1280</span>K<br>L3 cache:              <span class="hljs-number">8192</span>K<br>NUMA node0 CPU(s):     <span class="hljs-number">0</span><br>Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts nopl xtopology tsc_reliable nonstop_tsc aperfmperf eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm <span class="hljs-number">3</span>dnowprefetch epb invpcid_single fsgsbase tsc_adjust bmi1 avx2 smep bmi2 invpcid rdseed adx smap xsaveopt dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp hwp_pkg_req<br><br>[root@node1 ~]# cat /<span class="hljs-keyword">proc</span>/cpuinfo<span class="hljs-title"> </span><br><span class="hljs-title">processor</span>: 0<span class="hljs-title"></span><br><span class="hljs-title">vendor_id</span>:<span class="hljs-title"> GenuineIntel</span><br>cpu<span class="hljs-title"> family</span>: 6<span class="hljs-title"></span><br><span class="hljs-title">model</span>: 140<span class="hljs-title"></span><br><span class="hljs-title">model</span> name: 11th<span class="hljs-title"> Gen</span> Intel(R)<span class="hljs-title"> Core(TM)</span> i5-1135G7 @ 2.40GHz<span class="hljs-title"></span><br><span class="hljs-title">stepping</span>: 1<span class="hljs-title"></span><br><span class="hljs-title">microcode</span>: 0xa4<span class="hljs-title"></span><br><span class="hljs-title">cpu</span> MHz: 2419.204<span class="hljs-title"></span><br><span class="hljs-title">cache</span> size: 8192<span class="hljs-title"> KB</span><br>physical<span class="hljs-title"> id</span>: 0<span class="hljs-title"></span><br><span class="hljs-title">siblings</span>: 1<span class="hljs-title"></span><br><span class="hljs-title">core</span> id: 0<span class="hljs-title"></span><br><span class="hljs-title">cpu</span> cores: 1<span class="hljs-title"></span><br><span class="hljs-title">apicid</span>: 0<span class="hljs-title"></span><br><span class="hljs-title">initial</span> apicid: 0<span class="hljs-title"></span><br><span class="hljs-title">fpu</span>:<span class="hljs-title"> yes</span><br>fpu_exception:<span class="hljs-title"> yes</span><br>cpuid<span class="hljs-title"> level</span>: 27<span class="hljs-title"></span><br><span class="hljs-title">wp</span>:<span class="hljs-title"> yes</span><br>flags:<span class="hljs-title"> fpu</span> vme<span class="hljs-title"> de</span> pse<span class="hljs-title"> tsc</span> msr<span class="hljs-title"> pae</span> mce<span class="hljs-title"> cx8</span> apic<span class="hljs-title"> sep</span> mtrr<span class="hljs-title"> pge</span> mca<span class="hljs-title"> cmov</span> pat<span class="hljs-title"> pse36</span> clflush<span class="hljs-title"> dts</span> mmx<span class="hljs-title"> fxsr</span> sse<span class="hljs-title"> sse2</span> ss<span class="hljs-title"> syscall</span> nx<span class="hljs-title"> pdpe1gb</span> rdtscp<span class="hljs-title"> lm</span> constant_tsc<span class="hljs-title"> arch_perfmon</span> pebs<span class="hljs-title"> bts</span> nopl<span class="hljs-title"> xtopology</span> tsc_reliable<span class="hljs-title"> nonstop_tsc</span> aperfmperf<span class="hljs-title"> eagerfpu</span> pni<span class="hljs-title"> pclmulqdq</span> ssse3<span class="hljs-title"> fma</span> cx16<span class="hljs-title"> pcid</span> sse4_1<span class="hljs-title"> sse4_2</span> x2apic<span class="hljs-title"> movbe</span> popcnt<span class="hljs-title"> tsc_deadline_timer</span> aes<span class="hljs-title"> xsave</span> avx<span class="hljs-title"> f16c</span> rdrand<span class="hljs-title"> hypervisor</span> lahf_lm<span class="hljs-title"> abm</span> 3dnowprefetch<span class="hljs-title"> epb</span> invpcid_single<span class="hljs-title"> fsgsbase</span> tsc_adjust<span class="hljs-title"> bmi1</span> avx2<span class="hljs-title"> smep</span> bmi2<span class="hljs-title"> invpcid</span> rdseed<span class="hljs-title"> adx</span> smap<span class="hljs-title"> xsaveopt</span> dtherm<span class="hljs-title"> ida</span> arat<span class="hljs-title"> pln</span> pts<span class="hljs-title"> hwp</span> hwp_notify<span class="hljs-title"> hwp_act_window</span> hwp_epp<span class="hljs-title"> hwp_pkg_req</span><br>bogomips: 4838.40<span class="hljs-title"></span><br><span class="hljs-title">clflush</span> size: 64<span class="hljs-title"></span><br><span class="hljs-title">cache_alignment</span>: 64<span class="hljs-title"></span><br><span class="hljs-title">address</span> sizes: 42<span class="hljs-title"> bits</span> physical, 48<span class="hljs-title"> bits</span> virtual<span class="hljs-title"></span><br><span class="hljs-title">power</span> management:<br><br>[root@node1 ~]#<span class="hljs-title"> getconf</span> LONG_BIT          // 查看cpu位数<br>64<br><br>[root@node1 ~]#<span class="hljs-title"> grep</span> &quot;model<span class="hljs-title"> name&quot;</span>  /<span class="hljs-keyword">proc</span>/cpuinfo  |cut -d &quot;:&quot; -f2<br> 11th<span class="hljs-title"> Gen</span> Intel(R)<span class="hljs-title"> Core(TM)</span> i5-1135G7 @ 2.40GHz<br> <br>[root@node1 ~]#<span class="hljs-title"> grep</span> &quot;processor&quot; /<span class="hljs-keyword">proc</span>/cpuinfo  |wc -l  // 查看逻辑CPU的个数<br>1<br></code></pre></td></tr></table></figure><h3 id="查看内存"><a href="#查看内存" class="headerlink" title="查看内存"></a>查看内存</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># free</span><br>              <span class="hljs-string">total</span>        <span class="hljs-string">used</span>        <span class="hljs-string">free</span>      <span class="hljs-string">shared</span>  <span class="hljs-string">buff/cache</span>   <span class="hljs-string">available</span><br><span class="hljs-attr">Mem:</span>         <span class="hljs-number">995676</span>      <span class="hljs-number">124876</span>      <span class="hljs-number">776380</span>        <span class="hljs-number">7840       </span><span class="hljs-number">94420</span>      <span class="hljs-number">748284</span><br><span class="hljs-attr">Swap:</span>       <span class="hljs-number">2097148</span>           <span class="hljs-number">0</span>     <span class="hljs-number">2097148</span><br><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># free -h</span><br>              <span class="hljs-string">total</span>        <span class="hljs-string">used</span>        <span class="hljs-string">free</span>      <span class="hljs-string">shared</span>  <span class="hljs-string">buff/cache</span>   <span class="hljs-string">available</span><br><span class="hljs-attr">Mem:</span>           <span class="hljs-string">972M</span>        <span class="hljs-string">123M</span>        <span class="hljs-string">753M</span>        <span class="hljs-number">7.</span><span class="hljs-string">6M</span>         <span class="hljs-string">95M</span>        <span class="hljs-string">727M</span><br><span class="hljs-attr">Swap:</span>          <span class="hljs-number">2.</span><span class="hljs-string">0G</span>          <span class="hljs-string">0B</span>        <span class="hljs-number">2.</span><span class="hljs-string">0G</span><br><br>[<span class="hljs-string">root@node1</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cat /proc/meminfo </span><br><span class="hljs-attr">MemTotal:</span>         <span class="hljs-number">995676</span> <span class="hljs-string">kB</span>                 <span class="hljs-string">//</span> <span class="hljs-string">内存总量</span><br><span class="hljs-attr">MemFree:</span>          <span class="hljs-number">776668</span> <span class="hljs-string">kB</span><span class="hljs-string">//</span> <span class="hljs-string">空闲内存量</span><br><span class="hljs-attr">MemAvailable:</span>     <span class="hljs-number">748572</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Buffers:</span>            <span class="hljs-number">2108 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">Cached:</span>            <span class="hljs-number">76396</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">SwapCached:</span>            <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Active:</span>            <span class="hljs-number">50152</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Inactive:</span>          <span class="hljs-number">58288</span> <span class="hljs-string">kB</span><br><span class="hljs-string">Active(anon):</span>      <span class="hljs-number">30412</span> <span class="hljs-string">kB</span><br><span class="hljs-string">Inactive(anon):</span>     <span class="hljs-number">7364 </span><span class="hljs-string">kB</span><br><span class="hljs-string">Active(file):</span>      <span class="hljs-number">19740</span> <span class="hljs-string">kB</span><br><span class="hljs-string">Inactive(file):</span>    <span class="hljs-number">50924</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Unevictable:</span>           <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Mlocked:</span>               <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">SwapTotal:</span>       <span class="hljs-number">2097148</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">SwapFree:</span>        <span class="hljs-number">2097148</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Dirty:</span>                 <span class="hljs-number">4</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Writeback:</span>             <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">AnonPages:</span>         <span class="hljs-number">29968</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Mapped:</span>            <span class="hljs-number">21552</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Shmem:</span>              <span class="hljs-number">7840 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">Slab:</span>              <span class="hljs-number">39224</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">SReclaimable:</span>      <span class="hljs-number">15916</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">SUnreclaim:</span>        <span class="hljs-number">23308</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">KernelStack:</span>        <span class="hljs-number">3824 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">PageTables:</span>         <span class="hljs-number">3588 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">NFS_Unstable:</span>          <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Bounce:</span>                <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">WritebackTmp:</span>          <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">CommitLimit:</span>     <span class="hljs-number">2594984</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Committed_AS:</span>     <span class="hljs-number">232484</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">VmallocTotal:</span>   <span class="hljs-number">34359738367</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">VmallocUsed:</span>      <span class="hljs-number">177448</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">VmallocChunk:</span>   <span class="hljs-number">34359310332</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">Percpu:</span>            <span class="hljs-number">22528</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">HardwareCorrupted:</span>     <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">AnonHugePages:</span>      <span class="hljs-number">8192 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">CmaTotal:</span>              <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">CmaFree:</span>               <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">HugePages_Total:</span>       <span class="hljs-number">0</span><br><span class="hljs-attr">HugePages_Free:</span>        <span class="hljs-number">0</span><br><span class="hljs-attr">HugePages_Rsvd:</span>        <span class="hljs-number">0</span><br><span class="hljs-attr">HugePages_Surp:</span>        <span class="hljs-number">0</span><br><span class="hljs-attr">Hugepagesize:</span>       <span class="hljs-number">2048 </span><span class="hljs-string">kB</span><br><span class="hljs-attr">DirectMap4k:</span>       <span class="hljs-number">67456</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">DirectMap2M:</span>      <span class="hljs-number">980992</span> <span class="hljs-string">kB</span><br><span class="hljs-attr">DirectMap1G:</span>           <span class="hljs-number">0</span> <span class="hljs-string">kB</span><br></code></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-punctuation">[</span><span class="hljs-variable">root</span><span class="hljs-operator">@</span><span class="hljs-variable">node1</span> <span class="hljs-operator">~</span><span class="hljs-punctuation">]</span><span class="hljs-type">#</span> <span class="hljs-variable">dmidecode</span> <span class="hljs-operator">-</span><span class="hljs-variable">t</span> <span class="hljs-variable">memory</span><span class="hljs-operator">|</span><span class="hljs-variable">grep</span> <span class="hljs-operator">-</span><span class="hljs-variable">i</span> <span class="hljs-variable">size</span><br><span class="hljs-variable">Maximum</span> <span class="hljs-variable">Memory</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-number">32768</span> <span class="hljs-variable">MB</span><br><span class="hljs-variable">Maximum</span> <span class="hljs-built_in">Total</span> <span class="hljs-variable">Memory</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-number">491520</span> <span class="hljs-variable">MB</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-number">1024</span> <span class="hljs-variable">MB</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Single</span><span class="hljs-operator">-</span><span class="hljs-variable">bank</span> <span class="hljs-variable">Connection</span><span class="hljs-punctuation">)</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-number">1024</span> <span class="hljs-variable">MB</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Single</span><span class="hljs-operator">-</span><span class="hljs-variable">bank</span> <span class="hljs-variable">Connection</span><span class="hljs-punctuation">)</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Installed</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-built_in">Enabled</span> <span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Not</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-number">1024</span> <span class="hljs-variable">MB</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br><span class="hljs-variable">Size</span><span class="hljs-operator">:</span> <span class="hljs-variable">No</span> <span class="hljs-built_in">Module</span> <span class="hljs-variable">Installed</span><br></code></pre></td></tr></table></figure><h4 id="范例：内存故障"><a href="#范例：内存故障" class="headerlink" title="范例：内存故障"></a>范例：内存故障</h4><p>2019-12-25，央视西区20套高清备播出服务器，多个频道出现播出异常，视频服务器MSV-G的播出应用日志显示内存异常，在对应的uml-e存储使用命令查看内存，发现有一跟内存出现故障，不被系统所识别了，最终更换硬件得以解决。</p><p>dmidecode -t memory|grep Size   （正常是三根内存，每根4G） </p><p><img src="1655632709294.png" alt="1655632709294"></p><h3 id="查看硬盘和分区情况"><a href="#查看硬盘和分区情况" class="headerlink" title="查看硬盘和分区情况"></a>查看硬盘和分区情况</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@node1 ~]<span class="hljs-comment"># ll /dev/sd*</span><br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 0 </span>Jun<span class="hljs-number"> 19 </span>04:25 /dev/sda<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 1 </span>Jun<span class="hljs-number"> 19 </span>04:25 /dev/sda1<br>brw-rw----<span class="hljs-number"> 1 </span>root disk 8,<span class="hljs-number"> 2 </span>Jun<span class="hljs-number"> 19 </span>04:25 /dev/sda2<br><br>[root@node1 ~]<span class="hljs-comment"># df -h</span><br>Filesystem               Size  Used Avail Use% Mounted on<br>devtmpfs                 475M    <span class="hljs-number"> 0 </span> 475M   0% /dev<br>tmpfs                    487M    <span class="hljs-number"> 0 </span> 487M   0% /dev/shm<br>tmpfs                    487M  7.7M  479M   2% /run<br>tmpfs                    487M    <span class="hljs-number"> 0 </span> 487M   0% /sys/fs/cgroup<br>/dev/mapper/centos-root   17G  1.3G   16G   8% /<br>/dev/sda1               1014M  138M  877M  14% /boot<br>tmpfs                     98M    <span class="hljs-number"> 0 </span>  98M   0% /run/user/0<br><br>[root@node1 ~]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               8:0   <span class="hljs-number"> 0 </span>  20G <span class="hljs-number"> 0 </span>disk <br>├─sda1            8:1   <span class="hljs-number"> 0 </span>   1G <span class="hljs-number"> 0 </span>part /boot<br>└─sda2            8:2   <span class="hljs-number"> 0 </span>  19G <span class="hljs-number"> 0 </span>part <br>  ├─centos-root 253:0   <span class="hljs-number"> 0 </span>  17G <span class="hljs-number"> 0 </span>lvm  /<br>  └─centos-swap 253:1   <span class="hljs-number"> 0 </span>   2G <span class="hljs-number"> 0 </span>lvm  [SWAP]<br>sr0              11:0   <span class="hljs-number"> 1 </span> 4.4G <span class="hljs-number"> 0 </span>rom<br><br>[root@node1 ~]<span class="hljs-comment"># cat /proc/partitions </span><br>major minor  <span class="hljs-comment">#blocks  name</span><br><br>  <span class="hljs-number"> 8 </span>      <span class="hljs-number"> 0 </span> <span class="hljs-number"> 20971520 </span>sda<br>  <span class="hljs-number"> 8 </span>      <span class="hljs-number"> 1 </span>  <span class="hljs-number"> 1048576 </span>sda1<br>  <span class="hljs-number"> 8 </span>      <span class="hljs-number"> 2 </span> <span class="hljs-number"> 19921920 </span>sda2<br> <span class="hljs-number"> 11 </span>      <span class="hljs-number"> 0 </span>  <span class="hljs-number"> 4601856 </span>sr0<br><span class="hljs-number"> 253 </span>      <span class="hljs-number"> 0 </span> <span class="hljs-number"> 17821696 </span>dm-0<br><span class="hljs-number"> 253 </span>      <span class="hljs-number"> 1 </span>  <span class="hljs-number"> 2097152 </span>dm-1<br></code></pre></td></tr></table></figure><h4 id="范例-扫描新加的磁盘"><a href="#范例-扫描新加的磁盘" class="headerlink" title="范例: 扫描新加的磁盘"></a>范例: 扫描新加的磁盘</h4><p>增加硬盘后需要扫描后，才能被识别到。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@node1 ~]# ll <span class="hljs-regexp">/dev/</span>sd*<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>, <span class="hljs-number">0</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>, <span class="hljs-number">1</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda1<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>, <span class="hljs-number">2</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda2<br><br>[root@node1 ~]# echo - - - &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host0/scan;<br>[root@node1 ~]# echo - - - &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host1/scan;<br>[root@node1 ~]# echo - - - &gt; <span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/scsi_host/</span>host2/scan;<br><br>[root@node1 ~]# ll <span class="hljs-regexp">/dev/</span>sd*<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>,  <span class="hljs-number">0</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>,  <span class="hljs-number">1</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda1<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>,  <span class="hljs-number">2</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">25</span> <span class="hljs-regexp">/dev/</span>sda2<br>brw-rw---- <span class="hljs-number">1</span> root disk <span class="hljs-number">8</span>, <span class="hljs-number">16</span> Jun <span class="hljs-number">19</span> <span class="hljs-number">06</span>:<span class="hljs-number">13</span> <span class="hljs-regexp">/dev/</span>sdb<br><br>[root@node1 ~]# lsblk<br>NAME            MAJ:MIN RM  <span class="hljs-keyword">SIZE</span> RO TYPE MOUNTPOINT<br>sda               <span class="hljs-number">8</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">20</span>G  <span class="hljs-number">0</span> disk <br>├─sda1            <span class="hljs-number">8</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>G  <span class="hljs-number">0</span> part /boot<br>└─sda2            <span class="hljs-number">8</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span>   <span class="hljs-number">19</span>G  <span class="hljs-number">0</span> part <br>  ├─centos-root <span class="hljs-number">253</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">17</span>G  <span class="hljs-number">0</span> lvm  /<br>  └─centos-swap <span class="hljs-number">253</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">2</span>G  <span class="hljs-number">0</span> lvm  [SWAP]<br>sdb               <span class="hljs-number">8</span>:<span class="hljs-number">16</span>   <span class="hljs-number">0</span>    <span class="hljs-number">2</span>G  <span class="hljs-number">0</span> disk <br>sr0              <span class="hljs-number">11</span>:<span class="hljs-number">0</span>    <span class="hljs-number">1</span>  <span class="hljs-number">4.4</span>G  <span class="hljs-number">0</span> rom<br><br>[root@node1 ~]# df -h<br>Filesystem               <span class="hljs-keyword">Size</span>  Used Avail Use% Mounted on<br>devtmpfs                 <span class="hljs-number">475</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">475</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                    <span class="hljs-number">487</span>M  <span class="hljs-number">7.7</span>M  <span class="hljs-number">479</span>M   <span class="hljs-number">2</span>% /run<br>tmpfs                    <span class="hljs-number">487</span>M     <span class="hljs-number">0</span>  <span class="hljs-number">487</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/m</span>apper<span class="hljs-regexp">/centos-root   17G  1.3G   16G   8% /</span><br><span class="hljs-regexp">/dev/</span>sda1               <span class="hljs-number">1014</span>M  <span class="hljs-number">138</span>M  <span class="hljs-number">877</span>M  <span class="hljs-number">14</span>% /boot<br>tmpfs                     <span class="hljs-number">98</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">98</span>M   <span class="hljs-number">0</span>% <span class="hljs-regexp">/run/u</span>ser/<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第二周作业-2022-6-13</title>
    <link href="/2022/06/18/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-13/"/>
    <url>/2022/06/18/%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-6-13/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容：第七、八、九、十天 。</p><span id="more"></span><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a></p><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p>第七天：</p><p>用户组合权限管理</p><p>1、用户和组配置文件及管理命令</p><p>2、文件权限管理</p><p>3、默认权限和特殊权限</p><p>4、文件特殊属性和FACL</p><p>5、文本编辑之神vim</p><p>6、文本编辑之神vim</p><p>7、文件处理工具</p><p>“第八天：</p><p>文本处理工具和正则表达式</p><p>1、基本正则表达式</p><p>2、基本正则表达式和扩展正则表达式</p><p>3、文本处理三剑客之grep</p><p>4、shell脚本编程基础知识</p><p>5、shell脚本编程基础</p><p>6、shell脚本编程关于变量</p><p>7、shell脚本编程特殊变量和脚本安全</p><p>8、shell脚本编程算数运算”</p><p>“第九天：</p><p>文本处理和shell编程基础</p><p>1、shell脚本编程逻辑运算和条件测试</p><p>2、shell脚本编程条件判断和条件组合</p><p>3、shell脚本编程条件判断if和case</p><p>4、shell脚本编程for循环</p><p>5、文件查找locate和find</p><p>6、文件打包和压缩</p><p>6、文件打包和压缩”    </p><p>“第十天：</p><p>文本处理sed&amp;软件管理</p><p>1、文本处理三剑客之sed的高级用法</p><p>2、软件运行和编译过程及库调用机制</p><p>3、rpm包管理器常用用法</p><p>4、yum实现和配置文件</p><p>5、yum的私有仓库和内核升级</p><p>6、源码编译安装软件</p><p>7、源码编译安装软件实战”    “完成一个shell脚本，脚本的作用。 </p><h1 id="作业："><a href="#作业：" class="headerlink" title="作业："></a>作业：</h1><ol><li>运行脚本可以显示出本机的ip地址</li><li>如果ip地址中有3这个数字，那么就打印出当前的系统时间</li><li>如果ip地址中不含3这个数字，就批量建立用户magedu_00, magedu_01, … magedu_100并且所有用户同属于magedu组</li><li>打印出/etc/passwd这个文件中可以登陆的用户（非/usr/sbin/nologin）</li><li>yum安装nginx服务，并且启动该服务</li><li>一个脚本完成”</li></ol><p>========================================</p><h2 id="1、运行脚本可以显示出本机的ip地址"><a href="#1、运行脚本可以显示出本机的ip地址" class="headerlink" title="1、运行脚本可以显示出本机的ip地址"></a>1、运行脚本可以显示出本机的ip地址</h2><figure class="highlight d"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs d">方法一、<br>[root<span class="hljs-keyword">@node1</span> zuoye]# cat get_ip-<span class="hljs-number">1.</span>sh <br><span class="hljs-meta">#!/bin/bash</span><br>echo This host ip <span class="hljs-keyword">is</span> <span class="hljs-string">&quot;`hostname -I`&quot;</span><br>[root<span class="hljs-keyword">@node1</span> zuoye]# bash get_ip-<span class="hljs-number">1.</span>sh <br>This host ip <span class="hljs-keyword">is</span> <span class="hljs-number">10.0</span><span class="hljs-number">.21</span><span class="hljs-number">.101</span> <span class="hljs-number">10.0</span><span class="hljs-number">.21</span><span class="hljs-number">.5</span> <br><br>方法二、<br>[root<span class="hljs-keyword">@node1</span> zuoye]# cat get_ip-<span class="hljs-number">2.</span>sh <br><span class="hljs-meta">#!/bin/bash</span><br>echo This host ip <span class="hljs-keyword">is</span> <span class="hljs-string">&quot;`ifconfig|grep netmask|tr -s &quot;</span> <span class="hljs-string">&quot;|cut -d &quot;</span> <span class="hljs-string">&quot; -f3|grep -v 127`&quot;</span><br>[root<span class="hljs-keyword">@node1</span> zuoye]# bash get_ip-<span class="hljs-number">2.</span>sh <br>This host ip <span class="hljs-keyword">is</span> <span class="hljs-number">10.0</span><span class="hljs-number">.21</span><span class="hljs-number">.101</span><br><span class="hljs-number">10.0</span><span class="hljs-number">.21</span><span class="hljs-number">.5</span><br></code></pre></td></tr></table></figure><h2 id="2、如果ip地址中有3这个数字，那么就"><a href="#2、如果ip地址中有3这个数字，那么就" class="headerlink" title="2、如果ip地址中有3这个数字，那么就"></a>2、如果ip地址中有3这个数字，那么就</h2><p>打印出当前的系统时间</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs perl">方法一、条件测试 短路与<br>[root@node1 zuoye]<span class="hljs-comment"># cat zuoye2.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |<span class="hljs-keyword">grep</span> <span class="hljs-number">2</span> &gt; <span class="hljs-regexp">/dev/null</span>o;[ <span class="hljs-string">`echo $?`</span> -eq <span class="hljs-number">0</span> ] &amp;&amp; echo <span class="hljs-string">&quot;This host ip has num 2&quot;</span>. &amp;&amp; echo The current <span class="hljs-keyword">time</span> is: <span class="hljs-string">`date`</span>.<br>[root@node1 zuoye]<span class="hljs-comment"># bash zuoye2.sh </span><br>This host ip has num <span class="hljs-number">2</span>.<br>The current <span class="hljs-keyword">time</span> is: Mon Jun <span class="hljs-number">13</span> <span class="hljs-number">20</span>:<span class="hljs-number">31</span>:<span class="hljs-number">49</span> CST <span class="hljs-number">2022</span>.<br>[root@node1 zuoye]<span class="hljs-comment"># vim zuoye2.sh </span><br>[root@node1 zuoye]<span class="hljs-comment"># cat zuoye2.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |<span class="hljs-keyword">grep</span> <span class="hljs-number">3</span> &gt; <span class="hljs-regexp">/dev/null</span>o;[ <span class="hljs-string">`echo $?`</span> -eq <span class="hljs-number">0</span> ] &amp;&amp; echo <span class="hljs-string">&quot;This host ip has num 3&quot;</span>. &amp;&amp; echo The current <span class="hljs-keyword">time</span> is: <span class="hljs-string">`date`</span>.<br>[root@node1 zuoye]<span class="hljs-comment"># bash zuoye2.sh </span><br>[root@node1 zuoye]<span class="hljs-comment"># hostname -I</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">21.101</span> <span class="hljs-number">10.0</span>.<span class="hljs-number">21.5</span> <br>方法二、 <span class="hljs-keyword">if</span> <span class="hljs-keyword">else</span> 条件判断<br>[root@node1 zuoye]<span class="hljs-comment"># cat zuoye22.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |<span class="hljs-keyword">grep</span> <span class="hljs-number">3</span> &gt; <span class="hljs-regexp">/dev/null</span>;<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">`echo $?`</span> -eq <span class="hljs-number">0</span> ]; then <br>echo <span class="hljs-string">&quot;This host ip has num 3&quot;</span>. ;<br>echo The current <span class="hljs-keyword">time</span> is: <span class="hljs-string">`date`</span>.<br><span class="hljs-keyword">else</span> echo <span class="hljs-string">&quot;This host ip does&#x27;t  have num 3&quot;</span>.<br>fi<br>[root@node1 zuoye]<span class="hljs-comment"># bash zuoye22.sh </span><br>This host ip does<span class="hljs-string">&#x27;t  have num 3.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="3、如果ip地址中不含3这个数字，就"><a href="#3、如果ip地址中不含3这个数字，就" class="headerlink" title="3、如果ip地址中不含3这个数字，就"></a>3、如果ip地址中不含3这个数字，就</h2><p>批量建立用户magedu_00, magedu_01, … magedu_100并且所有用户同属于magedu组</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@node1 zuoye]# cat zuoye3.sh <br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |grep 3 &gt; /dev/<span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> [ `echo $?` -eq 0 ]; then <br>echo <span class="hljs-string">&quot;This host ip has num 3&quot;</span>. ;<br>echo The current time is: `date`.<br><span class="hljs-keyword">else</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;00<span class="hljs-built_in">..</span>100&#125; ;<span class="hljs-keyword">do</span><br>useradd -r magedu_<span class="hljs-variable">$i</span> &amp;&amp; usermod -g magedu magedu_<span class="hljs-variable">$i</span>;echo magedu_<span class="hljs-variable">$i</span> is created<br>done<br>fi<br>[root@node1 zuoye]# <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;00<span class="hljs-built_in">..</span>100&#125; ;<span class="hljs-keyword">do</span> userdel -r magedu_<span class="hljs-variable">$i</span>;done<br><br>扩展：如果ip地址中不含3这个数字，就批量创建用户和并设置随机密码<br>[root@node1 zuoye]# cat zuoye3.sh <br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |grep 3 &gt; /dev/<span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> [ `echo $?` -eq 0 ]; then <br>echo <span class="hljs-string">&quot;This host ip has num 3&quot;</span>. ;<br>echo The current time is: `date`.<br><span class="hljs-keyword">else</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;00<span class="hljs-built_in">..</span>100&#125; ;<span class="hljs-keyword">do</span><br>useradd -r magedu_<span class="hljs-variable">$i</span> &amp;&amp; usermod -g magedu magedu_<span class="hljs-variable">$i</span> &amp;&amp; echo magedu_<span class="hljs-variable">$i</span> is created;<br><span class="hljs-attribute">PASS</span>=`cat /dev/urandom | tr -dc <span class="hljs-string">&#x27;[:alnum:]&#x27;</span> |head -c12`<br>echo <span class="hljs-variable">$PASS</span> | passwd --stdin magedu_<span class="hljs-variable">$i</span> &amp;&gt; /dev/<span class="hljs-literal">null</span><br>echo magedu_<span class="hljs-variable">$i</span>:<span class="hljs-variable">$PASS</span> &gt;&gt; ./user.log<br>done<br>fi<br>[root@node1 zuoye]# bash zuoye3.sh <br>magedu_000 is created<br>magedu_001 is created<br>magedu_002 is created<br>magedu_003 is created<br>magedu_004 is created<br>magedu_005 is created<br>magedu_006 is created<br>magedu_007 is created<br>magedu_008 is created<br>magedu_009 is created<br>magedu_010 is created<br>magedu_011 is created<br>magedu_012 is created<br>magedu_013 is created<br>magedu_014 is created<br>magedu_015 is created<br>magedu_016 is created<br>magedu_017 is created<br>magedu_018 is created<br>magedu_019 is created<br>magedu_020 is created<br>magedu_021 is created<br>magedu_022 is created<br>magedu_023 is created<br>magedu_024 is created<br>magedu_025 is created<br>magedu_026 is created<br>magedu_027 is created<br>magedu_028 is created<br>magedu_029 is created<br>magedu_030 is created<br>magedu_031 is created<br>magedu_032 is created<br>magedu_033 is created<br>magedu_034 is created<br>magedu_035 is created<br>magedu_036 is created<br>magedu_037 is created<br>magedu_038 is created<br>magedu_039 is created<br>magedu_040 is created<br>magedu_041 is created<br>magedu_042 is created<br>magedu_043 is created<br>magedu_044 is created<br>magedu_045 is created<br>magedu_046 is created<br>magedu_047 is created<br>magedu_048 is created<br>magedu_049 is created<br>magedu_050 is created<br>magedu_051 is created<br>magedu_052 is created<br>magedu_053 is created<br>magedu_054 is created<br>magedu_055 is created<br>magedu_056 is created<br>magedu_057 is created<br>magedu_058 is created<br>magedu_059 is created<br>magedu_060 is created<br>magedu_061 is created<br>magedu_062 is created<br>magedu_063 is created<br>magedu_064 is created<br>magedu_065 is created<br>magedu_066 is created<br>magedu_067 is created<br>magedu_068 is created<br>magedu_069 is created<br>magedu_070 is created<br>magedu_071 is created<br>magedu_072 is created<br>magedu_073 is created<br>magedu_074 is created<br>magedu_075 is created<br>magedu_076 is created<br>magedu_077 is created<br>magedu_078 is created<br>magedu_079 is created<br>magedu_080 is created<br>magedu_081 is created<br>magedu_082 is created<br>magedu_083 is created<br>magedu_084 is created<br>magedu_085 is created<br>magedu_086 is created<br>magedu_087 is created<br>magedu_088 is created<br>magedu_089 is created<br>magedu_090 is created<br>magedu_091 is created<br>magedu_092 is created<br>magedu_093 is created<br>magedu_094 is created<br>magedu_095 is created<br>magedu_096 is created<br>magedu_097 is created<br>magedu_098 is created<br>magedu_099 is created<br>magedu_100 is created<br><br>[root@node1 zuoye]# cat user.log <br>magedu_000:ngoXZcZtFM28<br>magedu_001:L0JyTPd0bfQM<br>magedu_002:XNfFY36gjYTr<br>magedu_003:vhAhBzDj2oUc<br>magedu_004:TZbScFvMVeiO<br>magedu_005:2TVas8htZXYX<br>magedu_006:EwvIRjNi5Oiv<br>magedu_007:G7AKhtcKWZ8A<br>magedu_008:8DKJdgxk7F4I<br>magedu_009:eHrpn5lE1Wdu<br>magedu_010:QYIs3awovdH0<br>magedu_011:6NBULpqbOtfh<br>magedu_012:fmp6HJH9PbqD<br>magedu_013:wvMKTtLpB5pK<br>magedu_014:AQ80kKi0PQhO<br>magedu_015:YZZtBVPSmYvB<br>magedu_016:gMDOGsaGZ5Hi<br>magedu_017:HtRtRVDMq8zk<br>magedu_018:Rk5KZYfsezYF<br>magedu_019:ENISdlgAJ8Bx<br>magedu_020:UrxbiWXnTHNV<br>magedu_021:b5sYerc257Tz<br>magedu_022:6fTUvHQkreAd<br>magedu_023:IdLcPl0pa289<br>magedu_024:yanXbkz42bhD<br>magedu_025:r9XV4tUg2rK9<br>magedu_026:CaAdmM867Yav<br>magedu_027:VlZfx9VeKrxI<br>magedu_028:7PmFPJ5lvV1S<br>magedu_029:XBNqvpvtrTIJ<br>magedu_030:mmV3EOrJ9nZo<br>magedu_031:N3kfijfz2VYF<br>magedu_032:mCpF5yJQDscj<br>magedu_033:IsMMOIMsQbQk<br>magedu_034:nZlWpj66OW6j<br>magedu_035:e2unqmriketl<br>magedu_036:K3cvboMp7Apc<br>magedu_037:awhlL9WKGuYA<br>magedu_038:4kHsl6g9I8Nf<br>magedu_039:EVFRrQjcB2rh<br>magedu_040:lsEWha9CUmrP<br>magedu_041:Tani9CJPikcq<br>magedu_042:JQVgY82heJES<br>magedu_043:daKcPxEupObm<br>magedu_044:RcB6zH6gHUIk<br>magedu_045:u39G3zx4e4iw<br>magedu_046:VyJEdTWlOuUY<br>magedu_047:j1PvyfvSDwiT<br>magedu_048:xLr772I0pF8k<br>magedu_049:Unw1y7h3czFS<br>magedu_050:v7iBonS9lTA1<br>magedu_051:LNVBMSuKyCXN<br>magedu_052:xbLJvdhOhpmI<br>magedu_053:9uXkizxnZMqY<br>magedu_054:Rik4PPFDV4bE<br>magedu_055:Ub4Wf287dhtD<br>magedu_056:uaxfCGWfZaIB<br>magedu_057:SA9WwUU3eid2<br>magedu_058:qCRMjehD8Wxd<br>magedu_059:EISWlqfMhVos<br>magedu_060:FAGgWhq030RX<br>magedu_061:IKVJtIbbtM1v<br>magedu_062:le3LyfgFTeUH<br>magedu_063:JoPMXG2sC3Yx<br>magedu_064:zq6OQmgbKu1Q<br>magedu_065:Tg5jSP8aSwws<br>magedu_066:IMcqRPLX6gbU<br>magedu_067:owodd8Hlfn9y<br>magedu_068:AyqeltE734bB<br>magedu_069:YKYzVVhLi1Kn<br>magedu_070:Zb7ucYqjH05C<br>magedu_071:Iq2Xv9ZbOr17<br>magedu_072:EPms8IJKckuF<br>magedu_073:uYPxGXkTsWR9<br>magedu_074:mrGNx1FmPyF5<br>magedu_075:LpskRDatHcED<br>magedu_076:GBQErsPTs2Eh<br>magedu_077:PlT8baBRl34y<br>magedu_078:AdvF4QYUc1Rn<br>magedu_079:cIBMz0GdhUiF<br>magedu_080:0uGSu56s9wp7<br>magedu_081:p0GWgd3JdbCn<br>magedu_082:Vc9Op4LsxxkK<br>magedu_083:PEgtUsIyJMNu<br>magedu_084:7yXQdtx1kSeE<br>magedu_085:2am6D3Z3CP7V<br>magedu_086:0todSNhZucUQ<br>magedu_087:L0OUakK8sdzv<br>magedu_088:cMVeSWXBmfh1<br>magedu_089:wTObAQ9X77gt<br>magedu_090:H11hKKvvHJPW<br>magedu_091:7yL3MxwqnD13<br>magedu_092:8opQ0FxBl5qc<br>magedu_093:nm5ZL6qXNL1L<br>magedu_094:25M7LWguHDbi<br>magedu_095:CftnnQIWVwa4<br>magedu_096:3VD7SWp3KnHZ<br>magedu_097:kLBoYEQjkKjQ<br>magedu_098:Rk934H6CLnjG<br>magedu_099:oQkVH3hRANOe<br>magedu_100:KjmazVhViy0q<br>magedu_000:xOwcmfX4iSnw<br>magedu_001:6TUzdeZg0Vf8<br>magedu_002:OE0inG4llrtD<br>magedu_003:aqWyAcbz0AiE<br>magedu_004:ETyyNRYTlnnd<br>magedu_005:jm6OetYLI6FT<br>magedu_006:oWtl0aQNgYbm<br>magedu_007:FcIM7IuMl4uN<br>magedu_008:rH2r6Sqvha6X<br>magedu_009:NttNWNGIraWQ<br>magedu_010:v1faq54KoRD1<br>magedu_011:qr4VtFEmKVHH<br>magedu_012:OCpo47tk8LlR<br>magedu_013:BX5D5YLi9Obu<br>magedu_014:KuRuPCX9G6Mu<br>magedu_015:A630LpGLaQfD<br>magedu_016:7RLykk4RnHXC<br>magedu_017:yHLbbf4uKM8w<br>magedu_018:GUokYv2luIt5<br>magedu_019:fYqGonBESWLo<br>magedu_020:P1agEpkHpLyV<br>magedu_021:zUk95yPNkZ3F<br>magedu_022:5qM5rxiYO5eV<br>magedu_023:gCSNLRau9v4G<br>magedu_024:5MYicxFQLsAs<br>magedu_025:Q7s1t1iuCTSr<br>magedu_026:RQn91tdk9d3E<br>magedu_027:7Mos0fNgAZHo<br>magedu_028:FzEPAQjaH8Lu<br>magedu_029:xenrpOcBgVP3<br>magedu_030:7AwpsFURwk6t<br>magedu_031:vnPhBTV6SRBN<br>magedu_032:9xLN9ZlNFvgZ<br>magedu_033:JGgJAJQzUcEd<br>magedu_034:PaiB1T8Q0z9q<br>magedu_035:qhDolfnKMMUE<br>magedu_036:eQh9mCVg1lFk<br>magedu_037:cbmdYgA3EiqB<br>magedu_038:DXkbdfDrIa91<br>magedu_039:2xPYDZ5T3nv2<br>magedu_040:OibXPx10GPpa<br>magedu_041:ydIKM0173dLq<br>magedu_042:bN7Nft38KjnH<br>magedu_043:oLkqoi5213g8<br>magedu_044:B3UqO2R95juP<br>magedu_045:8uk3H2VsYfVV<br>magedu_046:3kD5ITJmorga<br>magedu_047:MIgEajdqXiQN<br>magedu_048:RJ7EhXeYpWuO<br>magedu_049:Ud9INMFqLI5q<br>magedu_050:wrTXRf93YKfM<br>magedu_051:KDSiRBVpuH29<br>magedu_052:ItSxHs8JXgtv<br>magedu_053:g0LvTFk6lnSM<br>magedu_054:jwvsjoJqBkp1<br>magedu_055:RBAfBbFVkJ6f<br>magedu_056:uWcCNDj7G2QC<br>magedu_057:n8o6nc8ZUvUf<br>magedu_058:yATVaYn87mrF<br>magedu_059:FYHj6l8eu9Ni<br>magedu_060:SXG7DdXijiF3<br>magedu_061:gDq0bNm5tblU<br>magedu_062:glEHGcTKfewO<br>magedu_063:RNZaLQG15s1l<br>magedu_064:OSZZSoyhPDfS<br>magedu_065:5le8x4op8685<br>magedu_066:KWZLwDsXPj96<br>magedu_067:439vJYOXwyyy<br>magedu_068:NtA0qJSDthbV<br>magedu_069:vsslNPmkNq0E<br>magedu_070:7d2JTtvGcBhp<br>magedu_071:xmC2xMC6rKXS<br>magedu_072:SGeJ1uBBw4e3<br>magedu_073:XOxjIOcW4cz5<br>magedu_074:m9uNeYREPXVD<br>magedu_075:k4rlQn3Y4gK0<br>magedu_076:5nrKBgB3vrCa<br>magedu_077:7dqd2g0Id9UP<br>magedu_078:076d1mSBohXu<br>magedu_079:zr2scFxUCjox<br>magedu_080:1u9O9E25poYq<br>magedu_081:zUfruaS6lpbA<br>magedu_082:QwuytWsJNQF2<br>magedu_083:jtM6NpY1HXEQ<br>magedu_084:nWJR8rChNcce<br>magedu_085:8WXneDRlHFtq<br>magedu_086:jjdsEovkCSFS<br>magedu_087:A6mNhLUl7NAT<br>magedu_088:uo7JmWN8xe5E<br>magedu_089:VbVPcBiHrRhd<br>magedu_090:oSKQdfkDBaeb<br>magedu_091:sCRgxjztoBdD<br>magedu_092:ypiUHadyoMbw<br>magedu_093:eG3E79b2Er0k<br>magedu_094:n7Zugt3Q88Fd<br>magedu_095:831Y8M8WUdTk<br>magedu_096:dojC5AAc92fp<br>magedu_097:dA3kYyLphxtj<br>magedu_098:tpkUQBevzbMF<br>magedu_099:VBTnydNaekZP<br>magedu_100:qBWoUA8a6YgF<br><br>[root@node1 ~]# <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;00<span class="hljs-built_in">..</span>100&#125;;<span class="hljs-keyword">do</span> id magedu_<span class="hljs-variable">$i</span>;done<br><span class="hljs-attribute">uid</span>=998(magedu_000) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=997(magedu_001) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=996(magedu_002) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=995(magedu_003) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=994(magedu_004) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=993(magedu_005) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=992(magedu_006) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=991(magedu_007) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=990(magedu_008) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=989(magedu_009) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=988(magedu_010) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=987(magedu_011) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=986(magedu_012) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=985(magedu_013) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=984(magedu_014) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=983(magedu_015) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=982(magedu_016) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=981(magedu_017) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=980(magedu_018) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=979(magedu_019) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=978(magedu_020) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=977(magedu_021) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=976(magedu_022) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=975(magedu_023) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=974(magedu_024) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=973(magedu_025) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=972(magedu_026) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=971(magedu_027) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=970(magedu_028) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=969(magedu_029) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=968(magedu_030) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=967(magedu_031) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=966(magedu_032) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=965(magedu_033) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=964(magedu_034) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=963(magedu_035) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=962(magedu_036) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=961(magedu_037) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=960(magedu_038) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=959(magedu_039) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=958(magedu_040) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=957(magedu_041) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=956(magedu_042) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=955(magedu_043) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=954(magedu_044) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=953(magedu_045) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=952(magedu_046) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=951(magedu_047) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=950(magedu_048) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=949(magedu_049) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=948(magedu_050) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=947(magedu_051) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=946(magedu_052) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=945(magedu_053) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=944(magedu_054) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=943(magedu_055) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=942(magedu_056) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=941(magedu_057) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=940(magedu_058) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=939(magedu_059) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=938(magedu_060) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=937(magedu_061) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=936(magedu_062) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=935(magedu_063) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=934(magedu_064) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=933(magedu_065) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=932(magedu_066) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=931(magedu_067) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=930(magedu_068) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=929(magedu_069) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=928(magedu_070) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=927(magedu_071) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=926(magedu_072) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=925(magedu_073) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=924(magedu_074) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=923(magedu_075) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=922(magedu_076) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=921(magedu_077) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=920(magedu_078) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=919(magedu_079) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=918(magedu_080) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=917(magedu_081) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=916(magedu_082) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=915(magedu_083) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=914(magedu_084) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=913(magedu_085) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=912(magedu_086) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=911(magedu_087) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=910(magedu_088) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=909(magedu_089) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=908(magedu_090) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=907(magedu_091) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=906(magedu_092) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=905(magedu_093) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=904(magedu_094) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=903(magedu_095) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=902(magedu_096) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=901(magedu_097) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=900(magedu_098) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=899(magedu_099) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br><span class="hljs-attribute">uid</span>=898(magedu_100) <span class="hljs-attribute">gid</span>=1002(magedu) <span class="hljs-attribute">groups</span>=1002(magedu)<br></code></pre></td></tr></table></figure><h2 id="4、打印出-etc-passwd这个文件中可以登陆的用户（非-usr-sbin-nologin）"><a href="#4、打印出-etc-passwd这个文件中可以登陆的用户（非-usr-sbin-nologin）" class="headerlink" title="4、打印出/etc/passwd这个文件中可以登陆的用户（非/usr/sbin/nologin）"></a>4、打印出/etc/passwd这个文件中可以登陆的用户（非/usr/sbin/nologin）</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@node1</span> zuoye]<span class="hljs-meta"># user_list=`cat /etc/passwd|grep -v nologin|cut -d <span class="hljs-string">&quot;:&quot;</span> -f1`</span><br>[root<span class="hljs-symbol">@node1</span> zuoye]<span class="hljs-meta"># echo <span class="hljs-string">&quot;可以登录的用户：$user_list&quot;</span>|xargs</span><br>可以登录的用户：root sync <span class="hljs-built_in">shutdown</span> halt user01 user02 magedu_000 magedu_001 magedu_002 magedu_003 magedu_004 magedu_005 magedu_006 magedu_007 magedu_008 magedu_009 magedu_010 magedu_011 magedu_012 magedu_013 magedu_014 magedu_015 magedu_016 magedu_017 magedu_018 magedu_019 magedu_020 magedu_021 magedu_022 magedu_023 magedu_024 magedu_025 magedu_026 magedu_027 magedu_028 magedu_029 magedu_030 magedu_031 magedu_032 magedu_033 magedu_034 magedu_035 magedu_036 magedu_037 magedu_038 magedu_039 magedu_040 magedu_041 magedu_042 magedu_043 magedu_044 magedu_045 magedu_046 magedu_047 magedu_048 magedu_049 magedu_050 magedu_051 magedu_052 magedu_053 magedu_054 magedu_055 magedu_056 magedu_057 magedu_058 magedu_059 magedu_060 magedu_061 magedu_062 magedu_063 magedu_064 magedu_065 magedu_066 magedu_067 magedu_068 magedu_069 magedu_070 magedu_071 magedu_072 magedu_073 magedu_074 magedu_075 magedu_076 magedu_077 magedu_078 magedu_079 magedu_080 magedu_081 magedu_082 magedu_083 magedu_084 magedu_085 magedu_086 magedu_087 magedu_088 magedu_089 magedu_090 magedu_091 magedu_092 magedu_093 magedu_094 magedu_095 magedu_096 magedu_097 magedu_098 magedu_099 magedu_100<br></code></pre></td></tr></table></figure><h2 id="5、yum安装nginx服务，并且启动该服务"><a href="#5、yum安装nginx服务，并且启动该服务" class="headerlink" title="5、yum安装nginx服务，并且启动该服务"></a>5、yum安装nginx服务，并且启动该服务</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs awk">[root@centos7 yum.repos.d]<span class="hljs-comment">#cat nginx.repo </span><br>[nginx-stable]<br>name=nginx stable repo<br>baseurl=http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/</span>centos<span class="hljs-regexp">/$releasever/</span><span class="hljs-variable">$basearch</span>/<br>gpgcheck=<span class="hljs-number">1</span><br>enabled=<span class="hljs-number">1</span><br>gpgkey=https:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/keys/</span>nginx_signing.key<br>module_hotfixes=true<br><br>[nginx-ainline]<br>name=nginx mainline repo<br>baseurl=http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/packages/m</span>ainline<span class="hljs-regexp">/centos/</span><span class="hljs-variable">$releasever</span><span class="hljs-regexp">/$basearch/</span><br>gpgcheck=<span class="hljs-number">1</span><br>enabled=<span class="hljs-number">1</span><br>gpgkey=https:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/keys/</span>nginx_siging.key<br>module_hotfixes=true<br><br>[root@centos7 yum.repos.d]<span class="hljs-comment">#yum list nginx</span><br>Loaded plugins: fastestmirror<br>Loading mirror speeds from cached hostfile<br> * base: mirrors.aliyun.com<br> * extras: mirrors.aliyun.com<br> * updates: mirrors.aliyun.com<br>nginx-ainline                                                                                                                                                | <span class="hljs-number">2.9</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>     <br>nginx-stable                                                                                                                                                 | <span class="hljs-number">2.9</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>     <br>(<span class="hljs-number">1</span><span class="hljs-regexp">/2): nginx-stable/</span><span class="hljs-number">7</span><span class="hljs-regexp">/x86_64/</span>primary_db                                                                                                                      |  <span class="hljs-number">75</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span>     <br>(<span class="hljs-number">2</span><span class="hljs-regexp">/2): nginx-ainline/</span><span class="hljs-number">7</span><span class="hljs-regexp">/x86_64/</span>primary_db                                                                                                                     | <span class="hljs-number">235</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">02</span>     <br>Installed Packages<br>nginx.x86_64                                                                     <span class="hljs-number">1</span>:<span class="hljs-number">1.20</span>.<span class="hljs-number">1</span>-<span class="hljs-number">9</span>.el7                                                                         @epel       <br>Available Packages<br>nginx.x86_64      <br><br>[root@centos7 yum.repos.d]<span class="hljs-comment">#yum install nginx</span><br>[root@centos7 yum.repos.d]<span class="hljs-comment">#rpm -q nginx</span><br>nginx-<span class="hljs-number">1.22</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span>.el7.ngx.x86_64<br>[root@centos7 yum.repos.d]<span class="hljs-comment">#rpm -qi nginx</span><br>Name        : nginx<br>Epoch       : <span class="hljs-number">1</span><br>Version     : <span class="hljs-number">1.22</span>.<span class="hljs-number">0</span><br>Release     : <span class="hljs-number">1</span>.el7.ngx<br>Architecture: x86_64<br>Install Date: Tue <span class="hljs-number">14</span> Jun <span class="hljs-number">2022</span> <span class="hljs-number">09</span>:<span class="hljs-number">57</span>:<span class="hljs-number">59</span> PM CST<br>Group       : System Environment/Daemons<br>Size        : <span class="hljs-number">2913059</span><br>License     : <span class="hljs-number">2</span>-clause BSD-like license<br>Signature   : RSA/SHA256, Tue <span class="hljs-number">24</span> May <span class="hljs-number">2022</span> <span class="hljs-number">11</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span> PM CST, Key ID abf5bd827bd9bf62<br>Source RPM  : nginx-<span class="hljs-number">1.22</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span>.el7.ngx.src.rpm<br>Build Date  : Tue <span class="hljs-number">24</span> May <span class="hljs-number">2022</span> <span class="hljs-number">11</span>:<span class="hljs-number">35</span>:<span class="hljs-number">18</span> PM CST<br>Build Host  : ip-<span class="hljs-number">10</span>-<span class="hljs-number">1</span>-<span class="hljs-number">17</span>-<span class="hljs-number">70</span>.eu-central-<span class="hljs-number">1</span>.compute.internal<br>Relocations : (not relocatable)<br>Vendor      : NGINX Packaging &lt;nginx-packaging@f5.com&gt;<br>URL         : https:<span class="hljs-regexp">//</span>nginx.org/<br>Summary     : High performance web server<br>Description :<br>nginx [engine x] is an HTTP and reverse proxy server, as well as<br>a mail proxy server.<br>[root@centos7 yum.repos.d]<span class="hljs-comment">#rpm -ql nginx</span><br><span class="hljs-regexp">/etc/</span>logrotate.d/nginx<br><span class="hljs-regexp">/etc/</span>nginx<br><span class="hljs-regexp">/etc/</span>nginx/conf.d<br><span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d/</span>default.conf<br><span class="hljs-regexp">/etc/</span>nginx/fastcgi_params<br><span class="hljs-regexp">/etc/</span>nginx/mime.types<br><span class="hljs-regexp">/etc/</span>nginx/modules<br><span class="hljs-regexp">/etc/</span>nginx/nginx.conf<br><span class="hljs-regexp">/etc/</span>nginx/scgi_params<br><span class="hljs-regexp">/etc/</span>nginx/uwsgi_params<br><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/nginx-debug.service<br><span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/nginx.service<br><span class="hljs-regexp">/usr/</span>lib64/nginx<br><span class="hljs-regexp">/usr/</span>lib64<span class="hljs-regexp">/nginx/m</span>odules<br><span class="hljs-regexp">/usr/</span>libexec<span class="hljs-regexp">/initscripts/</span>legacy-actions/nginx<br><span class="hljs-regexp">/usr/</span>libexec<span class="hljs-regexp">/initscripts/</span>legacy-actions<span class="hljs-regexp">/nginx/</span>check-reload<br><span class="hljs-regexp">/usr/</span>libexec<span class="hljs-regexp">/initscripts/</span>legacy-actions<span class="hljs-regexp">/nginx/u</span>pgrade<br><span class="hljs-regexp">/usr/</span>sbin/nginx<br><span class="hljs-regexp">/usr/</span>sbin/nginx-debug<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>nginx-<span class="hljs-number">1.22</span>.<span class="hljs-number">0</span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>nginx-<span class="hljs-number">1.22</span>.<span class="hljs-number">0</span>/COPYRIGHT<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/man/m</span>an8/nginx.<span class="hljs-number">8</span>.gz<br><span class="hljs-regexp">/usr/</span>share/nginx<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html/<span class="hljs-number">50</span>x.html<br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html/index.html<br><span class="hljs-regexp">/var/</span>cache/nginx<br><span class="hljs-regexp">/var/</span>log/nginx<br><br>[root@centos7 yum.repos.d]<span class="hljs-comment">#systemctl start nginx</span><br>[root@centos7 yum.repos.d]<span class="hljs-comment">#systemctl status nginx</span><br>● nginx.service - nginx - high performance web server<br>   Loaded: loaded (<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system/nginx.service; disabled; vendor preset: disabled)<br>   Active: active (running) since Tue <span class="hljs-number">2022</span>-<span class="hljs-number">06</span>-<span class="hljs-number">14</span> <span class="hljs-number">22</span>:<span class="hljs-number">13</span>:<span class="hljs-number">17</span> CST; <span class="hljs-number">2</span>s ago<br>     Docs: http:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/en/</span>docs/<br>  Process: <span class="hljs-number">40232</span> ExecStart=<span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/nginx -c /</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf (code=exited, status=<span class="hljs-number">0</span>/SUCCESS)<br> Main PID: <span class="hljs-number">40233</span> (nginx)<br>    Tasks: <span class="hljs-number">3</span><br>   Memory: <span class="hljs-number">2.1</span>M<br>   CGroup: <span class="hljs-regexp">/system.slice/</span>nginx.service<br>           ├─<span class="hljs-number">40233</span> nginx: master process <span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/nginx -c /</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf<br>           ├─<span class="hljs-number">40234</span> nginx: worker process<br>           └─<span class="hljs-number">40235</span> nginx: worker process<br><br>Jun <span class="hljs-number">14</span> <span class="hljs-number">22</span>:<span class="hljs-number">13</span>:<span class="hljs-number">17</span> centos7.magedu.com systemd[<span class="hljs-number">1</span>]: Starting nginx - high performance web server...<br>Jun <span class="hljs-number">14</span> <span class="hljs-number">22</span>:<span class="hljs-number">13</span>:<span class="hljs-number">17</span> centos7.magedu.com systemd[<span class="hljs-number">1</span>]: Started nginx - high performance web server.<br><br></code></pre></td></tr></table></figure><h2 id="6、一个脚本完成”"><a href="#6、一个脚本完成”" class="headerlink" title="6、一个脚本完成”"></a>6、一个脚本完成”</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@node1 zuoye]<span class="hljs-comment"># cat zuoye44.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>hostname -I |grep 3 &gt; /dev/null;<br><span class="hljs-keyword">if</span> [ `<span class="hljs-built_in">echo</span> $?` -eq 0 ]; <span class="hljs-keyword">then</span> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This host ip has num 3&quot;</span>. ;<br><span class="hljs-built_in">echo</span> The current time is: `<span class="hljs-built_in">date</span>`.<br><span class="hljs-keyword">else</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;00..100&#125; ;<span class="hljs-keyword">do</span><br>useradd -r magedu_<span class="hljs-variable">$i</span> &amp;&amp; usermod -g magedu magedu_<span class="hljs-variable">$i</span> &amp;&amp; <span class="hljs-built_in">echo</span> magedu_<span class="hljs-variable">$i</span> is created;<br>PASS=`<span class="hljs-built_in">cat</span> /dev/urandom | <span class="hljs-built_in">tr</span> -dc <span class="hljs-string">&#x27;[:alnum:]&#x27;</span> |<span class="hljs-built_in">head</span> -c12`<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PASS</span> | passwd --stdin magedu_<span class="hljs-variable">$i</span> &amp;&gt; /dev/null<br><span class="hljs-built_in">echo</span> magedu_<span class="hljs-variable">$i</span>:<span class="hljs-variable">$PASS</span> &gt;&gt; ./user.log<br><span class="hljs-keyword">done</span><br><span class="hljs-keyword">fi</span><br>user_list=`<span class="hljs-built_in">cat</span> /etc/passwd|grep -v nologin|<span class="hljs-built_in">cut</span> -d <span class="hljs-string">&quot;:&quot;</span> -f1`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;可以登录的用户：<span class="hljs-variable">$user_list</span>&quot;</span>|xargs<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第一周作业-2022-5-30</title>
    <link href="/2022/06/18/%E7%AC%AC%E4%B8%80%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-5-30/"/>
    <url>/2022/06/18/%E7%AC%AC%E4%B8%80%E5%91%A8%E4%BD%9C%E4%B8%9A-2022-5-30/</url>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>：报全程班和单就业的小伙伴，本周建议学习内容： 第四、五、六天。</p><p>请同学们完成作业后，将博客作业提交到此链接：<a href="https://www.wjx.top/vj/POHTQOH.aspx">https://www.wjx.top/vj/POHTQOH.aspx</a> </p><span id="more"></span><h1 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容"></a>章节内容</h1><p> 第四天：<br> 计算机基础和Linux安装<br> 1、计算机基础<br> 2、服务器硬件组成<br> 3、操作系统相关技术和Unix历史<br> 4、Linux各种版本的安装<br> 第五天：<br> 计算机基础和帮助<br> 1、Linux远程连接和基本操作<br> 2、Linux的终端和运行命令<br> 3、Linux命令格式<br> 4、Linux常用命令<br> 5、ASCII和Unicode编码及各种符号用法<br> 6、Linux查看帮助用法<br> 7、Linux的目录结构和文件类型<br> 第六天：<br> 文件管理和IO重定向<br> 1、文件路径和文件访问<br> 2、文件通配符<br> 3、文件管理命令<br> 4、文件的删除和节点表结构<br> 5、硬链接和软链接及重定向<br> 6、重定向和管道<br> 7、用户和组管理初步</p><h1 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h1><ol><li>图文并茂解释开源协定的区别？</li><li>安装centos ubuntu系统.</li><li>通过计算机基础和帮助的学习，完成学习ifconfig命令的使用。</li><li>总结linux FHS结构。</li></ol><p>===================================</p><h2 id="问题1、图文并茂解释开源协定的区别？"><a href="#问题1、图文并茂解释开源协定的区别？" class="headerlink" title="问题1、图文并茂解释开源协定的区别？"></a>问题1、图文并茂解释开源协定的区别？</h2><p>开源软件遵循的协定有这些： GPL、BSD、MIT、Mozilla、Apache和LGPL。就自己的理解，说出他们之间的区别和特性。</p><p>1）<strong>GPL</strong>： GNU General Public License </p><p>自由软件基金会：Free Software Foundation </p><p>允许用户任意复制、传递、修改及再发布 </p><p>基于自由软件修改再次发布的软件，仍需遵守GPL。</p><p>GPL协议和BSD, Apache Licence等鼓励代码重用的许可很不一样。GPL的出发点是代码的开源/免费使用和引用/修改/衍生代码的开源/免费使用，但不允许修改后和衍生的代码做为闭源的商业软件发布和销售。这也就是为什么我们能用免费的各种linux，包括商业公司的linux和linux上各种各样的由个人，组织，以及商业软件公司开发的免费软件了。</p><p>2）<strong>LGPL</strong>： Lesser General Public License，LGPL相对于GPL较为宽松，允许不公开全部源代码。</p><p>LGPL允许商业软件通过类库引用(link)方式使用LGPL类库而不需要开源商业软件的代码。这使得采用LGPL协议的开源代码可以被商业软件作为类库引用并发布和销售。</p><p>因此LGPL协议的开源代码很适合作为第三方类库被商业软件引用，但不适合希望以LGPL协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。</p><p><strong>BSD</strong>  是”Berkeley Software Distribution”的缩写，意思是”伯克利软件发行版”。</p><p>是一个给于使用者很大自由的协议。可以自由的使用，修改源代码，也可以将修改后的代码作为开源或者专有软件再发布。 当你发布使用了BSD协议的代码，或则以BSD协议代码为基础做二次开发自己的产品时，需要满足三个条件：</p><ul><li>1． 如果再发布的产品中包含源代码，则在源代码中必须带有原来代码中的BSD协议。</li><li>2． 如果再发布的只是二进制类库/软件，则需要在类库/软件的文档和版权声明中包含原来代码中的BSD协议。</li><li>3． 不可以用开源代码的作者/机构名字和原来产品的名字做市场推广。</li></ul><p>BSD代码鼓励代码共享，但需要尊重代码作者的著作权。BSD由于允许使用者修改和重新发布代码，也允许使用或在BSD代码上开发商业软件发布和销售，因此是对商业集成很友好的协议。而很多的公司企业在选用开源产品的时候都首选BSD协议，因为可以完全控制这些第三方的代码，在必要的时候可以修改或者二次开发。</p><p>4）<strong>MIT</strong>  MIT源自麻省理工学院（Massachusetts Institute of Technology, MIT），又称X11协议。与BSD类似，但是比BSD协议更加宽松，是目前最少限制的协议。这个协议唯一的条件就是在修改后的代码或者发行包包含原作者的许可信息。适用商业软件。使用MIT的软件项目有：jquery、Node.js。</p><p>5）<strong>Mozilla</strong>  MPL (Mozilla Public License 1.1) MPL协议允许免费重发布、免费修改，但要求修改后的代码版权归软件的发起者。这种授权维护了商业软件的利益，它要求基于这种软件的修改无偿贡献版权给该软件。这样，围绕该软件的所有代码的版权都集中在发起开发人的手中。但MPL是允许修改，无偿使用得。MPL软件对链接没有要求。</p><p>6）<strong>Apache</strong> </p><p>Apache License（Apache许可证），是Apache软件基金会发布的一个自由软件许可证。</p><p>Apache Licence是著名的非盈利开源组织Apache采用的协议。该协议和BSD类似，同样鼓励代码共享和最终原作者的著作权，同样允许源代码修改和再发布。但是也需要遵循以下条件：</p><ul><li>需要给代码的用户一份Apache Licence。</li><li>如果修改了代码，需要在被修改的文件中说明。</li><li>在衍生的代码中（修改和有源代码衍生的代码中）需要带有原来代码中的协议，商标，专利声明和其他原来作者规定需要包含的说明。</li><li>如果在发布的产品中包含一个Notice文件，则在Notice文件中需要带有Apache Licence。你可以在Notice中增加自己的许可，但是不可以表现为对Apache Licence构成更改。</li><li>Apache Licence也是对商业应用友好的许可。使用者也可以在需要的时候修改代码来满足并作为开源或商业产品发布/销售。</li></ul><p>使用这个协议的好处是:</p><ul><li>永久权利 一旦被授权，永久拥有。</li><li>全球范围的权利 在一个国家获得授权，适用于所有国家。假如你在美国，许可是从印度授权的，也没有问题。</li><li>授权免费 无版税， 前期、后期均无任何费用。</li><li>授权无排他性 任何人都可以获得授权</li><li>授权不可撤消 一旦获得授权，没有任何人可以取消。比如，你基于该产品代码开发了衍生产品，你不用担心会在某一天被禁止使用该代码</li></ul><p><img src="https://img-blog.csdnimg.cn/7f706e5985a94f77ab492fbb545a5425.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/14a664ecd88e4f4a82b2aa2ca7667b4d.png" alt="img"></p><h2 id="问题2、安装centos-ubuntu系统"><a href="#问题2、安装centos-ubuntu系统" class="headerlink" title="问题2、安装centos ubuntu系统."></a>问题2、安装centos ubuntu系统.</h2><h2 id="问题3、通过计算机基础和帮助的学习，完成学习ifconfig命令的使用。"><a href="#问题3、通过计算机基础和帮助的学习，完成学习ifconfig命令的使用。" class="headerlink" title="问题3、通过计算机基础和帮助的学习，完成学习ifconfig命令的使用。"></a>问题3、通过计算机基础和帮助的学习，完成学习ifconfig命令的使用。</h2><p>最小化安装的centos系统，没有ifconfig命令，需要先安装net-tools-2.0-0.25.20131004git.el7.x86_64。</p><p>[root@node1 ~]# yum provides ifconfig<br> Loaded plugins: fastestmirror<br> Repository cr is listed more than once in the configuration<br> Repository fasttrack is listed more than once in the configuration<br> Loading mirror speeds from cached hostfile<br> extras/7/x86_64/filelists_db                                          | 277 kB  00:00:00<br> mysql-connectors-community/x86_64/filelists_db                        |  35 kB  00:00:00<br> mysql-tools-community/x86_64/filelists_db                             | 325 kB  00:00:00<br> mysql80-community/x86_64/filelists_db                                 | 1.9 MB  00:00:00<br> updates/7/x86_64/filelists_db                                         | 8.7 MB  00:00:01<br> <strong>net-tools-2.0-0.25.20131004git.el7.x86_64</strong> : Basic networking tools<br> Repo        : @base<br> Matched from:<br> Filename    : /usr/sbin/ifconfig</p><p>在linux中我们可以使用ifconfig命令查看网卡配置与网络状态等信息，好比我们在windows中查看网络配置信息ipconfig命令一样。</p><p><strong>ifconfig [interface]</strong></p><p>interface是可选项，不加此选项则显示系统中所有网卡的信息。如果添加此选项，则显示指定网卡的信息。</p><p>[root@node2 ~]#ifconfig<br> ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>         inet 192.168.126.12  netmask 255.255.255.0  broadcast 192.168.126.255<br>         inet6 fe80::20c:29ff:fed7:a24c  prefixlen 64  scopeid 0x20<link><br>         ether 00:0c:29:d7:a2:4c  txqueuelen 1000  (Ethernet)<br>         RX packets 1183  bytes 100770 (98.4 KiB)<br>         RX errors 0  dropped 0  overruns 0  frame 0<br>         TX packets 197  bytes 22103 (21.5 KiB)<br>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p><p>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>         inet 127.0.0.1  netmask 255.0.0.0<br>         inet6 ::1  prefixlen 128  scopeid 0x10<host><br>         loop  txqueuelen 1000  (Local Loopback)<br>         RX packets 0  bytes 0 (0.0 B)<br>         RX errors 0  dropped 0  overruns 0  frame 0<br>         TX packets 0  bytes 0 (0.0 B)<br>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p><p>如上所示，使用ifconfig命令获取到的主要信息有：</p><p>1、主机被检测到的网卡有ens33，UP表示“接口已启用”，RUNNING表示“接口在工作中”，BROADCAST表示“主机支持广播”，MULTICAST表示“主机支持多播”，mtu 1500表示“最大传输单元 1500字节”</p><p><strong>inet 192.168.126.12  netmask 255.255.255.0  broadcast 192.168.126.255</strong></p><p>解释：inet ：网卡的IP地址；netmask ：网络掩码；broadcast ：广播地址。</p><p><strong>ether 00:0c:29:d7:a2:4c  txqueuelen 1000  (Ethernet)</strong></p><p>解释：连接类型：Ethernet (以太网)或者HWaddr (此网卡的硬件mac地址)；txqueuelen (网卡设置的传送队列长度)</p><p>RX packets 1183  bytes 100770 (98.4 KiB)<br> RX errors 0  dropped 0  overruns 0  frame 0</p><p>解释：接收时，正确的数据包数1183；接收的数据量(98.4 KiB）；</p><p> 接收时，产生错误的数据包数为0，丢弃的数据包数为0；overruns 表示接收时，由于速度过快而丢失的数据包数为0；RX frame 表示接收时，发生frame错误而丢失的数据包数为0。</p><p>ifconfig不仅可以查看网卡配置与网络状态，还可以进行网络配置，常见用法如下：</p><p><img src="https://img-blog.csdnimg.cn/2ebb79beb4024757933b1032519eb9fd.png" alt="img"></p><p>注意：用ifconfig命令配置的网卡信息，在网卡重启或者机器重启后，所做的配置就不存在了。如果需要网络配置永久生效，需要修改相应的配置文件。</p><p>使用find命令过滤即可找到对应的网卡配置文件：</p><p>[root@node2 ~]#find /etc/ -name <em>ens33</em><br> /etc/sysconfig/network-scripts/ifcfg-ens33</p><h2 id="问题4、总结linux-FHS结构。"><a href="#问题4、总结linux-FHS结构。" class="headerlink" title="问题4、总结linux FHS结构。"></a>问题4、总结linux FHS结构。</h2><p>linux的文件系统分层结构FileSystem Hierarchy Standdard(简称FHS)。</p><p>定义了在Linux系统中的目录结构和目录内容,即让用户了解到已安装软件通常放置哪个目录下。类似于Windows操作系统中C盘的文件目录,FHS采用树形结构组织文件,定义了系统中每个区域的用途、所需要的最小构成的文件和目录,同时还给出了例外处理和矛盾处理。</p><p>文件系统目录结构：</p><p><img src="https://img-blog.csdnimg.cn/6fb9a2608f1b4268bc757b034024d1c5.png" alt="img"></p><p>文件和目录被组织成一个单根倒置树结构 ；</p><p>文件系统从根目录下开始，用“/”表示；</p><p>常见文件系统的目录功能：</p><p>/boot：存放内核文件(vmlinuz)、引导加载器(bootloader, grub)等引导文件都存放于此目录 </p><p>/bin：所有用户使用的基本命令，OS启动即会用到的程序 </p><p>/sbin：管理类的基本命令，OS启动即会用到的程序 </p><p>/lib：启动时程序依赖的基本共享库文件，以及内核模块文件(/lib/modules) </p><p>/lib64：专用于x86_64系统上的辅助共享库文件存放位置 </p><p>/etc：配置文件目录 </p><p>/home/USERNAME：普通用户家目录 </p><p>/root：管理员的家目录 </p><p>/media：便携式移动设备挂载点 </p><p>/mnt：临时文件系统挂载点 </p><p>/dev：设备文件及特殊文件存储位置 </p><p>b: block device，随机访问 </p><p>c: character device，线性访问 </p><p>/opt：第三方应用程序的安装位置 </p><p>/tmp：临时文件存储位置</p>]]></content>
    
    
    <categories>
      
      <category>作业</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭建个人博客</title>
    <link href="/2022/06/18/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    <url>/2022/06/18/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="前言：完全免费"><a href="#前言：完全免费" class="headerlink" title="前言：完全免费"></a>前言：完全免费</h1><span id="more"></span><ol><li><p>通过<strong>淘宝账号</strong>登陆, <code>codeup.aliyun.com</code>,  免费。</p></li><li><p>登陆 <code>github.com</code> ，注册一个账号，免费。我这里账号是<code>slcnx</code></p></li><li><p>安装windows git,  <a href="https://gitforwindows.org/">https://gitforwindows.org/</a> 下载之后，直接安装。</p><p>需要先验证git, windows 打开 <code>CMD</code> , 输入 <code>git --version</code> <strong>看到</strong>版本号，说明git安装OK</p><p><img src="image-20220513093045210.png" alt="image-20220513093045210"></p></li><li><p>安装windows node,  <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a> 下载之后，直接安装</p><p>需要先验证node, windows 打开 <code>CMD</code> , 输入 <code>node --version</code> <strong>看到</strong>版本号，说明node安装OK</p><p><img src="image-20220513093341959.png" alt="image-20220513093341959"></p></li><li><p>安装vscode, <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a> 下载之后，直接安装</p></li><li><p>安装typora, <a href="https://typora.io/releases/all">https://typora.io/releases/all</a> 下载, 直接安装</p></li></ol><!--more--><h1 id="准备hexo基础模板"><a href="#准备hexo基础模板" class="headerlink" title="准备hexo基础模板"></a>准备hexo基础模板</h1><p>克隆git, 在CMD执行, 以下目录</p><figure class="highlight awk"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs awk">git clone --recurse-submodules https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/slcnx/</span>hexo-template.git blog<br></code></pre></td></tr></table></figure><blockquote><p>不成功多执行几次， 当看到100% 就表示成功了</p></blockquote><p><img src="image-20220513094643815.png" alt="image-20220513094643815"></p><p>现在进入克隆目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> blog<br></code></pre></td></tr></table></figure><p><img src="image-20220513093934096.png" alt="image-20220513093934096"></p><p>克隆子项目<code>git submodule update --init --recursive</code></p><p><img src="image-20220513094748529.png" alt="image-20220513094748529"></p><p>现在安装依赖<code> npm install</code></p><p><img src="image-20220513095055192.png" alt="image-20220513095055192"></p><p>现在在命令行输入 <code>start .</code></p><p><img src="image-20220513093954383.png" alt="image-20220513093954383"></p><p>看到以下界面</p><p><img src="image-20220513094013505.png" alt="image-20220513094013505"></p><h1 id="vscode打开目录-运行服务"><a href="#vscode打开目录-运行服务" class="headerlink" title="vscode打开目录, 运行服务"></a>vscode打开目录, 运行服务</h1><p>回到上一级目录，<code>blog</code>目录, 右键 <strong>通过 Code</strong> 打开</p><p><img src="image-20220513094214889.png" alt="image-20220513094214889"></p><p>进入到以下界面</p><p><img src="image-20220513094228729.png" alt="image-20220513094228729"></p><p>现在安装插件, 并退出vscode程序，之后重新 <code>blog</code>目录, 右键 <strong>通过 Code</strong> 打开</p><p><img src="image-20220513094320097.png" alt="image-20220513094320097"></p><p>现在快捷键 <strong>ctrl + shift + `</strong>  运行  <strong>npx hexo s</strong> </p><p><img src="image-20220513095212339.png" alt="image-20220513095212339"></p><p>访问本地的4000 <a href="http://localhost:4000/">http://localhost:4000/</a></p><p><img src="image-20220513095237808.png" alt="image-20220513095237808"></p><h1 id="github准备"><a href="#github准备" class="headerlink" title="github准备"></a>github准备</h1><h2 id="准备github仓库"><a href="#准备github仓库" class="headerlink" title="准备github仓库"></a>准备github仓库</h2><p>查看自己的账号名 , 我的为 <code>slcnx</code></p><p><img src="image-20220513095332738.png" alt="image-20220513095332738"></p><p>新建仓库  <code>slcnx.github.io</code> 格式是<code>用户名.github.io</code></p><p><img src="image-20220513095640820.png" alt="image-20220513095640820"></p><p><img src="image-20220513095652519.png" alt="image-20220513095652519"></p><h2 id="添加一个测试文件"><a href="#添加一个测试文件" class="headerlink" title="添加一个测试文件"></a>添加一个测试文件</h2><p><img src="image-20220513095752726.png" alt="image-20220513095752726"></p><p>一定要添加<code>index.html</code></p><p><img src="image-20220513095822054.png" alt="image-20220513095822054"></p><p>添加之后，刷新网页，过3分钟的样子，右下角出现 active</p><p><img src="image-20220513095942064.png" alt="image-20220513095942064"></p><p>访问网页 <a href="https://slcnx.github.io/">https://slcnx.github.io</a>  <code>用户名.github.io</code></p><p><img src="image-20220513100016239.png" alt="image-20220513100016239"></p><p>现在表示github.com已经正常</p><h2 id="配置github"><a href="#配置github" class="headerlink" title="配置github"></a>配置github</h2><p><img src="image-20220513100103791.png" alt="image-20220513100103791"></p><p><img src="image-20220513100129679.png" alt="image-20220513100129679"></p><p>现在需要生成一个公钥和密钥<code>ssh-keygen -t rsa -b 4096 -f id_rsa_2048 -P &#39;&#39;</code> 命令一定要对</p><blockquote><p>此处一定要在<code>Linux</code>主机上生成。之后下载 id_rsa_2048 id_rsa_2048.pub 到本地 博客blog目录</p></blockquote><p>vscode中查看公钥，复制公钥</p><p><img src="image-20220513100509093.png" alt="image-20220513100509093"></p><p><img src="image-20220513100606627.png" alt="image-20220513100606627"></p><p>看到以下内容表示OK</p><p><img src="image-20220513100630996.png" alt="image-20220513100630996"></p><h2 id="获取github的ssh地址"><a href="#获取github的ssh地址" class="headerlink" title="获取github的ssh地址"></a>获取github的ssh地址</h2><p><img src="image-20220513100825116.png" alt="image-20220513100825116"> </p><p><code>git@github.com:slcnx/slcnx.github.io.git</code></p><p>有docker的同学可以, 可以运行以下命令验证是否正常。<b style="color: red;">没有docker的同学，就不需要执行以下命令</b></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">docker build <span class="hljs-attr">--build-arg</span> GITHUB=git@github<span class="hljs-selector-class">.com</span>:slcnx/slcnx<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.git</span> <span class="hljs-attr">--build-arg</span> EMAIL=<span class="hljs-string">&#x27;2192383945@qq.com&#x27;</span> <span class="hljs-attr">--build-arg</span> GUSER=<span class="hljs-string">&#x27;songliangcheng&#x27;</span> ./<br></code></pre></td></tr></table></figure><h1 id="codeup准备"><a href="#codeup准备" class="headerlink" title="codeup准备"></a>codeup准备</h1><h2 id="准备codeup仓库"><a href="#准备codeup仓库" class="headerlink" title="准备codeup仓库"></a>准备codeup仓库</h2><p><img src="image-20220513101358650.png" alt="image-20220513101358650"></p><p><img src="image-20220513101431944.png" alt="image-20220513101431944"></p><p>获取https地址 <code>https://codeup.aliyun.com/5f73e5a3728df4b180fab5ca/myblog-2022-05-13.git</code></p><p><img src="image-20220513101457691.png" alt="image-20220513101457691"></p><h2 id="本地推送代码"><a href="#本地推送代码" class="headerlink" title="本地推送代码"></a>本地推送代码</h2><p>先在blog目录中， 即进入CMD中，在blog目录中</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">git</span> <span class="hljs-string">remote</span> <span class="hljs-built_in">set-url</span> <span class="hljs-string">origin</span> <span class="hljs-string">https</span>://<span class="hljs-string">codeup</span>.<span class="hljs-string">aliyun</span>.<span class="hljs-string">com</span>/<span class="hljs-string">5f73e5a3728df4b180fab5ca</span>/<span class="hljs-string">myblog-2022-05-13</span>.<span class="hljs-string">git</span><br></code></pre></td></tr></table></figure><p><img src="image-20220513101730325.png" alt="image-20220513101730325"></p><p>推送代码, 双击push.sh</p><p><img src="image-20220513101816443.png" alt="image-20220513101816443"></p><p>代码仓库, 已经有数据了</p><p><img src="image-20220513101839833.png" alt="image-20220513101839833"></p><h2 id="添加流水线"><a href="#添加流水线" class="headerlink" title="添加流水线"></a>添加流水线</h2><h3 id="进入流水线页面"><a href="#进入流水线页面" class="headerlink" title="进入流水线页面"></a>进入流水线页面</h3><p><img src="image-20220513101902870.png" alt="image-20220513101902870"></p><p><img src="image-20220513101910710.png" alt="image-20220513101910710"></p><p><img src="image-20220513101941108.png" alt="image-20220513101941108"></p><h3 id="配置流水线"><a href="#配置流水线" class="headerlink" title="配置流水线"></a>配置流水线</h3><p>因为代码中有submodule, 就启用</p><p><img src="image-20220513102015626.png" alt="image-20220513102015626"></p><p>定义构建镜像</p><p><img src="image-20220513102242848.png" alt="image-20220513102242848"></p><p><img src="image-20220513102317624.png" alt="image-20220513102317624"></p><p>配置构建参考，<strong>非常关键</strong>, 这里有3个参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">EMAIL       你的QQ邮箱 <br>GUSER       你的用户名，任意<br>GITHUB      这里一定是你上面github创建的仓库的ssh地址，参考4.4获取githubssh地址。我的为 git@github.com:slcnx/slcnx.github.io.git<br></code></pre></td></tr></table></figure><p><img src="image-20220513103303012.png" alt="image-20220513103303012"></p><p>不需要发布所以删除kubernetes</p><p><img src="image-20220513102349111.png" alt="image-20220513102349111"></p><p>保存并运行</p><p><img src="image-20220513102407557.png" alt="image-20220513102407557"></p><h3 id="运行流水线"><a href="#运行流水线" class="headerlink" title="运行流水线"></a>运行流水线</h3><p><img src="image-20220513102417620.png" alt="image-20220513102417620"></p><h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><p><img src="image-20220513102440868.png" alt="image-20220513102440868"></p><p><img src="image-20220513103852668.png" alt="image-20220513103852668"></p><h3 id="查看github-com"><a href="#查看github-com" class="headerlink" title="查看github.com"></a>查看github.com</h3><p><img src="image-20220513103918387.png" alt="image-20220513103918387"></p><h1 id="查看网页"><a href="#查看网页" class="headerlink" title="查看网页"></a>查看网页</h1><p><a href="https://slcnx.github.io/">https://slcnx.github.io/</a></p><p><img src="image-20220513102518346.png" alt="image-20220513102518346"></p><h1 id="写新的文章"><a href="#写新的文章" class="headerlink" title="写新的文章"></a>写新的文章</h1><h2 id="添加文章"><a href="#添加文章" class="headerlink" title="添加文章"></a>添加文章</h2><p>运行<code>addarticle.sh</code>脚本, 写标题  <strong>第3个文章</strong></p><p><img src="image-20220513102558031.png" alt="image-20220513102558031"></p><p>会自动弹出博客编写页面 编写<strong>第3个文章</strong></p><p><img src="image-20220513103034036.png" alt="image-20220513103034036"></p><p><img src="image-20220513103100965.png" alt="image-20220513103100965"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">第3个文章</span><br><span class="hljs-attr">tags:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">linux</span><br><span class="hljs-attr">categories:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">hexo</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-13 10:26:14</span><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment"># 背景</span><br><br><span class="hljs-string">hello</span><br><br><span class="hljs-type">![image</span><span class="hljs-number">-20220513102937310</span><span class="hljs-string">](第3个文章/image-20220513102937310.png)</span><br><br><span class="hljs-string">&lt;!--more--&gt;</span><br></code></pre></td></tr></table></figure><h2 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h2><p>运行push.sh脚本</p><p><img src="image-20220513102729742.png" alt="image-20220513102729742"></p><h2 id="查看网页-1"><a href="#查看网页-1" class="headerlink" title="查看网页"></a>查看网页</h2><p><img src="image-20220513104016387.png" alt="image-20220513104016387"></p><h1 id="自定义网页样式"><a href="#自定义网页样式" class="headerlink" title="自定义网页样式"></a>自定义网页样式</h1>]]></content>
    
    
    <categories>
      
      <category>云计算就业-王晓春</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>免费搞网站-gitpages</title>
    <link href="/2022/05/12/%E5%85%8D%E8%B4%B9%E6%90%9E%E7%BD%91%E7%AB%99-gitpages/"/>
    <url>/2022/05/12/%E5%85%8D%E8%B4%B9%E6%90%9E%E7%BD%91%E7%AB%99-gitpages/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>完全免费的git网站搭建, 参考 <a href="https://blog.csdn.net/yaorongke/article/details/119089190">https://blog.csdn.net/yaorongke/article/details/119089190</a></p><p>实现的目标: 本地写markdown, 推送github即可以看 github.io 域名查看网页。</p><p>实现的工具</p><ul><li><code>nodejs</code>           hexo生成网站</li><li><code>codeup.aliyun.com</code>    保存自己的博客代码</li><li><code>github.com</code>   静态页面展示 </li><li><code>vscode</code>   开发工具</li></ul><span id="more"></span><h1 id="生成静态页面"><a href="#生成静态页面" class="headerlink" title="生成静态页面"></a>生成静态页面</h1><p>参考  <a href="https://blog.csdn.net/yaorongke/article/details/119089190">https://blog.csdn.net/yaorongke/article/details/119089190</a> 确保访问OK</p><p>slcnx.github.io 仓库名</p><p>准备index.html</p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>主页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  hello world<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="20220512214701-16524035403072.png" alt="image-20220512214700115"></p><p><img src="20220512214623.png" alt="image-20220512214617755"></p><h1 id="docker推送github"><a href="#docker推送github" class="headerlink" title="docker推送github"></a>docker推送github</h1><p>新建临时目录，vscode打开, 准备以下文件</p><p>id_rsa_2048 <strong>需要linux生成或xshell生成，不可以自己生成</strong></p><p>id_rsa_2048的公钥加入到以上仓库中</p><p><img src="20220512225649.png" alt="image-20220512225647448"></p><p>Dockerfile</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> node:latest<br><br><br>WORKDIR /data/git <br><br><span class="hljs-built_in">ADD</span> id_rsa_2048 /root/.ssh/<br><span class="hljs-built_in">RUN</span>  chmod 600 /root/.ssh/id_rsa_2048 <br><br><span class="hljs-built_in">ADD</span> . ./<br><br><span class="hljs-comment"># 生成网页</span><br><span class="hljs-comment">#RUN npm run build </span><br><br><br><span class="hljs-comment"># 上传到GIT</span><br><br><span class="hljs-built_in">RUN</span> install -dv /data/page/ &amp;&amp; cp -a index.html /data/page/<br><br><br>WORKDIR /data/page/<br>ENV <span class="hljs-attribute">GIT_SSH_COMMAND</span>=<span class="hljs-string">&#x27;ssh -i /root/.ssh/id_rsa_2048  -o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no&#x27;</span><br><span class="hljs-built_in">RUN</span> git<span class="hljs-built_in"> config </span>--global init.defaultBranch main &amp;&amp; git<span class="hljs-built_in"> config </span>--global user.email <span class="hljs-string">&#x27;2192383945@qq.com&#x27;</span> &amp;&amp; git<span class="hljs-built_in"> config </span>--global user.name <span class="hljs-string">&#x27;songliangcheng&#x27;</span>  &amp;&amp; \<br>    git<span class="hljs-built_in"> config </span>--global pull.rebase <span class="hljs-literal">true</span> &amp;&amp; \<br>    git init &amp;&amp; \<br>    git remote <span class="hljs-built_in">add</span> origin git@github.com:slcnx/slcnx.github.io.git &amp;&amp; git <span class="hljs-built_in">add</span> -A &amp;&amp; git commit -m init &amp;&amp; git push --force origin main <br></code></pre></td></tr></table></figure><p>index.html</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>主页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    cat<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">D:\vscode_projects\myblog&gt;docker build -t <span class="hljs-built_in">test</span> .<br></code></pre></td></tr></table></figure><p><img src="20220512223352.png" alt="image-20220512223351323"></p><h1 id="本地生成hexo仓库"><a href="#本地生成hexo仓库" class="headerlink" title="本地生成hexo仓库"></a>本地生成hexo仓库</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-cli -g<br><br><span class="hljs-comment"># 当前目录为项目根</span><br>hexo init test1blog<br><span class="hljs-built_in">cd</span> test1blog<br><br><span class="hljs-comment"># 内容</span><br>$ <span class="hljs-built_in">ls</span><br>_config.landscape.yml  node_modules/  package-lock.json  <span class="hljs-built_in">source</span>/<br>_config.yml            package.json   scaffolds/         themes/<br></code></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p><img src="20220512224452.png" alt="image-20220512224451207"></p><h2 id="发布到github"><a href="#发布到github" class="headerlink" title="发布到github"></a>发布到github</h2><p>在以上目录 <code>test1blog</code> 中生成以下文件</p><ol><li><p><code>.dockerignore</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">node_modules/<br></code></pre></td></tr></table></figure></li><li><p><code>Dockerfile</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> node:latest<br><br><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /data/git </span><br><br><span class="hljs-keyword">ADD</span><span class="language-bash"> id_rsa_2048 /root/.ssh/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash">  <span class="hljs-built_in">chmod</span> 600 /root/.ssh/id_rsa_2048 </span><br><br><span class="hljs-keyword">ADD</span><span class="language-bash"> . ./</span><br><br><span class="hljs-comment"># 生成网页</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm install &amp;&amp; npm run build </span><br><br><span class="hljs-comment"># 上传到GIT</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> install -dv /data/page/ &amp;&amp; <span class="hljs-built_in">cp</span> -a public /data/page/</span><br><br><span class="hljs-keyword">ARG</span> GITHUB<br><span class="hljs-keyword">ARG</span> GUSER <br><span class="hljs-keyword">ARG</span> EMAIL <br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /data/page/public/</span><br><span class="hljs-keyword">ENV</span> GIT_SSH_COMMAND=<span class="hljs-string">&#x27;ssh -i /root/.ssh/id_rsa_2048  -o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no&#x27;</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> git config --global init.defaultBranch main &amp;&amp; git config --global user.email <span class="hljs-variable">$EMAIL</span>  &amp;&amp; git config --global user.name <span class="hljs-variable">$GUSER</span>  &amp;&amp; \</span><br><span class="language-bash">    git config --global pull.rebase <span class="hljs-literal">true</span> &amp;&amp; \</span><br><span class="language-bash">    git init &amp;&amp; \</span><br><span class="language-bash">    git remote add origin <span class="hljs-variable">$GITHUB</span> &amp;&amp; git add -A &amp;&amp; git commit -m init &amp;&amp; git push --force origin main </span><br></code></pre></td></tr></table></figure></li><li><p><code>id_rsa_2048</code> 以上与github互通的密钥</p></li><li><p>发布</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">docker build <span class="hljs-attr">--build-arg</span> GITHUB=git@github<span class="hljs-selector-class">.com</span>:slcnx/slcnx<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.git</span> <span class="hljs-attr">--build-arg</span> EMAIL=<span class="hljs-string">&#x27;2192383945@qq.com&#x27;</span> <span class="hljs-attr">--build-arg</span> GUSER=<span class="hljs-string">&#x27;songliangcheng&#x27;</span> ./<br></code></pre></td></tr></table></figure></li></ol><p><img src="20220512225143.png" alt="image-20220512225141348"></p><h1 id="codeup一键发布"><a href="#codeup一键发布" class="headerlink" title="codeup一键发布"></a>codeup一键发布</h1><h2 id="添加codeup仓库"><a href="#添加codeup仓库" class="headerlink" title="添加codeup仓库"></a>添加codeup仓库</h2><p>将当前仓库加入到自己的codeup中</p><p><img src="20220512230442.png" alt="image-20220512230441057"></p><p>复制https地址 <a href="https://codeup.aliyun.com/5f73e5a3728df4b180fab5ca/myblog-2022-05-12.git">https://codeup.aliyun.com/5f73e5a3728df4b180fab5ca/myblog-2022-05-12.git</a></p><h2 id="初始化代码"><a href="#初始化代码" class="headerlink" title="初始化代码"></a>初始化代码</h2><p>将上面test1blog中，初始化，添加代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global init.defaultBranch main<br>git init<br>git remote add origin https://codeup.aliyun.com/5f73e5a3728df4b180fab5ca/myblog-2022-05-12.git<br></code></pre></td></tr></table></figure><p>添加文件 <code>.gitignore</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Logs</span><br>logs<br>*.<span class="hljs-built_in">log</span><br>npm-debug.log*<br>yarn-debug.log*<br>yarn-error.log*<br>lerna-debug.log*<br>.pnpm-debug.log*<br><br><span class="hljs-comment"># Diagnostic reports (https://nodejs.org/api/report.html)</span><br>report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json<br><br><span class="hljs-comment"># Runtime data</span><br>pids<br>*.pid<br>*.seed<br>*.pid.lock<br><br><span class="hljs-comment"># Directory for instrumented libs generated by jscoverage/JSCover</span><br>lib-cov<br><br><span class="hljs-comment"># Coverage directory used by tools like istanbul</span><br>coverage<br>*.lcov<br><br><span class="hljs-comment"># nyc test coverage</span><br>.nyc_output<br><br><span class="hljs-comment"># Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)</span><br>.grunt<br><br><span class="hljs-comment"># Bower dependency directory (https://bower.io/)</span><br>bower_components<br><br><span class="hljs-comment"># node-waf configuration</span><br>.lock-wscript<br><br><span class="hljs-comment"># Compiled binary addons (https://nodejs.org/api/addons.html)</span><br>build/Release<br><br><span class="hljs-comment"># Dependency directories</span><br>node_modules/<br>jspm_packages/<br><br><span class="hljs-comment"># Snowpack dependency directory (https://snowpack.dev/)</span><br>web_modules/<br><br><span class="hljs-comment"># TypeScript cache</span><br>*.tsbuildinfo<br><br><span class="hljs-comment"># Optional npm cache directory</span><br>.npm<br><br><span class="hljs-comment"># Optional eslint cache</span><br>.eslintcache<br><br><span class="hljs-comment"># Optional stylelint cache</span><br>.stylelintcache<br><br><span class="hljs-comment"># Microbundle cache</span><br>.rpt2_cache/<br>.rts2_cache_cjs/<br>.rts2_cache_es/<br>.rts2_cache_umd/<br><br><span class="hljs-comment"># Optional REPL history</span><br>.node_repl_history<br><br><span class="hljs-comment"># Output of &#x27;npm pack&#x27;</span><br>*.tgz<br><br><span class="hljs-comment"># Yarn Integrity file</span><br>.yarn-integrity<br><br><span class="hljs-comment"># dotenv environment variable files</span><br>.<span class="hljs-built_in">env</span><br>.env.development.local<br>.env.test.local<br>.env.production.local<br>.env.local<br><br><span class="hljs-comment"># parcel-bundler cache (https://parceljs.org/)</span><br>.cache<br>.parcel-cache<br><br><span class="hljs-comment"># Next.js build output</span><br>.next<br>out<br><br><span class="hljs-comment"># Nuxt.js build / generate output</span><br>.nuxt<br>dist<br><br><span class="hljs-comment"># Gatsby files</span><br>.cache/<br><span class="hljs-comment"># Comment in the public line in if your project uses Gatsby and not Next.js</span><br><span class="hljs-comment"># https://nextjs.org/blog/next-9-1#public-directory-support</span><br><span class="hljs-comment"># public</span><br><br><span class="hljs-comment"># vuepress build output</span><br>.vuepress/dist<br><br><span class="hljs-comment"># vuepress v2.x temp and cache directory</span><br>.temp<br>.cache<br><br><span class="hljs-comment"># Docusaurus cache and generated files</span><br>.docusaurus<br><br><span class="hljs-comment"># Serverless directories</span><br>.serverless/<br><br><span class="hljs-comment"># FuseBox cache</span><br>.fusebox/<br><br><span class="hljs-comment"># DynamoDB Local files</span><br>.dynamodb/<br><br><span class="hljs-comment"># TernJS port file</span><br>.tern-port<br><br><span class="hljs-comment"># Stores VSCode versions used for testing VSCode extensions</span><br>.vscode-test<br><br><span class="hljs-comment"># yarn v2</span><br>.yarn/cache<br>.yarn/unplugged<br>.yarn/build-state.yml<br>.yarn/install-state.gz<br>.pnp.*<br><br><br><span class="hljs-comment"># 静态文件</span><br>public <br></code></pre></td></tr></table></figure><h2 id="推送aliyun"><a href="#推送aliyun" class="headerlink" title="推送aliyun"></a>推送aliyun</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 状态</span><br>$ git status<br>hint: core.useBuiltinFSMonitor will be deprecated soon; use core.fsmonitor instead<br>hint: Disable this message with <span class="hljs-string">&quot;git config advice.useCoreFSMonitorConfig false&quot;</span><br>On branch main<br><br>No commits yet<br><br>Untracked files:<br>  (use <span class="hljs-string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="hljs-keyword">in</span> what will be committed)<br>        .dockerignore<br>        .github/<br>        .gitignore<br>        .npmignore<br>        Dockerfile<br>        _config.landscape.yml<br>        _config.yml<br>        db.json<br>        id_rsa_2048<br>        package-lock.json<br>        package.json<br>        scaffolds/<br>        <span class="hljs-built_in">source</span>/<br>        themes/<br>        <br><span class="hljs-comment"># 生成标志</span><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;1111&#x27;</span> &gt;&gt; <span class="hljs-built_in">source</span>/_posts/hello-world.md<br><br><span class="hljs-comment"># 推送</span><br>git add . <br>git commit -m init<br><br>$ git push origin main<br>Enumerating objects: 122, <span class="hljs-keyword">done</span>.<br>Counting objects: 100% (122/122), <span class="hljs-keyword">done</span>.<br>Delta compression using up to 8 threads<br>Compressing objects: 100% (110/110), <span class="hljs-keyword">done</span>.<br>Writing objects: 100% (122/122), 580.00 KiB | 7.34 MiB/s, <span class="hljs-keyword">done</span>.<br>Total 122 (delta 0), reused 0 (delta 0), pack-reused 0<br>To https://codeup.aliyun.com/5f73e5a3728df4b180fab5ca/myblog-2022-05-12.git<br> * [new branch]      main -&gt; main<br><br></code></pre></td></tr></table></figure><h2 id="aliyun验证"><a href="#aliyun验证" class="headerlink" title="aliyun验证"></a>aliyun验证</h2><p><img src="20220512231059.png" alt="image-20220512231058218"></p><h2 id="添加流水线"><a href="#添加流水线" class="headerlink" title="添加流水线"></a>添加流水线</h2><p><img src="20220512231120.png" alt="image-20220512231118465"></p><p><img src="20220512231146.png" alt="image-20220512231145367"></p><p><img src="20220513000840.png" alt="image-20220513000838863"></p><p><img src="20220512231255.png" alt="image-20220512231253578"></p><p><img src="20220512231628.png" alt="image-20220512231626849"></p><p>删除kubernetes发布</p><p>保存并运行</p><p><img src="20220512231324.png" alt="image-20220512231322519"></p><h2 id="查看运行日志"><a href="#查看运行日志" class="headerlink" title="查看运行日志"></a>查看运行日志</h2><p><img src="20220512232021.png" alt="image-20220512232019242"></p><h2 id="查看github进度"><a href="#查看github进度" class="headerlink" title="查看github进度"></a>查看github进度</h2><p><img src="20220512232122.png" alt="image-20220512232121239"></p><h2 id="查看页面"><a href="#查看页面" class="headerlink" title="查看页面"></a>查看页面</h2><p>当进度为</p><p><img src="20220512232141.png" alt="image-20220512232140087"></p><p><img src="20220512232151.png" alt="image-20220512232150142"></p><h1 id="开发方式"><a href="#开发方式" class="headerlink" title="开发方式"></a>开发方式</h1><h2 id="准备vscode"><a href="#准备vscode" class="headerlink" title="准备vscode"></a>准备vscode</h2><p>在vscode中加载 codeup的仓库</p><p>安装插件 typora  <strong>安装后需要重启vscode</strong></p><p><img src="20220512231737.png" alt="image-20220512231735959"></p><h2 id="本地开发"><a href="#本地开发" class="headerlink" title="本地开发"></a>本地开发</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># clone 代码</span><br><br><span class="hljs-comment"># 安装依赖</span><br>npm install<br><br><span class="hljs-comment"># 运行服务</span><br>npx hexo server<br></code></pre></td></tr></table></figure><blockquote><p><code>npx command</code> 相当于加载了<code>$(npm bin)</code> 目录到环境变量, 后面的命令可以执行</p></blockquote><p>通过本地调试出合理的界面, 推送aliyun, 就可以一键发布</p><h2 id="本地添加文章"><a href="#本地添加文章" class="headerlink" title="本地添加文章"></a>本地添加文章</h2><p>脚本 <code>addarticle.sh</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">echo -ne <span class="hljs-string">&quot;Enter a \033[1;31mtitle\033[0m for your blog: &quot;</span>; read title<br>[ $? -ne <span class="hljs-number">0</span> ] &amp;&amp; echo <span class="hljs-string">&#x27;exit&#x27;</span> &amp;&amp; sleep <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>[ -z <span class="hljs-string">&quot;$title&quot;</span> ] &amp;&amp; echo title must be exists. &amp;&amp; sleep <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>npx hexo new <span class="hljs-string">&quot;$title&quot;</span><br><br>start $(readlink -f .)<span class="hljs-regexp">/source/</span>_posts<br></code></pre></td></tr></table></figure><p>生成文章, 运行脚本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">第1个文章</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-12 23:27:58</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h2 id="个性化页面展示"><a href="#个性化页面展示" class="headerlink" title="个性化页面展示"></a>个性化页面展示</h2><p><a href="https://blog.csdn.net/yaorongke/article/details/119089190">https://blog.csdn.net/yaorongke/article/details/119089190</a></p><ul><li><code>hexo站点配置</code></li><li><code>fluid</code>主题配置</li><li><code>阅读量</code></li><li><code>评论功能</code></li></ul><p>例如修改标题 <code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">&quot;5-12 23:30&quot;</span><br><span class="hljs-comment"># ...</span><br><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 处理typora相对路径</span><br>npm install hexo-typora-asset --registry https://registry.npmjs.org --save<br></code></pre></td></tr></table></figure><p>typora中的配置</p><p><img src="image-20220513092438970.png" alt="image-20220513092438970"></p><p>重启 <code>npx hexo server</code></p><p><img src="20220512233119.png" alt="image-20220512233117729"></p><h2 id="文章默认页面-可选"><a href="#文章默认页面-可选" class="headerlink" title="文章默认页面(可选)"></a>文章默认页面(可选)</h2><p><a href="https://hexo.io/docs/writing#Scaffolds">https://hexo.io/docs/writing#Scaffolds</a></p><p>当我们写大量的文章,发现主页不应该显示所有内容,需要readmore, readmore之前有1小段简介</p><p>如下, 上面的nginx文章会<code>显示标题,简介,readmore</code>, 而下面的hello world就显示所有, 这两者区别在于</p><p>后者,默认</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">第1个文章</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-12 23:27:58</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>前者</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">第1个文章</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2022-05-12 23:27:58</span><br><span class="hljs-attr">tags:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">hello</span><br><span class="hljs-attr">categories:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">nginx</span><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-comment"># 背景</span><br><br><span class="hljs-string">这篇讲解如何编译安装nginx,</span> <span class="hljs-string">优化nginx</span><br><br><span class="hljs-string">&lt;!--more--&gt;</span><br></code></pre></td></tr></table></figure><p><img src="20220512234116.png" alt="image-20220512234114962"></p><p>要实现每个文章创建均生成nginx这样的模板, 编辑 <code>scaffolds/post.md</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> &#123;&#123; <span class="hljs-string">title</span> &#125;&#125;<br><span class="hljs-attr">date:</span> &#123;&#123; <span class="hljs-string">date</span> &#125;&#125;<br><span class="hljs-attr">tags:</span><br><span class="hljs-bullet">-</span> <br><span class="hljs-attr">categories:</span><br><span class="hljs-bullet">-</span> <br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment"># 背景</span><br><br><span class="hljs-string">&lt;!--more--&gt;</span><br></code></pre></td></tr></table></figure><p>现在运行脚本 <code>addarticle.sh</code> 添加<strong>第2个文章</strong></p><p>网页已经达到效果</p><p><img src="20220512234553.png" alt="image-20220512234551537"></p><h2 id="准备一个主题-fluid"><a href="#准备一个主题-fluid" class="headerlink" title="准备一个主题 fluid"></a>准备一个主题 fluid</h2><blockquote><p>使用此主题后, 不需要前面的文章默认页面, 每个页面不需要加<code>&lt;!--more--&gt;</code> 主题会自动抽取前多少个字符,作为描述的.</p></blockquote><p>Fluid主题 <a href="https://blog.csdn.net/yaorongke/article/details/119089190">https://blog.csdn.net/yaorongke/article/details/119089190</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ git submodule add https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/fluid-dev/</span>hexo-theme-fluid.git themes/fluid<br></code></pre></td></tr></table></figure><p>编辑 <code>_config.yml</code></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean"># Extensions<br>## Plugins: https:<span class="hljs-comment">//hexo.io/plugins/</span><br>## Themes: https:<span class="hljs-comment">//hexo.io/themes/</span><br>theme: fluid<br></code></pre></td></tr></table></figure><p>重启 <code>npx hexo server</code></p><p><img src="20220512235039.png" alt="image-20220512235038001"></p><p>配置主题 <code>fluid</code> 需要准备一个文件 <code>_config.主题名.yml</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp themes<span class="hljs-regexp">/fluid/</span>_config.yml _config.fluid.yml<br></code></pre></td></tr></table></figure><p>测试配置是否生效,修改 <code>_config.fluid.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 首页副标题的独立设置</span><br><span class="hljs-comment"># Independent config of home page subtitle</span><br><span class="hljs-attr">slogan:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 为空则按 hexo config.subtitle 显示</span><br>  <span class="hljs-comment"># If empty, text based on `subtitle` in hexo config</span><br>  <span class="hljs-attr">text:</span> <span class="hljs-string">&quot;Hello 05-12 .... &quot;</span><br></code></pre></td></tr></table></figure><p>重启 <code>npx hexo server</code></p><p><img src="20220512235647.png" alt="image-20220512235645718"></p><h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><p>准备脚本 <code>push.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>git config --<span class="hljs-built_in">local</span> pull.rebase <span class="hljs-literal">true</span><br>git add .<br>git commit -m <span class="hljs-string">&quot;笔记本-`date +%F_%T`&quot;</span><br><br><br>git push origin main<br><br>git pull origin main<br>[ $? -ne 0 ] &amp;&amp; <span class="hljs-built_in">exit</span> -1<br><br>git push origin main<br><br><span class="hljs-comment"># test</span><br>start $(<span class="hljs-built_in">readlink</span> -f .)/source/_posts<br></code></pre></td></tr></table></figure><p><a href="https://slcnx.github.io/">https://slcnx.github.io/</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
